[
  {
    "id": "daily-digest-agent",
    "title": "AI Daily Digest Agent",
    "description": "Aggregates RSS articles, transcripts, and emails into a single Gemini-authored morning digest and sends it to Slack.",
    "problem": "Knowledge workers spend too much time scanning sources each morning; this agent compiles the highlights automatically.",
    "tags": [
      "ai",
      "slack",
      "digest",
      "rss",
      "automation"
    ],
    "metadata": {
      "industries": [
        "media",
        "productivity"
      ],
      "domains": [
        "daily-digest",
        "summaries"
      ],
      "channels": [
        "slack",
        "email"
      ],
      "trigger": "scheduled",
      "complexity": "high",
      "integrations": [
        "RSS Feed",
        "Slack",
        "Gmail",
        "YouTube"
      ]
    },
    "workflow": {
      "name": "My workflow 14",
      "nodes": [
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "cronExpression",
                  "expression": "0 9 * * 1-5"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -760,
            880
          ],
          "id": "546206f6-8979-47c4-b757-f2d15ea6b5e2",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "url": "https://feeds.businessinsider.com/custom/all",
            "options": {}
          },
          "type": "n8n-nodes-base.rssFeedRead",
          "typeVersion": 1.1,
          "position": [
            -220,
            480
          ],
          "id": "89afa486-1373-446a-9ad9-1e2c07440594",
          "name": "business insider"
        },
        {
          "parameters": {
            "url": "http://rss.cnn.com/rss/money_topstories.rss",
            "options": {}
          },
          "type": "n8n-nodes-base.rssFeedRead",
          "typeVersion": 1.1,
          "position": [
            -220,
            320
          ],
          "id": "672b094a-8e74-4c3b-8d31-80cfeaf8a776",
          "name": "cnn"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            0,
            400
          ],
          "id": "e94d4829-f060-4627-9542-1bbe2c327ff5",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fe0167d3-2e87-4b6b-a7b7-3993cafce60e",
                  "name": "title",
                  "value": "={{ $json.title }}",
                  "type": "string"
                },
                {
                  "id": "cd5318c7-c8b8-45a0-b0a1-00afecdc819c",
                  "name": "contentSnippet",
                  "value": "={{ $json.contentSnippet }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            220,
            400
          ],
          "id": "8123245c-c8d3-4582-b09c-973a5033a0e9",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "news",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            440,
            400
          ],
          "id": "ba254ac3-59cd-4eaa-a9c4-2f6170e6b5eb",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Create a summary of the biggest news stories in the last 24 hours.\nMake sure to categorize the news by topics, and list the title and the summary under each category.\n\n<news>\n{{ JSON.stringify($json.news) }}\n</news> \n"
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            660,
            400
          ],
          "id": "844ffb78-1293-46d4-9bf7-331862aa326d",
          "name": "Basic LLM Chain"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            580,
            620
          ],
          "id": "85aaeebd-2359-4a8a-bc30-ae8115deb389",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "9z2BF40dqIRV3ovL",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f1472042-3f7a-4fe3-b4f3-4cb377e5ceb8",
                  "name": "news",
                  "value": "={{ $json.text }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1020,
            400
          ],
          "id": "505f25d0-b63b-4526-835c-9df9db98b6fd",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "content": "# News",
            "height": 620,
            "width": 1720
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -300,
            180
          ],
          "id": "446df485-9389-44a7-b247-fa8e689067fc",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            1960,
            860
          ],
          "id": "ecb7cd9f-4cf7-44eb-ab51-a46b22898a3e",
          "name": "Merge1"
        },
        {
          "parameters": {
            "operation": "5DayForecast",
            "format": "imperial",
            "cityName": "los angeles,us"
          },
          "type": "n8n-nodes-base.openWeatherMap",
          "typeVersion": 1,
          "position": [
            -220,
            1180
          ],
          "id": "1b1b6e34-f0ac-4af2-9d9c-4763cedb9295",
          "name": "OpenWeatherMap",
          "credentials": {
            "openWeatherMapApi": {
              "id": "gTK9YmLWx133jqwn",
              "name": "OpenWeatherMap"
            }
          }
        },
        {
          "parameters": {
            "fieldToSplitOut": "list",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            20,
            1180
          ],
          "id": "04b6ba60-6ee0-445d-99fa-6203c2357c20",
          "name": "Split Out"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "ca2a4f67-c574-47a8-9aeb-3a586140943f",
                  "leftValue": "={{ $now.plus(1, \"days\").toSeconds() > $json.dt }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            240,
            1180
          ],
          "id": "41074405-36a2-4f5a-92cf-ba96645b82ec",
          "name": "Filter"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "weather_forecast",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            460,
            1180
          ],
          "id": "13ffe9ad-c9bc-4682-a12d-e74e91cc108b",
          "name": "Aggregate1"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Summarize the weather forecast for the next 24 hours using the provided forecast data. \nAdd clothing suggestions for a middle aged female who typically wears casual clothing.\nPlease note if she needs to carry an umbrella.\nThe summary should be an overview for the day, don't provide hourly breakdown on the weather changes.\n\n<WeatherForecast>\n{{ JSON.stringify($json.weather_forecast) }}\n</WeatherForecast>"
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            680,
            1180
          ],
          "id": "fc02621c-bd2f-4724-b50c-a4bf321e771c",
          "name": "Basic LLM Chain1"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            640,
            1360
          ],
          "id": "9c90e4ff-688c-418a-92b2-500c9e84b34b",
          "name": "OpenAI Chat Model1",
          "credentials": {
            "openAiApi": {
              "id": "9z2BF40dqIRV3ovL",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0dfe8ddb-2165-43d1-9114-4abffc3ecfbc",
                  "name": "weather_forecast",
                  "value": "={{ $json.text }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1040,
            1180
          ],
          "id": "2b89fe5d-8f0f-4e49-a532-c0b72d455c9a",
          "name": "Edit Fields2"
        },
        {
          "parameters": {
            "content": "# Weather",
            "height": 600,
            "width": 1720
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -300,
            1020
          ],
          "id": "ad6238da-20a8-4311-b996-9e05a883ad63",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "operation": "getAll",
            "simple": false,
            "filters": {
              "labelIds": [
                "CATEGORY_PERSONAL"
              ],
              "readStatus": "unread",
              "receivedAfter": "={{ $now.minus(1, \"day\") }}"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            -140,
            1880
          ],
          "id": "fe170333-dd9d-4992-b417-681b8e8a3443",
          "name": "Gmail",
          "webhookId": "c485b21f-207d-4efb-9e85-566ff2e3de15",
          "credentials": {
            "gmailOAuth2": {
              "id": "E1ofNfqugb4UykcT",
              "name": "Gmail 2rum2room2"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c5d24917-c196-4979-b118-40bedcf0511a",
                  "name": "email",
                  "value": "={{ $json.text }}",
                  "type": "string"
                },
                {
                  "id": "f99c070e-5e12-4b9f-8a46-84cad215c4d5",
                  "name": "from",
                  "value": "={{ $json.from.value }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            80,
            1880
          ],
          "id": "174d3816-15b3-4c5b-8429-e654451690fb",
          "name": "Edit Fields3"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "emails",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            300,
            1880
          ],
          "id": "74d2edad-8d4a-4f7d-acf7-b46523ea8a6c",
          "name": "Aggregate2"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Extract all the emails that were sent by humans and aren't newsletters or system updates or calendar updates and summarize the emails in one sentence for a digest and add who (name + email) sent the email.\n\n<emails>\n{{ $json.emails.map(item => `\\n<email>\\n<from>\\n${JSON.stringify(item.from)}\\n</from>\\n<body>\\n${item.email}\\n</body>\\n</email>\\n`).join('') }}\n</emails>\n",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            520,
            1880
          ],
          "id": "ad4cd02d-d2a4-4c94-9d93-c8d1025d2506",
          "name": "Basic LLM Chain2"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            480,
            2100
          ],
          "id": "0188e119-c4ed-4395-a8f8-cfda2d596aaa",
          "name": "OpenAI Chat Model2",
          "credentials": {
            "openAiApi": {
              "id": "9z2BF40dqIRV3ovL",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "jsonSchemaExample": "{\n\t\"emails\": [\"email 1\", \"email 2\"]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            660,
            2100
          ],
          "id": "dfc30db5-301f-448a-bc20-d80a35cc208d",
          "name": "Structured Output Parser"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "8b795abf-c0d7-42f9-aa3d-f5a4ed47dda1",
                  "name": "emails",
                  "value": "={{ JSON.stringify($json.output.emails) }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            880,
            1880
          ],
          "id": "0e1043d0-71ad-43e7-a1fb-dca55bbac2f4",
          "name": "Edit Fields4"
        },
        {
          "parameters": {
            "content": "# Emails",
            "height": 480,
            "width": 1500
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -300,
            1800
          ],
          "id": "ddab72eb-af03-4153-9d4b-000c51db4aeb",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "operation": "getAll",
            "calendar": {
              "__rl": true,
              "value": "2rum2room2@gmail.com",
              "mode": "list",
              "cachedResultName": "2rum2room2@gmail.com"
            },
            "timeMax": "={{ $now.plus({ days: 1 }) }}",
            "options": {}
          },
          "type": "n8n-nodes-base.googleCalendar",
          "typeVersion": 1.3,
          "position": [
            -180,
            2640
          ],
          "id": "c316f6f7-f205-4759-b27f-358262f71720",
          "name": "Google Calendar"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c2ed0b62-fb10-4d36-a53e-b448f385b93f",
                  "name": "summary",
                  "value": "={{ $json.summary }}",
                  "type": "string"
                },
                {
                  "id": "a224249f-f845-43a2-b50c-805212713481",
                  "name": "startDate",
                  "value": "={{ $json.start.dateTime }}",
                  "type": "string"
                },
                {
                  "id": "60793d7b-ba96-4114-9682-b722d7402f7a",
                  "name": "timezone",
                  "value": "={{ $json.start.timeZone }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            40,
            2640
          ],
          "id": "967aa856-fef4-454c-bbfa-5ebc8d138258",
          "name": "Edit Fields5"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "calendar_events",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            260,
            2640
          ],
          "id": "008d06e6-fe16-42ba-997d-9df9d209293f",
          "name": "Aggregate3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "768d5214-4d37-4b8f-9cbb-e34305e68381",
                  "name": "calendar_events",
                  "value": "={{ JSON.stringify($json.calendar_events) }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            480,
            2640
          ],
          "id": "f7eb428c-c645-492f-b681-e965139a725f",
          "name": "Edit Fields6"
        },
        {
          "parameters": {
            "content": "# Calendar",
            "height": 440,
            "width": 1120
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -300,
            2440
          ],
          "id": "52bd710f-b474-49ac-b93e-78f194cfdcae",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "news"
                },
                {
                  "fieldToAggregate": "weather_forecast"
                },
                {
                  "fieldToAggregate": "emails"
                },
                {
                  "fieldToAggregate": "calendar_events"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            2180,
            880
          ],
          "id": "cae01c8b-d668-4224-a927-ac280773eebd",
          "name": "Aggregate4"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "68158149-a655-4cba-857d-e1b289bd750f",
                  "name": "news",
                  "value": "={{ $json.news[0] }}",
                  "type": "string"
                },
                {
                  "id": "c3d828f7-f9a5-47b4-9e0f-03eea9e4b7bb",
                  "name": "weather_forecast",
                  "value": "={{ $json.weather_forecast[0] }}",
                  "type": "string"
                },
                {
                  "id": "531afbd6-339e-4408-bfc4-7c2daca1a751",
                  "name": "emails",
                  "value": "={{ $json.emails[0] }}",
                  "type": "string"
                },
                {
                  "id": "05bb70c2-ec0a-4b38-a08c-6d5c3bd44d06",
                  "name": "calendar_events",
                  "value": "={{ $json.calendar_events[0] }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2400,
            880
          ],
          "id": "befcca45-1026-48be-abce-776d0bebcac5",
          "name": "Edit Fields7"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=\nCreate a daily digest from the data below.\nUse a personal, light-hearted tone (2nd person). \nUse the `send_daily_digest` tool to send the digest.\n\nThe elements of to include (from the source data)\n1. Weather forecast\n2. News\n3. Emails\n4. Calendar events\n\n<DataSource>\n<News>\n{{ $json.news }}\n</News>\n<WeatherForecast>\n{{ $json.weather_forecast }}\n</WeatherForecast>\n<Emails>\n{{ $json.emails }}\n</Emails>\n<CalendarEvents>\n{{ $json.calendar_events }}\n</CalendarEvents>\n</DataSource>\n\nMake sure to format the email as raw text with proper new lines, separating everything.\nDo not use any markdown - as it will be read on mobile. Don't use any bold, other styling.\n\nExample formating:\n\nHi there,\n\nToday's weather\n- forecast\n- clothing recommendations\n\nUnread emails\n- email 1\n- email 2\n\nToday's events\n- event 1\n- event 2\n\nLatest news\n\nCategory 1\n- news item 1\n\nCategory 2\n- news item 1\n\nHave a great day, Miri!",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.7,
          "position": [
            3080,
            880
          ],
          "id": "a5034448-272b-4321-b78d-7f0fb4744fde",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            3000,
            1120
          ],
          "id": "148eef7a-a645-4967-a72b-887b68835afb",
          "name": "OpenAI Chat Model3",
          "credentials": {
            "openAiApi": {
              "id": "9z2BF40dqIRV3ovL",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "sendTo": "2rum2room2@gmail.com",
            "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
            "emailType": "text",
            "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
            "options": {}
          },
          "type": "n8n-nodes-base.gmailTool",
          "typeVersion": 2.1,
          "position": [
            3240,
            1100
          ],
          "id": "eb93a9ae-996b-43f2-a62c-7faf6350144e",
          "name": "send_digest",
          "webhookId": "162a213b-823b-4420-8c95-05e882822299",
          "credentials": {
            "gmailOAuth2": {
              "id": "E1ofNfqugb4UykcT",
              "name": "Gmail 2rum2room2"
            }
          }
        },
        {
          "parameters": {
            "content": "# Build and send digest",
            "height": 500,
            "width": 640,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            2860,
            780
          ],
          "id": "8c215499-36f2-4903-8099-2d28f537c183",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "content": "# Prepare the data",
            "height": 460,
            "width": 720
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1880,
            720
          ],
          "id": "2e62acc6-e972-4428-bc9f-9fd546fd0fbf",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w2)\n\n## Be part of a growing community and help us create more content like this",
            "height": 220,
            "width": 860,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -300,
            -140
          ],
          "id": "44f740f1-7849-4d41-bf55-57bb89ad4c08",
          "name": "Sticky Note6"
        }
      ],
      "pinData": {},
      "connections": {
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "cnn",
                "type": "main",
                "index": 0
              },
              {
                "node": "business insider",
                "type": "main",
                "index": 0
              },
              {
                "node": "OpenWeatherMap",
                "type": "main",
                "index": 0
              },
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              },
              {
                "node": "Google Calendar",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "cnn": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "business insider": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Basic LLM Chain",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Basic LLM Chain",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenWeatherMap": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Aggregate1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate1": {
          "main": [
            [
              {
                "node": "Basic LLM Chain1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Basic LLM Chain1",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain1": {
          "main": [
            [
              {
                "node": "Edit Fields2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gmail": {
          "main": [
            [
              {
                "node": "Edit Fields3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields3": {
          "main": [
            [
              {
                "node": "Aggregate2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate2": {
          "main": [
            [
              {
                "node": "Basic LLM Chain2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "Basic LLM Chain2",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser": {
          "ai_outputParser": [
            [
              {
                "node": "Basic LLM Chain2",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain2": {
          "main": [
            [
              {
                "node": "Edit Fields4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Calendar": {
          "main": [
            [
              {
                "node": "Edit Fields5",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields5": {
          "main": [
            [
              {
                "node": "Aggregate3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate3": {
          "main": [
            [
              {
                "node": "Edit Fields6",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields2": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Edit Fields4": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Edit Fields6": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "Aggregate4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate4": {
          "main": [
            [
              {
                "node": "Edit Fields7",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields7": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model3": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "send_digest": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "4110066c-8073-4e4d-a127-96077cb46794",
      "meta": {
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "ucEHSGg73IPzhX1n",
      "tags": []
    }
  },
  {
    "id": "job-board-linkedin-leadgen",
    "title": "LinkedIn + Job Board Lead Generation",
    "description": "Scrapes fresh job posts, enriches contacts with Gemini, and populates Airtable/Google Sheets for outreach sequences.",
    "problem": "Manual lead research is slow; this workflow automates sourcing and enrichment for sales and recruiting teams.",
    "tags": [
      "leadgen",
      "linkedin",
      "research",
      "airtable",
      "sales"
    ],
    "metadata": {
      "industries": [
        "sales",
        "recruiting"
      ],
      "domains": [
        "lead-generation",
        "prospecting"
      ],
      "channels": [
        "linkedin",
        "airtable",
        "email"
      ],
      "trigger": "scheduled",
      "complexity": "high",
      "integrations": [
        "LinkedIn",
        "Airtable",
        "Google Sheets",
        "Gemini"
      ]
    },
    "workflow": {
      "name": "My workflow 14",
      "nodes": [
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w6)\n\n## Be part of a growing community and help us create more content like this",
            "height": 220,
            "width": 860,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            4480,
            1280
          ],
          "id": "44f740f1-7849-4d41-bf55-57bb89ad4c08",
          "name": "Sticky Note6"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            4140,
            1860
          ],
          "id": "3cdd4760-f5ab-4e66-b902-098aab9cf457",
          "name": "When clicking â€˜Test workflowâ€™"
        },
        {
          "parameters": {
            "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  if (item.json.area_html) {\n    const parts = item.json.area_html.split('<span class=\"before:middot\"></span>');\n  item.json.area = parts?.[0]?.trim()\n  item.json.followers = parts?.[1]?.trim()\n  }\n}\n\nreturn $input.all();"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            10300,
            1240
          ],
          "id": "6470b14a-eced-44e8-8ce8-a78e60452ef6",
          "name": "Code1"
        },
        {
          "parameters": {
            "fieldToSplitOut": "definitions",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            9020,
            1620
          ],
          "id": "29d398b7-c04d-408f-9451-96e66609f81a",
          "name": "Split Out"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "definitions",
            "extractionValues": {
              "values": [
                {
                  "key": "key",
                  "cssSelector": "dt"
                },
                {
                  "key": "value",
                  "cssSelector": "dd"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            9220,
            1620
          ],
          "id": "ca95ed4e-487c-4f00-9a16-c26b1e90f901",
          "name": "HTML5"
        },
        {
          "parameters": {
            "jsCode": "const data = {};\n// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  let value = item.json.value;\n  const key = item.json.key;\n  if (key === 'Website') {\n    value = value.split('\\n')[0]\n  }\n  data[item.json.key] = value;\n}\n\nreturn {\n  ...data,\n  description: $('Extract about us').first().json.description\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            9480,
            1660
          ],
          "id": "0e40eafd-f182-4d12-b606-cb63e3a919bf",
          "name": "Code2"
        },
        {
          "parameters": {
            "fieldToSplitOut": "employee",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            8980,
            1940
          ],
          "id": "493e4b01-275c-46a4-acd1-3025529c0492",
          "name": "Split Out1"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "employee",
            "extractionValues": {
              "values": [
                {
                  "key": "name",
                  "cssSelector": "h3"
                },
                {
                  "key": "title",
                  "cssSelector": "h4"
                },
                {
                  "key": "linkedin_url",
                  "cssSelector": "a",
                  "returnValue": "attribute",
                  "attribute": "href"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            9360,
            1980
          ],
          "id": "066be7dc-6638-4b21-a36c-64cee647fc2c",
          "name": "HTML7"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "employees",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            9700,
            2000
          ],
          "id": "9d2ca065-1cbb-43a0-b9c7-816b1b56c98b",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "fieldToSplitOut": "article",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            8960,
            2340
          ],
          "id": "1263406e-c2e8-4c6a-814f-d12effe93c8b",
          "name": "Split Out2"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "article",
            "extractionValues": {
              "values": [
                {
                  "key": "link",
                  "cssSelector": ".main-feed-card__overlay-link",
                  "returnValue": "attribute",
                  "attribute": "href"
                },
                {
                  "key": "content",
                  "cssSelector": "[data-test-id=\"main-feed-activity-card__commentary\"]"
                },
                {
                  "key": "reshared_content",
                  "cssSelector": "[data-test-id=\"feed-reshare-content__commentary\"]"
                },
                {
                  "key": "time",
                  "cssSelector": "time",
                  "skipSelectors": "span"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            9240,
            2340
          ],
          "id": "5895154d-b990-41a4-9d31-846fcdd381e8",
          "name": "HTML9"
        },
        {
          "parameters": {
            "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  Object.keys(item.json).forEach(key => {\n    if (!item.json[key]) {\n      delete item.json[key]\n    }\n  })\n  \n  let time;\n  if (item.json.time.endsWith('h')) {\n    time = { hours: parseInt(item.json.time) }\n  }\n  else if (item.json.time.endsWith('d')) {\n    time = { days: parseInt(item.json.time) }\n  } else if (item.json.time.endsWith('w')) {\n    time = { weeks: parseInt(item.json.time) }\n  } else if (item.json.time.endsWith('mo')) {\n    time = { months: parseInt(item.json.time) }\n  }\n\n  if (time) {\n    item.json.posted_at = $now.minus(time).toFormat('yyyy-MM-dd')\n  }\n\n  delete item.json.time\n}\n\nreturn $input.all();"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            9580,
            2340
          ],
          "id": "3a78dcb5-9d83-469f-aa0b-037d9c0980ce",
          "name": "Code3"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "db889fcb-eb49-4c25-aed7-19d00c63c23c",
                  "leftValue": "={{ DateTime.fromISO($json.posted_at).toSeconds() }}",
                  "rightValue": "={{ $now.minus(3, 'months').toSeconds() }}",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            9860,
            2340
          ],
          "id": "841e55a9-1cfc-43d9-a95d-484ad5c9e208",
          "name": "Filter1"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "updates",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            10120,
            2280
          ],
          "id": "921724fa-9163-4937-9fbe-19dce91e3183",
          "name": "Aggregate1"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "products",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            9680,
            2600
          ],
          "id": "fc47956b-638d-4d41-80b6-649ff522948c",
          "name": "Aggregate2"
        },
        {
          "parameters": {
            "fieldToSplitOut": "products",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            9140,
            2980
          ],
          "id": "fd9e24f5-4215-4267-b595-a2945b7d9d12",
          "name": "Split Out3"
        },
        {
          "parameters": {
            "fieldToSplitOut": "affiliate_pages",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            9140,
            3380
          ],
          "id": "1ffa6473-7398-45c7-9401-d33f4339065d",
          "name": "Split Out4"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "affiliate_pages",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            9800,
            3380
          ],
          "id": "0e024675-68ec-437b-9914-236d6720bb41",
          "name": "Aggregate4"
        },
        {
          "parameters": {
            "mode": "combine",
            "combineBy": "combineByPosition",
            "numberInputs": 7,
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            10860,
            2120
          ],
          "id": "67afe935-1673-48d3-883b-12c0a14e58d1",
          "name": "Merge"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            11080,
            2200
          ],
          "id": "5e3f1c59-c03a-425b-a6e9-83f11e1f000a",
          "name": "Aggregate3"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            11960,
            2960
          ],
          "id": "e62e36e3-7af5-40fb-b49a-8de416ab6493",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"company_summary\": {\n            \"type\": \"string\",\n            \"description\": \"The summary of the company information\"\n        },\n        \"why_good_prospect\": {\n            \"type\": \"string\",\n            \"description\": \"Explanation why this company is a good prospect\"\n        }\n    },\n    \"required\": [\n        \"company_summary\",\n        \"why_good_prospect\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            12140,
            2960
          ],
          "id": "b5c9ab7f-5407-4bdd-88a9-de2dc6dc887a",
          "name": "Structured Output Parser"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            5460,
            1860
          ],
          "id": "df05d847-821b-423a-bb99-fd97036d27df",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "maxItems": 2
          },
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            5120,
            1860
          ],
          "id": "5b0cb657-ce72-475d-b7dd-c7eb0f6f0a7c",
          "name": "Limit"
        },
        {
          "parameters": {
            "content": "# Configure",
            "height": 360,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            4460,
            1740
          ],
          "id": "b99a3fb7-ee70-4d15-afc4-15cf72f18211",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "# Change or remove the limit",
            "height": 440,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            5060,
            1660
          ],
          "id": "f7a572db-9054-4888-a8d3-5853eb61fe64",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "baa6e64d-4305-421a-be0a-60cc6d2b06bf",
                  "name": "GOOGLE_API_KEY",
                  "value": "{YOUR_GOOGLE_API_KEY}",
                  "type": "string"
                },
                {
                  "id": "d8e33d4c-b790-488f-a57c-58b80bb5824d",
                  "name": "GOOGLE_CUSTOM_SEARCH",
                  "value": "{YOUR_GOOGLE_CUSTOM_SEARCH_ID}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4520,
            1860
          ],
          "id": "31adb8f4-e7a5-4407-bd7a-eaf2319bd340",
          "name": "Configure"
        },
        {
          "parameters": {
            "url": "https://remotive.com/remote-jobs/feed/marketing",
            "options": {}
          },
          "type": "n8n-nodes-base.rssFeedRead",
          "typeVersion": 1.1,
          "position": [
            4820,
            1860
          ],
          "id": "93a87ee2-a577-4518-9913-0a7393d56d2f",
          "name": "Get job board RSS feed",
          "retryOnFail": true
        },
        {
          "parameters": {
            "url": "={{ $json.link }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            5880,
            1880
          ],
          "id": "3b057b02-4bf2-4e69-9b4a-b491cbcf794b",
          "name": "Scrape the job ad",
          "retryOnFail": true
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "extractionValues": {
              "values": [
                {
                  "key": "info",
                  "cssSelector": ".tw-mt-4.tw-text-sm"
                },
                {
                  "key": "job_ad",
                  "cssSelector": ".tw-flex > section > .tw-mt-8 > .left > div:nth-child(1)"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            6260,
            1880
          ],
          "id": "1ffc69c2-e88b-491f-aa7e-864a1e7d34be",
          "name": "Extract job ad"
        },
        {
          "parameters": {
            "url": "https://www.googleapis.com/customsearch/v1",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "key",
                  "value": "={{ $('Configure').item.json.GOOGLE_API_KEY }}"
                },
                {
                  "name": "cx",
                  "value": "={{ $('Configure').item.json.GOOGLE_CUSTOM_SEARCH }}"
                },
                {
                  "name": "q",
                  "value": "={{ `site:linkedin.com/company ${$('Get job board RSS feed').item.json['dc:creator']} ${$json.location}` }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            5880,
            2380
          ],
          "id": "85ada378-accf-47e3-8013-28ee9be75819",
          "name": "Google X-Ray Search",
          "retryOnFail": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6a5c5157-a1de-46c9-b6fa-c3f999a76d1e",
                  "leftValue": "={{ $json.searchInformation.totalResults.toNumber() }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                },
                {
                  "id": "ec5a091f-e9c1-4ed5-8e0e-af7ddcccf0db",
                  "leftValue": "={{ $json.items[0].link }}",
                  "rightValue": "linkedin.com",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            6100,
            2380
          ],
          "id": "a0ca6256-881a-4a67-94a6-7db31b700c3f",
          "name": "Results?"
        },
        {
          "parameters": {
            "url": "={{ $json.linkedin_url }}",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "user-agent",
                  "value": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36"
                },
                {
                  "name": "referer",
                  "value": "https://www.google.com/"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            6780,
            2360
          ],
          "id": "e826ba65-f572-47cf-a55c-6f24c637004b",
          "name": "Scrape LinkedIn",
          "retryOnFail": true
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "extractionValues": {
              "values": [
                {
                  "key": "about_us",
                  "cssSelector": ".core-section-container[data-test-id=\"about-us\"]",
                  "returnValue": "html"
                },
                {
                  "key": "locations",
                  "cssSelector": ".core-section-container.locations",
                  "returnValue": "html"
                },
                {
                  "key": "employees",
                  "cssSelector": ".core-section-container[data-test-id=\"employees-at\"]",
                  "returnValue": "html"
                },
                {
                  "key": "updates",
                  "cssSelector": ".core-section-container[data-test-id=\"updates\"]",
                  "returnValue": "html"
                },
                {
                  "key": "info",
                  "cssSelector": ".top-card-layout__card .top-card-layout__entity-info:nth-child(1)",
                  "returnValue": "html"
                },
                {
                  "key": "products",
                  "cssSelector": ".core-section-container > .core-section-container__content > .base-card",
                  "returnValue": "html",
                  "returnArray": true
                },
                {
                  "key": "crunchbase",
                  "cssSelector": "a[data-tracking-control-name=\"funding_crunchbase\"]",
                  "returnValue": "attribute",
                  "attribute": "href"
                },
                {
                  "key": "affiliate_pages",
                  "cssSelector": "section[data-test-id=\"affiliated-pages\"] > div > ul > li",
                  "returnValue": "html",
                  "returnArray": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            7240,
            2360
          ],
          "id": "d6a17b1c-f4e2-4740-a273-68c44987adb1",
          "name": "Extract main blocks"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "info",
            "extractionValues": {
              "values": [
                {
                  "key": "name",
                  "cssSelector": "h1"
                },
                {
                  "key": "category",
                  "cssSelector": "h2"
                },
                {
                  "key": "area_html",
                  "cssSelector": "h3",
                  "returnValue": "html"
                },
                {
                  "key": "summary",
                  "cssSelector": "h4"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            8160,
            1240
          ],
          "id": "2efa53f9-0973-42bf-85ef-c5a5f578c6f4",
          "name": "Extract info"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "about_us",
            "extractionValues": {
              "values": [
                {
                  "key": "description",
                  "cssSelector": "p"
                },
                {
                  "key": "definitions",
                  "cssSelector": "dl > div",
                  "returnValue": "html",
                  "returnArray": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            8160,
            1660
          ],
          "id": "7db32e1f-c782-488e-b19a-213aa927bd19",
          "name": "Extract about us"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "employees",
            "extractionValues": {
              "values": [
                {
                  "key": "employee",
                  "cssSelector": "ul li",
                  "returnValue": "html",
                  "returnArray": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            7940,
            1940
          ],
          "id": "4312d3b1-3181-4c35-9039-d197ac3c8e8a",
          "name": "Extract employees"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "locations",
            "extractionValues": {
              "values": [
                {
                  "key": "locations",
                  "cssSelector": "div[id^=\"address-\"]",
                  "returnArray": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            8160,
            1460
          ],
          "id": "314dbac7-7087-4090-8577-409c755e8224",
          "name": "Extract locations"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "updates",
            "extractionValues": {
              "values": [
                {
                  "key": "article",
                  "cssSelector": "div[data-id=\"entire-feed-card-link\"]",
                  "returnValue": "html",
                  "returnArray": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            7920,
            2340
          ],
          "id": "c852a34d-ee21-4e7b-93f1-b0e31ed5963c",
          "name": "Extract updates"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4a990f72-dc16-464c-b35c-1573c38b2d18",
                  "leftValue": "={{ $json.products }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            8240,
            3000
          ],
          "id": "037030e3-220e-4389-841e-8bfd31bdd2bc",
          "name": "Are there products?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4b4a37dd-46e9-46f3-8dc6-1767a75375c2",
                  "leftValue": "={{ $json.affiliate_pages }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            8240,
            3400
          ],
          "id": "feb27d6d-7c3b-46c5-ba09-051c698c425b",
          "name": "Are there affiliated pages?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "2fa0ab4a-ca7c-47ab-90cc-75f8fe83b372",
                  "name": "affiliate_pages",
                  "value": "[]",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            9140,
            3600
          ],
          "id": "e653cc9a-5e37-4465-b910-92a8f9bcd9d1",
          "name": "No affiliated pages"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "6d5b89ba-9161-4999-bf63-8b0dad2d0f86",
                  "name": "products",
                  "value": "=[]",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            9140,
            3160
          ],
          "id": "251bb936-9e9c-4968-8b24-ddbfd9713a9d",
          "name": "No products"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "products",
            "extractionValues": {
              "values": [
                {
                  "key": "name",
                  "cssSelector": "h3",
                  "skipSelectors": "img"
                },
                {
                  "key": "category",
                  "cssSelector": "h4 a"
                },
                {
                  "key": "description",
                  "cssSelector": "p"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            9360,
            2980
          ],
          "id": "1d23d8d8-8c0f-45b0-9fd6-62c8fbec0f9f",
          "name": "Extract products"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "affiliate_pages",
            "extractionValues": {
              "values": [
                {
                  "key": "title",
                  "cssSelector": "h3"
                },
                {
                  "key": "link",
                  "cssSelector": "a",
                  "returnValue": "attribute",
                  "attribute": "href"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            9360,
            3380
          ],
          "id": "b11a5b3d-ec1c-4074-bffe-760403bc08ac",
          "name": "Extract affiliated pages"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=<Instruction>\nOur company sells marketing services. We scraped a list of marketing jobs, and found the linkedin profile and other data points of the advertiser.\n\nCreate a summary about this prospect that can be shared in the company Slack for the sales team.\n\nThe important signals are\n1. The company is looking for a hire, use information from the job ad\n2. The company does have a team that we target\n\nAlso make sure information from their new updates are also extracted.\n\nThe structure of the message should have\n1. Name of the company\n2. Quick summary of the company\n3. Why it's a good prospect\n</Instruction>\n\n<JobAd>\n{{ $('Extract job ad').item.json.job_ad }}\n</JobAd>\n\n<Data>\n{{ JSON.stringify($json.data, null, 2) }}\n</Data>",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.6,
          "position": [
            11960,
            2740
          ],
          "id": "ea814608-ede2-4edc-afa0-cd2cdc94065e",
          "name": "Summarize available data",
          "retryOnFail": true
        },
        {
          "parameters": {
            "sendTo": "2rum2room2@gmail.com",
            "subject": "=New prospect: {{ $('Aggregate3').item.json.data[0].name }}",
            "message": "=<h1>Company name: {{ $('Aggregate3').item.json.data[0].name }}</h1>\n<p>Category: {{ $('Aggregate3').item.json.data[0].category }}</p>\n<p>Linkedin Page: {{ $('Set Linkedin URL from the first result').item.json.linkedin_url }}</p>\n<p>Website: {{ $('Aggregate3').item.json.data[0].Website }}</p>\n{{ $('Extract main blocks').item.json.crunchbase ? `<p>Crunchbase: ${$('Extract main blocks').item.json.crunchbase.split('?')[0]}</p>` : `` }}\n\n<h2>Summary</h2>\n<p>{{ $json.output.company_summary }}</p>\n<h2>Why is it a good prospect</h2>\n<p>{{ $json.output.why_good_prospect }}</p>",
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            12320,
            2740
          ],
          "id": "3eee559b-ccd5-42ef-a5f7-5c11c8adb5d4",
          "name": "Send email",
          "webhookId": "5239298c-8f8b-408b-bc7e-cc36cd3a59e8",
          "credentials": {
            "gmailOAuth2": {
              "id": "E1ofNfqugb4UykcT",
              "name": "Gmail 2rum2room2"
            }
          }
        },
        {
          "parameters": {
            "content": "# Use the data\n\nPush the collected data into\n\n- your CRM\n- Airtable\n- Google Sheets\n- Notion\n- postgres\n- ...",
            "height": 760,
            "width": 660
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            11860,
            2400
          ],
          "id": "86105f1c-32b6-4295-8e3c-4c70542c078a",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# Extracting the data from LinkedIn\n\n## The CSS selectors could occasionally change - don't panic, very easy to fix, just replace them in the workflow. As of 25/4/10 these selectors are working",
            "height": 3040,
            "width": 4460
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            7120,
            940
          ],
          "id": "51a725da-19e9-431c-82af-2f724249a1de",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "content": "# Wait\n\n## To avoid being flagged or detected, wait some seconds before doing another scraping",
            "height": 380,
            "width": 440
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            12440,
            3700
          ],
          "id": "a3032b8d-0947-4e8b-9253-07eb35481ea1",
          "name": "Sticky Note4"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            12600,
            3900
          ],
          "id": "83349d99-0e87-4079-b0b1-d76357edb40d",
          "name": "Wait 5s",
          "webhookId": "0c941134-e324-4857-8e36-2ded681a4b38"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "11f75f95-038e-49c4-b7b3-2eb765ad2d1b",
                  "name": "linkedin_url",
                  "value": "={{ $json.items[0].link }}",
                  "type": "string"
                },
                {
                  "id": "dd80b252-cd03-42f4-be70-069f565d046a",
                  "name": "description",
                  "value": "={{ $json.items[0].pagemap.metatags[0]['og:description'] }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            6340,
            2360
          ],
          "id": "a079755a-cb7e-462b-a2b6-ddc17f936fa9",
          "name": "Set Linkedin URL from the first result"
        },
        {
          "parameters": {
            "jsCode": "for (const item of $input.all()) {\n  const companySlugMatch = item.json.linkedin_url.match(/[^linkedin]+linkedin\\.com\\/company\\/([^\\/]+)/);\n  if (companySlugMatch) {\n    const companySlug = companySlugMatch[1];\n    item.json.linkedin_url = `https://www.linkedin.com/company/${companySlug}`;\n  }\n}\n\nreturn $input.all();"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            6560,
            2360
          ],
          "id": "8de6392c-e763-4448-8a1d-7baab38c77cc",
          "name": "Clean linkedin url"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d5e4966d-3cb0-409f-9878-d227d6515afb",
                  "leftValue": "={{ $json.location }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            5600,
            2380
          ],
          "id": "496fe359-d5d4-4424-b908-42bb20bc8961",
          "name": "If"
        },
        {
          "parameters": {
            "jsCode": "for (const item of $input.all()) {\n  if (item.json.info.includes('Location:')) {\n    const location = item.json.info.split('Location:')[1]\n  item.json.location = location.slice(0, location.length - 1).replace(/\\n/g, '').trim()\n  }\n  \n}\n\nreturn $input.all();"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            6620,
            1880
          ],
          "id": "6d7372cd-74ec-4e03-a8fc-4593acc5d54c",
          "name": "Extract location data1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "8562b688-864d-47a2-9b04-08dffc8040fe",
                  "leftValue": "={{ $json.locations }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            9920,
            1420
          ],
          "id": "4f46887f-61b1-413f-a981-52e9aca2a1e2",
          "name": "If1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "b94e6f5d-bbed-4b6b-b3f1-b23ff2fe5f16",
                  "name": "locations",
                  "value": "=[]",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            10160,
            1500
          ],
          "id": "db28dd8a-5e88-4199-a427-79adea5e9eef",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "17e760be-a45a-43e1-999f-18ac321dcdde",
                  "leftValue": "={{ $json.definitions }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            8620,
            1660
          ],
          "id": "9e915a6f-ace8-4fe0-b3e8-b88aef26ad30",
          "name": "If2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "905a9082-fd1e-4961-acdd-9233a3e15aa0",
                  "name": "description",
                  "value": "={{ $json.description }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            9680,
            1780
          ],
          "id": "cba24601-4566-4448-8762-cfd1122b2ea1",
          "name": "Edit Fields4"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "2313cbcb-a3cc-4bd2-8d02-cad37db9473f",
                  "leftValue": "={{ $json.employees }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            8160,
            1940
          ],
          "id": "7560c1b3-5d2e-4210-a99e-27008b1c6374",
          "name": "If3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3e16c3b2-650c-4a58-b5fd-d138af9775ce",
                  "name": "employees",
                  "value": "=[]",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            9980,
            2120
          ],
          "id": "7aa3e935-e5ec-42db-8193-67f17d5c1f96",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "9839990c-6444-433b-8dd9-42c1b264be1e",
                  "leftValue": "={{ $json.updates }}",
                  "rightValue": "",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            8340,
            2500
          ],
          "id": "c0804a56-f9dd-4f39-b8df-4e8012ca3325",
          "name": "If4"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "98037fb5-6297-4970-810f-626219a27964",
                  "name": "updates",
                  "value": "=[]",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            8900,
            2580
          ],
          "id": "89d0b809-db71-4059-a5a2-b68998c2025b",
          "name": "Edit Fields2"
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Test workflowâ€™": {
          "main": [
            [
              {
                "node": "Configure",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "HTML5",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTML5": {
          "main": [
            [
              {
                "node": "Code2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out1": {
          "main": [
            [
              {
                "node": "HTML7",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTML7": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out2": {
          "main": [
            [
              {
                "node": "HTML9",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTML9": {
          "main": [
            [
              {
                "node": "Code3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code3": {
          "main": [
            [
              {
                "node": "Filter1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter1": {
          "main": [
            [
              {
                "node": "Aggregate1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code2": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Aggregate1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 4
              }
            ]
          ]
        },
        "Split Out3": {
          "main": [
            [
              {
                "node": "Extract products",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate2": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 5
              }
            ]
          ]
        },
        "Split Out4": {
          "main": [
            [
              {
                "node": "Extract affiliated pages",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate4": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 6
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Aggregate3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate3": {
          "main": [
            [
              {
                "node": "Summarize available data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Summarize available data",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser": {
          "ai_outputParser": [
            [
              {
                "node": "Summarize available data",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Scrape the job ad",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Configure": {
          "main": [
            [
              {
                "node": "Get job board RSS feed",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get job board RSS feed": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Scrape the job ad": {
          "main": [
            [
              {
                "node": "Extract job ad",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract job ad": {
          "main": [
            [
              {
                "node": "Extract location data1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google X-Ray Search": {
          "main": [
            [
              {
                "node": "Results?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Results?": {
          "main": [
            [
              {
                "node": "Set Linkedin URL from the first result",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Scrape LinkedIn": {
          "main": [
            [
              {
                "node": "Extract main blocks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract main blocks": {
          "main": [
            [
              {
                "node": "Extract info",
                "type": "main",
                "index": 0
              },
              {
                "node": "Extract locations",
                "type": "main",
                "index": 0
              },
              {
                "node": "Extract about us",
                "type": "main",
                "index": 0
              },
              {
                "node": "Extract employees",
                "type": "main",
                "index": 0
              },
              {
                "node": "Extract updates",
                "type": "main",
                "index": 0
              },
              {
                "node": "Are there products?",
                "type": "main",
                "index": 0
              },
              {
                "node": "Are there affiliated pages?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract info": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract about us": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract employees": {
          "main": [
            [
              {
                "node": "If3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract locations": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract updates": {
          "main": [
            [
              {
                "node": "If4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Are there products?": {
          "main": [
            [
              {
                "node": "Split Out3",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "No products",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Are there affiliated pages?": {
          "main": [
            [
              {
                "node": "Split Out4",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "No affiliated pages",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No affiliated pages": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 6
              }
            ]
          ]
        },
        "No products": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 5
              }
            ]
          ]
        },
        "Extract products": {
          "main": [
            [
              {
                "node": "Aggregate2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract affiliated pages": {
          "main": [
            [
              {
                "node": "Aggregate4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Summarize available data": {
          "main": [
            [
              {
                "node": "Send email",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Send email": {
          "main": [
            [
              {
                "node": "Wait 5s",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait 5s": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set Linkedin URL from the first result": {
          "main": [
            [
              {
                "node": "Clean linkedin url",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Clean linkedin url": {
          "main": [
            [
              {
                "node": "Scrape LinkedIn",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract location data1": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Google X-Ray Search",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ],
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Edit Fields4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields4": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "If3": {
          "main": [
            [
              {
                "node": "Split Out1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "If4": {
          "main": [
            [
              {
                "node": "Split Out2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Edit Fields2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields2": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 4
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "1fbd84d5-ed35-46b4-830c-84dea19669ba",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "ucEHSGg73IPzhX1n",
      "tags": []
    }
  },
  {
    "id": "postiz-social-scheduler",
    "title": "Postiz Social Video Scheduler",
    "description": "Downloads source video, uploads it to Postiz, fetches integrations, and schedules posts for TikTok/YouTube/Instagram.",
    "problem": "Creators need a repeatable way to share the same asset across multiple channels without logging into each platform.",
    "tags": [
      "social",
      "postiz",
      "video",
      "scheduler"
    ],
    "metadata": {
      "industries": [
        "marketing",
        "social"
      ],
      "domains": [
        "content-distribution",
        "video"
      ],
      "channels": [
        "postiz",
        "tiktok",
        "youtube",
        "instagram"
      ],
      "trigger": "manual",
      "complexity": "medium",
      "integrations": [
        "Postiz",
        "Seedance",
        "Fal.ai",
        "Telegram"
      ]
    },
    "workflow": {
      "name": "Episode 12: Postiz",
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -660,
            0
          ],
          "id": "78dd86e6-c5e6-4d44-bd04-8813c14637de",
          "name": "When clicking â€˜Execute workflowâ€™"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.identifier }}",
                        "rightValue": "tiktok",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "3ff74ffe-3f82-437d-9218-bce4f7551211"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "tiktok"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "2edc7f5f-18cf-45e2-9a10-03c6ee2a062f",
                        "leftValue": "={{ $json.identifier }}",
                        "rightValue": "youtube",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "youtube"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "f461c331-7506-486b-ab4a-de03823f82f9",
                        "leftValue": "={{ $json.identifier }}",
                        "rightValue": "instagram",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "instagram"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            440,
            0
          ],
          "id": "7deee34b-70d3-4f33-98e0-e715ff1ce2bf",
          "name": "Switch"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0f5772c0-1f84-45e9-b131-8be1c8dd6d85",
                  "name": "postiz_api",
                  "value": "YOUR_POSTIZ_URL/api/public/v1",
                  "type": "string"
                },
                {
                  "id": "781d5f1b-1724-4cd4-9e0d-916de65b43e5",
                  "name": "share_video_url",
                  "value": "https://cdn.pixabay.com/video/2023/08/31/178472-859955927_small.mp4?download",
                  "type": "string"
                },
                {
                  "id": "f3d9536a-3dc9-4673-b774-0434ca64575f",
                  "name": "share_title",
                  "value": "Summer is coming",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -400,
            0
          ],
          "id": "e610724a-f113-4238-a83b-1c2b0a2a6f9c",
          "name": "Configure me"
        },
        {
          "parameters": {
            "content": "# â— Config",
            "height": 380,
            "width": 220,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            -160
          ],
          "id": "33143617-4eda-4d49-9d1a-684922a9de0b",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "url": "={{ $json.share_video_url }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -180,
            0
          ],
          "id": "212f1b54-8e8b-4b39-b114-dfdc0f430d85",
          "name": "Download video"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Configure me').item.json.postiz_api }}/upload",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "parameterType": "formBinaryData",
                  "name": "file",
                  "inputDataFieldName": "data"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            40,
            0
          ],
          "id": "f63f1714-0c2f-49ba-947c-eb5401c081f1",
          "name": "Upload video to Postiz",
          "credentials": {
            "httpBearerAuth": {
              "id": "qaxoCSbcbmatcO44",
              "name": "Local postiz"
            },
            "httpCustomAuth": {
              "id": "X84DBVwdxIyjeWnM",
              "name": "Custom Auth account"
            },
            "httpHeaderAuth": {
              "id": "vLZnCmQuaqpFY5LK",
              "name": "Postiz auth"
            }
          }
        },
        {
          "parameters": {
            "url": "={{ $('Configure me').item.json.postiz_api }}/integrations",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            240,
            0
          ],
          "id": "e8b6b201-0295-4134-827a-212fb2213174",
          "name": "Get Postiz integrations",
          "credentials": {
            "httpBearerAuth": {
              "id": "qaxoCSbcbmatcO44",
              "name": "Local postiz"
            },
            "httpCustomAuth": {
              "id": "X84DBVwdxIyjeWnM",
              "name": "Custom Auth account"
            },
            "httpHeaderAuth": {
              "id": "vLZnCmQuaqpFY5LK",
              "name": "Postiz auth"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Configure me').item.json.postiz_api }}/posts",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"type\": \"schedule\",\n  \"date\": \"{{ $now.plus(1, 'days').toISO() }}\",\n  \"tags\": [],\n  \"shortLink\": false,\n  \"posts\": [\n    {\n      \"integration\": {\n        \"id\": \"{{ $('Switch').item.json.id }}\"\n      },\n      \"value\": [\n        {\n          \"content\": \"{{ $('Configure me').item.json.share_title }}\",\n          \"image\": [\n            {\n              \"id\": \"{{ $('Upload video to Postiz').item.json.id }}\",\n              \"path\": \"{{ $('Upload video to Postiz').item.json.path }}\"\n            }\n          ]\n        }\n      ],\n      \"settings\": {\n        \"title\": \"{{ $('Configure me').item.json.share_title }}\"\n      }\n    }\n  ]\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1080,
            -20
          ],
          "id": "4012aa85-d3c0-4f79-82cf-de9153e875fd",
          "name": "HTTP Request",
          "credentials": {
            "httpHeaderAuth": {
              "id": "vLZnCmQuaqpFY5LK",
              "name": "Postiz auth"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6edb3f17-3d22-408b-a935-5e9f59fa6cc5",
                  "leftValue": "",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            680,
            0
          ],
          "id": "e89f81f7-9ba2-4e81-94c2-5a620f2ecd85",
          "name": "YouTube check"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6edb3f17-3d22-408b-a935-5e9f59fa6cc5",
                  "leftValue": "",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            680,
            -260
          ],
          "id": "8901e4c4-bc30-40fb-8d49-a8118ff45346",
          "name": "TikTok check"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6edb3f17-3d22-408b-a935-5e9f59fa6cc5",
                  "leftValue": "",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            680,
            240
          ],
          "id": "60733cb5-bce9-446f-b060-c81a15316bc4",
          "name": "Instagram check"
        },
        {
          "parameters": {
            "content": "## Implement your logic here\n\nShare on the social media integrations you select",
            "height": 800,
            "width": 320
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            600,
            -400
          ],
          "id": "9a63682d-8c3a-4bbe-bef8-841a71869768",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# Schedule the post",
            "height": 280,
            "width": 360,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            980,
            -140
          ],
          "id": "8c3f1f18-3890-4158-9cc0-ea5f1d387082",
          "name": "Sticky Note2"
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Execute workflowâ€™": {
          "main": [
            [
              {
                "node": "Configure me",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "TikTok check",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "YouTube check",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Instagram check",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Configure me": {
          "main": [
            [
              {
                "node": "Download video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download video": {
          "main": [
            [
              {
                "node": "Upload video to Postiz",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload video to Postiz": {
          "main": [
            [
              {
                "node": "Get Postiz integrations",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Postiz integrations": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "YouTube check": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "2a01f863-ddea-40c9-a732-99170d4ab203",
      "meta": {
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "ABdn0f2r46qrgkkP",
      "tags": []
    }
  },
  {
    "id": "reddit-startup-ideas",
    "title": "Reddit Startup Idea Miner",
    "description": "Monitors Reddit threads, summarizes pain points with Gemini, and generates YC-style startup briefs in Notion.",
    "problem": "Finding validated startup ideas is tedious; this agent mines Reddit discussions and converts them into structured ideas.",
    "tags": [
      "reddit",
      "startup",
      "notion",
      "summaries",
      "ai"
    ],
    "metadata": {
      "industries": [
        "founder",
        "product"
      ],
      "domains": [
        "research",
        "ideation"
      ],
      "channels": [
        "notion"
      ],
      "trigger": "manual",
      "complexity": "medium",
      "integrations": [
        "Reddit",
        "Gemini",
        "Notion"
      ]
    },
    "workflow": {
      "name": "Episode 15: Startup ideas for YC RFS",
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            520,
            640
          ],
          "id": "875c9036-40db-42a9-a5de-9a63e04afd97",
          "name": "When clicking â€˜Execute workflowâ€™"
        },
        {
          "parameters": {
            "content": "# Set me up\n1. Setup the Reddit credentials\n2. Feel free to change the order by Reddit category (top, new, best, etc.) - and even the subreddit\n2. If you are our skool community member, replace this node with the Reddit pagination subworflow",
            "height": 480,
            "width": 260,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1300,
            340
          ],
          "id": "957f6f11-e9cc-445f-a292-1028df2c2470",
          "name": "Sticky Note12"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1-2025-04-14",
              "mode": "list",
              "cachedResultName": "gpt-4.1-2025-04-14"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            1520,
            1700
          ],
          "id": "ba227b86-fd5a-4bbf-9272-1bd421f5d54e",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "b737649d-c34b-4fb5-a008-96bcfc93d9ce",
                  "name": "request_for_startups",
                  "value": "=# Full-stack AI Companies:\nTraditional AI startups often build tools and sell them to businesses. A more disruptive approach is to launch companies that directly compete against industry incumbents using AI. For example, instead of selling AI to law firms, create a new AI-powered law firm. This \"full-stack\" model could be applied to any field with slow-moving players.\n\n# More Design Founders:\nDesigners should become founders, especially as no-code tools make product building more accessible. Good design will become a greater competitive advantage. Designers possess skills like user empathy and aesthetic judgment, which are vital for startup successâ€”as seen in companies like Airbnb and Stripe. YC wants to fund teams with strong design at their core.\n\n# Voice AI:\nDespite advances in business tech, voice interactions (phone calls) havenâ€™t changed in decades. New voice models and conversational AI are now realistic enough to be indistinguishable from humans. With over a trillion business calls annually, AI voice bots are poised to revolutionize this area.\n\n# AI for Scientific Advancement:\nMost scientific software in fields like chemistry and operations research is out-of-date. AI, especially at test time, enables solving complex problems in drug discovery, chemical processes, and more. YC is interested in startups leveraging AI to modernize scientific applications and physical production processes.\n\n# AI Personal Assistant:\nCurrent productivity tools help track tasks but donâ€™t complete them. LLMs now enable assistants that can deeply understand personal work routines and take on tasks like managing communications, scheduling, and recurring work, much like a human chief of staff.\n\n# Healthcare AI:\nU.S. healthcare spends over $1 trillion on administrative costs due to inefficiencies and lack of interoperability. Recent LLMs now enable automation of data extraction, entry, and administrative tasks. YC seeks startups tackling these issues to improve healthcare efficiency.\n\n# AI Personal Tutor for Everyone:\nThe dream of truly personalized, computer-based education is now possible with AI. New models can explain complex concepts step-by-step and use multimodal tools (animations, 3D objects, voice). A high-quality, AI-enabled tutor could be personalized for every learner and subject, radically improving education.\n\n# Software Tools to Make Robots:\nRobotics is close to a major breakthrough (\"ChatGPT moment\"). As AI improves robot perception and judgment, there's strong potential in industrial and farming applications. YC wants to fund teams building tools that make it easier for others to create functional robots.\n\n# The Future of Education:\nEducation is massive and hard to disrupt, with over a billion learners globally. AIâ€”especially LLMsâ€”can potentially personalize learning, improve access, and automate drudge work for students and teachers. The long-term transformation of education is inevitable.\n\n# AI Residential Security:\nHome security is a $20B/year industry dominated by outdated legacy firms. Commercial security uses AI for facial recognition, behavior detection, and virtual guards. There is a huge opportunity to use AI to provide genuinely safer homes, far beyond current home security offerings.\n\n# Internal Agent Builder:\nEvery employee will soon be able to create AI agents to automate their repetitive workâ€”not just developers. YC seeks infrastructure startups enabling workers to build, permission, and securely connect these agents to all work tools, freeing humans for higher-value tasks.\n\n# AI Research Labs:\nYC wants to fund new AI research labs, not just quick-to-market startups. OpenAI began as YC Research, and the model of independent, long-term AI research efforts has led to huge breakthroughs. There is still significant opportunity for new labs to tackle unsolved AI problems.\n\n# AI Voice Assistants for Email:\nVoice-enabled assistants (Vapi, Retell, ChatGPT Voice Mode) are now effective enough to triage inboxes by voice during time like a morning commute. Email is an especially promising domain for a universal voice assistant due to its centrality in daily life.\n\n# AI for Personal Finance:\nMost people make irrational financial decisions due to poor or biased advice, or expensive advisors. LLMs offer a new opportunity to provide personalized, unbiased, API-connected finance, investment, and tax advice to everyone for little to no cost.",
                  "type": "string"
                },
                {
                  "id": "7efb5516-5020-4607-b797-0b742e546912",
                  "name": "technology_definitions",
                  "value": "=# AI Agents\nAI agents are software systems that use artificial intelligence to autonomously perform tasks and achieve goals on behalf of a user or another system. They can reason, plan, and act with varying degrees of independence, often employing multiple tools and models to complete tasks. \n\nKey Characteristics:\n\nAutonomy:\nAI agents can operate with minimal or no direct human intervention, making decisions and taking actions based on their programming and learned behavior. \nGoal-Oriented:\nThey are designed to pursue specific objectives, whether that's answering customer inquiries, automating tasks, or making data-driven decisions. \n\nReasoning and Planning:\nAI agents can analyze situations, create plans, and adapt their actions to achieve their goals. \n\nAction Execution:\nThey can interact with the environment, utilizing various tools and systems to carry out tasks. \n\nLearning and Adaptation:\nMany AI agents can learn from their interactions and improve their performance over time, becoming more efficient and effective at their tasks. \n\nHow they work:\n\n1. Perception and Data Collection:\nAI agents gather information from various sources, such as user input, data streams, and sensor data. \n2. Decision Making:\nBased on the gathered information and pre-defined rules or learned patterns, the agent decides on the best course of action. \n3. Action Execution:\nThe agent carries out the chosen action, which could involve interacting with a software system, sending a message, or manipulating physical objects. \n4. Learning and Adaptation:\n\nThrough feedback and experience, the agent refines its decision-making process and adapts its behavior to improve future performance. \n\nExamples of AI Agents:\n\nChatbots and Virtual Assistants:\nAI agents can power conversational interfaces that answer questions, provide support, and complete tasks. \n\nRobotics:\nAI agents can control robots to perform physical tasks in various environments, from manufacturing to exploration. \n\nAutonomous Vehicles:\nAI agents can make decisions and control vehicles, enabling self-driving capabilities. \n\nCode Generation:\nAI agents can assist developers by generating code, debugging, and refactoring. \n\nFraud Detection:\nAI agents can analyze transaction data and identify suspicious patterns, helping prevent fraud. \n\nSupply Chain Optimization:\nAI agents can optimize logistics, inventory management, and other aspects of the supply chain. \n\nHealthcare:\nAI agents can assist with diagnosis, treatment planning, and patient monitoring\n\n# RAG\n\nIn the context of large language models (LLMs), Retrieval-Augmented Generation (RAG) is a technique that enhances the accuracy and relevance of AI-generated text by combining the strengths of information retrieval and generative AI. RAG works by first retrieving relevant information from external data sources and then using that information to inform and improve the generation of responses. \nHere's a more detailed breakdown:\n\n1. Retrieval:\nRAG systems use search algorithms to query external data sources like databases, knowledge bases, or the web. \nThis step aims to find the most relevant information related to the user's query. \nFor example, if a user asks about a specific company policy, the RAG system will search for documents related to that policy within the company's knowledge base. \n2. Augmentation (or Generation): \nThe retrieved information is then integrated into the LLM.\nThe LLM uses this external knowledge to generate more accurate, up-to-date, and contextually relevant responses.\nThis approach allows LLMs to provide answers that are not limited to their pre-trained knowledge and can incorporate specific information from various sources.\n\nBenefits of RAG:\n\nReduced Hallucinations:\nRAG can significantly reduce the instances of LLMs generating inaccurate or fabricated information (hallucinations) by grounding their responses in real data. \n\nIncreased Accuracy:\nBy using real-time information, RAG systems can provide more accurate and reliable answers. \n\nImproved Relevance:\nRAG enables LLMs to provide responses tailored to specific contexts and user needs. \n\nCost-Effectiveness:\nRAG offers a more cost-effective way to update LLMs with new information compared to retraining them on the entire dataset. \n\nIn essence, RAG transforms LLMs from static knowledge repositories into dynamic information processors capable of accessing and synthesizing knowledge from diverse sources to generate more informed and relevant outputs.\n\n# LLM\n\nLarge Language Models (LLMs) are advanced artificial intelligence systems designed to understand, generate, and manipulate human language. They are trained on massive amounts of text data and utilize deep learning techniques, particularly the Transformer architecture, to process and generate human-like text. LLMs are capable of performing various natural language processing tasks, including text generation, translation, question answering, and more. \n\nHere's a more detailed explanation:\nKey Features:\nMassive Data Training:\nLLMs are trained on enormous datasets of text and code, allowing them to learn intricate patterns and relationships within language.\nDeep Learning Architecture:\nThey commonly use the Transformer architecture, which excels at handling sequential data and capturing contextual information.\nNatural Language Understanding and Generation:\nLLMs can understand the nuances of human language, including context, sentiment, and intent, and generate coherent and contextually relevant text.\nVersatile Applications:\nLLMs are used in a wide range of applications, including chatbots, content creation, language translation, code generation, and more. \nHow LLMs Work:\n1. Training:\nLLMs are trained on vast amounts of data, learning to predict the next word in a sequence or to perform other language-related tasks.\n2. Contextual Understanding:\nThrough the training process, LLMs develop a deep understanding of language, including syntax, semantics, and context.\n3. Input Processing:\nWhen a user provides input, the LLM processes the text, breaking it down into smaller units (tokens) and analyzing their relationships.\n4. Output Generation:\nBased on the input and its learned knowledge, the LLM generates a response or output, which can be text, code, or other forms of data. \nExamples of LLMs:\nGPT series (Generative Pre-trained Transformer):\nDeveloped by OpenAI, these models are known for their ability to generate human-quality text.\nBERT (Bidirectional Encoder Representations from Transformers):\nDeveloped by Google, BERT is used for understanding the context of text and is often used in search and other NLP tasks. \nWhat are Large Language Models (LLMs)? | phData\nIn essence, LLMs are powerful AI systems that are revolutionizing how we interact with technology and process information, enabling more natural and intuitive ways to communicate and access knowledge.\n\n# Multi-agent system\n\nA multi-agent system (MAS) is a system composed of multiple interacting intelligent agents that collaborate to achieve common or conflicting goals. These agents can be software programs or robots, and they operate within a shared environment, making decisions and taking actions to fulfill their objectives. MAS allows for complex problem-solving by distributing tasks among specialized agents, enabling them to perform actions that a single agent might struggle with. \n\nHere's a more detailed breakdown:\nKey Components:\nAgents:\nAutonomous entities with specific roles and functionalities, capable of perceiving their environment, making decisions, and taking actions.\nEnvironment:\nThe shared space where agents interact and operate, which can be physical or virtual.\nCommunication:\nA mechanism for agents to exchange information and coordinate their actions.\nControl Structure:\nA mechanism to manage the interactions and decision-making processes among agents. \nHow it Works:\n1. Task Decomposition:\nA complex problem is broken down into smaller, manageable sub-tasks. \n2. Agent Specialization:\nDifferent agents are assigned specific roles based on their expertise and capabilities. \n3. Collaboration and Coordination:\nAgents communicate and coordinate their actions to achieve the overall goal. \n4. Emergent Behavior:\nThe interactions between agents can lead to unexpected or emergent behavior, which can be beneficial or require careful management. \nBenefits of Multi-Agent Systems:\nIncreased Efficiency and Scalability:\nMAS can handle complex tasks more efficiently by distributing the workload among specialized agents. \nImproved Robustness and Adaptability:\nIf one agent fails, the system can still function by redistributing tasks among the remaining agents. \nComplex Problem Solving:\nMAS can tackle problems that are too difficult for a single agent to solve. \nFlexibility and Reusability:\nIndividual agents can be reused in different MAS configurations. \nExamples:\nRobotics: Multi-robot systems for manufacturing, exploration, or disaster response. \nAutonomous Vehicles: Coordinating multiple self-driving cars in a traffic network. \nE-commerce: Optimizing online shopping experiences with personalized recommendations and customer service. \nSmart Grids: Managing electricity distribution and integrating renewable energy sources. \nHealthcare: Coordinating patient care, optimizing hospital resources, and assisting with medical diagnoses. \n\n# Multi-modal LLMs\n\nMultimodal large language models (MLLMs) are AI models that can understand and generate content across multiple data types, or \"modalities,\" such as text, images, audio, and video. Unlike traditional language models that primarily handle text, MLLMs integrate information from various sources to create a richer, more comprehensive understanding of the world. \n\nHere's a more detailed explanation:\nKey Concepts:\nModalities:\nMLLMs can process and generate different types of data, including:\nText: Traditional language input and output. \nImages: Visual information, such as pictures and videos. \nAudio: Sound, including speech and music. \nOther modalities: Sensor data, robot state information, and more. \nMultimodal Fusion:\nMLLMs use techniques to combine information from different modalities. This might involve:\nEarly Fusion: Combining features from different modalities at the beginning of processing. \nLate Fusion: Processing modalities separately and then combining the results. \nHybrid Fusion: Combining elements of both early and late fusion. \nCross-modal Interactions:\nMLLMs can perform tasks that involve multiple modalities, such as:\nImage captioning: Generating text descriptions of images. \nVisual Question Answering (VQA): Answering questions based on images. \nText-to-image generation: Creating images from text descriptions. \nSpeech-to-text and text-to-speech: Converting audio to text and vice versa. \nHow they work:\nMLLMs typically have components for each modality (e.g., a vision model for images, an audio model for sound, and a language model for text). These components process the input data and extract features. These features are then combined using multimodal fusion techniques to create a unified representation that the model uses for understanding and generating outputs. \nExamples of MLLMs:\nMicrosoft's Kosmos-1: An example of a vision-language model that can process images and text.\nDeepMind's Flamingo: Another vision-language model known for its ability to understand and generate text descriptions of images.\nGoogle's PaLM-E: A model that can handle information about a robot's state and surroundings in addition to text and images.\nOpen-source models like LLaVA: Provide access to multimodal capabilities for research and development. \nBenefits of MLLMs:\nRicher Contextual Understanding:\nBy combining information from multiple modalities, MLLMs can achieve a deeper understanding of the world than text-only models. \nNew Applications:\nMLLMs unlock new possibilities for AI applications in areas like content creation, personalized recommendations, human-machine interaction, and more. \nImproved Human-Computer Interaction:\nMLLMs can enable more intuitive and natural interactions with AI, as they can understand and respond to a wider range of inputs.\n\n# AI Voice Agents\n\nAI voice agents are software systems that use artificial intelligence to understand, interpret, and respond to human speech, enabling natural, conversational interactions. They leverage technologies like natural language processing (NLP) and machine learning to answer questions, provide information, and perform actions, much like a human assistant or customer service representative. \n\nHere's a more detailed explanation:\nNatural Language Understanding:\nAI voice agents utilize NLP to decipher the meaning and intent behind spoken words, even with variations in pronunciation, accents, and sentence structure. \nSpeech Recognition:\nThey accurately convert spoken words into text using speech recognition technology, which is crucial for understanding what the user is saying. \nMachine Learning:\nThese agents learn from interactions, improving their ability to understand and respond to user queries over time. \nEnd-to-End Capabilities:\nModern AI voice agents handle the entire interaction process, from receiving input to providing a relevant response, often in near real-time. \nApplications:\nAI voice agents are used in various applications, including:\nCustomer service: Handling routine inquiries, providing support, and resolving issues. \nSmart home control: Interacting with devices like smart speakers and controlling home automation. \nPersonal assistants: Managing schedules, setting reminders, and providing information. \nBusiness automation: Automating tasks like appointment scheduling, data entry, and call routing. \nKey Differences from Older IVR Systems:\nAI voice agents go beyond simple menu navigation (like \"Press 1 for sales\") by engaging in more complex, conversational interactions, remembering context, and responding to interruptions. \nFuture Potential:\nThey are evolving to become more autonomous, capable of handling complex tasks and even making decisions on behalf of the user.",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1080,
            640
          ],
          "id": "87a4dd77-682e-42ec-961a-3913b9497c76",
          "name": "Setup"
        },
        {
          "parameters": {
            "resource": "spreadsheet",
            "title": "New startup ideas",
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            800,
            640
          ],
          "id": "d21cf000-1d79-42d8-9655-a2cc613f02d7",
          "name": "Create Google Sheets",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "y3SQnJ2q0kAJw5OI",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=<Instructions>\nYour task is to extract any pain points or frustrations that could be resolved with custom software solutions, AI, ML, or automation from the given reddit post.\n\nIdentify whether the case study explicitly mentions any pain points or frustrations related to manual processes or repetitive tasks that could be addressed efficiently with custom software, AI, ML, or automation.\n\nThink out loud while extracting the pain points.\n</Instructions>\n\n<RedditPost>\n{{ $json.title }}\n\n{{ $json.selftext }}\n</RedditPost>",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2,
          "position": [
            740,
            980
          ],
          "id": "624d3df6-e176-4ca4-84d7-bfe7b936d017",
          "name": "Find pain points"
        },
        {
          "parameters": {
            "text": "={{ $json.output.includes('<think>') ? $json.output.split('</think>')?.[1] : $json.output }}\n",
            "schemaType": "fromJson",
            "jsonSchemaExample": "{\n\t\"pain_points\": [\"\"]\n}",
            "options": {
              "systemPromptTemplate": "You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value.\n\nYour job is to extract the pain points from the provided text.\t"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1.1,
          "position": [
            1080,
            980
          ],
          "id": "02d73bde-6c40-4bbc-8630-ccd6ab993484",
          "name": "Extract pain points"
        },
        {
          "parameters": {
            "text": "=<Task>\nYour job is to assess, whether the following startup idea falls into the categories that are listed under the request for startup categories below.\n</Task>\n\n<Instructions>\n\nFollow these instructions while thinking out loud:\n1. Read through all the request for startups categories\n2. Read through the startup idea\n3. See if the startup idea fits (strongly) into any of the categories. We don't allow ambiguity.\n4. Assign the rigth category to the startup idea - if it won't fit any, just add `n/a`.\n</Instructions>\n\n<StartupIdea>\n# Pain point\n\n{{ $json.output.pain_points_summary }}\n\n# Startup idea:\n\n{{ $json.output.startup_idea }}\n</StartupIdea>\n\n<RequestForStartups>\n{{ $('Setup').item.json.request_for_startups }}\n</RequestForStartups>",
            "attributes": {
              "attributes": [
                {
                  "name": "reasoning",
                  "description": "explain why the startup idea falls into that category",
                  "required": true
                },
                {
                  "name": "category",
                  "description": "the request for startups category",
                  "required": true
                },
                {
                  "name": "has_category",
                  "type": "boolean",
                  "description": "does the startup idea fit the request for startups categories",
                  "required": true
                },
                {
                  "name": "industry",
                  "description": "the industry of the startup idea",
                  "required": true
                }
              ]
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1.1,
          "position": [
            1940,
            980
          ],
          "id": "4f69ef6c-403e-4809-b099-2e6121e5e229",
          "name": "Extract category"
        },
        {
          "parameters": {
            "text": "=<Task>\nCreate a startup idea that solves the listed pain points.\n</Task>\n\n<Instructions>\n\nFollow these instructions while thinking out loud:\n1. Read through all the pain points\n2. Come up with an idea, that's using today's hot new technologies, like AI, ML, AI Agents (agentic AI), LLMs and multi-modal LLMs, RAG, AI Voice Agents and multi ai agents. Find the definitions of these technologies below.\n3. You don't have to use all the technologies for an idea - one is enough, but use as much as needed to solve the problem in the best possible way\n</Instructions>\n\n<Context>\n{{ $('Setup').item.json.technology_definitions }}\n</Context>\n\n<PainPoints>\n{{ $json.output.pain_points.map(item => `\\t<PainPoint>${item}</PainPoint>`).join('\\n') }}\n</PainPoints>",
            "attributes": {
              "attributes": [
                {
                  "name": "pain_points_summary",
                  "description": "the summary of the pain points",
                  "required": true
                },
                {
                  "name": "reasoning",
                  "description": "why the startup idea solves the given pain points",
                  "required": true
                },
                {
                  "name": "startup_idea",
                  "description": "the startup idea that solves the pain points",
                  "required": true
                }
              ]
            },
            "options": {
              "systemPromptTemplate": "You are an expert startup product manager who comes up with the best startup ideas for customer pain points."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1.1,
          "position": [
            1640,
            980
          ],
          "id": "dc7efdb1-4490-489f-bc07-444c87d344e4",
          "name": "Create a startup idea"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "79e47cb0-8c95-4e48-b603-5b2065d01798",
                  "name": "RFS Category",
                  "value": "={{ $json.output.category }}",
                  "type": "string"
                },
                {
                  "id": "527f1c7b-2ad3-4ff0-92d4-20334334f0f9",
                  "name": "Industry",
                  "value": "={{ $json.output.industry }}",
                  "type": "string"
                },
                {
                  "id": "76bee27e-5361-4f51-b98d-dce4029690ed",
                  "name": "Pain points",
                  "value": "={{ $('Create a startup idea').item.json.output.pain_points_summary }}",
                  "type": "string"
                },
                {
                  "id": "98ccaed8-6ab7-4f87-99d5-bd0fab4d799a",
                  "name": "Startup idea",
                  "value": "={{ $('Create a startup idea').item.json.output.startup_idea }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2500,
            980
          ],
          "id": "2b12af06-98c4-4e22-8e64-c373df2ed93f",
          "name": "Setup fields for Google Sheets"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "={{ $('Create Google Sheets').item.json.spreadsheetId }}",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "0",
              "mode": "id"
            },
            "columns": {
              "mappingMode": "autoMapInputData",
              "value": {},
              "matchingColumns": [],
              "schema": [
                {
                  "id": "RFS Category",
                  "displayName": "RFS Category",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Industry",
                  "displayName": "Industry",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Pain points",
                  "displayName": "Pain points",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Startup idea",
                  "displayName": "Startup idea",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.6,
          "position": [
            2700,
            1000
          ],
          "id": "6c43f7df-3a3c-47f2-8e4f-5616e21289a2",
          "name": "Save row to Sheets",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "y3SQnJ2q0kAJw5OI",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            500,
            980
          ],
          "id": "66e45d40-70a8-4e3c-99e4-d4b3af22187b",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "ea611ac8-9e7e-425d-aa5b-0487380b425d",
                  "leftValue": "={{ $json.output.pain_points }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthGt",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1400,
            980
          ],
          "id": "abd20894-86a6-4d4d-bd6c-7715a49cbb69",
          "name": "Has pain points?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "bd56a0e2-3b7c-4cd9-a77e-9f7895b7a70b",
                  "leftValue": "={{ $json.output.has_category }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2260,
            980
          ],
          "id": "b6d23d58-d136-402b-bd21-bb011271283b",
          "name": "RFS compatible?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3da9b8a9-f36a-4987-8941-945dd743e46b",
                  "name": "Sheet URL",
                  "value": "=https://docs.google.com/spreadsheets/d/{{ $('Create Google Sheets').item.json.spreadsheetId }}/edit",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            720,
            1320
          ],
          "id": "1c10c505-915d-4466-ac60-0ea4be5a3164",
          "name": "Setup Google Sheet URL"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
          "typeVersion": 1,
          "position": [
            1040,
            1360
          ],
          "id": "d295316f-1fdd-4084-86dc-c0c89559d2e5",
          "name": "Ollama Chat Model",
          "credentials": {
            "ollamaApi": {
              "id": "cWXUsJ0LsqnzOEx0",
              "name": "Ollama account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
          "typeVersion": 1,
          "position": [
            1360,
            1360
          ],
          "id": "fbe5ae0b-d535-4c01-b3a2-87149af77c83",
          "name": "DeepSeek Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
          "typeVersion": 1,
          "position": [
            1520,
            1360
          ],
          "id": "a128c1ec-21c0-4a2f-94ee-06ab24a9efbd",
          "name": "OpenRouter Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            1040,
            1700
          ],
          "id": "07008c40-f307-44cb-b012-0a428ade13d4",
          "name": "Google Gemini Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
          "typeVersion": 1,
          "position": [
            1040,
            1520
          ],
          "id": "f1c5c76b-34cd-4b81-9d03-1732c1bc296b",
          "name": "Azure OpenAI Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            1200,
            1520
          ],
          "id": "c8356d95-5dd4-4260-9539-1d7541f7349f",
          "name": "xAI Grok Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "claude-sonnet-4-20250514",
              "cachedResultName": "Claude 4 Sonnet"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            1360,
            1520
          ],
          "id": "20b15101-7331-4a99-b548-66bf928f6c57",
          "name": "Anthropic Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            1520,
            1520
          ],
          "id": "f7475c50-c5d0-4073-ac9e-c06db19415f3",
          "name": "xAI Grok Chat Model1",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
          "typeVersion": 1,
          "position": [
            1360,
            1700
          ],
          "id": "fc275a8c-4ea3-4fd4-a6f8-9f9814f53276",
          "name": "Groq Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAwsBedrock",
          "typeVersion": 1,
          "position": [
            1200,
            1360
          ],
          "id": "133feaa9-04c4-487d-9fdb-59b2db831105",
          "name": "AWS Bedrock Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
          "typeVersion": 1,
          "position": [
            1200,
            1700
          ],
          "id": "48a5e626-7ce3-4575-b2b8-63315739d77e",
          "name": "Mistral Cloud Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "content": "# Pick your choice of LLM\n\nSelect one LLM and make sure to deactivate the rest",
            "height": 700,
            "width": 720,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            960,
            1220
          ],
          "id": "d390d687-4bd9-4ad0-a6d0-795355462529",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "content": "# How to set up this automation?\n\n## 1. Setup the Google Sheets nodes to use your Sheets integration. If you self-host, make sure the Sheets API and the Google Drive APIs are both enabled in Google Console\n## 2. Setup Reddit with OAuth credentials\n## 3. Pick your choice of LLM and connect it to the 4 LLM nodes - make sure to deactivate the rest of the chat nodes\n## 4. This template was made on n8n version number `1.97.0` - on lower versions some nodes could misbehave, in that case make sure you update your self-hosted n8n instance",
            "height": 500,
            "width": 900,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1200,
            -240
          ],
          "id": "bb64d712-46d8-46d4-b158-2f8f0dfe27c7",
          "name": "Sticky Note14"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w9)\n\n## Be part of a growing community and help us create more content like this\n\n## And get access to our premium workflows and servers",
            "height": 500,
            "width": 700,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            460,
            -240
          ],
          "id": "68cab941-7e2b-4267-a62f-66108caa8609",
          "name": "Sticky Note16"
        },
        {
          "parameters": {
            "content": "# Extract pain points from posts and generate startup ideas",
            "height": 320,
            "width": 2420
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            460,
            860
          ],
          "id": "d1f7b845-906f-4c7f-a979-bd5dbee82919",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# Done!",
            "height": 320,
            "width": 460,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            460,
            1220
          ],
          "id": "a5a13e21-8739-45db-bac1-54926d54fa70",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# Context\nFeel free to add more context for the technologies the startup ideas could include",
            "height": 480,
            "width": 260,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1000,
            340
          ],
          "id": "0370e902-2952-4595-96d3-72487341220f",
          "name": "Sticky Note13"
        },
        {
          "parameters": {
            "operation": "getAll",
            "subreddit": "smallbusiness",
            "limit": 5,
            "filters": {
              "category": "top"
            }
          },
          "type": "n8n-nodes-base.reddit",
          "typeVersion": 1,
          "position": [
            1380,
            640
          ],
          "id": "ef5c4b42-7e58-4a67-9ca9-074df43557df",
          "name": "Reddit",
          "credentials": {
            "redditOAuth2Api": {
              "id": "l1tTlMrxURLbE7Fs",
              "name": "Reddit account 3"
            }
          }
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Execute workflowâ€™": {
          "main": [
            [
              {
                "node": "Create Google Sheets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Find pain points",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Extract pain points",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Extract category",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Create a startup idea",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Setup": {
          "main": [
            [
              {
                "node": "Reddit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Google Sheets": {
          "main": [
            [
              {
                "node": "Setup",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Find pain points": {
          "main": [
            [
              {
                "node": "Extract pain points",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract pain points": {
          "main": [
            [
              {
                "node": "Has pain points?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract category": {
          "main": [
            [
              {
                "node": "RFS compatible?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a startup idea": {
          "main": [
            [
              {
                "node": "Extract category",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup fields for Google Sheets": {
          "main": [
            [
              {
                "node": "Save row to Sheets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [
              {
                "node": "Setup Google Sheet URL",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Find pain points",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Save row to Sheets": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Has pain points?": {
          "main": [
            [
              {
                "node": "Create a startup idea",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RFS compatible?": {
          "main": [
            [
              {
                "node": "Setup fields for Google Sheets",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Reddit": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "991719c2-1545-4d61-9fd6-8cb926c4900c",
      "meta": {
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "vRKyEOR9iC6tOmL9",
      "tags": []
    }
  },
  {
    "id": "linkedin-hitl-writer",
    "title": "LinkedIn Content with Human Approval",
    "description": "Ingests industry news, drafts LinkedIn posts with Gemini, and routes them through a manual approval branch before publishing.",
    "problem": "Marketing teams want AI-generated posts but insist on a human-in-the-loop signoff to keep messaging on brand.",
    "tags": [
      "linkedin",
      "content",
      "approval",
      "marketing"
    ],
    "metadata": {
      "industries": [
        "marketing"
      ],
      "domains": [
        "copywriting",
        "human-in-the-loop"
      ],
      "channels": [
        "linkedin",
        "email"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "LinkedIn",
        "Gemini",
        "Gmail",
        "Slack"
      ]
    },
    "workflow": {
      "name": "My workflow 14",
      "nodes": [
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w3)\n\n## Be part of a growing community and help us create more content like this",
            "height": 220,
            "width": 860,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            760,
            -300
          ],
          "id": "44f740f1-7849-4d41-bf55-57bb89ad4c08",
          "name": "Sticky Note6"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            20,
            200
          ],
          "id": "fa71cf61-6295-4c9e-a3da-3cb97eb1702a",
          "name": "When clicking â€˜Test workflowâ€™"
        },
        {
          "parameters": {
            "url": "https://www.artificialintelligence-news.com/feed/",
            "options": {}
          },
          "type": "n8n-nodes-base.rssFeedRead",
          "typeVersion": 1.1,
          "position": [
            760,
            200
          ],
          "id": "044501f8-aab3-4e4f-8fe0-083a933539ce",
          "name": "RSS Read"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c5321485-5348-4ca3-83af-3daf61b150d0",
                  "name": "title",
                  "value": "={{ $json.title }}",
                  "type": "string"
                },
                {
                  "id": "705a2b08-41fa-4764-b533-c855249eac53",
                  "name": "link",
                  "value": "={{ $json.link }}",
                  "type": "string"
                },
                {
                  "id": "b56b4d7d-9b6d-468f-a8c6-2ba9f2b13414",
                  "name": "contentSnippet",
                  "value": "={{ $json.contentSnippet }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            980,
            200
          ],
          "id": "d7042c29-2cb2-4edf-9522-749481418d35",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "news",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            1200,
            200
          ],
          "id": "fa734fc9-a226-47ad-8564-e026354c60f3",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=I'm creating a weekly digest from the latest AI articles for SMB executives. \nHelp me to pick 5 articles worth reading for these executives.\nOnly pick the ones that would be interesting for small and medium business owners.\n\n```\n{{ JSON.stringify($json.news) }}\n```",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            1420,
            200
          ],
          "id": "b954ac22-fc5f-402d-a5bc-3e819488d07b",
          "name": "Basic LLM Chain"
        },
        {
          "parameters": {
            "jsonSchemaExample": "{\n\t\"articles\": [{\n      \"title\": \"\",\n      \"link\": \"\"\n    }]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            1700,
            440
          ],
          "id": "434fe5dc-6a92-4289-b32d-9af01447849a",
          "name": "Structured Output Parser"
        },
        {
          "parameters": {
            "fieldToSplitOut": "output.articles",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            760,
            660
          ],
          "id": "7d133cb6-89b5-45ac-b7f2-659ae023da0a",
          "name": "Split Out"
        },
        {
          "parameters": {
            "url": "={{ $json.link }}",
            "options": {
              "redirect": {
                "redirect": {}
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            980,
            660
          ],
          "id": "2b83631b-fbce-4196-b19d-130cc7fadceb",
          "name": "HTTP Request"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "extractionValues": {
              "values": [
                {
                  "key": "article",
                  "cssSelector": ".elementor-widget-theme-post-content"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            1200,
            660
          ],
          "id": "1768254d-cff9-4e7b-9be6-1e903a412f18",
          "name": "HTML"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "articles",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            1420,
            660
          ],
          "id": "d2bc9444-75c7-49ac-bac0-1be960774bbf",
          "name": "Aggregate1"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Create a LinkedIn post with the title \"Here is everything that happened in AI this week\" and use the articles below to create an engaging content for SMB business owners.\n\n<instructions>\n- Don't use any markdown for the LinkedIn post as it's not supported (no bold, heading etc.) Use clear text for formatting.\n- Make sure to add the link to the article under its summary.\n- Add a summary of the post (hook) to the beginning of the post. It should consist of 2 short sentences, and needs to grab the attention. Make sure to mention AI in it.\n- also make sure the news summaries explains why it's important for SMB business owners, make it one sentence.\n</instructions>\n\n<articles>\n{{ JSON.stringify($json.articles) }}\n</articles>"
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            1000,
            1120
          ],
          "id": "49d34a49-4cd6-4ea8-a4f4-e734284e2d25",
          "name": "Basic LLM Chain1"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Rewrite the following linkedin post to match the style of the example post.\nMake sure to keep it as plain text.\n\n<ExamplePost>\n{{ $('Writing style').item.json.your_style }}\n</ExamplePost>\n\n<Article>\n{{ $json.text }}\n</Article>"
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            1360,
            1120
          ],
          "id": "ec4bd9df-ebaf-4149-b37d-2d56a4fb6f01",
          "name": "Basic LLM Chain2"
        },
        {
          "parameters": {
            "operation": "sendAndWait",
            "subject": "[action required] LinkedIn post approval is needed",
            "message": "={{ $json.linkedin_post }}",
            "responseType": "customForm",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Do you approve the post?",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "yes"
                      },
                      {
                        "option": "no - I'll add my change requests below"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "Change requests",
                  "fieldType": "textarea",
                  "placeholder": "Add your change requests here"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.gmail",
          "typeVersion": 2.1,
          "position": [
            1580,
            1600
          ],
          "id": "bc901fdb-d236-472b-a599-a529b594848d",
          "name": "Gmail",
          "webhookId": "1b16f0aa-aa5f-431f-8e85-247f4e981d6c",
          "credentials": {
            "gmailOAuth2": {
              "id": "E1ofNfqugb4UykcT",
              "name": "Gmail 2rum2room2"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "298e856c-87fa-4751-a235-eabed33f0f43",
                  "leftValue": "={{ $json.data['Do you approve the post?'] }}",
                  "rightValue": "yes",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1880,
            1600
          ],
          "id": "acaae32d-9f9c-44e1-85db-f5762113904e",
          "name": "If"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Apply the modification requests on the following LinkedIn post. Besides applying the reqested modifications, return the same linkedin post.\n\nLinkedIn post:\n```\n{{ $('Edit Fields1').item.json.linkedin_post }}\n```\n\nChange requests:\n{{ $json.data['Change requests'] }}",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            1500,
            1960
          ],
          "id": "7610541d-8dd4-482f-87c2-9057414e8741",
          "name": "Basic LLM Chain3"
        },
        {
          "parameters": {
            "jsonSchemaExample": "{\n\t\"modified_post\": \"\"\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            1740,
            2200
          ],
          "id": "2bc3be9f-9be4-49b6-8011-e9fa30106d19",
          "name": "Structured Output Parser1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a593cd1a-0603-4b52-9d1f-2f2f717651ff",
                  "name": "linkedin_post",
                  "value": "={{ $json.text }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1340,
            1600
          ],
          "id": "fe4b7db0-643e-4dfa-9356-d1d339eb4b0e",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f2075dc4-d6b0-46d9-aad8-247c054432ec",
                  "name": "text",
                  "value": "={{ $json.output.modified_post }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1880,
            1960
          ],
          "id": "6585ca7f-d75b-479b-b3a3-c3c47a8a8d1d",
          "name": "Edit Fields2"
        },
        {
          "parameters": {
            "person": "F_0mve6gG0",
            "text": "={{ $('Edit Fields1').item.json.linkedin_post }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.linkedIn",
          "typeVersion": 1,
          "position": [
            2460,
            1580
          ],
          "id": "39032942-25e7-453a-b507-f1c08799a8d8",
          "name": "LinkedIn",
          "credentials": {
            "linkedInOAuth2Api": {
              "id": "sOxyu51vK3iNtauN",
              "name": "LinkedIn account 3"
            }
          }
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4o",
              "mode": "list",
              "cachedResultName": "gpt-4o"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            980,
            1620
          ],
          "id": "b3829abf-008d-4703-9376-e39cea58767e",
          "name": "gpt-4o",
          "credentials": {
            "openAiApi": {
              "id": "9z2BF40dqIRV3ovL",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            660,
            1600
          ],
          "id": "324c2030-346b-40d0-8162-e3b9cf0ff123",
          "name": "gpt-4o-mini",
          "credentials": {
            "openAiApi": {
              "id": "9z2BF40dqIRV3ovL",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "content": "# Gather news articles",
            "height": 80,
            "width": 920
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            760,
            80
          ],
          "id": "6d341009-6e49-4453-8b03-fcb50d015629",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3474133c-bf58-4e48-aa50-bcebd919dc5b",
                  "name": "your_style",
                  "value": "=Dude... Firecrawl is amazing. Turn any website into LLM-ready data? Yes please. I just made a llms-full.txt of my website (all 80 blog posts! ðŸ¥µ) using a free account.\n\nI then threw that 250k token .txt file into Gemini for some analysis to...\n- review the ontology of my work and see the big picture\n- psychoanalyze myself (lol of course)\n\namazing, after that I was both feeling proud of myself (ðŸ¤©) and self-conscious of how obvious my psychological profile is from my published work (ðŸ˜…) so I figured I better make some real progress while I had all this data and an open chat with plenty of headroom in Gemini's sweet sweet 2m context window.\n\nSo I exported my google search console data for the past 3 months to add some analytical context to the content, and threw that into gemini too. Now we're up to ~300k tokens.\n\nI asked it to analyze my SEO and deliver a prioritized plan for improving my strategy.\n\nAnd not only did it give me a really thoughtful overview of my content map, it also was ready to give me an operational plan for improving the overall footprint, my linking strategies, etc. it also gave me some great non-obvious recommendations.\n\nFrankly, this has proven to be extremely effective. Just a year or two ago, this level of SEO analysis & strategic planning would easily have cost me a couple thousand bucks.\n\nBut now... I can do it for free with Claude Desktop + Firecrawl's MCP server, and Gemini 2.0 for 2M context window. \n\nNow... I just need to implement the 2 week plan it wrote for capitalizing on my top performing blogs it affectionately titled \"Stop The Bleeding\" lol, I appreciate Gemini's sense of urgency for improving my funnel.\n\nIt's a pity Squarespace is so poorly positioned for AI augmentation. I 100% have to move away from this platform to something that I can power agentically. \n\nI've thought about Ghost CMS, or building something myself with Lovable. But it's hard to prioritize that at the moment. It's a big lift to migrate a website to a new platform, even in this day and age. There's an opportunity in there somewhere for a hustler.\n\nAnyways, go play with Firecrawl. Well worth it. And if youâ€™ve got this far and you donâ€™t follow me yetâ€¦ wellâ€¦ you know what to do",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            340,
            200
          ],
          "id": "d1cd7039-78a1-4af4-a8d6-47be39f06b95",
          "name": "Writing style"
        },
        {
          "parameters": {
            "content": "# Edit your writing style",
            "height": 340,
            "width": 190,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            300,
            20
          ],
          "id": "f0ff21a2-fcc1-4496-b96b-88b343b8e5cf",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# Download article content",
            "height": 80,
            "width": 760
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            760,
            540
          ],
          "id": "78d8b4bf-b3e9-4782-a698-5622384f5a70",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# Create LinkedIn post content",
            "height": 80,
            "width": 620
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1000,
            1000
          ],
          "id": "1e656e73-13c3-43f3-b9a2-7cd41cd10502",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "content": "# Approval process",
            "height": 80,
            "width": 640
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1340,
            1480
          ],
          "id": "f89384ea-5216-4263-a008-a484943fc101",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "content": "# Edit the post",
            "height": 80,
            "width": 480
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1500,
            1840
          ],
          "id": "8d29fc25-cd86-4d1e-ab0a-ce5bf505403e",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "content": "# Post to LinkedIn",
            "height": 260,
            "width": 320,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            2420,
            1500
          ],
          "id": "6d7c6281-71c8-4e3b-b9db-714472aedc34",
          "name": "Sticky Note7"
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Test workflowâ€™": {
          "main": [
            [
              {
                "node": "Writing style",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "RSS Read": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Basic LLM Chain",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser": {
          "ai_outputParser": [
            [
              {
                "node": "Basic LLM Chain",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "HTML",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTML": {
          "main": [
            [
              {
                "node": "Aggregate1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate1": {
          "main": [
            [
              {
                "node": "Basic LLM Chain1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain1": {
          "main": [
            [
              {
                "node": "Basic LLM Chain2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain2": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gmail": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "LinkedIn",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Basic LLM Chain3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser1": {
          "ai_outputParser": [
            [
              {
                "node": "Basic LLM Chain3",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain3": {
          "main": [
            [
              {
                "node": "Edit Fields2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields2": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "gpt-4o": {
          "ai_languageModel": [
            [
              {
                "node": "Basic LLM Chain2",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Basic LLM Chain3",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "gpt-4o-mini": {
          "ai_languageModel": [
            [
              {
                "node": "Basic LLM Chain1",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Basic LLM Chain",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Writing style": {
          "main": [
            [
              {
                "node": "RSS Read",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "0aaa24f5-4101-4c5f-8857-427722e96007",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "ucEHSGg73IPzhX1n",
      "tags": []
    }
  },
  {
    "id": "google-deep-research",
    "title": "Google Programmable Deep Research",
    "description": "Uses programmable search plus scraping subflows to collect context, summarize sources, and hand results to downstream agents.",
    "problem": "Analysts need trustworthy research packs before writing; this workflow automates discovery, extraction, and consolidation.",
    "tags": [
      "research",
      "google",
      "scraping",
      "ai"
    ],
    "metadata": {
      "industries": [
        "research",
        "seo"
      ],
      "domains": [
        "deep-research",
        "scraping"
      ],
      "channels": [
        "notion",
        "docs"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "Google Programmable Search",
        "Crawl4AI",
        "OpenAI"
      ]
    },
    "workflow": {
      "name": "My workflow 14",
      "nodes": [
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w4)\n\n## Be part of a growing community and help us create more content like this",
            "height": 220,
            "width": 860,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -260,
            -420
          ],
          "id": "44f740f1-7849-4d41-bf55-57bb89ad4c08",
          "name": "Sticky Note6"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "5c28393f-6e8b-425b-babb-22eac9ad7238",
                  "name": "GOOGLE_API_KEY",
                  "value": "YOUR_GOOGLE_API_KEY_COMES_HERE",
                  "type": "string"
                },
                {
                  "id": "7f935132-6cb7-43a4-ae87-77336bd2cf82",
                  "name": "GOOGLE_CUSTOM_SEARCH",
                  "value": "YOUR_CUSTOM_SEARCH_ID_COMES_HERE",
                  "type": "string"
                },
                {
                  "id": "a848bf0c-0a5f-4acc-9412-aebd93c84380",
                  "name": "top_results",
                  "value": "={{ $json.top_results ?? 3 }}",
                  "type": "number"
                },
                {
                  "id": "c52bbef3-c0a6-4017-a403-abaaee216895",
                  "name": "context",
                  "value": "={{ $json.context }}",
                  "type": "string"
                },
                {
                  "id": "ae883a9e-7207-48ef-ad1f-9c86076e0308",
                  "name": "num_search_terms",
                  "value": "={{ $json.num_search_terms ?? 2 }}",
                  "type": "number"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            60,
            400
          ],
          "id": "77d185cd-6840-4178-b99d-ecbc681809dc",
          "name": "configuration"
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"search_terms\": {\n            \"type\": \"array\",\n            \"description\": \"the google search terms\",\n            \"items\": {\n                \"type\": \"string\"\n            }\n        }\n    },\n    \"required\": [\n        \"search_terms\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            600,
            700
          ],
          "id": "ce9663e3-b2fd-4a7f-a155-582882fc44f1",
          "name": "Structured Output Parser"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            1900,
            900
          ],
          "id": "d0d79be5-6a89-498d-91b4-ef33d5546d8f",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "9z2BF40dqIRV3ovL",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "fieldToSplitOut": "output.search_terms",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            740,
            400
          ],
          "id": "03b39df2-67d3-428c-913e-6d7ccc7a6bda",
          "name": "Split Out"
        },
        {
          "parameters": {
            "fieldToSplitOut": "items",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            1180,
            400
          ],
          "id": "15cb99a2-74f2-4c16-8032-e3cbbe1c4856",
          "name": "Split Out1"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "extractionValues": {
              "values": [
                {
                  "key": "data",
                  "cssSelector": "body",
                  "returnValue": "html"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            2060,
            400
          ],
          "id": "2a2020a9-974d-4adc-b1d3-07f0e4cb6978",
          "name": "HTML"
        },
        {
          "parameters": {
            "html": "={{ $json.data }}",
            "options": {}
          },
          "type": "n8n-nodes-base.markdown",
          "typeVersion": 1,
          "position": [
            2280,
            400
          ],
          "id": "035220d2-2759-46b3-ab8d-66f7005d2ff1",
          "name": "Markdown"
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"summary\": {\n            \"type\": \"string\",\n            \"description\": \"the summary of the content\"\n        }\n    },\n    \"required\": [\n        \"summary\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            3000,
            760
          ],
          "id": "a90ed520-7f70-445c-916a-4a30a46623ae",
          "name": "Structured Output Parser1"
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"relevant_to_context\": {\n            \"type\": \"boolean\",\n            \"description\": \"whether the researched content is relevant to the context\"\n        }\n    },\n    \"required\": [\n        \"relevant_to_article\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            3420,
            740
          ],
          "id": "d31c2a54-1b14-4d25-a3f0-21146531245d",
          "name": "Structured Output Parser2"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "research_results",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            4100,
            400
          ],
          "id": "255cd796-6d0f-4197-a4fa-60c85689bbc8",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "top_results",
                  "type": "number"
                },
                {
                  "name": "context"
                },
                {
                  "name": "num_search_terms",
                  "type": "number"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            -260,
            400
          ],
          "id": "642a7a80-84c0-47b3-b8d9-1e751d3152bc",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "content": "# Configure\n\n- Google API key\n- Google custom search id",
            "height": 400,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            0,
            220
          ],
          "id": "0b43d25d-8fa2-4097-8c77-89f088a0b977",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "# Google programmable search documentation\n\nhttps://developers.google.com/custom-search/v1/using_rest\nhttps://programmablesearchengine.google.com/controlpanel/all",
            "height": 200,
            "width": 620
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -260,
            -40
          ],
          "id": "6b7ab3e0-54b9-42b3-aa0f-da12b31a8e0e",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=<Context>\n{{ $json.context }}\n</Context>\n\n<Instructions>\nI want to run a research on Google on the context above. \nHelp me to come up with search terms I can use.\nI need exactly {{ $json.num_search_terms }} search term(s) - no more no less. \nMake sure to be creative, and give me different ones so I can get diverse search results.\n</Instructions>",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            380,
            400
          ],
          "id": "06920cd4-00a0-494a-abad-71af227500de",
          "name": "create search terms"
        },
        {
          "parameters": {
            "url": "https://www.googleapis.com/customsearch/v1",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "key",
                  "value": "={{ $('configuration').item.json.GOOGLE_API_KEY }}"
                },
                {
                  "name": "cx",
                  "value": "={{ $('configuration').item.json.GOOGLE_CUSTOM_SEARCH }}"
                },
                {
                  "name": "q",
                  "value": "={{ $json['output.search_terms'] }}"
                },
                {
                  "name": "num",
                  "value": "={{ $('configuration').item.json.top_results }}"
                },
                {
                  "name": "siteSearch",
                  "value": "reddit.com"
                },
                {
                  "name": "siteSearchFilter",
                  "value": "e"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            960,
            400
          ],
          "id": "3dd1ea7f-8c0d-41f9-a91c-0e9f2026b09b",
          "name": "search on Google",
          "retryOnFail": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c18ff56b-39fa-477c-a48d-bc65ad0a510d",
                  "leftValue": "={{ $json.mime }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notExists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            1400,
            400
          ],
          "id": "dc0c6d15-b885-430d-a0f6-0f2e7bbd9ca8",
          "name": "remove documents"
        },
        {
          "parameters": {
            "url": "={{ $json.link }}",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "user-agent",
                  "value": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1620,
            400
          ],
          "id": "b50aa2c5-8fb9-4b37-a8e6-80b00db43922",
          "name": "get the content of the link",
          "retryOnFail": false,
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "99cf6ac1-d77b-491c-86dc-44555032f5b0",
                  "leftValue": "={{ $json.error }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "notExists",
                    "singleValue": true
                  }
                },
                {
                  "id": "e6dd1301-acb8-4dc4-83d0-4d5b1a7f2036",
                  "leftValue": "={{ $json.data }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            1840,
            400
          ],
          "id": "22999b1a-9b5e-47ad-9ca9-5f7050bcc3ad",
          "name": "filter out the errors"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "e70a34f7-b723-47fe-a62f-1a318c483959",
                  "leftValue": "={{ $json.data }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            2500,
            400
          ],
          "id": "35ded490-70d5-49d4-9b10-9d58498c0489",
          "name": "filter empty results"
        },
        {
          "parameters": {
            "jsCode": "for (const item of $input.all()) {\n  item.json.data = item.json.data.replace(/!\\[[^\\]]+\\]\\([^\\)]+\\)/g, \"\") // remove images\n  item.json.data = item.json.data.replace(/\\[.*?\\]\\(.*?\\)/g, \"\") // remove links\n  item.json.data = item.json.data.replace(/\\n{2,}/g, \"\") // remove extra new line characters\n}\n\nreturn $input.all();"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2720,
            400
          ],
          "id": "e34ff673-58c4-4420-966e-2b5cca101ce7",
          "name": "cleanup the markdown"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=I've collected research content using Google search.\n\nRead the research content, and analyze whether it is relevant to the context below.\nMake sure it's also useful, and contains relevant information for my context.\n\n<Context>\n{{ $('configuration').item.json.context }}\n</Context>\n\n<ResearchContentSummary>\n{{ $json.output.summary }}\n</ResearchContentSummary>",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            3300,
            400
          ],
          "id": "d703961f-4dce-4a9b-85e0-1e716a790663",
          "name": "is it relevant?",
          "retryOnFail": true
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Please summarize the following content for me. Make sure to capture all the information in a concise format. Don't miss anything important.\nIgnore generic website elements like cookie policies, etc.\n\n<Content>\n{{ $json.data }}\n</Content>",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            2940,
            400
          ],
          "id": "0ff51b30-b172-476e-8798-d7421d8b5b58",
          "name": "summarize",
          "retryOnFail": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "a72e5161-9b19-45fb-bb4f-5ae28d3da266",
                  "leftValue": "={{ $json.output.relevant_to_context }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            3660,
            400
          ],
          "id": "4e21d3c2-c059-48e2-ad58-9eeef5e43b9d",
          "name": "filter irrelevant"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "53e16d12-8a90-4cf8-85e2-6aa2ef2ae3af",
                  "name": "summary",
                  "value": "={{ $('summarize').item.json.output.summary }}",
                  "type": "string"
                },
                {
                  "id": "1ca9f5a5-0e9a-47e6-9fef-079367dc4769",
                  "name": "title",
                  "value": "={{ $('remove documents').item.json.title }}",
                  "type": "string"
                },
                {
                  "id": "11c33d6b-d23c-4bc6-9003-b8ca022b3ada",
                  "name": "link",
                  "value": "={{ $('remove documents').item.json.link }}",
                  "type": "string"
                },
                {
                  "id": "eea8547b-2e21-4b71-a9dc-74639d658485",
                  "name": "snippet",
                  "value": "={{ $('remove documents').item.json.snippet }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3880,
            400
          ],
          "id": "797834a5-9a83-4685-a94c-8cd3e31b596b",
          "name": "set fields to return"
        },
        {
          "parameters": {
            "content": "# You can replace OpenAI with Ollama!",
            "height": 320,
            "width": 420
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1760,
            740
          ],
          "id": "98bfd96d-8cb6-4bd5-9e56-3a6fa1a648a3",
          "name": "Sticky Note1"
        }
      ],
      "pinData": {},
      "connections": {
        "configuration": {
          "main": [
            [
              {
                "node": "create search terms",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser": {
          "ai_outputParser": [
            [
              {
                "node": "create search terms",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "create search terms",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "summarize",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "is it relevant?",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "search on Google",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out1": {
          "main": [
            [
              {
                "node": "remove documents",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTML": {
          "main": [
            [
              {
                "node": "Markdown",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Markdown": {
          "main": [
            [
              {
                "node": "filter empty results",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser1": {
          "ai_outputParser": [
            [
              {
                "node": "summarize",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser2": {
          "ai_outputParser": [
            [
              {
                "node": "is it relevant?",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "configuration",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "create search terms": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "search on Google": {
          "main": [
            [
              {
                "node": "Split Out1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "remove documents": {
          "main": [
            [
              {
                "node": "get the content of the link",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get the content of the link": {
          "main": [
            [
              {
                "node": "filter out the errors",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "filter out the errors": {
          "main": [
            [
              {
                "node": "HTML",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "filter empty results": {
          "main": [
            [
              {
                "node": "cleanup the markdown",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "cleanup the markdown": {
          "main": [
            [
              {
                "node": "summarize",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "is it relevant?": {
          "main": [
            [
              {
                "node": "filter irrelevant",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "summarize": {
          "main": [
            [
              {
                "node": "is it relevant?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "filter irrelevant": {
          "main": [
            [
              {
                "node": "set fields to return",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "set fields to return": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "a4736b82-ed72-48f3-a786-adf8dfce43bd",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "ucEHSGg73IPzhX1n",
      "tags": []
    }
  },
  {
    "id": "ai-blog-writer",
    "title": "AI Blog Writer with Structured Research",
    "description": "Chains research subworkflows, scrapes supporting links, and generates multi-section blog posts ready for CMS handoff.",
    "problem": "Content teams struggle to turn raw research into long-form articles; this agent packages insights into publishable drafts.",
    "tags": [
      "blog",
      "content",
      "research",
      "writing"
    ],
    "metadata": {
      "industries": [
        "marketing",
        "content"
      ],
      "domains": [
        "blogging",
        "long-form"
      ],
      "channels": [
        "notion",
        "google-docs"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "OpenAI",
        "Notion",
        "Google Docs"
      ]
    },
    "workflow": {
      "name": "My workflow 14",
      "nodes": [
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w5)\n\n## Be part of a growing community and help us create more content like this",
            "height": 220,
            "width": 860,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            7400,
            560
          ],
          "id": "44f740f1-7849-4d41-bf55-57bb89ad4c08",
          "name": "Sticky Note6"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            7480,
            1440
          ],
          "id": "e792910d-0abd-4ede-b692-d018552286b7",
          "name": "When clicking â€˜Test workflowâ€™"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=I'm working on an article with the following topic:\n\n<TopicTitle>\n{{ $('Come up with a topic1').item.json.output.title }}\n</TopicTitle>\n\n<TopicSummary>\n{{ $('Come up with a topic1').item.json.output.summary }}\n</TopicSummary>\n\nOriginal articles we used as an inspiration to come up with the topic\n\n<InpirationArticles>\n{{ $('Come up with a topic1').item.json.output.inspirations.map(item => `<Article>\\n${item.article}\\n</Article>`).join('\\n') }}\n</InpirationArticles>\n\n\nI did a research on google and came up with the results below. Each article is the markdown content of the HTML body.\n\n<OnlineResearch>\n{{  $json.research_results.map(item => `<Article>\\n${item.summary}\\n</Article>`).join('\\n') }}\n</OnlineResearch>\n\nWrite an detailed, long, engaging article on the subject, make sure to structure the article well, breaking the long text with lists, using bold, etc..",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            11440,
            1440
          ],
          "id": "9d7bc9cb-66e6-4506-ba3d-140f38e14de4",
          "name": "Basic LLM Chain3"
        },
        {
          "parameters": {
            "content": "# 4. Write and post the article\n\n## After creating the article, you could other LLM chains or agents to add\n- SEO keywords\n- Add personality by rewriting the content in your style\n- Adding interlinks\n- Add sources",
            "height": 240,
            "width": 860
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            11440,
            1160
          ],
          "id": "b4094562-03f1-47fc-a40e-b5fede4f5d1f",
          "name": "Sticky Note5",
          "disabled": true
        },
        {
          "parameters": {
            "title": "={{ $json.output.title }}",
            "additionalFields": {
              "content": "={{ $json.content_html }}",
              "status": "publish"
            }
          },
          "type": "n8n-nodes-base.wordpress",
          "typeVersion": 1,
          "position": [
            12120,
            1440
          ],
          "id": "54bbcc1d-4cb5-4b1a-8c8b-7acf9c5a6139",
          "name": "Wordpress",
          "credentials": {
            "wordpressApi": {
              "id": "IvzKT4JMIWbSbJm3",
              "name": "Wordpress account"
            }
          }
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"title\": {\n            \"type\": \"string\",\n            \"description\": \"the title of the article\"\n        },\n        \"content\": {\n            \"type\": \"string\",\n            \"description\": \"the content of the article\"\n        }\n    },\n    \"required\": [\n        \"title\",\n        \"content\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            11700,
            1700
          ],
          "id": "39f365f4-755e-47b0-8e74-60e5acc494de",
          "name": "Structured Output Parser3"
        },
        {
          "parameters": {
            "mode": "markdownToHtml",
            "markdown": "={{ $json.output.content }}",
            "destinationKey": "content_html",
            "options": {}
          },
          "type": "n8n-nodes-base.markdown",
          "typeVersion": 1,
          "position": [
            11900,
            1440
          ],
          "id": "f2bf30a7-5d84-49cf-807b-73f156195a47",
          "name": "Markdown"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            10280,
            2180
          ],
          "id": "61f91620-db0d-4e86-9514-aa1556bcfef7",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "fieldToSplitOut": "bookmarks",
            "options": {
              "destinationFieldName": "bookmark"
            }
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            8260,
            1440
          ],
          "id": "42ab8e69-f335-4366-af5b-e7008ab61fab",
          "name": "Split Out"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "bookmarks",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            8700,
            1440
          ],
          "id": "d88487f8-565e-41de-98f7-aa7e8031ff54",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"ai_bookmarks\": {\n            \"type\": \"array\",\n            \"description\": \"user name\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"title\": {\n                        \"type\": \"string\"\n                    },\n                    \"link\": {\n                        \"type\": \"string\"\n                    }\n                },\n                \"required\": [\n                    \"title\",\n                    \"link\"\n                ]\n            }\n        }\n    },\n    \"required\": [\n        \"ai_bookmarks\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            9440,
            1700
          ],
          "id": "de812263-2794-492b-b793-7655fec7ca59",
          "name": "Structured Output Parser2"
        },
        {
          "parameters": {
            "url": "https://pinboard.in/popular/",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            7780,
            1440
          ],
          "id": "6b28714b-f206-4e5a-ac91-4ae400bf1be7",
          "name": "Get popular bookmarks"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "extractionValues": {
              "values": [
                {
                  "key": "bookmarks",
                  "cssSelector": ".display",
                  "returnValue": "html",
                  "returnArray": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            8040,
            1440
          ],
          "id": "f905febc-df2b-4b63-a04b-d0a85e7b9f41",
          "name": "Extract bookmarks"
        },
        {
          "parameters": {
            "operation": "extractHtmlContent",
            "dataPropertyName": "bookmark",
            "extractionValues": {
              "values": [
                {
                  "key": "link",
                  "cssSelector": ".bookmark_title",
                  "returnValue": "attribute",
                  "attribute": "href"
                },
                {
                  "key": "title",
                  "cssSelector": ".bookmark_title"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.html",
          "typeVersion": 1.2,
          "position": [
            8480,
            1440
          ],
          "id": "1b19927b-9cca-4dd0-9733-610e9f3c5a46",
          "name": "Extract bookmark"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Your job is to find an interesting topic to create an article about in the AI subject. The audience is \"AI enthusiasts\".\n\nYou are presented with popular articles (title and content). Please create an idea for an article that my AI enthusiastic audience will love. They are mostly knowledge workers, managers, leaders.\n\nThe thought process you should follow:\n1. Review all the articles from below\n2. Find the most interesting one for my audience. You can combine multiple articles if it makes sense.\n3. Return the articles used for inspiration by copying them over without changing the content.\n\n<Articles>\n{{ $('Aggregate3').item.json.articles.map(item => `<Article>\\n<Title>\\n${item.title}\\n</Title>\\n<Link>\\n${item.link}\\n<\\Link>\\n<Content>\\n${item.article}\\n</Content>\\n</Article>`).join('\\n') }}\n</Articles>",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            10580,
            1440
          ],
          "id": "d13ec8ec-ce16-413e-a458-25d20317d481",
          "name": "Come up with a topic1",
          "retryOnFail": true
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=<Instruction>\nYour job is to find AI related bookmarks that I can use as inspiration to write an article for my audience - mostly managers and leaders. Make sure you only pick bookmarks that are suitable for them.\n</Instruction>\n\n<ThoughtProcess>\nThe thought process you should follow:\n1. Review all the articles from below\n2. Find the ones that are AI related and relevant for my audience\n3. Return the title and the link of each AI related bookmarks\n</ThoughtProcess>\n\n<Bookmarks>\n{{ $json.bookmarks.map(bookmark => `<Bookmark>\\n<Title>${bookmark.title}</Title>\\n<Link>${bookmark.link}</Link>\\n</Bookmark>`).join('\\n') }}\n</Bookmarks>",
            "hasOutputParser": true
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.5,
          "position": [
            9160,
            1440
          ],
          "id": "6e96cd4d-9672-4f09-bb2a-1701cc99c6a5",
          "name": "Find trending AI bookmarks",
          "retryOnFail": true
        },
        {
          "parameters": {
            "fieldToSplitOut": "output.ai_bookmarks",
            "options": {
              "destinationFieldName": "bookmark"
            }
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            9500,
            1440
          ],
          "id": "892eef5f-8ceb-4520-a3ab-4ffc509ece81",
          "name": "Split Out3"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "articles",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            10120,
            1440
          ],
          "id": "155c67d1-943c-4126-af55-58d0983fd3bf",
          "name": "Aggregate3"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "d7b5f308-b2e9-49f7-b9bd-4d339d96d0ee",
                  "name": "article",
                  "value": "={{ $json.data }}",
                  "type": "string"
                },
                {
                  "id": "2cf35a52-6c39-4109-a5b2-3ae3e45fdde3",
                  "name": "title",
                  "value": "={{ $('Split Out3').item.json.bookmark.title }}",
                  "type": "string"
                },
                {
                  "id": "41c86ac7-6301-47a8-881d-9402f76e1a06",
                  "name": "link",
                  "value": "={{ $('Split Out3').item.json.bookmark.link }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            9920,
            1440
          ],
          "id": "5d4791d9-3d4a-4301-b60a-c7370f2d5592",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"title\": {\n            \"type\": \"string\"\n        },\n        \"summary\": {\n            \"type\": \"string\"\n        },\n        \"inspirations\": {\n            \"type\": \"array\",\n            \"description\": \"inspirations used to create the concept for the article\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"title\": {\n                        \"type\": \"string\",\n                        \"description\": \"the title of the inspiration\"\n                    },\n                    \"link\": {\n                        \"type\": \"string\",\n                        \"description\": \"the link of the inspiration\"\n                    },\n                    \"article\": {\n                        \"type\": \"string\",\n                        \"description\": \"the content of the inspiration\"\n                    }\n                },\n                \"required\": [\n                    \"title\",\n                    \"link\",\n                    \"article\"\n                ]\n            }\n        }\n    },\n    \"required\": [\n        \"inspirations\",\n        \"title\",\n        \"summary\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            10680,
            1720
          ],
          "id": "5bd6d308-42e8-49c1-b413-a21fa733479b",
          "name": "Structured Output Parser1"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "0HtQ72bNs1lx7LHj",
              "mode": "list",
              "cachedResultName": "Scrape link subworkflow"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "link": "={{ $json.bookmark.link }}"
              },
              "matchingColumns": [
                "link"
              ],
              "schema": [
                {
                  "id": "link",
                  "displayName": "link",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            9720,
            1440
          ],
          "id": "16ca64f9-1b83-414d-bc0e-a227278d1bcb",
          "name": "Scrape and summarize bookmarks"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "oSdtjLRztYX86nWY",
              "mode": "list",
              "cachedResultName": "Deep research subworkflow"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "top_results": 3,
                "num_search_terms": 2,
                "context": "=<Instructions>\nI'd like to create an article. I already got inspirations from other articles, and came up with a title and a summary. Find the data below.\n\nI want to run a research on Google on the subject to collect even more data/inspiration. Help me to come up with search terms I can use.\nI need 4 search terms. Make sure to be creative, and give me different ones so I can get diverse search results.\n</Instructions>\n\n<Title>\n{{ $json.output.title }}\n</Title>\n\n<Summary>\n{{ $json.output.summary }}\n</Summary>\n\n<Inspirations>\n{{ $json.output.inspirations.map(item => `<Inspiration>\\n${item.article}\\n</Inspiration>`).join('\\n') }}\n</Inspirations>"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "top_results",
                  "displayName": "top_results",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number"
                },
                {
                  "id": "context",
                  "displayName": "context",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "num_search_terms",
                  "displayName": "num_search_terms",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            10920,
            1440
          ],
          "id": "99d58229-a7d5-47a6-a202-31909d7ed7b5",
          "name": "Run deep research"
        },
        {
          "parameters": {
            "content": "# 1. Gather bookmarks",
            "height": 80,
            "width": 760
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            8040,
            1320
          ],
          "id": "90cc25ac-d580-4e29-a15f-4a66ebbdd936",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "# 2. Pick the related bookmarks",
            "height": 80,
            "width": 1060
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            9160,
            1320
          ],
          "id": "1e457227-47a7-489c-af94-157541dacb4a",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# 3. Create topic, deep research",
            "height": 80,
            "width": 560
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            10580,
            1320
          ],
          "id": "aa95b63c-b00d-4fc5-9a7a-7c6463a05fc7",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# I recommend you to add some kind of persistency so you won't use the same bookmarks twice",
            "height": 680,
            "width": 300,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            7680,
            980
          ],
          "id": "36eeeac5-19d7-4f7b-81ab-811e3e54346c",
          "name": "Sticky Note7"
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Test workflowâ€™": {
          "main": [
            [
              {
                "node": "Get popular bookmarks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain3": {
          "main": [
            [
              {
                "node": "Markdown",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser3": {
          "ai_outputParser": [
            [
              {
                "node": "Basic LLM Chain3",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Markdown": {
          "main": [
            [
              {
                "node": "Wordpress",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Basic LLM Chain3",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Find trending AI bookmarks",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Come up with a topic1",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Extract bookmark",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Find trending AI bookmarks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser2": {
          "ai_outputParser": [
            [
              {
                "node": "Find trending AI bookmarks",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Get popular bookmarks": {
          "main": [
            [
              {
                "node": "Extract bookmarks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract bookmarks": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract bookmark": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Find trending AI bookmarks": {
          "main": [
            [
              {
                "node": "Split Out3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out3": {
          "main": [
            [
              {
                "node": "Scrape and summarize bookmarks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate3": {
          "main": [
            [
              {
                "node": "Come up with a topic1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Aggregate3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser1": {
          "ai_outputParser": [
            [
              {
                "node": "Come up with a topic1",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Come up with a topic1": {
          "main": [
            [
              {
                "node": "Run deep research",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Scrape and summarize bookmarks": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Run deep research": {
          "main": [
            [
              {
                "node": "Basic LLM Chain3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "e50ee71f-9787-4aba-9a3f-28295ac93b96",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "ucEHSGg73IPzhX1n",
      "tags": []
    }
  },
  {
    "id": "shopify-product-videos",
    "title": "Shopify Product Video Factory",
    "description": "Collects Shopify catalog data, feeds prompts into Seedance + Fal/Latentsync, and assembles talking avatar product videos.",
    "problem": "Merchants want consistent video assets for ads and PDPs but canâ€™t produce them manually for every SKU.",
    "tags": [
      "shopify",
      "video",
      "fal",
      "seedance",
      "commerce"
    ],
    "metadata": {
      "industries": [
        "ecommerce",
        "marketing"
      ],
      "domains": [
        "video-generation"
      ],
      "channels": [
        "youtube",
        "instagram"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "Shopify",
        "Seedance",
        "Fal.ai",
        "Latentsync",
        "ElevenLabs"
      ]
    },
    "workflow": {
      "name": "My workflow 53",
      "nodes": [
        {
          "parameters": {
            "formTitle": "Create a UGC-like video from a Shopify product",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Shopify store URL",
                  "placeholder": "Add the full shopify URL here",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Search term",
                  "placeholder": "What search term we should use to find a product?",
                  "requiredField": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -780,
            800
          ],
          "id": "e14aed0b-0bfe-44c9-86f2-27cd83ef38b4",
          "name": "On form submission",
          "webhookId": "39b9f0f9-f469-4df0-82fc-5239911d77c5"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.SHOPIFY_URL }}/products.json?limit=250&page={{ $('Setup defaults').last().json.page }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -280,
            800
          ],
          "id": "4d93f9bd-63d3-49f9-91f9-f20489095e3b",
          "name": "Get the products from the Shopify store"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7d55d6da-a78c-4a28-9343-0ea9035a0aa3",
                  "name": "SHOPIFY_URL",
                  "value": "={{   ((u) => {   let s = u.trim();   if (!/^https?:\\/\\//i.test(s)) s = 'https://' + s;   const parts = s.split('/');   return parts[0] + '//' + parts[2]; })($('On form submission').first().json['Shopify store URL'])  }}",
                  "type": "string"
                },
                {
                  "id": "2915c500-dadd-414d-b49c-e4034ae4110d",
                  "name": "max_pages",
                  "value": 5,
                  "type": "number"
                },
                {
                  "id": "0d9bab79-3790-43e3-a338-8428daa23a3d",
                  "name": "max_products",
                  "value": 50,
                  "type": "number"
                },
                {
                  "id": "2ae82e10-3fd1-48ab-863c-dd98ad1688a8",
                  "name": "products",
                  "value": "={{ $json.products || [] }}",
                  "type": "array"
                },
                {
                  "id": "c7cbc705-4029-4a50-835d-1ebffc2a1fa7",
                  "name": "page",
                  "value": "={{ $json.page || 1 }}",
                  "type": "number"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -500,
            800
          ],
          "id": "b0ac5374-7484-4219-9b12-a3fcce8b4afa",
          "name": "Setup defaults"
        },
        {
          "parameters": {
            "content": "# 1. Select product",
            "height": 320,
            "width": 1700
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -540,
            680
          ],
          "id": "1000fdc3-0dcf-44da-9301-d5d770b65824",
          "name": "Sticky Note10"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            -760,
            1200
          ],
          "id": "0e73e26e-e33f-4f6b-85c6-ed2c843990a3",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "amount": 3
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            400,
            1940
          ],
          "id": "a75a3917-9dfd-4afa-9a6a-d9b4229bee8b",
          "name": "Wait for the image",
          "webhookId": "385de300-af3f-4db6-b9c8-23b2122a68a7"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the image').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            580,
            1940
          ],
          "id": "6284b9e2-d4f0-4ee6-a139-df8bd940211c",
          "name": "Get the image",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            760,
            1940
          ],
          "id": "0b7be214-1600-4200-bb9c-41b1377419d3",
          "name": "Image status"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the image').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1060,
            1980
          ],
          "id": "e8606bdb-eafc-4ac7-885c-b33201749999",
          "name": "Download the image",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/flux-pro/kontext/max/multi",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"prompt\": \"{{ $json.output.image_prompt }}\",\n  \"image_urls\": {{ JSON.stringify($('Aggregate base64').item.json.base64) }}\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            120,
            1940
          ],
          "id": "7c89e8b8-9ee9-4165-b577-8efb5872d772",
          "name": "Start generating the image",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/bytedance/seedance/v1/lite/image-to-video",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "prompt",
                  "value": "={{ $('Generate prompts').item.json.output.video_prompt }}"
                },
                {
                  "name": "image_url",
                  "value": "={{ $json.images[0].url }}"
                },
                {
                  "name": "end_image_url",
                  "value": "={{ $json.images[0].url }}"
                },
                {
                  "name": "resolution",
                  "value": "480p"
                },
                {
                  "name": "duration",
                  "value": "5"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1320,
            1940
          ],
          "id": "21cd9560-05c5-4e6a-9072-ad3c0268b983",
          "name": "Start generating the video",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "2c3a90c7-f43a-47b3-bec7-77fdae122bfc",
                  "name": "product",
                  "value": "={{ $('Limits exceeded?').last().json.products.find(item => item.title === $json.Product) }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            620,
            760
          ],
          "id": "88a48cc0-ebd2-422c-8efc-65824a8ff1ab",
          "name": "Setup product"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            1600,
            1940
          ],
          "id": "e5d5de10-d77c-4c1c-b3a8-735222f6276f",
          "name": "Wait for the video",
          "webhookId": "20df58f7-73b4-451f-8683-cf34eb4b6cfd"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the video').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1800,
            1940
          ],
          "id": "d5a4f624-c926-4ab6-a697-444fe9446e20",
          "name": "Get the video status",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            2040,
            1940
          ],
          "id": "ac5fa891-125b-4f97-8f01-1d2989f97d6d",
          "name": "Video status"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the video').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            2320,
            1980
          ],
          "id": "8ba31946-7376-44e3-94ae-7ec4f8a1f4d7",
          "name": "Get the  video",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "amount": 1
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -80,
            2340
          ],
          "id": "224e4eae-3cca-4710-806a-7a9219466f65",
          "name": "Wait for the speech",
          "webhookId": "900ad265-63ec-4840-aae6-7de08f4d9d14"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the speech').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            100,
            2340
          ],
          "id": "5a81c509-a2fe-43b0-bca1-7edadd93acba",
          "name": "Get the speech status",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/elevenlabs/tts/turbo-v2.5",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "text",
                  "value": "={{ $('Generate prompts').item.json.output.dialogue }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -300,
            2340
          ],
          "id": "5f789bae-1abf-4a19-bbb1-dd396e73ac2c",
          "name": "Start generating the speech",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            280,
            2340
          ],
          "id": "74ea81d8-4e94-43af-a8ee-b835c9724303",
          "name": "Speech status"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the speech').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            560,
            2380
          ],
          "id": "1f7f29a5-1e06-4761-aa2f-9d0fd3536d16",
          "name": "Get the speech",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/latentsync",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "video_url",
                  "value": "={{ $('Get the  video').item.json.video.url }}"
                },
                {
                  "name": "audio_url",
                  "value": "={{ $json.audio.url }}"
                },
                {
                  "name": "loop_mode",
                  "value": "loop"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            820,
            2340
          ],
          "id": "b1a3c761-e5d0-4e23-bc91-e5b3d2a2e619",
          "name": "Start generating the lipsync",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            1160,
            2340
          ],
          "id": "46dda3b9-e0d3-4854-9438-8d29d9aba277",
          "name": "Wait for the lipsync",
          "webhookId": "d21191bf-cc1c-4fd6-a08d-d01ce6c8108d"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the lipsync').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1360,
            2340
          ],
          "id": "598be352-79ea-4cf8-899e-5c7ac5c6936d",
          "name": "Get the lipsync status",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1600,
            2340
          ],
          "id": "429ec6b7-7652-482f-9a2b-f340c4cd4db5",
          "name": "Lipsync status"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the lipsync').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1880,
            2380
          ],
          "id": "3e879351-439b-4547-af0f-b05c0f409fc2",
          "name": "Get the lipsync video",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const products = [...$('Setup defaults').last().json.products];\n\nfor (const item of $input.all()) {\n  if (\n    `${item.json.title} ${item.json.body_html}`.toLowerCase()\n      .includes(\n        $('On form submission').first().json['Search term'].toLowerCase()\n      )\n  ) {\n    products.push(item.json);  \n  }\n}\n\nreturn {\n  json: {\n    products,\n    page: $('Setup defaults').last().json.page + 1\n  }\n}"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            100,
            800
          ],
          "id": "65a30b27-2f23-4142-9dde-9d34f0f3abed",
          "name": "Edit loop variables"
        },
        {
          "parameters": {
            "fieldToSplitOut": "products",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -80,
            800
          ],
          "id": "cd84f8c2-42fd-40a8-9042-9dc08c87ed34",
          "name": "For each product"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "9fdf17cd-63a3-4f2c-941f-5daa61d9a35c",
                  "leftValue": "={{ $json.page }}",
                  "rightValue": "={{ $('Setup defaults').first().json.max_pages }}",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                },
                {
                  "id": "958d42f5-27e4-4ff4-82d0-80d7f31c2771",
                  "leftValue": "={{ $json.products }}",
                  "rightValue": "={{ $('Setup defaults').first().json.max_products }}",
                  "operator": {
                    "type": "array",
                    "operation": "lengthGte",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            260,
            800
          ],
          "id": "4462e907-26f8-40da-8d51-978862a04898",
          "name": "Limits exceeded?"
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "=[\n   {\n      \"fieldLabel\": \"Product\",\n      \"requiredField\": true,\n      \"fieldType\": \"dropdown\",\n      \"fieldOptions\": {\n        \"values\": {{ JSON.stringify($json.products.map(item => { return {option: `${item.title}`} })) }}\n      }\n   }\n]",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            460,
            760
          ],
          "id": "987aaa68-c52c-4700-8c29-37575023492b",
          "name": "Select product",
          "webhookId": "02870f80-3c7b-4444-b8a5-5c433f3f91fc"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "Sit tight!",
            "completionMessage": "We are generating the video for you, it could take up to 5 minutes",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 1,
          "position": [
            960,
            820
          ],
          "id": "b3026030-3909-4eda-9ae1-0e454fb806d8",
          "name": "Close the form",
          "webhookId": "ccd96940-1401-43a8-9671-4086def029d4"
        },
        {
          "parameters": {
            "url": "={{ $json.selected_images }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1740,
            1560
          ],
          "id": "b59593cb-b5fe-4e3c-8f77-91e26f215bfb",
          "name": "Download image"
        },
        {
          "parameters": {
            "operation": "resize",
            "width": 800,
            "height": 800,
            "options": {}
          },
          "type": "n8n-nodes-base.editImage",
          "typeVersion": 1,
          "position": [
            1880,
            1560
          ],
          "id": "44a7ce26-18ae-4715-ab29-561b6a823d6e",
          "name": "Resize image"
        },
        {
          "parameters": {
            "operation": "binaryToPropery",
            "options": {}
          },
          "type": "n8n-nodes-base.extractFromFile",
          "typeVersion": 1,
          "position": [
            2040,
            1560
          ],
          "id": "3f925ded-7db5-4699-8c2c-c513acc9b756",
          "name": "Convert image to base64"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9136d2ce-9e89-4ee6-9a0b-bef338199bb5",
                  "name": "base64",
                  "value": "=data:image/{{ ((u)=>{let e=u.split('.').pop().split('?')[0]; return e==='jpg'?'jpeg':e})($('Split Out').last().json.selected_images) }};base64,{{ $json.data }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2220,
            1560
          ],
          "id": "5f80e68f-3b1e-4dcd-b0d8-6e04417173d9",
          "name": "Set base64 data"
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "base64"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            2380,
            1560
          ],
          "id": "4fbd6af3-829a-4367-9700-8d34d7b9938d",
          "name": "Aggregate base64"
        },
        {
          "parameters": {
            "content": "# 2. Setup images",
            "height": 680,
            "width": 3080
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -540,
            1060
          ],
          "id": "0424006f-6e66-46ca-8edb-f79112f188f8",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "# 3. Generate prompts + dialogue",
            "height": 360,
            "width": 560
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -540,
            1800
          ],
          "id": "16cf099e-7bee-4753-8902-0b50590620dd",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=<Instructions>\nI'm working on creating a UGC (user generated content) ad for a fashion ecommerce product item.\n\nOur goal is to create a scene, where we can build a 5s long video that can easily be looped. That means, that the background should be still, and the character should be standing and talking to the camera.\n\nCreate the following items:\n\n1. An image prompt\n\nCreate an image prompt, that describes the background, and since the AI image generator receives the reference image, it should say to wear the item from the image. Have the character stand at a very slight angle to the camera. Give the character a slight smile. Include in the image prompt, that any text, illustration, signature, frame or border should be removed. Also include, that the main character should be looking into the camera.\n\n2. Dialogue for the main character\n\nCreate a dialogue that's about 550 characters long, and talks about the item. Use the product description, and the reference image.\nThe dialogue should sound natural, like an amateur product review.\n\n3. Video prompt\nA detailed description of the 5s long clip, that will be looped. The character should be visibly speaking in the video, with a slight smile.\nThe emotion of the character should not change during the full length of the clip.\nWe want the character to be in a very natural pose, arms resting naturally at the sides, both feet planted on the ground.\nStart the clip with the weight on one foot and shift it to the other one very very slowly and naturally, then shift it back.\nInclude in the video prompt, that nothing should move behind the character, should be no lifting of the feet, and no excessive turning, knee bending, arm movements, or any other odd movements. \nInclude in the video prompt that the clip should contain minimal camera movement, zoom in or out. \n\n4. The sex of the person on the attached image\n\n</Instructions>\n\n<FashionItem>\n# {{ $('Setup product').item.json.product.title }}\n\n{{ $('Markdown').item.json.body }}\n</FashionItem>",
            "hasOutputParser": true,
            "messages": {
              "messageValues": [
                {
                  "type": "HumanMessagePromptTemplate",
                  "messageType": "imageUrl",
                  "imageUrl": "={{ $('Did we reach the limit?').last().json.selected_images[0] }}"
                }
              ]
            },
            "batching": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.7,
          "position": [
            -500,
            1960
          ],
          "id": "8e5742eb-c964-4710-ad6e-3ec1989c164d",
          "name": "Generate prompts",
          "retryOnFail": true
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"image_prompt\": {\n            \"type\": \"string\",\n            \"description\": \"The image prompt for the AI image generation\"\n        },\n        \"dialogue\": {\n            \"type\": \"string\",\n            \"description\": \"The dialogue that the main character should be saying to the camera\"\n        },\n        \"video_prompt\": {\n            \"type\": \"string\",\n            \"description\": \"The video prompt, that we are going to use to generate the video starting and finishing with the generated image\"\n        },\n        \"sex\": {\n            \"type\": \"string\",\n            \"description\": \"The sex of the person on the attached image\"\n        }\n    },\n    \"required\": [\n        \"image_prompt\",\n        \"dialogue\",\n        \"video_prompt\",\n        \"sex\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.3,
          "position": [
            -140,
            1900
          ],
          "id": "225b5ecd-d2c9-4ab0-b8ce-1ead188ac932",
          "name": "Structured Output Parser for prompt generation"
        },
        {
          "parameters": {
            "content": "# 4. Generate the main image",
            "height": 360,
            "width": 1140
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            80,
            1800
          ],
          "id": "52f403a7-5047-4c02-912c-9fab7246f41c",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# 5. Generate the looping video",
            "height": 360,
            "width": 1200
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1280,
            1800
          ],
          "id": "9cf40f40-acd0-4aeb-ad7c-601816b64d4b",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "content": "# 6. Generate speech",
            "height": 340,
            "width": 1260
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -540,
            2220
          ],
          "id": "4da17dbd-2fb9-4e1b-b073-20386ffe9c7b",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "content": "# 7. Generate lipsync",
            "height": 340,
            "width": 1300
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            780,
            2220
          ],
          "id": "06205a76-c6ec-489a-823a-5bfd328cb278",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "url": "={{ $json.video.url }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            2240,
            2360
          ],
          "id": "e0b44536-59f2-4408-86b0-8169df91b5c4",
          "name": "Download the video"
        },
        {
          "parameters": {
            "content": "# ðŸŽ‰ Here's the generated video",
            "height": 340,
            "width": 400,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            2140,
            2220
          ],
          "id": "b76f4649-1ba3-4166-9d89-0c68f201f295",
          "name": "Sticky Note6"
        },
        {
          "parameters": {
            "model": "qwen3:32b",
            "options": {
              "numCtx": 16048
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
          "typeVersion": 1,
          "position": [
            -1220,
            1200
          ],
          "id": "31c9123f-53c5-49ed-b2a8-3301fdab612f",
          "name": "Ollama Chat Model",
          "credentials": {
            "ollamaApi": {
              "id": "cWXUsJ0LsqnzOEx0",
              "name": "Ollama account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
          "typeVersion": 1,
          "position": [
            -900,
            1200
          ],
          "id": "85d542bc-7eea-45ef-b325-70a26a905c96",
          "name": "DeepSeek Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": "tngtech/deepseek-r1t-chimera:free",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
          "typeVersion": 1,
          "position": [
            -760,
            1540
          ],
          "id": "c39d2a13-c05a-4b16-b91e-d66cba75248e",
          "name": "OpenRouter Chat Model",
          "credentials": {
            "openRouterApi": {
              "id": "pKxg2Rhtt3cG3h19",
              "name": "OpenRouter account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1220,
            1540
          ],
          "id": "6e3a85d7-3606-4e1b-af9b-86e72328c9f1",
          "name": "Google Gemini Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
          "typeVersion": 1,
          "position": [
            -1220,
            1360
          ],
          "id": "f61c7c00-faa5-43cc-b81f-8976a0590588",
          "name": "Azure OpenAI Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            -1060,
            1360
          ],
          "id": "3920c595-cc60-4ce7-8911-fef177b2e165",
          "name": "xAI Grok Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "claude-sonnet-4-20250514",
              "cachedResultName": "Claude 4 Sonnet"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            -900,
            1360
          ],
          "id": "bdb4ccc3-c1ee-4a3b-ad04-641901b70393",
          "name": "Anthropic Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            -760,
            1360
          ],
          "id": "e5f71064-092d-48f7-8416-743ead6c3d2a",
          "name": "xAI Grok Chat Model1",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
          "typeVersion": 1,
          "position": [
            -900,
            1540
          ],
          "id": "0a6bbe13-409b-4c9b-b766-fea9349d3bf9",
          "name": "Groq Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAwsBedrock",
          "typeVersion": 1,
          "position": [
            -1060,
            1200
          ],
          "id": "877a7de7-575d-472d-bd80-fdf066109e54",
          "name": "AWS Bedrock Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
          "typeVersion": 1,
          "position": [
            -1060,
            1540
          ],
          "id": "eacd8a9e-e1e0-4eb2-b78c-caaeecc33b42",
          "name": "Mistral Cloud Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "content": "# Pick your choice of LLM âš ï¸\nâš ï¸ Make sure to deactive/delete the rest of the LLMs after selecting one",
            "height": 680,
            "width": 700,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1300,
            1060
          ],
          "id": "0b2b2a14-9a10-4d4a-b248-81482f67fdf7",
          "name": "Sticky Note7"
        },
        {
          "parameters": {
            "content": "# How to set up this automation?\n\n## Make sure to use n8n `1.97.1` or higher, lower versions could break the stuctured output node\n\n## 1. Setup the two LLM nodes, select a multimodal (!) LLM - I recommend using GPT 4.1 or GPT 4.1-mini. Make sure to disable the rest of the chat nodes.\n## 2. Find all the `Start generating the ...` and `Get the ... status` nodes, and setup your fal.ai authentication. Make sure to use this format in the header authentication: `key YOUR_KEY` - first writing `key` then a space and then pasting in your API key.\n",
            "height": 360,
            "width": 1680,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            240,
            160
          ],
          "id": "0f2305af-e8ad-45aa-a733-f3a74daf051d",
          "name": "Sticky Note14"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w9)\n\n## Be part of a growing community and help us create more content like this",
            "height": 260,
            "width": 700,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -540,
            260
          ],
          "id": "b9526699-6155-43e5-a53e-a48b78e0800e",
          "name": "Sticky Note16"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bcbc506b-434c-4738-9a63-dd38efcace4f",
                  "name": "voice",
                  "value": "={{ $('Generate prompts').item.json.sex === \"female\" ? \"Aria\" : \"Roger\" }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -500,
            2340
          ],
          "id": "fb2f27c3-a4c2-4648-b8a1-a298ce5d0ddb",
          "name": "Set the voice based on sex"
        },
        {
          "parameters": {
            "html": "={{ $json.product.body_html }}",
            "destinationKey": "body",
            "options": {}
          },
          "type": "n8n-nodes-base.markdown",
          "typeVersion": 1,
          "position": [
            780,
            760
          ],
          "id": "beb071d2-16a4-4144-ab8b-32375e0878e7",
          "name": "Markdown"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "e644bc63-a4ad-476a-9abd-c2e43e748bc7",
                  "leftValue": "={{ $json.product.images }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthEquals",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -500,
            1180
          ],
          "id": "ad8c0047-7b95-4859-894a-b551b08a9aaf",
          "name": "no images"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "b623894a-44da-4a24-9dc0-47754ac2945f",
                  "name": "images",
                  "value": "={{ $json.images || $json.product.images.filter(image => image.width > 200) }}",
                  "type": "array"
                },
                {
                  "id": "116430be-b1a8-4152-b7cb-3891e534aca2",
                  "name": "selected_images",
                  "value": "={{ $json.selected_images || [] }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -220,
            1260
          ],
          "id": "b48dd1fd-a3ef-459d-bab6-4b334de53ba5",
          "name": "Setup loop variables"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "93eadf68-6cab-4bcb-92c0-186fa6446c8e",
                  "name": "images",
                  "value": "={{ $('Setup loop variables').last().json.images.slice(1) }}",
                  "type": "array"
                },
                {
                  "id": "1669e0f6-4a4c-4d76-aee7-ee544db28e73",
                  "name": "selected_images",
                  "value": "={{\n\n$json.text === \"Allowed\" ? \n  [...$('Setup loop variables').last().json.selected_images, $('Setup image for processing').last().json.image_for_processing.src] :\n  $('Setup loop variables').last().json.selected_images\n\n}}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1080,
            1360
          ],
          "id": "d47da686-6ca7-4347-97cb-b5645ba431aa",
          "name": "Update loop variables"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "92a8b8a3-59ed-4e2d-b652-d63b07b8ab59",
                  "name": "image_for_processing",
                  "value": "={{ $json.images[0] }}",
                  "type": "object"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -40,
            1260
          ],
          "id": "aa0af2e6-38d4-4422-9f9f-c62e81bccfbd",
          "name": "Setup image for processing"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "9dec6eba-f1d6-4b7e-bd6e-a808358d44bf",
                  "leftValue": "={{ $json.image_for_processing.width }}",
                  "rightValue": 200,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            180,
            1260
          ],
          "id": "b8bd3400-4ab1-4d26-9f87-db168e5bb7c8",
          "name": "The image is large enough"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "4dfe8c89-e1a3-4822-b442-009e514b97e8",
                  "name": "images",
                  "value": "={{ $('Setup loop variables').last().json.images.slice(1) }}",
                  "type": "array"
                },
                {
                  "id": "6dca0fae-b336-40be-a596-87511ef26e53",
                  "name": "selected_images",
                  "value": "={{ $('Setup loop variables').last().json.selected_images }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            760,
            1540
          ],
          "id": "66201f5e-e3db-4862-953d-3d96fbc34ff7",
          "name": "Skip item"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c8696b5c-288f-437f-ad0b-4c9e83cf7b28",
                  "leftValue": "={{ \n\n$json.selected_images.map(image => (u => u.split('?')[0].split('.').pop())(image)).includes('png')\n\n&&\n\n$json.selected_images.length >= 2 \n\n}}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                },
                {
                  "id": "fa369de6-0e9f-4c2a-a887-d73dfd957b2c",
                  "leftValue": "={{ \n\n!$json.selected_images.map(image => (u => u.split('?')[0].split('.').pop())(image)).includes('png')\n\n&& \n\n$json.selected_images.length >= 4 }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                },
                {
                  "id": "214cf419-6544-4c5c-a6ca-c1e8ff166f5d",
                  "leftValue": "={{ $json.images }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthEquals",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "or"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1260,
            1540
          ],
          "id": "420d8cda-77ca-4b46-b162-15b16255f1d4",
          "name": "Did we reach the limit?"
        },
        {
          "parameters": {
            "fieldToSplitOut": "selected_images",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            1600,
            1560
          ],
          "id": "bc9b8c12-73e4-4a79-81ea-dab7be2a9740",
          "name": "Split Out"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5c137ab9-02fb-432d-b983-35a3ebf082db",
                  "leftValue": "={{ $json.selected_images }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthEquals",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1440,
            1460
          ],
          "id": "674b8e9e-689a-4d74-9270-978f3d5c3112",
          "name": "No usable image?"
        },
        {
          "parameters": {
            "errorMessage": "There was no usable image for the selected product"
          },
          "type": "n8n-nodes-base.stopAndError",
          "typeVersion": 1,
          "position": [
            1620,
            1300
          ],
          "id": "c589d429-56c6-404a-95ac-db8d7ae332e2",
          "name": "No usable image error"
        },
        {
          "parameters": {
            "errorMessage": "No images found for the selected product"
          },
          "type": "n8n-nodes-base.stopAndError",
          "typeVersion": 1,
          "position": [
            -220,
            1080
          ],
          "id": "602b0fac-514e-4b55-a770-c632a2d9b769",
          "name": "No image error"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=You are an AI system reviewing ecommerce product images. Your goal is to identify and flag images that contain significant explanatory or descriptive text overlaid on the image, such as labels, callouts, arrows with text, or UI elements that describe product features directly on the image (for example: \"Waist Tie-up\", \"Thread detailing\", \"Checkered pattern\", diagrams, or instructions).\n\nAllow for:\n\nSmall logos, watermarks, or brand signatures that are unobtrusive and do not describe product features.\nDo NOT allow:\n\nOverlaid text that explains, labels, or calls out product details/features, UI labels, instructions, or prominent text boxes/arrows on the main image content.\nYour output should be:\n\n\"Flagged\" if the image has any explanatory or callout text as described above.\n\"Allowed\" if the image only contains a logo, watermark, or signature.\nExamples:\n\nIf the image contains callouts like \"Checkered pattern\" or \"Thread detailing\" with arrows pointing to those features, respond with \"Flagged\".\nIf the only text is a small brand logo or signature, respond with \"Allowed\".",
            "messages": {
              "messageValues": [
                {
                  "type": "HumanMessagePromptTemplate",
                  "messageType": "imageUrl",
                  "imageUrl": "={{ $('Setup image for processing').item.json.image_for_processing.src }}",
                  "imageDetail": "high"
                }
              ]
            },
            "batching": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.7,
          "position": [
            600,
            1260
          ],
          "id": "9f2e7107-88d7-4d0d-9787-ca882d39c6d8",
          "name": "Analyze image"
        }
      ],
      "pinData": {},
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "Setup defaults",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the products from the Shopify store": {
          "main": [
            [
              {
                "node": "For each product",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup defaults": {
          "main": [
            [
              {
                "node": "Get the products from the Shopify store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Generate prompts",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Analyze image",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the image": {
          "main": [
            [
              {
                "node": "Get the image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the image": {
          "main": [
            [
              {
                "node": "Image status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Image status": {
          "main": [
            [
              {
                "node": "Download the image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download the image": {
          "main": [
            [
              {
                "node": "Start generating the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating the image": {
          "main": [
            [
              {
                "node": "Wait for the image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup product": {
          "main": [
            [
              {
                "node": "Markdown",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the video": {
          "main": [
            [
              {
                "node": "Get the video status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the video status": {
          "main": [
            [
              {
                "node": "Video status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video status": {
          "main": [
            [
              {
                "node": "Get the  video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating the video": {
          "main": [
            [
              {
                "node": "Wait for the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the  video": {
          "main": [
            [
              {
                "node": "Set the voice based on sex",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the speech": {
          "main": [
            [
              {
                "node": "Get the speech status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the speech status": {
          "main": [
            [
              {
                "node": "Speech status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating the speech": {
          "main": [
            [
              {
                "node": "Wait for the speech",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Speech status": {
          "main": [
            [
              {
                "node": "Get the speech",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the speech",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the speech",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the speech": {
          "main": [
            [
              {
                "node": "Start generating the lipsync",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating the lipsync": {
          "main": [
            [
              {
                "node": "Wait for the lipsync",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the lipsync": {
          "main": [
            [
              {
                "node": "Get the lipsync status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the lipsync status": {
          "main": [
            [
              {
                "node": "Lipsync status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Lipsync status": {
          "main": [
            [
              {
                "node": "Get the lipsync video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the lipsync",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the lipsync",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit loop variables": {
          "main": [
            [
              {
                "node": "Limits exceeded?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "For each product": {
          "main": [
            [
              {
                "node": "Edit loop variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limits exceeded?": {
          "main": [
            [
              {
                "node": "Select product",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Setup defaults",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Select product": {
          "main": [
            [
              {
                "node": "Setup product",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Close the form": {
          "main": [
            [
              {
                "node": "no images",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download image": {
          "main": [
            [
              {
                "node": "Resize image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Resize image": {
          "main": [
            [
              {
                "node": "Convert image to base64",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Convert image to base64": {
          "main": [
            [
              {
                "node": "Set base64 data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set base64 data": {
          "main": [
            [
              {
                "node": "Aggregate base64",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate base64": {
          "main": [
            [
              {
                "node": "Generate prompts",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate prompts": {
          "main": [
            [
              {
                "node": "Start generating the image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser for prompt generation": {
          "ai_outputParser": [
            [
              {
                "node": "Generate prompts",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Get the lipsync video": {
          "main": [
            [
              {
                "node": "Download the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set the voice based on sex": {
          "main": [
            [
              {
                "node": "Start generating the speech",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Markdown": {
          "main": [
            [
              {
                "node": "Close the form",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "no images": {
          "main": [
            [
              {
                "node": "No image error",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Setup loop variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup loop variables": {
          "main": [
            [
              {
                "node": "Setup image for processing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup image for processing": {
          "main": [
            [
              {
                "node": "The image is large enough",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update loop variables": {
          "main": [
            [
              {
                "node": "Did we reach the limit?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "The image is large enough": {
          "main": [
            [
              {
                "node": "Analyze image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Skip item",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Skip item": {
          "main": [
            [
              {
                "node": "Did we reach the limit?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Did we reach the limit?": {
          "main": [
            [
              {
                "node": "No usable image?",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Setup loop variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Download image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No usable image?": {
          "main": [
            [
              {
                "node": "No usable image error",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Analyze image": {
          "main": [
            [
              {
                "node": "Update loop variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "cd0a0230-27dd-4026-9842-1247d919867e",
      "meta": {
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "luNO1hHMDUnffHAs",
      "tags": []
    }
  },
  {
    "id": "scary-story-tiktok",
    "title": "Scary Story TikTok Generator",
    "description": "Scrapes Reddit horror prompts, writes scripts with Gemini, renders scenes with Together AI, and posts short-form videos.",
    "problem": "Faceless YouTube/TikTok channels need a constant stream of spooky stories without writing or editing each clip.",
    "tags": [
      "tiktok",
      "reddit",
      "video",
      "horror",
      "fal"
    ],
    "metadata": {
      "industries": [
        "media",
        "entertainment"
      ],
      "domains": [
        "short-video"
      ],
      "channels": [
        "tiktok",
        "youtube"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "Reddit",
        "Together AI",
        "Postiz",
        "Fal.ai"
      ]
    },
    "workflow": {
      "name": "Episode 18 Scary Stories TikTok final",
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            -2620,
            1920
          ],
          "id": "17a3416c-8768-4930-8284-9a86aaa31708",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.together.ai/v1/images/generations",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "model",
                  "value": "black-forest-labs/FLUX.1-schnell-Free"
                },
                {
                  "name": "prompt",
                  "value": "={{ $json.image_prompt }}"
                },
                {
                  "name": "width",
                  "value": "={{ 720 }}"
                },
                {
                  "name": "height",
                  "value": "={{ 1280 }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -2240,
            1660
          ],
          "id": "c6b3aa8e-5717-4c01-b8be-5a336406b497",
          "name": "Generate AI image",
          "alwaysOutputData": false,
          "credentials": {
            "httpBearerAuth": {
              "id": "Y58EiorQxBVC7D3s",
              "name": "Together AI"
            }
          },
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "url",
                  "value": "={{ $json.data[0].url }}"
                },
                {
                  "name": "media_type",
                  "value": "image"
                }
              ]
            },
            "options": {
              "timeout": 10000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1940,
            1600
          ],
          "id": "20e3cb91-358e-4845-b81c-d7d9c51a7ae5",
          "name": "Upload image to server",
          "retryOnFail": true
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $('Start generating TTS (chatterbox)').item.json.file_id }}/status",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1260,
            1720
          ],
          "id": "0a5c293a-be60-4392-a81a-88500dc83f92",
          "name": "Get status of TTS generation",
          "retryOnFail": true
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "ready",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "91402596-3978-4dfc-91b7-9ffe3521b862"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "ready"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0c29765e-4213-434c-9bf3-c5e854dd6ee8",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "processing",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "processing"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4a6cfd86-e690-417e-aa6d-ae497e1177ae",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "not_found",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "failed"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1080,
            1780
          ],
          "id": "42469903-80f0-4abc-a2c0-4db83d6b2376",
          "name": "TTS status switch"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/video-tools/generate/tts-captioned-video",
            "sendBody": true,
            "contentType": "form-urlencoded",
            "specifyBody": "string",
            "body": "={{ \n\n[\n  `background_id=${$('Upload image to server').last().json.file_id}`,\n  `audio_id=${$json.tts_audio_id}`,\n  `text=${encodeURIComponent($('Loop Over Items').last().json.text)}`,\n  'caption_config_line_count=2',\n  'caption_config_line_max_length=15',\n  'caption_config_font_size=80',\n  'caption_config_font_bold=true',\n  'caption_config_font_color=ffffff',\n  'caption_config_subtitle_position=bottom',\n  'image_effect=pan'\n].filter(Boolean).join('&')\n\n}}",
            "options": {
              "redirect": {
                "redirect": {}
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -680,
            1760
          ],
          "id": "efca6ecb-3e86-476c-8a19-3382dd8c420d",
          "name": "Start generating captioned TTS video"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $('Start generating captioned TTS video').item.json.file_id }}/status",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -280,
            1780
          ],
          "id": "3685a5e8-dbc9-4439-b61d-c0ac69c38096",
          "name": "Get video generation status",
          "retryOnFail": true
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "ready",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "91402596-3978-4dfc-91b7-9ffe3521b862"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "ready"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0c29765e-4213-434c-9bf3-c5e854dd6ee8",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "processing",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "processing"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4a6cfd86-e690-417e-aa6d-ae497e1177ae",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "not_found",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "failed"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -100,
            1780
          ],
          "id": "cff75dab-68cd-44bf-993d-9d80973fa135",
          "name": "Video generation switch"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a7fdacca-749e-4f69-84fd-50075e0e3409",
                  "name": "video_id",
                  "value": "={{ $('Start generating captioned TTS video').item.json.file_id }}",
                  "type": "string"
                },
                {
                  "id": "6c99c267-5c41-4697-ba19-b51d9e8c9a4e",
                  "name": "tts_id",
                  "value": "={{ $('Setup TTS file_id').item.json.tts_audio_id }}",
                  "type": "string"
                },
                {
                  "id": "21dd08a7-f785-4829-8609-a99950f21572",
                  "name": "image_id",
                  "value": "={{ $('Upload image to server').item.json.file_id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            160,
            1780
          ],
          "id": "fc3419e0-edf0-435e-951f-c4b88d3f4214",
          "name": "Setup media fields"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -2180,
            2120
          ],
          "id": "99225c4c-5012-4675-b177-2cc1f473354a",
          "name": "Combine loop items"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/video-tools/merge",
            "sendBody": true,
            "contentType": "form-urlencoded",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "video_ids",
                  "value": "={{ $json.data.map(item => item.video_id).join(',') }}"
                },
                {
                  "name": "background_music_id",
                  "value": "={{ $('Set background music id').first().json.background_music_id ?? '' }}"
                },
                {
                  "name": "background_music_volume",
                  "value": "={{ $('Configure me').first().json.background_music_volume }}"
                }
              ]
            },
            "options": {
              "redirect": {
                "redirect": {}
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1980,
            2120
          ],
          "id": "2b6905e2-4455-4da1-ba0b-f2401e8d2543",
          "name": "Start merging the videos"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $('Start merging the videos').item.json.file_id }}/status",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1560,
            2160
          ],
          "id": "25055217-2567-44cb-b744-c433af2d6884",
          "name": "Get status of the video merge"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "ready",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "91402596-3978-4dfc-91b7-9ffe3521b862"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "ready"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0c29765e-4213-434c-9bf3-c5e854dd6ee8",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "processing",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "processing"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4a6cfd86-e690-417e-aa6d-ae497e1177ae",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "not_found",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "failed"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1380,
            2180
          ],
          "id": "9decfc13-e138-4885-916c-9b9a316a2646",
          "name": "Video merge status switch"
        },
        {
          "parameters": {
            "amount": 10
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -1940,
            1780
          ],
          "id": "aa67d849-7d3f-42c8-845a-ad9076b2063d",
          "name": "Wait for the error / rate limit to go away",
          "webhookId": "dd4b24dd-3b50-4c92-b78f-2744086ba9d2"
        },
        {
          "parameters": {
            "amount": 1
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -1440,
            1720
          ],
          "id": "f2ac1bba-9d67-4277-8887-8df8fc24b3a4",
          "name": "Wait until the TTS gets generated",
          "webhookId": "5440c431-012b-43be-a88b-13c011800acc"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/audio-tools/tts/chatterbox",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "text",
                  "value": "={{ $('Loop Over Items').item.json.text }}"
                },
                {
                  "name": "sample_audio_id",
                  "value": "={{ $('Set sample voice id').first().json.sample_audio_id ?? '' }}"
                },
                {
                  "name": "exaggeration",
                  "value": "={{ $('Configure me').first().json.chatterbox_exaggeration }}"
                },
                {
                  "name": "cfg_weight",
                  "value": "={{ $('Configure me').first().json.chatterbox_cfg_weight }}"
                },
                {
                  "name": "temperature",
                  "value": "={{ $('Configure me').first().json.chatterbox_temperature }}"
                },
                {
                  "name": "chunk_chars",
                  "value": "256"
                },
                {
                  "name": "chunk_silence_ms",
                  "value": "350"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1620,
            1720
          ],
          "id": "a12564d2-a23a-41ad-95ed-0415f721be70",
          "name": "Start generating TTS (chatterbox)"
        },
        {
          "parameters": {
            "amount": 1
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -480,
            1780
          ],
          "id": "c0e279ff-3ade-4e2b-a188-6ee2ea210d0b",
          "name": "Wait until the video gets generated",
          "webhookId": "7ee4a3f6-a2f2-4b53-a6c1-cd3c23bc9aec"
        },
        {
          "parameters": {
            "amount": 1
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -1760,
            2160
          ],
          "id": "d3a2104f-5a96-427e-aa62-74a12ccb654f",
          "name": "Wait until the videos gets merged together",
          "webhookId": "291478b4-ab17-41fa-9c4c-c206ac8683c2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "d41f1ef6-7591-41b7-805d-94b58caba5c4",
                  "name": "tts_audio_id",
                  "value": "={{ $('Start generating TTS (chatterbox)').item.json.file_id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -900,
            1760
          ],
          "id": "3ba034bf-4491-4b28-91ab-e87033cd18c5",
          "name": "Setup TTS file_id"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            320,
            240
          ],
          "id": "795a40ab-a8cf-4067-8190-e83aa82dff05",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "content": "# Pick your choice of LLM âš ï¸\nâš ï¸ Make sure to deactive/delete the rest of the LLMs after selecting one",
            "height": 700,
            "width": 700,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -220,
            100
          ],
          "id": "b010fe49-1edc-4afa-a7ed-0dbda845047d",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "model": "qwen3:32b",
            "options": {
              "numCtx": 16048
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
          "typeVersion": 1,
          "position": [
            -140,
            240
          ],
          "id": "1fda7c39-546e-486d-bff1-e99e423ef367",
          "name": "Ollama Chat Model",
          "credentials": {
            "ollamaApi": {
              "id": "cWXUsJ0LsqnzOEx0",
              "name": "Ollama account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
          "typeVersion": 1,
          "position": [
            180,
            240
          ],
          "id": "77941471-b8f2-4177-8fe0-a99797400522",
          "name": "DeepSeek Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": "tngtech/deepseek-r1t-chimera:free",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
          "typeVersion": 1,
          "position": [
            320,
            580
          ],
          "id": "6bd948a1-6cc3-43ca-b7b9-d44d4971d13b",
          "name": "OpenRouter Chat Model",
          "credentials": {
            "openRouterApi": {
              "id": "pKxg2Rhtt3cG3h19",
              "name": "OpenRouter account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -140,
            580
          ],
          "id": "7b9e29e5-9313-4265-92ae-1a86d4143ec9",
          "name": "Google Gemini Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
          "typeVersion": 1,
          "position": [
            -140,
            400
          ],
          "id": "d6909aea-9d61-4b09-8ac2-440a8c5526fd",
          "name": "Azure OpenAI Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            20,
            400
          ],
          "id": "a13b8bbd-f24f-497f-ba91-416919517577",
          "name": "xAI Grok Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "claude-sonnet-4-20250514",
              "cachedResultName": "Claude 4 Sonnet"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            180,
            400
          ],
          "id": "12592026-f863-4383-bcd4-e8d14fd756fb",
          "name": "Anthropic Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            320,
            400
          ],
          "id": "c51ea62f-9690-43d2-a96d-79f114caa340",
          "name": "xAI Grok Chat Model1",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
          "typeVersion": 1,
          "position": [
            180,
            580
          ],
          "id": "0f5a2a6c-5e99-4a34-9244-658f4414ce7b",
          "name": "Groq Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAwsBedrock",
          "typeVersion": 1,
          "position": [
            20,
            240
          ],
          "id": "2e459cd6-47c1-4a21-9918-cc1ba804dc1d",
          "name": "AWS Bedrock Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
          "typeVersion": 1,
          "position": [
            20,
            580
          ],
          "id": "15bf8cdb-5496-4371-bdfb-531c9d1f7789",
          "name": "Mistral Cloud Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "content": "# 2. Create script from the story",
            "height": 560,
            "width": 360
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -140,
            840
          ],
          "id": "8914cae6-944e-4c7f-b0b8-7300bdbf10e1",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "content": "# 6. Merge the videos",
            "height": 360,
            "width": 1180
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -2280,
            2000
          ],
          "id": "99518b44-ad42-42f1-afad-f4cb3fcfbffd",
          "name": "Sticky Note6"
        },
        {
          "parameters": {
            "content": "# 3. Generate an image with Flux âš ï¸\n\nâš ï¸ add your credentials to the `Generate AI image` node\n\nthe free image generation is slow, if you want to make it faster, just remove the `free`",
            "height": 520,
            "width": 580
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -2280,
            1440
          ],
          "id": "56659373-51de-4e26-8008-92c5d87eb44a",
          "name": "Sticky Note7"
        },
        {
          "parameters": {
            "content": "# 4. Create speech from text",
            "height": 520,
            "width": 900
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1660,
            1440
          ],
          "id": "31f9d57c-c8c8-41ab-b8cc-8056be480802",
          "name": "Sticky Note8"
        },
        {
          "parameters": {
            "content": "# 5. Generate captioned video",
            "height": 520,
            "width": 1040
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -720,
            1440
          ],
          "id": "a166544c-edbc-41d0-9088-44c640519d2e",
          "name": "Sticky Note9"
        },
        {
          "parameters": {
            "text": "=<Instructions>\nUsing the inspirations below, write a completely new scary story. \n\nUse the following structure for the story, and make sure it's coherent and the reading level is 8th grade. Make it sound like a camp counsellor telling the story to people around the campfire. Don't greet/address the audience, just start telling the story. Don't mention the campfire.\n\n1. Act 1: Set the scene with the protagonist and the antagonist. Start building up the sense of unease or the source of fear.\n2. Act 2: Growing tension between the protagonist and the antagonist\n3. Act 3: Conflict goes to a head\n4. Act 4: Aftermath\n\n\nFor each scene, create an image prompt that we'll use with an image generation tool.\n\nCreate the image generation prompt using the ImageTemplate below.\nAdd \"Do not add text or characters to the final image.\" to the end of each image prompt.\n\nUse the following art style for the images:\n\n{{ $('Configure me').first().json.art_style }}\n</Instructions>\n\n<ImageTemplate>\nGenerate an image that matches the following story scene, using the provided art style.\n\nStory scene:\n{ADD_STORY_SCENE_HERE}\n</ImageTemplate>\n\n<Inspirations>\n{{ $json.items.map(item => `<Story>\n${item.title}\n\n${item.selftext}\n</Story>`).join('\\n') }}\n</Inspirations>",
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"scenes\": {\n            \"type\": \"array\",\n            \"description\": \"Scenes for the story\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"text\": {\n                        \"type\": \"string\",\n                        \"description\": \"the text of the scene, it will be used for TTS\"\n                    },\n                    \"image_prompt\": {\n                        \"type\": \"string\",\n                        \"description\": \"prompt for image generation\"\n                    }\n                },\n                \"required\": [\n                    \"text\",\n                    \"image_prompt\"\n                ]\n            }\n        },\n        \"title\": {\n            \"type\": \"string\",\n            \"description\": \"the title of the tiktok video\"\n        },\n        \"description\": {\n            \"type\": \"string\",\n            \"description\": \"the description of the tiktok video\"\n        },\n        \"tags\": {\n            \"type\": \"array\",\n            \"description\": \"tags for sharing the video on tiktok\",\n            \"items\": {\n                \"type\": \"string\"\n            }\n        }\n    },\n    \"required\": [\n        \"scenes\",\n        \"title\",\n        \"description\",\n        \"tags\"\n    ]\n}",
            "options": {
              "systemPromptTemplate": "You are an expert copywriter. You write exciting short stories."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1.1,
          "position": [
            -80,
            1000
          ],
          "id": "bbe6f995-bf54-4d96-8a81-4e282afc4a6b",
          "name": "Create the script",
          "retryOnFail": true
        },
        {
          "parameters": {
            "fieldToSplitOut": "output.scenes",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -20,
            1220
          ],
          "id": "6425e91e-9ba3-4ae4-a54d-21bc774e8284",
          "name": "Split Out"
        },
        {
          "parameters": {
            "content": "# How to set up this automation?\n\n## Make sure to use n8n `1.97.1` or higher, lower versions could break the stuctured output node\n\n## 1. Add the AI Agents No-Code Tools server URL to the Configure me node, and optionally your Postiz server URL\n## 2. Select the LLM you want to use, make sure to deactivate the rest\n## 3. Add your free Together.ai API key to the Generate AI image node\n## 4. Setup the Postiz nodes with your credentials\n",
            "height": 360,
            "width": 1680,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1940,
            440
          ],
          "id": "e740737b-5019-4efa-9fe0-dcd524cb9621",
          "name": "Sticky Note14"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7bbb518a-c4f1-49a5-9e72-3e9d939b131b",
                  "name": "AI_AGENTS_NO_CODE_TOOLS_URL",
                  "value": "http://192.168.68.60:8000/",
                  "type": "string"
                },
                {
                  "id": "79226bcb-3a26-4d30-b3a3-e578cda677f9",
                  "name": "postiz_api_url",
                  "value": "https://api.postiz.com/public/v1",
                  "type": "string"
                },
                {
                  "id": "34f8b468-b669-46ed-be9d-e77e15f36380",
                  "name": "background_music_volume",
                  "value": 0.1,
                  "type": "number"
                },
                {
                  "id": "a725aaf1-c91e-4d5b-87f9-d540d309098c",
                  "name": "chatterbox_exaggeration",
                  "value": 0.5,
                  "type": "number"
                },
                {
                  "id": "d048e31d-f1cb-48ac-9ff2-13f1028c843e",
                  "name": "chatterbox_cfg_weight",
                  "value": 0.5,
                  "type": "number"
                },
                {
                  "id": "96943158-11f6-4731-9d4b-dbae0862d7ab",
                  "name": "chatterbox_temperature",
                  "value": 0.8,
                  "type": "number"
                },
                {
                  "id": "fd0df44b-b7d3-45af-8556-bd77ef83b2db",
                  "name": "art_style",
                  "value": "=Scene: Highly cinematic with a moody, noir atmosphere, inspired by detective and crime thriller films from the 1970s and 1980s. The setting can be anything, from an interior room to a suburban street, depicted in a tense, suspenseful moment. Emphasize the following details:\n\n- **Lighting:**Â Strong directional lighting with deep shadows; use cool blue and teal color grading with subtle hints of warm light from lamps or windows. The lighting should cast dramatic shadows across the scene.\n- **Mood:**Â Mysterious, somber, and slightly surreal ambiance, evoking a sense of unease or suspense.\n- **Subjects:**Â Human figures should appear contemplative, searching, tense, or whatever the scene calls for.\n- **Color Palette:**Â Dominant cold blues and teals contrasted by occasional soft warm light from lamps or daylight through curtains. The overall tone should be desaturated and muted.\n- **Cinematic Framing:**Â Framed like a movie still, with careful composition and leading lines, sometimes viewed through doorways or windows for added depth.\n- **Exterior Scenes:**Â Overcast skies, muted and overexposed daylight.\n\n**Style influences:** Denis Villeneuve, David Fincher, *Zodiac*, *Mindhunter*, *True Detective*, Gregory Crewdson, neo-noir photography.",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2180,
            1080
          ],
          "id": "a2b8265d-e485-47cb-87b0-cce37d3fd1d3",
          "name": "Configure me"
        },
        {
          "parameters": {
            "content": "# Configure me âš ï¸\n",
            "height": 560,
            "width": 300,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -2280,
            840
          ],
          "id": "8b109688-9c0f-4b95-80ef-616b9b46a689",
          "name": "Sticky Note12"
        },
        {
          "parameters": {
            "url": "={{ $json.AI_AGENTS_NO_CODE_TOOLS_URL }}/health",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1700,
            1000
          ],
          "id": "cea55748-015b-488d-993a-1e5f7e49fb77",
          "name": "HTTP Request",
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "errorMessage": "The server is not running or isn't configured"
          },
          "type": "n8n-nodes-base.stopAndError",
          "typeVersion": 1,
          "position": [
            -1700,
            1220
          ],
          "id": "f4589939-9537-4201-967d-46d2854765fa",
          "name": "Server isn't ready"
        },
        {
          "parameters": {
            "content": "# Test connection",
            "height": 560,
            "width": 420,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1940,
            840
          ],
          "id": "f672f4cb-321f-4636-a66e-66733a455556",
          "name": "Sticky Note15"
        },
        {
          "parameters": {
            "content": "# 9. cleanup (removing tmp files)\nif you want to delete the generated video too, add it's id to the array",
            "height": 360,
            "width": 540
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1360,
            2400
          ],
          "id": "9d618443-9c44-421a-9eda-fcadfe604bab",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "27bcaf96-fcaa-41cb-8a51-436870ce2110",
                  "name": "file_ids",
                  "value": "={{ [...$('Combine loop items').last().json.data.map(item => [item.video_id, item.tts_id, item.image_id]).flat(), $('Configure me').first().json.chatterbox_clone_voice_id, $('Configure me').first().json.background_music_id, $('Upload overlay to the server').item.json.file_id].filter(Boolean) }}",
                  "type": "array"
                },
                {
                  "id": "ff26af44-84ff-46a0-8532-5eeca8dbb099",
                  "name": "",
                  "value": "",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1320,
            2520
          ],
          "id": "1d98b47c-e1e8-438f-84a1-e3e519ab47e5",
          "name": "Set file ids to delete"
        },
        {
          "parameters": {
            "method": "DELETE",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $json.file_ids }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1000,
            2520
          ],
          "id": "c924ca30-7479-457c-9842-0d5399a2faa0",
          "name": "Delete tmp files",
          "disabled": true
        },
        {
          "parameters": {
            "fieldToSplitOut": "file_ids",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -1160,
            2520
          ],
          "id": "ab91bbe3-816d-40cb-ace0-efcdfa3c996d",
          "name": "For each file"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w9)\n\n## Get premium variations of this workflow!\n\n## Be part of a growing community and help us create more content like this",
            "height": 300,
            "width": 700,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -2680,
            500
          ],
          "id": "0da53a2e-5461-4bf0-af28-df019e9db940",
          "name": "Sticky Note16"
        },
        {
          "parameters": {
            "content": "# 8. Schedule with Postiz",
            "height": 820,
            "width": 880,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -2280,
            2400
          ],
          "id": "7400bb12-90d8-4ffa-8cdb-a57f691ec5c7",
          "name": "Sticky Note20"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $('Start adding overlay to thevideo').last().json.file_id }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -2240,
            2520
          ],
          "id": "d21cbc05-fc8e-4a9b-b633-326eead7c93c",
          "name": "Download the video for Postiz"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Configure me').first().json.postiz_api_url }}/upload",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "parameterType": "formBinaryData",
                  "name": "file",
                  "inputDataFieldName": "data"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -2040,
            2520
          ],
          "id": "ea9f8e97-5dfd-4796-9a77-f5e3936c9cdb",
          "name": "Upload video to Postiz",
          "credentials": {
            "httpBearerAuth": {
              "id": "qaxoCSbcbmatcO44",
              "name": "Local postiz"
            },
            "httpCustomAuth": {
              "id": "X84DBVwdxIyjeWnM",
              "name": "Custom Auth account"
            },
            "httpHeaderAuth": {
              "id": "vLZnCmQuaqpFY5LK",
              "name": "Postiz auth"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "url": "={{ $('Configure me').first().json.postiz_api_url }}/integrations",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1820,
            2520
          ],
          "id": "1c658fe2-6b27-4423-be6d-880c24fd0068",
          "name": "Get Postiz integrations",
          "credentials": {
            "httpBearerAuth": {
              "id": "qaxoCSbcbmatcO44",
              "name": "Local postiz"
            },
            "httpCustomAuth": {
              "id": "X84DBVwdxIyjeWnM",
              "name": "Custom Auth account"
            },
            "httpHeaderAuth": {
              "id": "vLZnCmQuaqpFY5LK",
              "name": "Postiz auth"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -1640,
            2520
          ],
          "id": "31434d65-1e61-483a-88a5-06e6da992537",
          "name": "Merge integrations",
          "disabled": true
        },
        {
          "parameters": {
            "content": "# Setup the integration\n\nYou should implement your own logic here.\n\n1. You can hard-code the desired integration id\n2. You can filter the integrations by your own logic\n\nMake sure to modify the `settings` field if you are sharing to other platforms than YouTube",
            "height": 500,
            "width": 380
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -2240,
            2700
          ],
          "id": "d8eeed9a-c941-418b-b45e-8e406211d4b2",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "formTitle": "Scary story creator for TikTok",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Background music",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "acceptFileTypes": ".mp3"
                },
                {
                  "fieldLabel": "Sample voice",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "acceptFileTypes": ".wav, .mp3"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -2520,
            1080
          ],
          "id": "c5800aad-08cc-498a-9953-0e14e9f03bb4",
          "name": "On form submission",
          "webhookId": "eba470c9-0082-43b1-b48d-e62981cb0415"
        },
        {
          "parameters": {
            "jsCode": "return $('On form submission').first()"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1240,
            920
          ],
          "id": "6079b135-c5ec-4735-8f03-06077d6291ec",
          "name": "Relay background music"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7aec0c26-8c27-4aa6-bec7-1f65d9fe3aaf",
                  "name": "background_music_id",
                  "value": "={{ $json.file_id ?? '' }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1240,
            1220
          ],
          "id": "39375cce-c971-4181-a95d-cee48eba85a0",
          "name": "Set background music id"
        },
        {
          "parameters": {
            "jsCode": "return $('On form submission').first()"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -800,
            920
          ],
          "id": "bc416d69-0d4e-4323-8196-00b8b2d60b57",
          "name": "Relay sample audio"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7aec0c26-8c27-4aa6-bec7-1f65d9fe3aaf",
                  "name": "sample_audio_id",
                  "value": "={{ $json.file_id ?? '' }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -800,
            1240
          ],
          "id": "e52b820e-ae27-47c6-ae81-ecffb0101193",
          "name": "Set sample voice id"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "parameterType": "formBinaryData",
                  "name": "file",
                  "inputDataFieldName": "=data"
                },
                {
                  "name": "media_type",
                  "value": "video"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -820,
            2160
          ],
          "id": "2f6d03e2-0c63-4753-ab99-e68d45331e3b",
          "name": "Upload overlay to the server"
        },
        {
          "parameters": {
            "url": "https://github.com/gyoridavid/ai_agents_az/raw/refs/heads/main/episode_18/bg_1.mp4",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1000,
            2160
          ],
          "id": "68393334-1c9a-4b0c-86ae-c8219bd29f24",
          "name": "Download example overlay"
        },
        {
          "parameters": {
            "amount": 1
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -420,
            2160
          ],
          "id": "c08d5fc0-4d81-48a9-bccd-ac560bab17df",
          "name": "Wait until the videos gets merged together1",
          "webhookId": "b7a3186e-211b-47e7-96c4-11a942809b30"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/video-tools/add-colorkey-overlay",
            "sendBody": true,
            "contentType": "form-urlencoded",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "video_id",
                  "value": "={{ $('Start merging the videos').last().json.file_id }}"
                },
                {
                  "name": "overlay_video_id",
                  "value": "={{ $('Upload overlay to the server').last().json.file_id }}"
                },
                {
                  "name": "color",
                  "value": "#000000"
                }
              ]
            },
            "options": {
              "redirect": {
                "redirect": {}
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -640,
            2160
          ],
          "id": "fee8b2bc-e42b-4ba4-a0cf-2bcb6d935092",
          "name": "Start adding overlay to thevideo"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $('Start adding overlay to thevideo').last().json.file_id }}/status",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -220,
            2160
          ],
          "id": "42c718dd-a6c5-4b15-943c-2d376b6a92a7",
          "name": "Get status of the overlay"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "ready",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "91402596-3978-4dfc-91b7-9ffe3521b862"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "ready"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0c29765e-4213-434c-9bf3-c5e854dd6ee8",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "processing",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "processing"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4a6cfd86-e690-417e-aa6d-ae497e1177ae",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "not_found",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "failed"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            20,
            2200
          ],
          "id": "3c25208f-a68d-4549-949a-657426116e21",
          "name": "Overlay status"
        },
        {
          "parameters": {
            "content": "To get free social media scheduling, you need to host your own [Postiz instance](https://docs.postiz.com/installation/coolify). \n\nAs an alternative, you can use the free tier of [ayrshare](https://www.ayrshare.com/).",
            "height": 340
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -2560,
            2400
          ],
          "id": "460af147-6ca5-4384-b538-ef7555ec34ea",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "content": "# Upload background music",
            "height": 560,
            "width": 400,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1480,
            840
          ],
          "id": "786ffc69-f976-466d-9e7d-ace8d5740691",
          "name": "Sticky Note17"
        },
        {
          "parameters": {
            "content": "# Upload voice sample",
            "height": 560,
            "width": 400,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1040,
            840
          ],
          "id": "f40dbe53-342e-4ee1-9906-7ac34450f52c",
          "name": "Sticky Note18"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "parameterType": "formBinaryData",
                  "name": "file",
                  "inputDataFieldName": "=Background_music"
                },
                {
                  "name": "media_type",
                  "value": "audio"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1240,
            1060
          ],
          "id": "6ea8126c-fb04-4cd7-807a-9c60de97804e",
          "name": "Upload background music to the server"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "parameterType": "formBinaryData",
                  "name": "file",
                  "inputDataFieldName": "=Sample_voice"
                },
                {
                  "name": "media_type",
                  "value": "audio"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -800,
            1060
          ],
          "id": "0eecbd01-e71e-4e4a-ae2a-fb2accf4da7f",
          "name": "Upload voice sample to the server"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7d55d6da-a78c-4a28-9343-0ea9035a0aa3",
                  "name": "AI_AGENTS_NO_CODE_TOOLS_URL",
                  "value": "={{   ((u) => {   let s = u.trim();   if (!/^https?:\\/\\//i.test(s)) s = 'https://' + s;   const parts = s.split('/');   return parts[0] + '//' + parts[2]; })($json.AI_AGENTS_NO_CODE_TOOLS_URL)  }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1900,
            1080
          ],
          "id": "ced29d51-7e87-45fd-b4ea-0cf072bf9dcb",
          "name": "Setup defaults"
        },
        {
          "parameters": {
            "content": "# 7. Add overlay",
            "height": 360,
            "width": 1320
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1060,
            2000
          ],
          "id": "6f6646dd-a3b4-4a8b-a995-428761281195",
          "name": "Sticky Note10"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1f7adeed-3cd0-47bb-8bf5-5887d2c82cad",
                  "name": "postiz_integration_id",
                  "value": "={{ $json.data.find(integration => integration.identifier === 'tiktok')?.id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -2200,
            3000
          ],
          "id": "c16ccf96-822e-4f56-ba5c-cbca207be528",
          "name": "Set integration id for TikTok",
          "disabled": true
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Configure me').first().json.postiz_api_url }}/posts",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"type\": \"schedule\",\n  \"date\": \"{{ $now.plus(1, 'days').toISO() }}\",\n  \"tags\": [],\n  \"shortLink\": false,\n  \"posts\": [\n    {\n      \"integration\": {\n        \"id\": \"{{ $json.postiz_integration_id }}\"\n      },\n      \"value\": [\n        {\n          \"content\": \"{{ $('Create the script').item.json.output.description }}\",\n          \"image\": [\n            {\n              \"id\": \"{{ $('Upload video to Postiz').item.json.id }}\",\n              \"path\": \"{{ $('Upload video to Postiz').item.json.path }}\"\n            }\n          ]\n        }\n      ],\n      \"settings\": {\n      \"title\": \"{{ $('Create the script').item.json.output.title }}\",\n      \"type\": \"unlisted\",\n      \"tags\": {{ JSON.stringify($('Create the script').item.json.output.tags.map(tag => ({ value: tag, label: tag }))) }}\n  }\n    }\n  ]\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1660,
            3000
          ],
          "id": "df53357c-9cd3-4375-87dc-75ccef74e548",
          "name": "Schedule the TikTok video",
          "credentials": {
            "httpHeaderAuth": {
              "id": "vLZnCmQuaqpFY5LK",
              "name": "Postiz auth"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "url": "=https://www.reddit.com/r/creepyencounters/top.json?t=year&limit=100",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -520,
            980
          ],
          "id": "a3081c61-6c6d-46c3-9097-4c5fe72bdcb6",
          "name": "Get stories from reddit"
        },
        {
          "parameters": {
            "jsCode": "function getRandomItems(A, X) {\n  return A\n    .slice()\n    .sort(() => Math.random() - 0.5)\n    .slice(0, X);\n}\n\nconst items = getRandomItems($input.all().map(item => item.json.data), 3);\n\nreturn [{\n  json: {\n    items\n  }\n}]"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -340,
            1200
          ],
          "id": "42edb01a-c030-46b4-af29-3720bfe6fdd9",
          "name": "Code"
        },
        {
          "parameters": {
            "content": "# 1. Source inspirations from Reddit",
            "height": 560,
            "width": 420
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -600,
            840
          ],
          "id": "a513fd82-b6ff-45b3-9354-a40af0727176",
          "name": "Sticky Note11"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6b9c15f3-2db9-4a1e-a688-4fc4e95ded53",
                  "leftValue": "={{ $('On form submission').item.json['Sample voice'] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1000,
            1060
          ],
          "id": "946baa9d-14d2-456e-b51e-4097cad11d91",
          "name": "Upload voice sample?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "6b9c15f3-2db9-4a1e-a688-4fc4e95ded53",
                  "leftValue": "={{ $('On form submission').item.json['Background music'] }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1440,
            1120
          ],
          "id": "70a74fec-f110-4afe-adf6-6785cb2e28a9",
          "name": "Upload music?"
        },
        {
          "parameters": {
            "fieldToSplitOut": "data.children",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -340,
            980
          ],
          "id": "5d006f17-caaa-4f64-b2ef-5b397e50419b",
          "name": "For each post"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "a6926aaf-b4ac-4e90-ac82-c32796fd7e0c",
                  "leftValue": "={{ $json.data.selftext.length }}",
                  "rightValue": 1500,
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  }
                },
                {
                  "id": "c81af31b-c032-4960-870f-ee7b6a6dc029",
                  "leftValue": "={{ $json.data.is_video }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "false",
                    "singleValue": true
                  }
                },
                {
                  "id": "659ef810-1298-4df0-81f4-e049c2c020b1",
                  "leftValue": "={{ $json.data.media === null }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            -520,
            1200
          ],
          "id": "fdb85b1f-43a2-4dc4-8dd7-84bc76900ad3",
          "name": "Remove short ones"
        }
      ],
      "pinData": {},
      "connections": {
        "Loop Over Items": {
          "main": [
            [
              {
                "node": "Combine loop items",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Generate AI image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate AI image": {
          "main": [
            [
              {
                "node": "Upload image to server",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the error / rate limit to go away",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload image to server": {
          "main": [
            [
              {
                "node": "Start generating TTS (chatterbox)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get status of TTS generation": {
          "main": [
            [
              {
                "node": "TTS status switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TTS status switch": {
          "main": [
            [
              {
                "node": "Setup TTS file_id",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait until the TTS gets generated",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Start generating TTS (chatterbox)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating captioned TTS video": {
          "main": [
            [
              {
                "node": "Wait until the video gets generated",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get video generation status": {
          "main": [
            [
              {
                "node": "Video generation switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video generation switch": {
          "main": [
            [
              {
                "node": "Setup media fields",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait until the video gets generated",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup media fields": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Combine loop items": {
          "main": [
            [
              {
                "node": "Start merging the videos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start merging the videos": {
          "main": [
            [
              {
                "node": "Wait until the videos gets merged together",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get status of the video merge": {
          "main": [
            [
              {
                "node": "Video merge status switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video merge status switch": {
          "main": [
            [
              {
                "node": "Download example overlay",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait until the videos gets merged together",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the error / rate limit to go away": {
          "main": [
            [
              {
                "node": "Generate AI image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait until the TTS gets generated": {
          "main": [
            [
              {
                "node": "Get status of TTS generation",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating TTS (chatterbox)": {
          "main": [
            [
              {
                "node": "Wait until the TTS gets generated",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait until the video gets generated": {
          "main": [
            [
              {
                "node": "Get video generation status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait until the videos gets merged together": {
          "main": [
            [
              {
                "node": "Get status of the video merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup TTS file_id": {
          "main": [
            [
              {
                "node": "Start generating captioned TTS video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Create the script",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Create the script": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Configure me": {
          "main": [
            [
              {
                "node": "Setup defaults",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Upload music?",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Server isn't ready",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set file ids to delete": {
          "main": [
            [
              {
                "node": "For each file",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "For each file": {
          "main": [
            [
              {
                "node": "Delete tmp files",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download the video for Postiz": {
          "main": [
            [
              {
                "node": "Upload video to Postiz",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload video to Postiz": {
          "main": [
            [
              {
                "node": "Get Postiz integrations",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Postiz integrations": {
          "main": [
            [
              {
                "node": "Merge integrations",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge integrations": {
          "main": [
            [
              {
                "node": "Set integration id for TikTok",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On form submission": {
          "main": [
            [
              {
                "node": "Configure me",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Relay background music": {
          "main": [
            [
              {
                "node": "Upload background music to the server",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set background music id": {
          "main": [
            [
              {
                "node": "Upload voice sample?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Relay sample audio": {
          "main": [
            [
              {
                "node": "Upload voice sample to the server",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set sample voice id": {
          "main": [
            [
              {
                "node": "Get stories from reddit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload overlay to the server": {
          "main": [
            [
              {
                "node": "Start adding overlay to thevideo",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download example overlay": {
          "main": [
            [
              {
                "node": "Upload overlay to the server",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait until the videos gets merged together1": {
          "main": [
            [
              {
                "node": "Get status of the overlay",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start adding overlay to thevideo": {
          "main": [
            [
              {
                "node": "Wait until the videos gets merged together1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get status of the overlay": {
          "main": [
            [
              {
                "node": "Overlay status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Overlay status": {
          "main": [
            [
              {
                "node": "Download the video for Postiz",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait until the videos gets merged together1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload background music to the server": {
          "main": [
            [
              {
                "node": "Set background music id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload voice sample to the server": {
          "main": [
            [
              {
                "node": "Set sample voice id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup defaults": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set integration id for TikTok": {
          "main": [
            [
              {
                "node": "Schedule the TikTok video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule the TikTok video": {
          "main": [
            [
              {
                "node": "Set file ids to delete",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get stories from reddit": {
          "main": [
            [
              {
                "node": "For each post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Create the script",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload voice sample?": {
          "main": [
            [
              {
                "node": "Relay sample audio",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Set sample voice id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload music?": {
          "main": [
            [
              {
                "node": "Relay background music",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Set background music id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "For each post": {
          "main": [
            [
              {
                "node": "Remove short ones",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Remove short ones": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "e47580c2-eda6-4996-a566-d21122aad982",
      "meta": {
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "vbVVE59RZMfezN7L",
      "tags": [
        {
          "createdAt": "2025-06-18T16:25:08.935Z",
          "updatedAt": "2025-06-18T16:25:08.935Z",
          "id": "1t0O0JsvnM933ez8",
          "name": "youtube"
        }
      ]
    }
  },
  {
    "id": "wan-text-to-video",
    "title": "Wan 2.2 Text-to-Video Launcher",
    "description": "Wraps Modal + ComfyUI endpoints to trigger Wan 2.2 video renders from text prompts and retrieve resulting clips.",
    "problem": "Creators want to experiment with Wan 2.2 without manual API calls; this workflow automates job submission and retrieval.",
    "tags": [
      "video",
      "modal",
      "comfyui",
      "wan",
      "ai"
    ],
    "metadata": {
      "industries": [
        "media",
        "creative"
      ],
      "domains": [
        "video-generation"
      ],
      "channels": [
        "modal",
        "comfyui"
      ],
      "trigger": "manual",
      "complexity": "medium",
      "integrations": [
        "Wan 2.2",
        "Modal",
        "ComfyUI"
      ]
    },
    "workflow": {
      "name": "ComfyUI: wan 2.2 5b - text 2 video",
      "nodes": [
        {
          "parameters": {
            "formTitle": "Upload reference images",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "prompt",
                  "fieldType": "textarea",
                  "placeholder": "what should happen on the video",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Negative prompt",
                  "placeholder": "optional"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -620,
            -60
          ],
          "id": "f7de41fc-a563-4e92-82ba-d5f3b877fa36",
          "name": "On form submission",
          "webhookId": "e0a61b98-84e7-42ab-9c8c-e5b130a8adc4"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7d55d6da-a78c-4a28-9343-0ea9035a0aa3",
                  "name": "COMFY_URL",
                  "value": "={{   ((u) => {   let s = u.trim();   if (!/^https?:\\/\\//i.test(s)) s = 'https://' + s;   const parts = s.split('/');   return parts[0] + '//' + parts[2]; })($json.comfyui_url)  }}",
                  "type": "string"
                },
                {
                  "id": "c491a696-6081-4e42-98f5-0c3b75c16edc",
                  "name": "NEGATIVE_PROMPT",
                  "value": "={{ $('On form submission').item.json['Negative prompt'] || $json.negative_prompt }}",
                  "type": "string"
                },
                {
                  "id": "e179a11b-ab0b-4772-b151-10b0b7d49a8c",
                  "name": "PROMPT",
                  "value": "={{ $('On form submission').item.json.prompt }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -100,
            -60
          ],
          "id": "677e7deb-bf71-48b6-bea7-46b46ba6b18c",
          "name": "Setup defaults"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.COMFY_URL }}/history/{{ $('Start the workflow with ComfyUI').first().json.prompt_id }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            520,
            -60
          ],
          "id": "0fb73fc5-555b-49e1-8370-990732971fee",
          "name": "Get video generation status",
          "retryOnFail": true
        },
        {
          "parameters": {
            "amount": 10
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            320,
            -60
          ],
          "id": "ec329f92-0ca2-499b-900f-391da62266ba",
          "name": "Wait until the video gets generated",
          "webhookId": "e785aaa5-76f0-473d-bbc9-bd05b1c1565c"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "5e89df7d-4c0e-4bd4-8a84-b1e28bdb1f7e",
                  "leftValue": "={{ $json.keys().length > 0 && $json[$('Start the workflow with ComfyUI').item.json.prompt_id] && $json[$('Start the workflow with ComfyUI').item.json.prompt_id].status.completed }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                },
                {
                  "id": "354e3206-bbe3-481d-876b-255eed39f7cf",
                  "leftValue": "",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            680,
            -60
          ],
          "id": "7f8edbdb-0dd2-46c7-83a2-2fce33dd7058",
          "name": "Completed?"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "9bfcdffd-8c7c-407d-b95c-83f8aa104845",
                  "leftValue": "={{ $json[$('Start the workflow with ComfyUI').item.json.prompt_id].status.status_str === 'success' }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            980,
            -80
          ],
          "id": "14c2f182-2eee-4420-86dd-f2d7244db30d",
          "name": "Success?"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.COMFY_URL }}/view",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "type",
                  "value": "output"
                },
                {
                  "name": "filename",
                  "value": "={{ $('Get video generation status').last().json[$('Start the workflow with ComfyUI').item.json.prompt_id].outputs.values().map(item => item.images).flat(Infinity).find(item => item.type === 'output').filename }}"
                },
                {
                  "name": "subfolder",
                  "value": "={{ $('Get video generation status').last().json[$('Start the workflow with ComfyUI').item.json.prompt_id].outputs['58'].images[0].subfolder }}"
                }
              ]
            },
            "sendBody": true,
            "contentType": "form-urlencoded",
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "options": {
              "redirect": {
                "redirect": {}
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1260,
            -240
          ],
          "id": "f5d3ffcf-e9b2-4417-a489-ecdf46be67f6",
          "name": "HTTP Request"
        },
        {
          "parameters": {
            "errorMessage": "An error occoured while generating the image"
          },
          "type": "n8n-nodes-base.stopAndError",
          "typeVersion": 1,
          "position": [
            1280,
            80
          ],
          "id": "42b6898a-7150-4c4e-9098-fc96865f1dc6",
          "name": "Stop and Error"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "1ece166a-0536-4c3e-bf1f-e0d4ff300169",
                  "name": "workflow",
                  "value": "={\n  \"3\": {\n    \"inputs\": {\n      \"seed\": {{ (() => {\n  const max = 0xFFFFFFFF - 1;\n  const seed = Math.floor(Math.random() * max) + 1;\n  return seed;\n})() }},\n      \"steps\": 20,\n      \"cfg\": 5,\n      \"sampler_name\": \"uni_pc\",\n      \"scheduler\": \"simple\",\n      \"denoise\": 1,\n      \"model\": [\n        \"48\",\n        0\n      ],\n      \"positive\": [\n        \"6\",\n        0\n      ],\n      \"negative\": [\n        \"7\",\n        0\n      ],\n      \"latent_image\": [\n        \"55\",\n        0\n      ]\n    },\n    \"class_type\": \"KSampler\",\n    \"_meta\": {\n      \"title\": \"KSampler\"\n    }\n  },\n  \"6\": {\n    \"inputs\": {\n      \"text\": \"${PROMPT}\",\n      \"clip\": [\n        \"38\",\n        0\n      ]\n    },\n    \"class_type\": \"CLIPTextEncode\",\n    \"_meta\": {\n      \"title\": \"CLIP Text Encode (Positive Prompt)\"\n    }\n  },\n  \"7\": {\n    \"inputs\": {\n      \"text\": \"${NEGATIVE_PROMPT}\",\n      \"clip\": [\n        \"38\",\n        0\n      ]\n    },\n    \"class_type\": \"CLIPTextEncode\",\n    \"_meta\": {\n      \"title\": \"CLIP Text Encode (Negative Prompt)\"\n    }\n  },\n  \"8\": {\n    \"inputs\": {\n      \"samples\": [\n        \"3\",\n        0\n      ],\n      \"vae\": [\n        \"39\",\n        0\n      ]\n    },\n    \"class_type\": \"VAEDecode\",\n    \"_meta\": {\n      \"title\": \"VAE Decode\"\n    }\n  },\n  \"37\": {\n    \"inputs\": {\n      \"unet_name\": \"wan2.2_ti2v_5B_fp16.safetensors\",\n      \"weight_dtype\": \"default\"\n    },\n    \"class_type\": \"UNETLoader\",\n    \"_meta\": {\n      \"title\": \"Load Diffusion Model\"\n    }\n  },\n  \"38\": {\n    \"inputs\": {\n      \"clip_name\": \"umt5_xxl_fp8_e4m3fn_scaled.safetensors\",\n      \"type\": \"wan\",\n      \"device\": \"default\"\n    },\n    \"class_type\": \"CLIPLoader\",\n    \"_meta\": {\n      \"title\": \"Load CLIP\"\n    }\n  },\n  \"39\": {\n    \"inputs\": {\n      \"vae_name\": \"wan2.2_vae.safetensors\"\n    },\n    \"class_type\": \"VAELoader\",\n    \"_meta\": {\n      \"title\": \"Load VAE\"\n    }\n  },\n  \"48\": {\n    \"inputs\": {\n      \"shift\": 8,\n      \"model\": [\n        \"37\",\n        0\n      ]\n    },\n    \"class_type\": \"ModelSamplingSD3\",\n    \"_meta\": {\n      \"title\": \"ModelSamplingSD3\"\n    }\n  },\n  \"55\": {\n    \"inputs\": {\n      \"width\": 1280,\n      \"height\": 704,\n      \"length\": 121,\n      \"batch_size\": 1,\n      \"vae\": [\n        \"39\",\n        0\n      ]\n    },\n    \"class_type\": \"Wan22ImageToVideoLatent\",\n    \"_meta\": {\n      \"title\": \"Wan22ImageToVideoLatent\"\n    }\n  },\n  \"57\": {\n    \"inputs\": {\n      \"fps\": 24,\n      \"images\": [\n        \"8\",\n        0\n      ]\n    },\n    \"class_type\": \"CreateVideo\",\n    \"_meta\": {\n      \"title\": \"Create Video\"\n    }\n  },\n  \"58\": {\n    \"inputs\": {\n      \"filename_prefix\": \"video/ComfyUI\",\n      \"format\": \"auto\",\n      \"codec\": \"auto\",\n      \"video-preview\": \"\",\n      \"video\": [\n        \"57\",\n        0\n      ]\n    },\n    \"class_type\": \"SaveVideo\",\n    \"_meta\": {\n      \"title\": \"Save Video\"\n    }\n  }\n}",
                  "type": "string"
                },
                {
                  "id": "92df0709-c03c-400e-b2ac-1a8e3aff7416",
                  "name": "comfyui_url",
                  "value": "YOUR_COMFYUI_URL",
                  "type": "string"
                },
                {
                  "id": "fb621130-6eac-41ab-b514-576a0275f6b1",
                  "name": "negative_prompt",
                  "value": "è‰²è°ƒè‰³ä¸½ï¼Œè¿‡æ›ï¼Œé™æ€ï¼Œç»†èŠ‚æ¨¡ç³Šä¸æ¸…ï¼Œå­—å¹•ï¼Œé£Žæ ¼ï¼Œä½œå“ï¼Œç”»ä½œï¼Œç”»é¢ï¼Œé™æ­¢ï¼Œæ•´ä½“å‘ç°ï¼Œæœ€å·®è´¨é‡ï¼Œä½Žè´¨é‡ï¼ŒJPEGåŽ‹ç¼©æ®‹ç•™ï¼Œä¸‘é™‹çš„ï¼Œæ®‹ç¼ºçš„ï¼Œå¤šä½™çš„æ‰‹æŒ‡ï¼Œç”»å¾—ä¸å¥½çš„æ‰‹éƒ¨ï¼Œç”»å¾—ä¸å¥½çš„è„¸éƒ¨ï¼Œç•¸å½¢çš„ï¼Œæ¯å®¹çš„ï¼Œå½¢æ€ç•¸å½¢çš„è‚¢ä½“ï¼Œæ‰‹æŒ‡èžåˆï¼Œé™æ­¢ä¸åŠ¨çš„ç”»é¢ï¼Œæ‚ä¹±çš„èƒŒæ™¯ï¼Œä¸‰æ¡è…¿ï¼ŒèƒŒæ™¯äººå¾ˆå¤šï¼Œå€’ç€èµ°",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -380,
            -60
          ],
          "id": "1f08ab0e-14b2-4ed9-a83a-722a1f9b0ea4",
          "name": "Configuration"
        },
        {
          "parameters": {
            "content": "# Configure me",
            "height": 420,
            "width": 260,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            -280
          ],
          "id": "2c275d22-12c7-420f-b172-920b69ab1288",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.COMFY_URL }}/prompt",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"client_id\": \"n8n\",\n  \"prompt\": {{ \n\n    $('Configuration').item.json.workflow\n      .replace('${PROMPT}', $('Setup defaults').first().json.PROMPT)\n      .replace('${NEGATIVE_PROMPT}', $('Setup defaults').first().json.NEGATIVE_PROMPT) \n\n}}\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            60,
            -60
          ],
          "id": "a3d6ad94-891f-4e4d-861b-543a424f45d9",
          "name": "Start the workflow with ComfyUI"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for support, premium content and more!](https://www.skool.com/ai-agents-az/about?w9)\n\n## Get premium variations of this workflow!\n\n## Be part of a growing community and help us create more content like this",
            "height": 300,
            "width": 700,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            -620
          ],
          "id": "2eb38610-f368-4a22-ae45-bf140231693a",
          "name": "Sticky Note16"
        }
      ],
      "pinData": {},
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "Configuration",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup defaults": {
          "main": [
            [
              {
                "node": "Start the workflow with ComfyUI",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get video generation status": {
          "main": [
            [
              {
                "node": "Completed?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait until the video gets generated": {
          "main": [
            [
              {
                "node": "Get video generation status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Completed?": {
          "main": [
            [
              {
                "node": "Success?",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait until the video gets generated",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Success?": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Stop and Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Configuration": {
          "main": [
            [
              {
                "node": "Setup defaults",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start the workflow with ComfyUI": {
          "main": [
            [
              {
                "node": "Wait until the video gets generated",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "3d16e9b0-95ad-4ab5-8806-4465fea2e17e",
      "meta": {
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "DuIW59NyIFVGq0C4",
      "tags": []
    }
  },
  {
    "id": "sleep-music-longform",
    "title": "Sleep Music Long-form Creator",
    "description": "Combines GPT-5 scripts, ElevenLabs music, seed scenes, and editing logic to output hour-long sleep tracks ready for YouTube.",
    "problem": "Sleep-music channels struggle to produce long videos daily; this flow automates narration, visuals, and audio blending.",
    "tags": [
      "sleep",
      "music",
      "youtube",
      "ai",
      "longform"
    ],
    "metadata": {
      "industries": [
        "media",
        "audio"
      ],
      "domains": [
        "music-generation"
      ],
      "channels": [
        "youtube"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "OpenAI",
        "ElevenLabs",
        "Imagen4",
        "Seedance"
      ]
    },
    "workflow": {
      "name": "Episode 22: sleep",
      "nodes": [
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7bbb518a-c4f1-49a5-9e72-3e9d939b131b",
                  "name": "AI_AGENTS_NO_CODE_TOOLS_URL",
                  "value": "http://localhost:8000",
                  "type": "string"
                },
                {
                  "id": "526ec84c-8c10-4e62-b5dd-9c7ce17e5c11",
                  "name": "DURATION_IN_MINUTES",
                  "value": 10,
                  "type": "number"
                },
                {
                  "id": "be15f2fa-ce57-4843-b283-bdfc397967aa",
                  "name": "CONCEPT_PROMPT",
                  "value": "=<Instructions>\nCreate one concept for a new sleep video on youtube.\nMy main theme is cute animals and characters in 3d style.\nThe length of the video is going to be 3 hours long, and it will be one looped video and a generated, classical music lullaby.\nFor the visual, make sure to create something where looping makes sense: small, gentle movements, that looks great when it's on repeat.\n</Instructions>\n<Examples>\n\t<Example>\n\t\t<Title>\n          Brahms Lullaby For Babies To Go To Sleep Make Bedtime Super Easy Good Night And Sweet Dreams\n    </Title>\n\t\t<Visual>\n      This whimsical and serene image is a screenshot from a YouTube sleep video, designed to be calming and help viewers relax.\n      The scene features two adorable, fluffy kittens with large, expressive eyes. One kitten is a soft pink, while the other is a gentle baby blue. They are set against a dreamy night sky filled with soft, purple and blue clouds, twinkling stars, and a crescent moon.\n      Adding to the magical atmosphere are glowing, heart-shaped bubbles floating in the air and the silhouette of a fairytale-like castle in the distance. The overall art style is very soft and cute, typical of content created to aid with sleep and relaxation.\n    </Visual>\n\t</Example>\n\t<Example>\n\t\t<Title>\n          Soft Music for Sleep and Relaxing â€¢ Listening For 3 Minutes, Fall Into Deep Sleep â€¢ Remove Insomnia\n    </Title>\n\t\t<Visual>\n      This charming and heartwarming image, likely from a YouTube sleep video, captures a moment of pure sweetness and comfort.\n      At the center of the composition is an irresistibly cute, fluffy white bunny with large, expressive dark eyes. The tiny creature is depicted nibbling on a large bar of milk chocolate, holding it with its small paws.\n      The enchanting scene is further enhanced by an array of delectable chocolates scattered around the bunny, including truffles and other candy pieces. A warm, gentle glow emanates from a lit candle in the soft-focused background, casting a serene and cozy ambiance over the entire setting. Adding to the whimsical atmosphere, a cup or holder decorated with bunny ears can be seen in the background. The overall color palette is a soothing blend of warm browns, soft pinks, and creamy whites, creating a visually relaxing and dreamy experience perfect for a sleep video.\n    </Visual>\n\t</Example>\n</Examples>",
                  "type": "string"
                },
                {
                  "id": "65e843d3-1444-4a19-b5b1-8328a50ee4a2",
                  "name": "CREATE_PROMPTS_PROMPT",
                  "value": "=<Instructions>\nI'm creating a sleep video on youtube for the concept below. Help me to create the following materials:\n\n1. Image prompt\n\nCreate a prompt for a nice visual, suitable for children and very cute.\n\n2. Video prompt\n\nMake sure the generated, 12s video can be easily looped, and the loops make sense. Make sure to include in the prompt, that things should not move in straight line, for example clouds should be still, a car shouldn't cross into the picture.\n\n3. Music prompt\n\nCreate a prompt for a classical lullaby.\nInclude in the prompt: the music should be fully instrumental and designed for looping with no distinct intro or outro, just a continous main theme.\nThe music should be 60bpm at most.\n</Instructions>\n<Concept>\n{CONCEPT}\n</Concept>",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1232,
            -1248
          ],
          "id": "9fcd12dc-851b-4373-b67f-42cbb20dfd5c",
          "name": "Configure me"
        },
        {
          "parameters": {
            "content": "# Configure me âš ï¸\n",
            "height": 560,
            "width": 204,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1280,
            -1488
          ],
          "id": "67bd461f-02b1-4294-934a-c55f07d9fcdf",
          "name": "Sticky Note12"
        },
        {
          "parameters": {
            "url": "={{ $json.AI_AGENTS_NO_CODE_TOOLS_URL }}/health",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -784,
            -1328
          ],
          "id": "cec7633f-9045-49fe-a021-ef6c1ddb09ee",
          "name": "HTTP Request",
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "errorMessage": "The server is not running or isn't configured"
          },
          "type": "n8n-nodes-base.stopAndError",
          "typeVersion": 1,
          "position": [
            -784,
            -1104
          ],
          "id": "c219e229-8aa3-4ecc-8edc-1de577dac86e",
          "name": "Server isn't ready"
        },
        {
          "parameters": {
            "content": "# Test connection \ndon't delete/touch this",
            "height": 560,
            "width": 420,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1024,
            -1488
          ],
          "id": "c064a991-bf2c-4ea8-a93f-49be19647270",
          "name": "Sticky Note15"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7d55d6da-a78c-4a28-9343-0ea9035a0aa3",
                  "name": "AI_AGENTS_NO_CODE_TOOLS_URL",
                  "value": "={{   ((u) => {   let s = u.trim();   if (!/^https?:\\/\\//i.test(s)) s = 'https://' + s;   const parts = s.split('/');   return parts[0] + '//' + parts[2]; })($json.AI_AGENTS_NO_CODE_TOOLS_URL)  }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -992,
            -1248
          ],
          "id": "15fc5886-e896-4c2e-8d20-c6f8f17a89f9",
          "name": "Setup defaults"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $('Start creating the sleep video').item.json.file_id }}/status",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            2016,
            -1248
          ],
          "id": "ff0799fb-9f2c-40d8-9041-02379f0f0bdb",
          "name": "Get video generation status",
          "retryOnFail": true
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "ready",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "91402596-3978-4dfc-91b7-9ffe3521b862"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "ready"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0c29765e-4213-434c-9bf3-c5e854dd6ee8",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "processing",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "processing"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "4a6cfd86-e690-417e-aa6d-ae497e1177ae",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "not_found",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "failed"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            2208,
            -1248
          ],
          "id": "f6fb0b91-b714-4f87-9e28-fdb99f0375db",
          "name": "Video generation switch"
        },
        {
          "parameters": {
            "amount": 10
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            1824,
            -1248
          ],
          "id": "aa4c3483-e180-4eee-9656-2c86c3a0a556",
          "name": "Wait until the video gets generated",
          "webhookId": "79a98417-9547-42a4-ae3a-5ba656396d41"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/video-tools/long-form-ambient",
            "sendBody": true,
            "contentType": "form-urlencoded",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "video_id",
                  "value": "={{ $json.video_id }}"
                },
                {
                  "name": "audio_id",
                  "value": "={{ $json.music_id }}"
                },
                {
                  "name": "duration_minutes",
                  "value": "={{ $('Configure me').item.json.DURATION_IN_MINUTES }}"
                }
              ]
            },
            "options": {
              "redirect": {
                "redirect": {}
              }
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1632,
            -1248
          ],
          "id": "de9aebb6-8c9f-48be-979a-6117d287c584",
          "name": "Start creating the sleep video"
        },
        {
          "parameters": {
            "errorMessage": "Something happened while generating the video - contact Miri!"
          },
          "type": "n8n-nodes-base.stopAndError",
          "typeVersion": 1,
          "position": [
            2416,
            -1104
          ],
          "id": "7d0e3a58-39a2-4e77-9e49-1ae75fab7d29",
          "name": "Stop and Error"
        },
        {
          "parameters": {
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage/{{ $('Start creating the sleep video').item.json.file_id }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            2656,
            -1264
          ],
          "id": "8f5111ba-45e5-4e40-8a4d-89ded8a0b113",
          "name": "Download the video"
        },
        {
          "parameters": {
            "content": "# Generate the final video",
            "height": 560,
            "width": 1216,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1344,
            -1472
          ],
          "id": "0ee96c73-818c-4666-a09e-b917a1c3f226",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "# Done",
            "height": 560,
            "width": 208,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            2608,
            -1472
          ],
          "id": "6ecd54b4-72a2-4939-ba68-63e5a5f0026f",
          "name": "Sticky Note1"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -1456,
            -1248
          ],
          "id": "8b13f87e-e5b2-4160-8929-5bea41bb0bf3",
          "name": "When clicking â€˜Execute workflowâ€™"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            288,
            -1632
          ],
          "id": "5c13e90d-f358-4396-a215-9974e15a2d4a",
          "name": "Wait for seed image",
          "webhookId": "e8d6e2f8-2c00-4b80-a18c-3693765b6976"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            736,
            -1632
          ],
          "id": "42afdec9-0c2f-49cc-adb4-58a1532e6208",
          "name": "Seed image status"
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Generate seed image').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1152,
            -1568
          ],
          "id": "cb0498d4-7347-4319-a71b-e6e426ae9adc",
          "name": "Get the seed image",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "mode": "combine",
            "combineBy": "combineByPosition",
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            1440,
            -1248
          ],
          "id": "2bdd317b-193b-41b8-887e-66f80e3d3f07",
          "name": "Merge1"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            512,
            -1264
          ],
          "id": "1367f84f-9c3f-4cbd-8d86-79a5a7c15dbc",
          "name": "Looping video status"
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Start generating the looping video').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            752,
            -1232
          ],
          "id": "251bb482-f2b9-45d5-ba99-9ae1bd3c1a29",
          "name": "Get the looping video",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "media_type",
                  "value": "video"
                },
                {
                  "name": "url",
                  "value": "={{ $json.video.url }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            960,
            -1232
          ],
          "id": "d49e97e5-a5e8-458c-9413-897eef2c7616",
          "name": "Upload the looping video to the server"
        },
        {
          "parameters": {
            "jsCode": "for (const item of $input.all()) {\n  const output = item.json.output.find(item => item.type === 'message');\n  if (output.status !== 'completed') {\n    throw new Error('OpenAI call failed');\n  }\n  const textContent = output?.content?.[0].text;\n  if (!textContent) {\n    throw new Error('No content received from OpenAI');\n  }\n\n  \n  item.json = {\n    output: JSON.parse(textContent)\n  }\n}\n\nreturn $input.all();"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -304,
            -1376
          ],
          "id": "a476eb1e-b117-4bc8-a807-0f810bb6dac9",
          "name": "Parse concept"
        },
        {
          "parameters": {
            "jsCode": "for (const item of $input.all()) {\n  const output = item.json.output.find(item => item.type === 'message');\n  if (output.status !== 'completed') {\n    throw new Error('OpenAI call failed');\n  }\n  const textContent = output?.content?.[0].text;\n  if (!textContent) {\n    throw new Error('No content received from OpenAI');\n  }\n\n  \n  item.json = {\n    output: JSON.parse(textContent)\n  }\n}\n\nreturn $input.all();"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -304,
            -1136
          ],
          "id": "53b7d756-e55f-4b22-8dfe-f5b5f7b6b6f7",
          "name": "Parse prompts"
        },
        {
          "parameters": {
            "content": "# Create script",
            "height": 560,
            "width": 420,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -560,
            -1488
          ],
          "id": "cc5e7f67-688f-46c3-a66a-c156a1cd225f",
          "name": "Sticky Note16"
        },
        {
          "parameters": {
            "content": "# Generate music",
            "height": 288,
            "width": 1396,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -96,
            -992
          ],
          "id": "5dd92973-4465-4dbc-97c0-946078d1a62f",
          "name": "Sticky Note18"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "={{ $('Setup defaults').first().json.AI_AGENTS_NO_CODE_TOOLS_URL }}/api/v1/media/storage",
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "parameterType": "formBinaryData",
                  "name": "file",
                  "inputDataFieldName": "=data"
                },
                {
                  "name": "media_type",
                  "value": "audio"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            416,
            -896
          ],
          "id": "5fe03bb6-6685-4374-a538-eb6687b7a5c1",
          "name": "Upload music to the server"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "09899c0c-4e96-40f6-9038-718fb42d4ed4",
                  "name": "music_id",
                  "value": "={{ $json.file_id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            640,
            -896
          ],
          "id": "e8b9772f-e15e-4abf-827e-c00698f9843c",
          "name": "Map music file_id"
        },
        {
          "parameters": {
            "content": "# Generate seed image",
            "height": 288,
            "width": 1396,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -96,
            -1680
          ],
          "id": "f69a4b15-3bba-4cec-bdb0-dddfccb16f7d",
          "name": "Sticky Note19"
        },
        {
          "parameters": {
            "content": "# Generate looping video",
            "height": 320,
            "width": 1396,
            "color": 7
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -96,
            -1344
          ],
          "id": "3f4ff8fd-c845-4312-9de4-7d7830d0b57f",
          "name": "Sticky Note20"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            160,
            -1264
          ],
          "id": "cc21467b-6867-4cbc-bdad-92f60ff02b6e",
          "name": "Wait for the looping video",
          "webhookId": "e8d6e2f8-2c00-4b80-a18c-3693765b6976"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "09899c0c-4e96-40f6-9038-718fb42d4ed4",
                  "name": "video_id",
                  "value": "={{ $json.file_id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1152,
            -1232
          ],
          "id": "87773962-0810-4b34-900d-7f799a92bf44",
          "name": "Map the loopin video file_id"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.openai.com/v1/responses",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "openAiApi",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n   \"model\":\"gpt-5\",\n   \"input\": {{ JSON.stringify($('Configure me').item.json.CONCEPT_PROMPT) }},\n   \"reasoning\":{\n      \"effort\":\"minimal\",\n      \"summary\":\"auto\"\n   },\n   \"text\":{\n      \"format\": {\n        \"type\": \"json_schema\",\n        \"name\": \"video_concept\",\n        \"schema\": {\n           \"type\":\"object\",\n           \"properties\":{\n              \"title\":{\n                 \"type\":\"string\",\n                 \"description\":\"the title of the video idea\"\n              },\n              \"visual\":{\n                 \"type\":\"string\",\n                 \"description\":\"the visual characteristics of the video\"\n              }\n           },\n           \"required\":[\n              \"title\",\n              \"visual\"\n           ],\n           \"additionalProperties\": false\n        }\n      },\n      \"verbosity\":\"high\"\n   },\n   \"stream\":false,\n   \"store\":false\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -480,
            -1376
          ],
          "id": "4cbefd90-22b3-4485-ab92-4799f3b1eb6c",
          "name": "âš ï¸ Create concept",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.openai.com/v1/responses",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "openAiApi",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n   \"model\":\"gpt-5\",\n   \"input\": {{ JSON.stringify($('Configure me').item.json.CREATE_PROMPTS_PROMPT.replace('{CONCEPT}', `\n  ${$json.output.title}\n\n  ${$json.output.visual}\n`)) }},\n   \"reasoning\":{\n      \"effort\":\"low\",\n      \"summary\":\"auto\"\n   },\n   \"text\":{\n      \"format\": {\n        \"type\": \"json_schema\",\n        \"name\": \"video_concept\",\n        \"schema\": {\n           \"type\":\"object\",\n           \"properties\": {\n                \"music_prompt\": {\n                    \"type\": \"string\",\n                    \"description\": \"the music prompt for music generation\"\n                },\n                \"image_prompt\": {\n                    \"type\": \"string\",\n                    \"description\": \"the image prompt to generate the seed image for the video generation\"\n                },\n                \"video_prompt\": {\n                    \"type\": \"string\",\n                    \"description\": \"the video prompt to generate the looping video\"\n                }\n            },\n            \"required\": [\n                \"music_prompt\",\n                \"image_prompt\",\n                \"video_prompt\"\n            ],\n           \"additionalProperties\": false\n        }\n      },\n      \"verbosity\":\"high\"\n   },\n   \"stream\":false,\n   \"store\":false\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -480,
            -1136
          ],
          "id": "c0ce5aee-687a-4d04-84de-5369092110b1",
          "name": "âš ï¸ Create prompts",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "content": "# How to set up this automation?\n\n## 1. Add your server URL to the `Configure me` node and setup the desired video length\n## Next, add credentials to the nodes marked with the âš ï¸ emoji\n## 2. Setup your OpenAI credentials in the `Create concept` and `Create prompts` nodes\n## 3. Setup your Fal.ai credentials in the `Generate seed image`, `Get status of the seed image`, `Start generating the looping video` and the `Get status of the looping video` nodes\n## 4. Setup your ElevenLabs credentials in the `Create music plan` and `Generate music` nodes",
            "height": 372,
            "width": 1220,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1344,
            -1888
          ],
          "id": "fae2fe17-b1d5-4e1b-8026-16c1890b7eed",
          "name": "Sticky Note14"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for more sleep video automations, support, premium content and more!](https://www.skool.com/ai-agents-az/about?w9)\n\n## Be part of a growing community and help us create more content like this\n\n## And get access to our premium workflows and our hosted servers",
            "height": 372,
            "width": 1132,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1280,
            -1904
          ],
          "id": "08b489d0-7d2b-4c4d-9cc0-4adaeb0c500f",
          "name": "Sticky Note17"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.elevenlabs.io/v1/music/plan",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "prompt",
                  "value": "={{ $json.output.music_prompt.slice(0, 2000) }}"
                },
                {
                  "name": "music_length_ms",
                  "value": "240000"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -32,
            -896
          ],
          "id": "3776c249-f21d-4c65-bc75-1f7b0cf93207",
          "name": "âš ï¸ Create music plan",
          "credentials": {
            "httpHeaderAuth": {
              "id": "lTjJlaw5BpPoTt5b",
              "name": "ElevenLabs full key"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.elevenlabs.io/v1/music",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"composition_plan\": {\n    \"positive_global_styles\": {{ JSON.stringify($json.positive_global_styles) }},\n    \"negative_global_styles\": {{ JSON.stringify($json.negative_global_styles) }},\n    \"sections\": {{ JSON.stringify($json.sections) }}\n  },\n  \"model_id\": \"music_v1\"\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            192,
            -896
          ],
          "id": "32477f71-bddd-4857-8d04-87ee63c8881e",
          "name": "âš ï¸ Generate music",
          "credentials": {
            "httpHeaderAuth": {
              "id": "lTjJlaw5BpPoTt5b",
              "name": "ElevenLabs full key"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/imagen4/preview",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "prompt",
                  "value": "={{ $json.output.image_prompt }}"
                },
                {
                  "name": "aspect_ratio",
                  "value": "=16:9"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -32,
            -1600
          ],
          "id": "553b49c6-994e-44ee-9a28-68abdaa3c988",
          "name": "âš ï¸ Generate seed image",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Generate seed image').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            496,
            -1632
          ],
          "id": "1898d50b-f74c-43b5-ac26-f27a51d08a70",
          "name": "âš ï¸ Get status of the seed image",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/bytedance/seedance/v1/lite/image-to-video",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "prompt",
                  "value": "={{ $('Parse prompts').item.json.output.video_prompt }}"
                },
                {
                  "name": "resolution",
                  "value": "=480p"
                },
                {
                  "name": "duration",
                  "value": "12"
                },
                {
                  "name": "camera_fixed",
                  "value": "true"
                },
                {
                  "name": "image_url",
                  "value": "={{ $json.images?.[0].url }}"
                },
                {
                  "name": "end_image_url",
                  "value": "={{ $json.images?.[0].url }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -48,
            -1248
          ],
          "id": "7314f71f-b41d-49e1-84e5-1ac859410e31",
          "name": "âš ï¸ Start generating the looping video",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Start generating the looping video').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            336,
            -1264
          ],
          "id": "435d3488-b390-4294-82a4-8f098671d0ea",
          "name": "âš ï¸ Get the status of the looping video",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        }
      ],
      "pinData": {},
      "connections": {
        "Configure me": {
          "main": [
            [
              {
                "node": "Setup defaults",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "âš ï¸ Create concept",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Server isn't ready",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup defaults": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get video generation status": {
          "main": [
            [
              {
                "node": "Video generation switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video generation switch": {
          "main": [
            [
              {
                "node": "Download the video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait until the video gets generated",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Stop and Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait until the video gets generated": {
          "main": [
            [
              {
                "node": "Get video generation status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start creating the sleep video": {
          "main": [
            [
              {
                "node": "Wait until the video gets generated",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When clicking â€˜Execute workflowâ€™": {
          "main": [
            [
              {
                "node": "Configure me",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for seed image": {
          "main": [
            [
              {
                "node": "âš ï¸ Get status of the seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Seed image status": {
          "main": [
            [
              {
                "node": "Get the seed image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for seed image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the seed image": {
          "main": [
            [
              {
                "node": "âš ï¸ Start generating the looping video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Looping video status": {
          "main": [
            [
              {
                "node": "Get the looping video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the looping video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the looping video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the looping video": {
          "main": [
            [
              {
                "node": "Upload the looping video to the server",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "Start creating the sleep video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload the looping video to the server": {
          "main": [
            [
              {
                "node": "Map the loopin video file_id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse concept": {
          "main": [
            [
              {
                "node": "âš ï¸ Create prompts",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse prompts": {
          "main": [
            [
              {
                "node": "âš ï¸ Generate seed image",
                "type": "main",
                "index": 0
              },
              {
                "node": "âš ï¸ Create music plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload music to the server": {
          "main": [
            [
              {
                "node": "Map music file_id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map music file_id": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Wait for the looping video": {
          "main": [
            [
              {
                "node": "âš ï¸ Get the status of the looping video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map the loopin video file_id": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Create concept": {
          "main": [
            [
              {
                "node": "Parse concept",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Create prompts": {
          "main": [
            [
              {
                "node": "Parse prompts",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Create music plan": {
          "main": [
            [
              {
                "node": "âš ï¸ Generate music",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Generate music": {
          "main": [
            [
              {
                "node": "Upload music to the server",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Generate seed image": {
          "main": [
            [
              {
                "node": "Wait for seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Get status of the seed image": {
          "main": [
            [
              {
                "node": "Seed image status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Start generating the looping video": {
          "main": [
            [
              {
                "node": "Wait for the looping video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Get the status of the looping video": {
          "main": [
            [
              {
                "node": "Looping video status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "3e38ef47-0881-4595-a985-fef63d18b979",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "1PYCKdNE20TuTQHn",
      "tags": []
    }
  },
  {
    "id": "ugc-nanobanana",
    "title": "UGC Ads with Nanobanana",
    "description": "Generates UGC-style ad scenes using Google nanobanana, ElevenLabs, and Seedance, then stitches them into paid media assets.",
    "problem": "Brands need UGC ads fast but real creator shoots are expensive; this agent fabricates them programmatically.",
    "tags": [
      "ugc",
      "ads",
      "nanobanana",
      "seedance",
      "marketing"
    ],
    "metadata": {
      "industries": [
        "marketing",
        "ugc"
      ],
      "domains": [
        "video-ads"
      ],
      "channels": [
        "instagram",
        "tiktok"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "Google nanobanana",
        "Fal.ai",
        "ElevenLabs",
        "Seedance"
      ]
    },
    "workflow": {
      "name": "Episode 23: UGC with nanobanana",
      "nodes": [
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5",
              "mode": "list",
              "cachedResultName": "gpt-5"
            },
            "options": {
              "responseFormat": "json_object"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            -1312,
            -912
          ],
          "id": "4dded72c-e430-460f-bbaf-3d0bb501a3bd",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "model": "qwen3:32b",
            "options": {
              "numCtx": 16048
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
          "typeVersion": 1,
          "position": [
            -1760,
            -912
          ],
          "id": "0f677115-006c-4ee2-9f99-1ae3e8f748bc",
          "name": "Ollama Chat Model",
          "credentials": {
            "ollamaApi": {
              "id": "cWXUsJ0LsqnzOEx0",
              "name": "Ollama account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
          "typeVersion": 1,
          "position": [
            -1440,
            -912
          ],
          "id": "a4557cc7-f684-4eb1-aa5f-8d2ed81cfb15",
          "name": "DeepSeek Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": "tngtech/deepseek-r1t-chimera:free",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
          "typeVersion": 1,
          "position": [
            -1312,
            -576
          ],
          "id": "ac496073-7092-43fe-ac65-1b6eb08c57eb",
          "name": "OpenRouter Chat Model",
          "credentials": {
            "openRouterApi": {
              "id": "pKxg2Rhtt3cG3h19",
              "name": "OpenRouter account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1760,
            -576
          ],
          "id": "04db5d3d-64f0-485f-8c1f-012b736f8eae",
          "name": "Google Gemini Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
          "typeVersion": 1,
          "position": [
            -1760,
            -752
          ],
          "id": "1ad3b054-3f84-4e7b-aafe-55575d19b17d",
          "name": "Azure OpenAI Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            -1600,
            -752
          ],
          "id": "e1d60af5-4a6f-4f25-b813-e729ffe15ac7",
          "name": "xAI Grok Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "claude-sonnet-4-20250514",
              "cachedResultName": "Claude 4 Sonnet"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            -1440,
            -752
          ],
          "id": "8f2b1a75-190c-4ee3-8962-f9d817aa0116",
          "name": "Anthropic Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            -1312,
            -752
          ],
          "id": "1aec8db8-bd6d-42fa-92a1-268afdfc31ce",
          "name": "xAI Grok Chat Model1",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
          "typeVersion": 1,
          "position": [
            -1440,
            -576
          ],
          "id": "46e7a7a2-6725-4148-a172-2a367716c2c7",
          "name": "Groq Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAwsBedrock",
          "typeVersion": 1,
          "position": [
            -1600,
            -912
          ],
          "id": "e52e65c0-5156-4d3e-a268-107d4cf41a35",
          "name": "AWS Bedrock Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
          "typeVersion": 1,
          "position": [
            -1600,
            -576
          ],
          "id": "a75c5985-3992-4125-9964-e0c16ce5bb9d",
          "name": "Mistral Cloud Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "content": "# Pick your choice of LLM âš ï¸\nâš ï¸ Make sure to deactive/delete the rest of the LLMs after selecting one",
            "height": 680,
            "width": 700,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1840,
            -1056
          ],
          "id": "8e0d21de-d9e4-4e41-96ba-09f48d9d3154",
          "name": "Sticky Note7"
        },
        {
          "parameters": {
            "formTitle": "Create a UGC-like video for a product",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Details of the product",
                  "fieldType": "textarea",
                  "placeholder": "name, description, etc.",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Product image",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "acceptFileTypes": ".jpg,.jpeg,.png,.webp",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Instructions for the video",
                  "fieldType": "textarea"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -1232,
            -1664
          ],
          "id": "040d2bdc-dcce-4a30-94d5-b574db086243",
          "name": "On form submission",
          "webhookId": "fe600a73-6a8b-4137-81c0-8f78a689d891"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bcbc506b-434c-4738-9a63-dd38efcace4f",
                  "name": "voice",
                  "value": "={{ $('Create main scene').item.json.output.sex  === \"female\" ? \"Sarah\" : \"Roger\" }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -608,
            640
          ],
          "id": "aefbfe77-9ab8-4f25-a6b1-6b9fd0c82d73",
          "name": "Set the voice based on sex"
        },
        {
          "parameters": {
            "content": "# ðŸŽ‰ Here's the generated video",
            "height": 916,
            "width": 400,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1696,
            512
          ],
          "id": "0b316ec3-b456-436f-94e0-be4bad9c11ec",
          "name": "Sticky Note6"
        },
        {
          "parameters": {
            "url": "={{ $json.video.url }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1792,
            944
          ],
          "id": "a866da3e-1548-46ce-93c3-3dec5129fcda",
          "name": "Download the video"
        },
        {
          "parameters": {
            "content": "# 7. Generate lipsync",
            "height": 916,
            "width": 804
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            832,
            512
          ],
          "id": "1fb8c08f-11ae-4ad2-8449-e96c3f51190b",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the lipsync').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1472,
            912
          ],
          "id": "bd196ffa-29bd-46e7-97d1-f2e35d468210",
          "name": "Get the lipsync video",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1312,
            1200
          ],
          "id": "c5cca6db-c171-49b4-a906-72db309434b8",
          "name": "Lipsync status"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the lipsync').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "timeout": 10000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1088,
            1216
          ],
          "id": "1bcf1617-ffa5-473d-a3ec-fd4f33d6e61e",
          "name": "Get the lipsync status",
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            1088,
            928
          ],
          "id": "2c533dbf-d8c7-42b0-9242-209af23afdcd",
          "name": "Wait for the lipsync",
          "webhookId": "4f5e5279-5484-47a8-8d18-cc1dc9c5a042"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/latentsync",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "video_url",
                  "value": "={{ $json.video_url }}"
                },
                {
                  "name": "audio_url",
                  "value": "={{ $json.audio_url }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1072,
            640
          ],
          "id": "2e0ca6cc-0dea-4d41-8a1c-e1a2741b4370",
          "name": "Start generating the lipsync",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the speech').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            416,
            672
          ],
          "id": "af173ccd-fbef-4b28-87e0-105a98479c93",
          "name": "Get the speech",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            144,
            624
          ],
          "id": "0ddeecf5-5c23-407f-b91a-41f5d1d17bbb",
          "name": "Speech status"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/elevenlabs/tts/eleven-v3",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "text",
                  "value": "={{ $('Create main scene').item.json.output.dialogue }}"
                },
                {
                  "name": "voice",
                  "value": "={{ $json.voice }}"
                },
                {
                  "name": "style",
                  "value": "0.5"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -448,
            640
          ],
          "id": "eb80e649-b190-4c04-9408-32962153239e",
          "name": "Start generating the speech",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the speech').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "timeout": 10000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -32,
            640
          ],
          "id": "740d61b6-b6dc-4813-9779-373e29f34a59",
          "name": "Get the speech status",
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "amount": 1
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -224,
            640
          ],
          "id": "2deeb522-ceac-48c1-a8f0-e252b84a9d43",
          "name": "Wait for the speech",
          "webhookId": "76c0b34b-8a7d-44d8-8705-019ccc6c2367"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the video').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            112,
            80
          ],
          "id": "bfef97fc-8777-41f9-9022-535640d3f690",
          "name": "Get the  video",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -160,
            48
          ],
          "id": "561cce2b-0496-46bf-b90c-e55dc11b4dc7",
          "name": "Video status"
        },
        {
          "parameters": {
            "url": "={{ $('Start generating the video').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "timeout": 10000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -400,
            48
          ],
          "id": "2b636c8b-444c-457d-a4d4-ace3d636a7df",
          "name": "Get the video status",
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "amount": 1
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -608,
            48
          ],
          "id": "faf299bd-f329-4488-95bf-251d21acdb5c",
          "name": "Wait for the video",
          "webhookId": "7fdf42c3-fb77-4420-8e49-699ebea41e29"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/bytedance/seedance/v1/lite/image-to-video",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "prompt",
                  "value": "={{ $json.prompt }}"
                },
                {
                  "name": "image_url",
                  "value": "={{ $json.start_image }}"
                },
                {
                  "name": "end_image_url",
                  "value": "={{ $json.end_image ? $json.end_image : undefined }}"
                },
                {
                  "name": "resolution",
                  "value": "480p"
                },
                {
                  "name": "duration",
                  "value": "8"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -800,
            48
          ],
          "id": "a367b516-9ba0-4175-95a4-15fbed3fb7cc",
          "name": "Start generating the video",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9136d2ce-9e89-4ee6-9a0b-bef338199bb5",
                  "name": "base64",
                  "value": "={{ $json.data }}",
                  "type": "string"
                },
                {
                  "id": "0efe7428-8ca6-44ff-a569-910c9ca3847e",
                  "name": "mime",
                  "value": "={{ $('On form submission').item.json['Product image'].mimetype }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -576,
            -1168
          ],
          "id": "6d6f57d1-c136-463e-b04f-846d71ade842",
          "name": "Set base64 data"
        },
        {
          "parameters": {
            "operation": "binaryToPropery",
            "binaryPropertyName": "Product_image",
            "options": {}
          },
          "type": "n8n-nodes-base.extractFromFile",
          "typeVersion": 1,
          "position": [
            -800,
            -1168
          ],
          "id": "8e008123-6f44-4c63-a986-b03bb8a73277",
          "name": "Convert image to base64"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "c277f1ec-44a8-49c7-8f50-37633160a722",
                  "name": "image_prompts",
                  "value": "={{ $('Create scenes').item.json.output.scenes.slice(1).map(scene => $('Create main scene').item.json.output.image_prompt + ' ' + scene.starter_image_prompt + ' The scene should be the same as the reference image.') }}",
                  "type": "array"
                },
                {
                  "id": "526dbae5-1eda-4a52-af98-99b9cbab3de6",
                  "name": "seed_image",
                  "value": "={{ $json.images[0].url }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1040,
            -768
          ],
          "id": "99d58051-211e-44bd-be82-89688bde268d",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            -560,
            -768
          ],
          "id": "9845b87c-e57e-4925-9953-d06359fe45c3",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "fieldToSplitOut": "image_prompts",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -816,
            -768
          ],
          "id": "1ebc95cb-ff5d-4185-97b1-bb2ce23eb4b5",
          "name": "Split Out"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=Continuous Dynamic Scene Prompt Template (Self-contained)\n\nWe have a dialogue:\n\n{{ $json.output.dialogue }}  \n\n\nThe main image is created with the following base prompt:\n\n{{ $json.output.image_prompt }}  \n\n\nEach scene will be 8s long.\nThe character is talking continuously, so:\n\nDo not stop the talk.\n\nDo not cover the mouth.\n\nNo eating, drinking, yawning, or actions that block lipsync.\n\nIf the character is holding the product, they must hold it in every scene.\n\nThe background, lighting, and environment must stay 100% identical in every scene.\nDo not change or move objects in the surroundings.\nOnly change the characterâ€™s gestures/expressions slightly.\n\nâš ï¸ Important: Each prompt must be self-contained.\n\nDo not reference \"previous scene,\" \"next scene,\" \"continuation,\" or \"earlier.\"\n\nEach scene must repeat all continuity requirements explicitly.\n\nPrompt Pairs (3 self-contained examples)\nScene 1\n\nImage prompt: Character is standing naturally, holding the product steadily, looking at the camera, mouth open mid-speech. Neutral gesture.\n\nVideo prompt: Character gently nods once while speaking, keeping the product visible and steady. Background and environment remain unchanged. The character continues talking without interruption.\n\nScene 2\n\nImage prompt: Character is still holding the product, slightly raising eyebrows, one hand lightly gesturing near the chest while mouth open mid-speech. The environment and objects remain identical.\n\nVideo prompt: Character moves hand in a small outward gesture while talking, maintaining eye contact and holding the product. The background, lighting, and all surroundings remain unchanged. The character continues talking without interruption.\n\nScene 3\n\nImage prompt: Character smiling slightly while talking, holding the product in the same position, other hand resting casually by side. The background and environment remain unchanged.\n\nVideo prompt: Character makes a subtle hand wave or small pointing motion while continuing to talk, product still visible and stable. The background, lighting, and all objects remain identical. The character continues talking without interruption.",
            "hasOutputParser": true,
            "batching": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.7,
          "position": [
            -688,
            -1664
          ],
          "id": "1e58ac71-bec3-472b-ab9f-49e7b37bf032",
          "name": "Create scenes"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=<Instructions>  \nIâ€™m creating a UGC-style ad for an ecommerce product.  \n\nYour task is to create a natural, authentic scene and dialogue:  \n\n1. **Scene setup**  \n   - Place the character in an everyday environment that matches the product naturally (e.g. in a car, at the gym, cooking at home, running at the park).  \n   - The scene should feel casual, relatable, and influencer-like.  \n   - The character should always be the focus â€” close-up, as if recorded on a phone for social media.  \n   - Make sure the product fits seamlessly into the environment, not staged or artificial.  \n\n2. **Dialogue**  \n   - Write a **casual, genuine-sounding dialogue** (max 250 characters).  \n   - Tone: conversational, natural, like a friend giving a quick recommendation.  \n   - Avoid scripted/advertisy language, keep it real and simple.  \n\n3. **Character info**  \n   - Return the **sex of the character** (so the correct TTS voice can be chosen).  \n\n4. **Special rules**  \n   - Apply the following additional instructions:  \n     {{ $json['Instructions for the video'] }}  \n\n</Instructions>  \n\n<Product>  \n{{ $json['Details of the product'] }}  \n</Product>  \n",
            "hasOutputParser": true,
            "messages": {
              "messageValues": [
                {
                  "type": "HumanMessagePromptTemplate",
                  "messageType": "imageBinary",
                  "binaryImageDataKey": "Product_image"
                }
              ]
            },
            "batching": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "typeVersion": 1.7,
          "position": [
            -992,
            -1664
          ],
          "id": "ccf9faf0-7dc9-430d-b617-0edd00fb4dbb",
          "name": "Create main scene",
          "retryOnFail": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            -1040,
            64
          ],
          "id": "dfc8989f-acfb-47c9-a4d2-3bd27c4eb8b1",
          "name": "Loop Over Items1"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            608,
            -800
          ],
          "id": "16452108-a860-452f-91dc-73e57ca8261f",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/ffmpeg-api/merge-videos",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ JSON.stringify({\n\n  video_urls: $json.data.map(item => item.video.url),\n  resolution: {\n    width: 1080,\n    height: 1080\n  }\n\n}, null, 2) }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -544,
            1120
          ],
          "id": "29ce8426-8b2e-44ff-a8f9-3d5c0c6195fb",
          "name": "Start merging the videos",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "url": "={{ $('Start merging the videos').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "timeout": 10000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -144,
            1120
          ],
          "id": "a62292cd-714e-4031-8f69-9699c716a289",
          "name": "Get the status of the video merge",
          "alwaysOutputData": false,
          "executeOnce": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            96,
            1120
          ],
          "id": "e1b7f9ca-1c8d-4a5f-97a7-befbaf9a6be5",
          "name": "Video merge status"
        },
        {
          "parameters": {
            "url": "={{ $('Start merging the videos').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            432,
            1120
          ],
          "id": "f1b00b4b-5c1a-4c90-b94b-13c437fb0c18",
          "name": "Get the merged video",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -352,
            1120
          ],
          "id": "cf33eec4-3f5b-476c-bb65-e1d7618bd295",
          "name": "Wait for the merged video",
          "webhookId": "7fdf42c3-fb77-4420-8e49-699ebea41e29"
        },
        {
          "parameters": {
            "mode": "combine",
            "combineBy": "combineByPosition",
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            912,
            912
          ],
          "id": "ecdbeb65-dc67-4fbc-bebd-f74b3bb5c173",
          "name": "Merge"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -48,
            -1248
          ],
          "id": "daa54bda-873e-467c-89a7-d7efc7c53258",
          "name": "Wait for seed image",
          "webhookId": "5ba253c4-2ea2-4ecc-81cc-251ca00a5058"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            400,
            -1248
          ],
          "id": "c6edca48-23cb-4f46-af0f-47dbd312119b",
          "name": "Seed image status"
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Generate seed image').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            816,
            -1136
          ],
          "id": "1949ec85-a03e-4005-b689-8d024897623e",
          "name": "Get the seed image",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/nano-banana/edit",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ JSON.stringify(\n\n  {\n    prompt: $('Create main scene').item.json.output.image_prompt + ' ' + $('Create scenes').item.json.output.scenes[0].starter_image_prompt,\n    image_urls: [\n      `data:${$json.mime};base64,${$json.base64}`\n    ]\n  }, null, 2\n\n) }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -304,
            -1232
          ],
          "id": "16608e73-8e3a-4e5c-9b1b-ebd44f69eccb",
          "name": "âš ï¸ Generate seed image",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Generate seed image').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "timeout": 10000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            160,
            -1248
          ],
          "id": "ecaf5768-29d8-40d8-8ac9-a91f31b022b9",
          "name": "âš ï¸ Get status of the seed image",
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "content": "# 1. Create scenes",
            "height": 384,
            "width": 672
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1072,
            -1872
          ],
          "id": "644e18cf-4f0b-4eb8-97be-4b9a5e68f02d",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# 2. Generate the main seed image",
            "height": 464,
            "width": 2096
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1072,
            -1424
          ],
          "id": "f04db1e1-4448-4ea6-aa61-a661c161f73b",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# 3. Generate the rest of the seed images",
            "height": 704,
            "width": 2112
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1088,
            -896
          ],
          "id": "d486e662-6a0e-4241-a323-ad3f8df64bbc",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "content": "# 4. Create the videos for each scene",
            "height": 560,
            "width": 2112
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1088,
            -128
          ],
          "id": "bc8a0c8f-8f1c-4387-a63d-0c3b75d2cb94",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "content": "# 5. Create the text to speech",
            "height": 432,
            "width": 1440
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -672,
            496
          ],
          "id": "4e6e641f-918d-4ab4-8df0-eab5e778336f",
          "name": "Sticky Note8"
        },
        {
          "parameters": {
            "content": "# 6. Merge the videos",
            "height": 432,
            "width": 1440
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -672,
            992
          ],
          "id": "dae46aee-a5c1-47d3-9411-94f08b569424",
          "name": "Sticky Note9"
        },
        {
          "parameters": {
            "content": "# Structured output",
            "height": 304,
            "width": 400
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1536,
            -1424
          ],
          "id": "016fbee6-5496-49a2-a269-ebd0fde6482c",
          "name": "Sticky Note10"
        },
        {
          "parameters": {
            "content": "# How to set up this automation?\n\n## 1. Setup your Fal.ai credentials in the `Generate seed image`, `Get status of the seed image`, `Generate rest of the seed image`, `Get status of the image`, `Staart generating the video`, `Get the video status`, `Start generating the speech, `Get the speech status`, `Start merging the videos`, `Get the status of the video merge` , `Start generating the lipsync` and `Get the lipsync status` nodes\n## 2. Pick a multimodal LLM (stronger the better) and connect it to the `Create main scene` and `Create scenes` nodes",
            "height": 388,
            "width": 1348,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -336,
            -1872
          ],
          "id": "22775964-6820-4936-b426-de37b4a6d839",
          "name": "Sticky Note14"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for more automations, support, premium content and more!](https://www.skool.com/ai-agents-az/about?w9)\n\n## Be part of a growing community and help us create more content like this\n\n## And get access to our premium workflows and our hosted servers",
            "height": 372,
            "width": 1132,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1072,
            -2304
          ],
          "id": "289d36f0-063f-4ae7-b1d7-f975f4a19d26",
          "name": "Sticky Note17"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://queue.fal.run/fal-ai/nano-banana/edit",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ JSON.stringify(\n\n  {\n    prompt: $('Create main scene').item.json.output.image_prompt + ' ' + $json.image_prompts,\n    image_urls: [\n      $('Edit Fields').item.json.seed_image\n    ]\n  }, null, 2\n\n) }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -336,
            -496
          ],
          "id": "7661e0f4-e560-4de5-b1d6-12cde1af4a38",
          "name": "âš ï¸ Generate rest of the seed image",
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -144,
            -480
          ],
          "id": "b7d4130f-ab4f-47d6-9c1c-122e20934f08",
          "name": "Wait for image",
          "webhookId": "5ba253c4-2ea2-4ecc-81cc-251ca00a5058"
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Generate rest of the seed image').item.json.status_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {
              "timeout": 10000
            }
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            64,
            -480
          ],
          "id": "8d0aacbb-29f1-4a05-99eb-38043f6abc0b",
          "name": "âš ï¸ Get status of the image",
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "COMPLETED",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "6fc5bea4-1567-474b-bfca-5394eb303217"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "COMPLETED"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0882f634-2472-4d24-a1c3-a39f0cd94855",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_PROGRESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_PROGRESS"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e6c8b207-13ac-4537-8c5c-677039bc2fef",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "IN_QUEUE",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "IN_QUEUE"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            304,
            -480
          ],
          "id": "63833f9d-caa3-49df-b272-fd5c438ce583",
          "name": "Image status"
        },
        {
          "parameters": {
            "url": "={{ $('âš ï¸ Generate rest of the seed image').item.json.response_url }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            560,
            -416
          ],
          "id": "d409ac1b-9025-456e-a30c-a0e632f05cbc",
          "name": "Get image",
          "alwaysOutputData": false,
          "retryOnFail": true,
          "credentials": {
            "httpHeaderAuth": {
              "id": "BUYuOe8V0hqLtA02",
              "name": "fal.ai"
            }
          }
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"image_prompt\": {\n            \"type\": \"string\",\n            \"description\": \"The image prompt for the AI image generation\"\n        },\n        \"sex\": {\n            \"type\": \"string\",\n            \"description\": \"The sex of the person on the attached image\"\n        },\n        \"dialogue\": {\n            \"type\": \"string\",\n            \"description\": \"the dialogue for the UGC video\"\n        }\n    },\n    \"required\": [\n        \"image_prompt\",\n        \"sex\",\n        \"dialogue\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.3,
          "position": [
            -1456,
            -1312
          ],
          "id": "775aaefb-70c3-41c8-bd3f-ebae1f73285b",
          "name": "Main scene output parser"
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n    \"type\": \"object\",\n    \"properties\": {\n        \"scenes\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"starter_image_prompt\": {\n                        \"type\": \"string\",\n                        \"description\": \"describing the gestures/motions of the character\"\n                    },\n                    \"video_prompt\": {\n                        \"type\": \"string\",\n                        \"description\": \"describing what happens in the scene\"\n                    }\n                },\n                \"required\": [\n                    \"starter_image_prompt\",\n                    \"video_prompt\"\n                ]\n            }\n        }\n    },\n    \"required\": [\n        \"scenes\"\n    ]\n}"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.3,
          "position": [
            -1280,
            -1312
          ],
          "id": "0f9a32a8-4cac-409f-b99b-1bb8ae7940da",
          "name": "Scenes output parser"
        },
        {
          "parameters": {
            "jsCode": "return $('On form submission').first()"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1024,
            -1168
          ],
          "id": "ef4c4789-8354-4b19-9d10-634ad9a08b13",
          "name": "Relay image",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "jsCode": "const scenes = []\n\nconst urlArray = [\n  $('Edit Fields').first().json.seed_image,\n  ...$input.first().json.data.map(item => item.images[0].url)\n]\n\n$('Create scenes').first().json.output.scenes.forEach((item, index) => {\n  const start_image = urlArray[index];\n  const end_image = index < urlArray.length - 1 ? urlArray[index + 1] : undefined;\n    \n    scenes.push({\n      prompt: item.video_prompt,\n      start_image,\n      end_image\n    })\n  })\n\nreturn scenes.map(scene => ({\n  json: scene\n}))"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            864,
            -368
          ],
          "id": "6b2c35b2-4d09-4997-848b-da76f7c188de",
          "name": "Setup the scenes"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -864,
            288
          ],
          "id": "4ee65aa5-9c69-4eab-914c-4732a64b8a47",
          "name": "Collect videos"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "8a10e867-bc74-403e-988d-776eeed86c27",
                  "name": "audio_url",
                  "value": "={{ $json.audio.url }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            592,
            672
          ],
          "id": "692f592c-b4c6-4d55-89b9-f9d06416caf5",
          "name": "Set audio url"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7993e2cc-6dde-4b29-9561-7c45ee39172c",
                  "name": "video_url",
                  "value": "={{ $json.video.url }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            608,
            1120
          ],
          "id": "ef497da5-3939-440b-80cd-9245d2edd14f",
          "name": "Set video url"
        }
      ],
      "pinData": {},
      "connections": {
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Create main scene",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Create scenes",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Get the lipsync video": {
          "main": [
            [
              {
                "node": "Download the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Lipsync status": {
          "main": [
            [
              {
                "node": "Get the lipsync video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the lipsync",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the lipsync",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the lipsync status": {
          "main": [
            [
              {
                "node": "Lipsync status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the lipsync": {
          "main": [
            [
              {
                "node": "Get the lipsync status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating the lipsync": {
          "main": [
            [
              {
                "node": "Wait for the lipsync",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set the voice based on sex": {
          "main": [
            [
              {
                "node": "Start generating the speech",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Speech status": {
          "main": [
            [
              {
                "node": "Get the speech",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the speech",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the speech",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating the speech": {
          "main": [
            [
              {
                "node": "Wait for the speech",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the speech status": {
          "main": [
            [
              {
                "node": "Speech status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the speech": {
          "main": [
            [
              {
                "node": "Get the speech status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the  video": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video status": {
          "main": [
            [
              {
                "node": "Get the  video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the video status": {
          "main": [
            [
              {
                "node": "Video status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the video": {
          "main": [
            [
              {
                "node": "Get the video status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start generating the video": {
          "main": [
            [
              {
                "node": "Wait for the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On form submission": {
          "main": [
            [
              {
                "node": "Create main scene",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the speech": {
          "main": [
            [
              {
                "node": "Set audio url",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set base64 data": {
          "main": [
            [
              {
                "node": "âš ï¸ Generate seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Convert image to base64": {
          "main": [
            [
              {
                "node": "Set base64 data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "âš ï¸ Generate rest of the seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create scenes": {
          "main": [
            [
              {
                "node": "Relay image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create main scene": {
          "main": [
            [
              {
                "node": "Create scenes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items1": {
          "main": [
            [
              {
                "node": "Collect videos",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Start generating the video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Setup the scenes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Start merging the videos": {
          "main": [
            [
              {
                "node": "Wait for the merged video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the status of the video merge": {
          "main": [
            [
              {
                "node": "Video merge status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video merge status": {
          "main": [
            [
              {
                "node": "Get the merged video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the merged video",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for the merged video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for the merged video": {
          "main": [
            [
              {
                "node": "Get the status of the video merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the merged video": {
          "main": [
            [
              {
                "node": "Set video url",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Start generating the lipsync",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for seed image": {
          "main": [
            [
              {
                "node": "âš ï¸ Get status of the seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Seed image status": {
          "main": [
            [
              {
                "node": "Get the seed image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for seed image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Generate seed image": {
          "main": [
            [
              {
                "node": "Wait for seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Get status of the seed image": {
          "main": [
            [
              {
                "node": "Seed image status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the seed image": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Generate rest of the seed image": {
          "main": [
            [
              {
                "node": "Wait for image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait for image": {
          "main": [
            [
              {
                "node": "âš ï¸ Get status of the image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "âš ï¸ Get status of the image": {
          "main": [
            [
              {
                "node": "Image status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Image status": {
          "main": [
            [
              {
                "node": "Get image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait for image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get image": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Main scene output parser": {
          "ai_outputParser": [
            [
              {
                "node": "Create main scene",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Scenes output parser": {
          "ai_outputParser": [
            [
              {
                "node": "Create scenes",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Relay image": {
          "main": [
            [
              {
                "node": "Convert image to base64",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup the scenes": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Collect videos": {
          "main": [
            [
              {
                "node": "Set the voice based on sex",
                "type": "main",
                "index": 0
              },
              {
                "node": "Start merging the videos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set audio url": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set video url": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "e90863de-a37e-4c95-b79d-e6d706883cb6",
      "meta": {
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "YyEbl4OcYaZ596pO",
      "tags": []
    }
  },
  {
    "id": "influencer-machine",
    "title": "Instagram Influencer Machine",
    "description": "Plans weekly content, generates captions/images via Fal.ai, stores schedules in DB tables, and posts to Instagram Business accounts.",
    "problem": "AI influencer brands need coordinated publishing across multiple personas; this workflow manages planning + posting.",
    "tags": [
      "instagram",
      "influencer",
      "scheduler",
      "fal"
    ],
    "metadata": {
      "industries": [
        "marketing",
        "social"
      ],
      "domains": [
        "content-scheduling"
      ],
      "channels": [
        "instagram",
        "google-sheets"
      ],
      "trigger": "scheduled",
      "complexity": "high",
      "integrations": [
        "Instagram Graph",
        "Fal.ai",
        "Google Sheets",
        "PostgreSQL"
      ]
    },
    "workflow": {
      "name": "Influencer 2.0",
      "nodes": [
        {
          "parameters": {
            "formTitle": "Influencer workflow 2.0 by AI Agents A-Z",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "What do you want to do?",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Add a new influencer"
                      },
                      {
                        "option": "Create a weekly plan"
                      },
                      {
                        "option": "Create a new post"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.3,
          "position": [
            -1552,
            -112
          ],
          "id": "761a9cea-2189-401a-bbd1-8debfd486afb",
          "name": "On form submission",
          "webhookId": "d9176a7c-2df4-4823-b5a1-9073c7eca7f0"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "af22e08c-fb4c-4f71-beeb-baf1396e3025",
                        "leftValue": "={{ $('On form submission').item.json['What do you want to do?'] }}",
                        "rightValue": "Add a new influencer",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Add a new influencer"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "31301ad8-6aea-4a83-aea9-32c4b54fcccb",
                        "leftValue": "={{ $('On form submission').item.json['What do you want to do?'] }}",
                        "rightValue": "Create a weekly plan",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Create a weekly plan"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('On form submission').item.json['What do you want to do?'] }}",
                        "rightValue": "Create a new post",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "a1482d9a-1250-4821-ac3c-088193496380"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Create a new post"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.3,
          "position": [
            -1008,
            -128
          ],
          "id": "2cfbfb08-8619-4a5b-a020-5b62128e2857",
          "name": "Switch"
        },
        {
          "parameters": {
            "jsCode": "const results = [];\n\nfor (const file in $input.first().binary) {\n  try {\n    const bin = $input.first().binary[file];\n    const binBuffer = await this.helpers.getBinaryDataBuffer(0, file);\n\n    const path = bin.directory\n      ? `${bin.directory}/${bin.fileName}`\n      : bin.fileName;\n\n    results.push(`data:${bin.mimeType};base64,` + Buffer.from(binBuffer).toString('base64'));\n  } catch (error) {\n    console.error(`Error processing file \"${file}\": ${error.message}`);\n  }\n}\n\nreturn [{\n  json: {\n    files: results,\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -592,
            -672
          ],
          "id": "7ffd4e23-6ac3-4984-ac46-7d51c31fd9dc",
          "name": "Convert images to base64"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Name of the influencer",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Bio of the influencer",
                  "fieldType": "textarea",
                  "placeholder": "be as thorough as possible",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Reference image",
                  "fieldType": "file",
                  "acceptFileTypes": ".jpg,.png",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Add a weekly plan",
                  "fieldType": "checkbox",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Add a weekly plan"
                      }
                    ]
                  }
                },
                {
                  "fieldLabel": "Instagram Business ID",
                  "placeholder": "use the guide to get the ID"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -752,
            -672
          ],
          "id": "fbf84d2f-1b40-40c4-84ac-6170ca780d3c",
          "name": "Influencer details",
          "webhookId": "d5ba0708-5fc2-4621-b672-4548f39da099"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "88fdb102-725a-43d9-9244-2871042a803d",
                  "leftValue": "={{ $('Influencer details').item.json['Add a weekly plan'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthGt",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -256,
            -672
          ],
          "id": "d7652926-5229-43e3-88f3-d1c6267b206b",
          "name": "Add weekly plan?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9ac51cc9-10e5-44b4-8c6d-878fb3656503",
                  "name": "influencer_id",
                  "value": "={{ $json.id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            448,
            -112
          ],
          "id": "b87f34ba-7857-415c-adee-1e9069043f82",
          "name": "Set influencer id"
        },
        {
          "parameters": {
            "text": "=Create a social media post calendar for this artificial person, who's sharing the life events on Instagram using the instructions below.\nEach day of the week should be carefully planned, monday to sunday. Add at least one paragraph to each day.\nMake sure to add 3 different post ideas for each day.\n\n<PersonalProfile>\n{{ $('Get influencer for weekly planning').item.json.name }}\n\n{{ $('Get influencer for weekly planning').item.json.bio }}\n</PersonalProfile>\n\n<Instructions>\n{{ $json.Plan }}\n</Instructions>\n\n{{ $json.change_requests ? `\nThe weekly plan was already generated, please make the requested changes.\n\n<WeeklyPlan>\n${$json.weekly_plan}\n</WeeklyPlan>\n\n<ChangeRequests>\n${$json.change_requests}\n</ChangeRequests>\n` : '' }}",
            "attributes": {
              "attributes": [
                {
                  "name": "weekly_plan",
                  "description": "the weekly plan",
                  "required": true
                }
              ]
            },
            "options": {
              "systemPromptTemplate": "You are a travel planner for a famous instagram celebrity. Create a detailed plan according to the instructions."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1,
          "position": [
            1760,
            -320
          ],
          "id": "dccc0eee-58d0-4514-b057-71d03f4198e2",
          "name": "Generate weekly plan"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4.1-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            -1040,
            416
          ],
          "id": "3356af24-5cc0-4e6f-80aa-40614ef854c7",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "tGvJRP2th9CbI2oq",
              "name": "OpenAi account 2"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.influencer_db }}",
              "mode": "id"
            },
            "filters": {
              "conditions": [
                {
                  "keyValue": "={{ $json.influencer_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            672,
            -112
          ],
          "id": "1f6dcb21-3f0c-4bf8-9a50-c17ccf50f1b3",
          "name": "Get influencer for weekly planning"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.influencer_db }}",
              "mode": "id"
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            -736,
            -112
          ],
          "id": "6bdb1907-c4a8-42c4-9e3e-8091bfbf5330",
          "name": "Get all influencers for weekly planning",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -544,
            -112
          ],
          "id": "3e8a38ea-9fd4-4764-9c56-b53e809c2e1f",
          "name": "Aggregate influencers",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            1056,
            -112
          ],
          "id": "4ae4f1f7-0c28-4e8f-8596-5b9199fa2ef7",
          "name": "Aggregate previous plans"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.plans_db }}",
              "mode": "id"
            },
            "filters": {
              "conditions": [
                {
                  "keyName": "influencer_id",
                  "keyValue": "={{ $('Set influencer id').item.json.influencer_id }}"
                }
              ]
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            864,
            -112
          ],
          "id": "59a7bf4f-4539-4bec-accf-cf5e2387b625",
          "name": "Get previous plans",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.plans_db }}",
              "mode": "id"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "influencer_id": "={{ $('Set influencer id').item.json.influencer_id }}",
                "week": "={{ ((weekString) => {\n  const matches = weekString.match(/^(\\d{4}), week (\\d{1,2})/);\n  return `${matches[1]}/${matches[2]}`;\n})($('Select the week').item.json['Select week']) }}",
                "plan": "={{ $('Generate weekly plan').last().json.output.weekly_plan }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "influencer_id",
                  "displayName": "influencer_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "week",
                  "displayName": "week",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "plan",
                  "displayName": "plan",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            2384,
            -336
          ],
          "id": "3e7cf4e2-e75f-471b-9007-d02c2c4cc124",
          "name": "Insert plan"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "7b46b57d-a476-4d73-969c-2b590ddf4967",
                  "name": "influencer_id",
                  "value": "={{ $json.influencer_id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -752,
            240
          ],
          "id": "ed38b981-3ba6-4bab-b9f3-5f4a4e34dbc8",
          "name": "Edit Fields2"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.influencer_db }}",
              "mode": "id"
            },
            "filters": {
              "conditions": [
                {
                  "keyValue": "={{ $json.influencer_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            176,
            400
          ],
          "id": "74777967-8d31-4bc0-89ff-a497ec3c4c53",
          "name": "Get influencer for creating a post"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0c71548d-c249-42aa-998e-2d91bc29a230",
                  "name": "influencer_db",
                  "value": "<<insert here your influencer database id>>",
                  "type": "string"
                },
                {
                  "id": "65a94cf4-b0ea-47ce-8289-acde7768fb2e",
                  "name": "plans_db",
                  "value": "<<insert here your influencer plans database id>>",
                  "type": "string"
                },
                {
                  "id": "627b55aa-69b2-4712-b81f-36ac2fccf2ce",
                  "name": "posts_db",
                  "value": "<<insert here your influencer posts database id>>",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -1280,
            -112
          ],
          "id": "320aecb1-81cf-40ca-b7bb-825f5b889286",
          "name": "Configure workflow"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Post type",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Image"
                      },
                      {
                        "option": "Video"
                      }
                    ]
                  },
                  "requiredField": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            1376,
            416
          ],
          "id": "fad1c9a5-ec98-4c17-bee8-15064f14a6df",
          "name": "Select post type",
          "webhookId": "e9886663-3a3a-43ab-8973-9ccb2b1d9e5d"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            1056,
            384
          ],
          "id": "915a5a26-bab9-44d7-a833-64daf498da9a",
          "name": "Aggregate daily posts"
        },
        {
          "parameters": {
            "content": "# Post to instagram\n# [Guide to setup Facebook (Instagram)](https://github.com/gyoridavid/ai_agents_az/blob/main/episode_8/guide-instagram.md)",
            "height": 884,
            "width": 464,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            2320,
            480
          ],
          "id": "ded2b5d0-158f-4855-aa29-3e0da1bb1682",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json['Post type'] }}",
                        "rightValue": "Image",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "d5b604c1-33a9-4d85-bf97-df9ab8369121"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Image"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "ca0ddd39-98ec-417e-8627-e5ac1a7c6407",
                        "leftValue": "={{ $json['Post type'] }}",
                        "rightValue": "Video",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "Video"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.3,
          "position": [
            -752,
            944
          ],
          "id": "725d7f3f-616e-4683-89d6-c90a4c2a3cb8",
          "name": "Switch1"
        },
        {
          "parameters": {
            "text": "=Create a social media video post for this artificial person, who's sharing her life on Instagram using the instructions below.\nUse the detailed weekly plan to find what to post today. Make sure to look at the previous posts (if available) to make sure the post fits to the plan in a logical order.\n\nFor each post, generate an instagram post (text content, seed image generation prompt and a video prompt (that will use the seed image as the starter image)). \nAs I'm using a reference image for the image generation, don't describe the general look of the person, and start with \"create a photorealistic image of me\", and continue with describing the scene in great detail, make it a few paragraph long. Make sure the image prompt includes \"do not add any text on the image\".\nCreate a short summary of the post for cataloging purposes.\n\n<PersonalProfile>\n{{ $('Get influencer for creating a post').item.json.name }}\n\n{{ $('Get influencer for creating a post').item.json.bio }}\n</PersonalProfile>\n\n<WeeklyPlan>\n{{ $('Get the plan for the week').item.json.plan }}\n</WeeklyPlan>\n\n<DayOfTheWeek>\n{{ $now.format('EEEE') }}\n</DayOfTheWeek>\n\n{{ !$('Aggregate daily posts').item.json.data.length ? `\n<PreviousPostsFromToday>\n${$('Aggregate daily posts').item.json.data.map(item => `\n<Post>\n  <Content>${item.post_summary}</Content>\n</Post>\n`).join('\\n')}\n</PreviousPostsFromToday>\n` : '' }}\n\n{{ $json.change_requests ? `\nThe post was already generated, please apply the change requests\n\n<PostContent>\n${$json.post_content}\n</PostContent>\n\n<ImagePrompt>\n${$json.image_prompt}\n</ImagePrompt>\n\n<VideoPrompt>\n${$json.video_prompt}\n</VideoPrompt>\n\n<ChangeRequests>\n${$json.change_requests}\n</ChangeRequests>\n` : '' }}",
            "attributes": {
              "attributes": [
                {
                  "name": "post_content",
                  "description": "the instagram post's text content to share with the image. use emojis, hashtags",
                  "required": true
                },
                {
                  "name": "image_prompt",
                  "description": "the seed image prompt to use to generate the social media image",
                  "required": true
                },
                {
                  "name": "summary",
                  "description": "short summary of the post",
                  "required": true
                },
                {
                  "name": "video_prompt",
                  "description": "the video prompt, that will generate the 8s long video, starting from the seed image",
                  "required": true
                }
              ]
            },
            "options": {
              "systemPromptTemplate": "You are a social media expert. Create a post for instagram based on the instructions."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1,
          "position": [
            -464,
            1120
          ],
          "id": "4846a5ba-e349-46ef-9aae-6b72c6711833",
          "name": "Generate new Instagram post for video"
        },
        {
          "parameters": {
            "text": "=Create a social media post for this artificial person, who's sharing her life on Instagram using the instructions below.\nUse the detailed weekly plan to find what to post today. Make sure to look at the previous posts (if available) to make sure the post fits to the plan in a logical order.\n\nFor each post, generate an instagram post (text content and an image generation prompt). \nAs I'm using a reference image for the image generation, don't describe the general look of the person, and start with \"create a photorealistic image of me\", and continue with describing the scene in great detail, make it a few paragraph long. Make sure the image prompt includes \"do not add any text on the image\".\nCreate a short summary of the post for cataloging purposes.\n\n<PersonalProfile>\n{{ $('Get influencer for creating a post').item.json.name }}\n\n{{ $('Get influencer for creating a post').item.json.bio }}\n</PersonalProfile>\n\n<WeeklyPlan>\n{{ $('Get the plan for the week').item.json.plan }}\n</WeeklyPlan>\n\n<DayOfTheWeek>\n{{ $now.format('EEEE') }}\n</DayOfTheWeek>\n\n{{ !$('Aggregate daily posts').item.json.data.length ? `\n<PreviousPostsFromToday>\n${$('Aggregate daily posts').item.json.data.map(item => `\n<Post>\n  <Content>${item.post_summary}</Content>\n</Post>\n`).join('\\n')}\n</PreviousPostsFromToday>\n` : '' }}\n\n{{ $json.change_requests ? `\nThe post was already generated, please apply the change requests\n\n<PostContent>\n${$json.post_content}\n</PostContent>\n\n<ImagePrompt>\n${$json.image_prompt}\n</ImagePrompt>\n\n<ChangeRequests>\n${$json.change_requests}\n</ChangeRequests>\n` : '' }}",
            "attributes": {
              "attributes": [
                {
                  "name": "post_content",
                  "description": "the instagram post's text content to share with the image. use emojis, hashtags",
                  "required": true
                },
                {
                  "name": "image_prompt",
                  "description": "the image prompt to use to generate the social media image",
                  "required": true
                },
                {
                  "name": "summary",
                  "description": "short summary of the post",
                  "required": true
                }
              ]
            },
            "options": {
              "systemPromptTemplate": "You are a social media expert. Create a post for instagram based on the instructions."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1,
          "position": [
            -464,
            704
          ],
          "id": "1da00350-152c-4994-8fd3-079440484a95",
          "name": "Generate new Instagram post for image"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "qENpKJWFtOASEV54",
              "mode": "list",
              "cachedResultUrl": "/workflow/qENpKJWFtOASEV54",
              "cachedResultName": "Fal.ai nanobanana subworkflow"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "prompt": "={{ $json.image_prompt }}",
                "image_base64": "={{ $('Get influencer for creating a post').item.json.image }}",
                "aspect_ratio": "9:16"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "prompt",
                  "displayName": "prompt",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "width",
                  "displayName": "width",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number",
                  "removed": true
                },
                {
                  "id": "height",
                  "displayName": "height",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number",
                  "removed": true
                },
                {
                  "id": "image_base64",
                  "displayName": "image_base64",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "aspect_ratio",
                  "displayName": "aspect_ratio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.3,
          "position": [
            576,
            1104
          ],
          "id": "8b7cfa86-4a55-42db-bb2b-172542165666",
          "name": "Generate seed image"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "csjah07VqeSWIUn0",
              "mode": "list",
              "cachedResultUrl": "/workflow/csjah07VqeSWIUn0",
              "cachedResultName": "Fal.ai Veo 3.1 image to video subworkflow"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "prompt": "={{ $json.video_prompt }}",
                "image_base64": "={{ $('Generate seed image').item.json.images[0].url }}",
                "aspect_ratio": "9:16",
                "resolution": "1080p",
                "generate_audio": true
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "prompt",
                  "displayName": "prompt",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "image_base64",
                  "displayName": "image_base64",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "aspect_ratio",
                  "displayName": "aspect_ratio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "resolution",
                  "displayName": "resolution",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "generate_audio",
                  "displayName": "generate_audio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "boolean",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.3,
          "position": [
            1520,
            1088
          ],
          "id": "3b240738-190d-4f49-b1cf-ff6b29b13ad3",
          "name": "Generate video"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bca7d364-d81e-415f-b759-b1ccceffb763",
                  "name": "video_prompt",
                  "value": "={{ $json.video_prompt || $('Generate new Instagram post for video').item.json.output.video_prompt }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1344,
            1088
          ],
          "id": "c4e8621e-e136-435d-aed4-6cb3727e85ee",
          "name": "Set video prompt"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "qENpKJWFtOASEV54",
              "mode": "list",
              "cachedResultUrl": "/workflow/qENpKJWFtOASEV54",
              "cachedResultName": "Fal.ai nanobanana subworkflow"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "prompt": "={{ $json.image_prompt }}",
                "image_base64": "={{ $('Get influencer for creating a post').item.json.image }}",
                "aspect_ratio": "9:16"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "prompt",
                  "displayName": "prompt",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "width",
                  "displayName": "width",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number",
                  "removed": true
                },
                {
                  "id": "height",
                  "displayName": "height",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "number",
                  "removed": true
                },
                {
                  "id": "image_base64",
                  "displayName": "image_base64",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "aspect_ratio",
                  "displayName": "aspect_ratio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.3,
          "position": [
            768,
            688
          ],
          "id": "c0577237-9db8-4a9f-afaa-9f4f11d14f24",
          "name": "Generate image"
        },
        {
          "parameters": {
            "content": "# Configure me âš ï¸",
            "height": 480,
            "width": 304,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1360,
            -288
          ],
          "id": "9c710a3f-f84b-40da-bd8e-36168ead6287",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "d74c44d8-e66b-4835-9e15-729676b0c4d5",
                  "leftValue": "={{ $json.data.filter(item => item.id) }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthGt",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -368,
            -112
          ],
          "id": "e2a6f0b1-4816-4f3a-92b9-33602a30a463",
          "name": "If no influencer"
        },
        {
          "parameters": {
            "options": {
              "formTitle": "You don't have any influencers yet",
              "buttonLabel": "Create a new influencer"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -48,
            -352
          ],
          "id": "892cdc96-72a2-4391-9699-334e4cf9603e",
          "name": "Notify user to create an influencer",
          "webhookId": "de7583f1-0244-4738-a222-4091a0797699"
        },
        {
          "parameters": {
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.influencer_db }}",
              "mode": "id"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "name": "={{ $('Influencer details').item.json['Name of the influencer'] }}",
                "bio": "={{ $('Influencer details').item.json['Bio of the influencer'] }}",
                "image": "={{ $json.files[0] }}",
                "instagram_business_id": "={{ $('Influencer details').item.json['Instagram Business ID'] }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "name",
                  "displayName": "name",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "bio",
                  "displayName": "bio",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "image",
                  "displayName": "image",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "instagram_business_id",
                  "displayName": "instagram_business_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            -416,
            -672
          ],
          "id": "0d28f503-9ca0-4646-9616-21e32ddfc0c9",
          "name": "Add influencer"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=Great success!",
            "completionMessage": "={{ $json['Name of the influencer'] }} was saved successfully to the database. Now it's time to add some plans and posts!",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            48,
            -672
          ],
          "id": "b89205e7-4108-4186-b583-39a6e91f5871",
          "name": "Influencer saved",
          "webhookId": "ed74d1ab-db40-48c9-8a42-99ebf608c367"
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "={{ JSON.stringify([\n  {\n    \"fieldLabel\": \"Influencer\",\n    \"requiredField\": true,\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": $json.data.map(item => { return {option: `${item.name}`} })\n    }\n  }\n]) }}",
            "options": {
              "formTitle": "Select the influencer"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -112,
            -128
          ],
          "id": "51d9662b-0c56-48cb-94ce-ff26ab506ee3",
          "name": "Select influencer for planning",
          "webhookId": "dd733256-81ee-4213-abcb-91cbe246d6e0"
        },
        {
          "parameters": {
            "jsCode": "let id;\n// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  const selectedInfluencer = item.json.Influencer;\n  id = $('Aggregate influencers').first().json.data.find(influencer => selectedInfluencer === influencer.name)?.id;\n}\n\nreturn [{\n  json: {\n    id\n  }\n}]"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            128,
            -128
          ],
          "id": "1f23a89d-3630-4bb8-8cf1-a1d7213073ab",
          "name": "Map influencer for planning"
        },
        {
          "parameters": {
            "jsCode": "let weeks = [];\n\nfunction weekBounds(year, weekNumber) {\n  const monday = DateTime.fromObject({\n    weekYear: year,\n    weekNumber: weekNumber,\n    weekday: 1,   // Monday\n    hour: 0,\n    minute: 0,\n    second: 0,\n    millisecond: 0\n  });\n  \n  const sunday = monday.plus({ days: 6 });\n\n  return {\n    start: monday.toFormat(\"MM/dd/yyyy\"),\n    end: sunday.toFormat(\"MM/dd/yyyy\")\n  };\n}\n\nfor (const item of $input.all()) {\n  let currentWeek = DateTime.now().weekNumber;\n  let currentYear = 2025;\n\n  while(weeks.length < 4) {\n    if (currentWeek > 52) {\n      currentWeek = 1;\n      currentYear++;\n    }\n    if ($input.first().json.data.find(previous => previous?.week === `${currentYear}/${currentWeek}`)) {\n      currentWeek++;\n      continue;\n    }\n    const {start, end} = weekBounds(currentYear, currentWeek)\n    weeks.push({\n      currentYear,\n      currentWeek,\n      startOfWeek: start,\n      endOfWeek: end\n    });\n    currentWeek++;\n  }\n}\n\nreturn [{\n  json: {\n    weeks\n  }\n}]"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1248,
            -112
          ],
          "id": "c9667e05-934a-4e88-974f-6e4b4a841f8a",
          "name": "Generate week options"
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "={{ JSON.stringify([\n  {\n    \"fieldLabel\": \"Select week\",\n    \"requiredField\": true,\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": $json.weeks.map(item => { return {option: `${item.currentYear}, week ${item.currentWeek} (${item.startOfWeek}-${item.endOfWeek})`} })\n    }\n  },\n  {\n    \"fieldLabel\": \"Plan\",\n    \"fieldType\": \"textarea\",\n    \"requiredField\": true\n  }\n]) }}",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            1440,
            -112
          ],
          "id": "71649751-93ee-4038-ae34-9cde6d3e2dae",
          "name": "Select the week",
          "webhookId": "e88b064f-10d2-48af-baff-086b69085e00"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Do you approve?",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Yes"
                      },
                      {
                        "option": "No"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "If you selected no, what changes do you want to apply?",
                  "fieldType": "textarea",
                  "placeholder": "Be as thorough as possible"
                },
                {
                  "fieldLabel": "Create post",
                  "fieldType": "checkbox",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Create post"
                      }
                    ]
                  }
                }
              ]
            },
            "options": {
              "formDescription": "=Here's the weekly plan:\n\n{{ $json.output.weekly_plan }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            2032,
            -320
          ],
          "id": "d4fa092e-9883-4944-84dd-4540336b8fe9",
          "name": "Plan approval",
          "webhookId": "b4fd283b-aab4-4766-b444-12ecba728534"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4c919b7b-8ddc-4c10-afa4-68cd7edf2176",
                  "leftValue": "={{ $json['Do you approve?'] }}",
                  "rightValue": "Yes",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2192,
            -320
          ],
          "id": "a5e8bbf5-c820-41b0-a52c-c875e055f017",
          "name": "Approve plan?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a6d99474-863d-4926-bbf6-6f8d96502ca4",
                  "name": "change_requests",
                  "value": "={{ $json['If you selected no, what changes do you want to apply?'] }}",
                  "type": "string"
                },
                {
                  "id": "562dcfe4-60c2-4883-989c-97b2fa8accd0",
                  "name": "weekly_plan",
                  "value": "={{ $('Generate weekly plan').last().json.output.weekly_plan }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2416,
            -128
          ],
          "id": "b2879d80-0a15-40d4-b158-11d8805c7ee8",
          "name": "Set plan variables"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "9bc0ab4b-838e-4f5f-a5e0-d4227bd65d58",
                  "leftValue": "={{ $('Plan approval').last().json['Create post'] }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthGt",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            2656,
            -112
          ],
          "id": "e5cd092b-017d-4efc-8576-1cbcd4fed685",
          "name": "Create post?"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "=Great success!",
            "completionMessage": "=The plan for {{ $json.week }} was saved successfully to the database. Now it's time to add some posts!",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            2912,
            -128
          ],
          "id": "a4fb2571-6032-4cb6-a71d-60e8fa137278",
          "name": "Plan saved",
          "webhookId": "ed74d1ab-db40-48c9-8a42-99ebf608c367"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.influencer_db }}",
              "mode": "id"
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            -768,
            400
          ],
          "id": "a7562054-769b-45b8-b7a9-9860876ee78a",
          "name": "Get all influencers for creating posts"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -576,
            400
          ],
          "id": "c583751c-0b76-4845-9012-f2389bff7be4",
          "name": "Aggregate influencers for creating post"
        },
        {
          "parameters": {
            "defineForm": "json",
            "jsonOutput": "={{ JSON.stringify([\n  {\n    \"fieldLabel\": \"Influencer\",\n    \"requiredField\": true,\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": $json.data.map(item => { return {option: `${item.name}`} })\n    }\n  }\n]) }}",
            "options": {
              "formTitle": "Select the influencer"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -384,
            400
          ],
          "id": "e1dd75a3-24c8-43b9-951e-02df15ceed31",
          "name": "Select influencer for creating post",
          "webhookId": "dd733256-81ee-4213-abcb-91cbe246d6e0"
        },
        {
          "parameters": {
            "jsCode": "let influencer_id;\n// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  const selectedInfluencer = item.json.Influencer;\n  influencer_id = $('Aggregate influencers for creating post').first().json.data.find(influencer => selectedInfluencer === influencer.name)?.id;\n}\n\nreturn [{\n  json: {\n    influencer_id\n  }\n}]"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -224,
            400
          ],
          "id": "5744c2d1-b679-4b55-aec4-4bcfb1742ebe",
          "name": "Map influencer for creating post"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9ac51cc9-10e5-44b4-8c6d-878fb3656503",
                  "name": "influencer_id",
                  "value": "={{ $json.influencer_id }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -48,
            400
          ],
          "id": "05d60f28-1e34-4ecd-bbb6-c168479c23ab",
          "name": "Set influencer id for creating a post"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.plans_db }}",
              "mode": "id"
            },
            "matchType": "allConditions",
            "filters": {
              "conditions": [
                {
                  "keyName": "week",
                  "keyValue": "={{ $now.format('yyyy/WW') }}"
                },
                {
                  "keyName": "influencer_id",
                  "keyValue": "={{ $json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            352,
            400
          ],
          "id": "ba762d6c-9c26-4783-b54d-0fd344718dd4",
          "name": "Get the plan for the week",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "c2454227-a8e8-41d2-970a-bbaf3b587693",
                  "leftValue": "={{ $json.keys() }}",
                  "rightValue": 0,
                  "operator": {
                    "type": "array",
                    "operation": "lengthGt",
                    "rightType": "number"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            624,
            400
          ],
          "id": "a9a1cd4a-a41c-43e7-8714-7536503e2d38",
          "name": "Has a plan for the week?"
        },
        {
          "parameters": {
            "operation": "get",
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.posts_db }}",
              "mode": "id"
            },
            "filters": {
              "conditions": [
                {
                  "keyName": "createdAt",
                  "condition": "gt",
                  "keyValue": "={{ $now.startOf('day').toUTC() }}"
                }
              ]
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            864,
            384
          ],
          "id": "6c992df4-a073-4dad-ba77-8152508a335c",
          "name": "Get previous posts for today",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Do you approve?",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Yes"
                      },
                      {
                        "option": "No"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "If you selected no, what changes do you want to apply?",
                  "fieldType": "textarea",
                  "placeholder": "Be as thorough as possible"
                }
              ]
            },
            "options": {
              "formDescription": "=Here's the post:\n{{ $json.output.post_content }}\n\nThis is the image prompt:\n{{ $json.output.image_prompt }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -144,
            704
          ],
          "id": "ed28c35e-ba15-407d-baf3-8456c3d78670",
          "name": "Image post approval",
          "webhookId": "b4fd283b-aab4-4766-b444-12ecba728534"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4c919b7b-8ddc-4c10-afa4-68cd7edf2176",
                  "leftValue": "={{ $json['Do you approve?'] }}",
                  "rightValue": "Yes",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            48,
            704
          ],
          "id": "9f569d5d-b518-4d3a-9653-990580fe0e19",
          "name": "Approve image post?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a6d99474-863d-4926-bbf6-6f8d96502ca4",
                  "name": "change_requests",
                  "value": "={{ $json['If you selected no, what changes do you want to apply?'] }}",
                  "type": "string"
                },
                {
                  "id": "2b67b23c-bb56-4e31-adbf-3c5596098822",
                  "name": "post_content",
                  "value": "={{ $('Generate new Instagram post for image').item.json.output.post_content }}",
                  "type": "string"
                },
                {
                  "id": "7cafc015-bb66-4ce4-9406-2d9485008430",
                  "name": "image_prompt",
                  "value": "={{ $('Generate new Instagram post for image').item.json.output.image_prompt }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            256,
            784
          ],
          "id": "5611a7af-2643-4b2b-902c-581f3caa4c44",
          "name": "Set image post variables"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bca7d364-d81e-415f-b759-b1ccceffb763",
                  "name": "image_prompt",
                  "value": "={{ $json.image_prompt || $('Generate new Instagram post for image').last().json.output.image_prompt }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            528,
            688
          ],
          "id": "0b1289b5-d0ba-4fb0-9e6c-6c201e33931b",
          "name": "Set image prompt for image post"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Do you approve?",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Yes"
                      },
                      {
                        "option": "No"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "The image prompt",
                  "fieldType": "textarea",
                  "placeholder": "Change the image prompt here"
                }
              ]
            },
            "options": {
              "formDescription": "=Here's the generated image:\n<img src=\"{{ $json.images[0].url }}\" width=\"100%\" alt=\"\" />\n\nThis was the image prompt:\n{{ $('Set image prompt for image post').last().json.image_prompt }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            1056,
            688
          ],
          "id": "18d0dae4-f1e3-4202-96d0-f0b6928f5354",
          "name": "Image approval",
          "webhookId": "b4fd283b-aab4-4766-b444-12ecba728534"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4c919b7b-8ddc-4c10-afa4-68cd7edf2176",
                  "leftValue": "={{ $json['Do you approve?'] }}",
                  "rightValue": "Yes",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1264,
            688
          ],
          "id": "6185f378-e15d-4b5a-8838-3ddfc95808f4",
          "name": "Approve image?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "6ab73f03-24e1-40be-8a98-3148546f18d6",
                  "name": "image_prompt",
                  "value": "={{ $json['The image prompt'] }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1472,
            784
          ],
          "id": "6e8ebac0-0e32-4190-92bd-af9acb9ceaa1",
          "name": "Setup image variables"
        },
        {
          "parameters": {
            "httpRequestMethod": "POST",
            "graphApiVersion": "v22.0",
            "node": "={{ $('Get influencer for creating a post').item.json.instagram_business_id }}",
            "edge": "media_publish",
            "options": {
              "queryParameters": {
                "parameter": [
                  {
                    "name": "creation_id",
                    "value": "={{ $json.id }}"
                  }
                ]
              }
            }
          },
          "type": "n8n-nodes-base.facebookGraphApi",
          "typeVersion": 1,
          "position": [
            2592,
            720
          ],
          "id": "09006f1d-7562-4f62-adde-c4aede45750c",
          "name": "Post to Instagram",
          "credentials": {
            "facebookGraphApi": {
              "id": "6QYA8nXTfX9mWQr4",
              "name": "Facebook Graph account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "httpRequestMethod": "POST",
            "graphApiVersion": "v22.0",
            "node": "={{ $('Get influencer for creating a post').item.json.instagram_business_id }}",
            "edge": "media",
            "options": {
              "queryParameters": {
                "parameter": [
                  {
                    "name": "image_url",
                    "value": "={{ $('Generate image').item.json.images[0].url }}"
                  },
                  {
                    "name": "caption",
                    "value": "={{ $('Generate new Instagram post for image').last().json.output.post_content }}"
                  }
                ]
              }
            }
          },
          "type": "n8n-nodes-base.facebookGraphApi",
          "typeVersion": 1,
          "position": [
            2400,
            720
          ],
          "id": "31f1f159-f6a4-455d-a3a7-8499cabc85a4",
          "name": "Upload image to Instagram",
          "credentials": {
            "facebookGraphApi": {
              "id": "6QYA8nXTfX9mWQr4",
              "name": "Facebook Graph account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.posts_db }}",
              "mode": "id"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "influencer_id": "={{ $('Get influencer for creating a post').item.json.id }}",
                "post_summary": "={{ $('Generate new Instagram post for image').last().json.output.summary }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "influencer_id",
                  "displayName": "influencer_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "post_summary",
                  "displayName": "post_summary",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            2944,
            720
          ],
          "id": "578fd357-290a-4da6-9427-692cb7514bff",
          "name": "Insert image post"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "The post was created",
            "completionMessage": "Posted, and saved to the database",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            3120,
            720
          ],
          "id": "da9ceb71-27ce-4003-8304-6e4ca63cd072",
          "name": "Image post saved",
          "webhookId": "9a7cb03a-7c1a-43c6-8ba1-d97dc3c0349e"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Do you approve?",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Yes"
                      },
                      {
                        "option": "No"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "If you selected no, what changes do you want to apply?",
                  "fieldType": "textarea",
                  "placeholder": "Be as thorough as possible"
                }
              ]
            },
            "options": {
              "formDescription": "=Here's the post:\n{{ $json.output.post_content }}\n\nThis is the image prompt:\n{{ $json.output.image_prompt }}\n\nThis is the video prompt:\n{{ $json.output.video_prompt }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -176,
            1120
          ],
          "id": "8ed3381d-7625-4190-acdd-cbab1da9191f",
          "name": "Video post approval",
          "webhookId": "b4fd283b-aab4-4766-b444-12ecba728534"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4c919b7b-8ddc-4c10-afa4-68cd7edf2176",
                  "leftValue": "={{ $json['Do you approve?'] }}",
                  "rightValue": "Yes",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            16,
            1120
          ],
          "id": "3caf3917-fd48-4586-bb3f-f5deb13301fd",
          "name": "Approve video post?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a6d99474-863d-4926-bbf6-6f8d96502ca4",
                  "name": "change_requests",
                  "value": "={{ $json['If you selected no, what changes do you want to apply?'] }}",
                  "type": "string"
                },
                {
                  "id": "2b67b23c-bb56-4e31-adbf-3c5596098822",
                  "name": "post_content",
                  "value": "={{ $('Generate new Instagram post for video').item.json.output.post_content }}",
                  "type": "string"
                },
                {
                  "id": "7cafc015-bb66-4ce4-9406-2d9485008430",
                  "name": "image_prompt",
                  "value": "={{ $('Generate new Instagram post for video').item.json.output.image_prompt }}",
                  "type": "string"
                },
                {
                  "id": "044a617b-6df1-44b7-9c54-c93e4425769e",
                  "name": "video_prompt",
                  "value": "={{ $('Generate new Instagram post for video').item.json.output.video_prompt }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            192,
            1232
          ],
          "id": "0e7cbcbd-14ce-4786-8dca-ca24f75bada1",
          "name": "Setup video post variables"
        },
        {
          "parameters": {
            "options": {
              "formTitle": "No plan for this week!",
              "formDescription": "You need a weekly plan before creating a post",
              "buttonLabel": "Create a weekly plan"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            -48,
            208
          ],
          "id": "18557be3-f274-4944-bb43-a8dbdb299bdb",
          "name": "Notify user about the missing plan",
          "webhookId": "96a38fbf-a480-4aa9-8a91-54d119873518"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "79a1670d-70d1-4f58-b036-4583e5c8568a",
                  "name": "id",
                  "value": "={{ $('Get influencer for creating a post').item.json.id }}",
                  "type": "number"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            160,
            208
          ],
          "id": "12d6dd2f-373c-4095-be9a-3880957b5ab8",
          "name": "Setup the influencer id"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Do you approve?",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Yes"
                      },
                      {
                        "option": "No"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "The image prompt",
                  "fieldType": "textarea",
                  "placeholder": "Change the image prompt here"
                }
              ]
            },
            "options": {
              "formDescription": "=Here's the generated image:\n<img src=\"{{ $json.images[0].url }}\" width=\"100%\" alt=\"\" />\n\nThis was the image prompt:\n{{ $('Set image prompt for seed image').last().json.image_prompt }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            768,
            1104
          ],
          "id": "9a41fb25-d799-4056-8bb7-453ef70675c8",
          "name": "Seed image approval",
          "webhookId": "b4fd283b-aab4-4766-b444-12ecba728534"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4c919b7b-8ddc-4c10-afa4-68cd7edf2176",
                  "leftValue": "={{ $json['Do you approve?'] }}",
                  "rightValue": "Yes",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            944,
            1104
          ],
          "id": "126b98e4-b3f4-4153-b3dc-1c3236a37254",
          "name": "Approve seed image?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "6ab73f03-24e1-40be-8a98-3148546f18d6",
                  "name": "image_prompt",
                  "value": "={{ $json['The image prompt'] }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1136,
            1232
          ],
          "id": "002eeafd-5feb-4ae6-badd-1159d9cd9673",
          "name": "Setup seed image variables"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "bca7d364-d81e-415f-b759-b1ccceffb763",
                  "name": "image_prompt",
                  "value": "={{ $json.image_prompt || $('Generate new Instagram post for video').last().json.output.image_prompt }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            384,
            1104
          ],
          "id": "aec9b722-de38-4f53-8897-f6f0b6503bc0",
          "name": "Set image prompt for seed image"
        },
        {
          "parameters": {
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Do you approve?",
                  "fieldType": "radio",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "Yes"
                      },
                      {
                        "option": "No"
                      }
                    ]
                  },
                  "requiredField": true
                },
                {
                  "fieldLabel": "The video prompt",
                  "fieldType": "textarea",
                  "placeholder": "Change the video prompt here"
                }
              ]
            },
            "options": {
              "formDescription": "=Here's the generated image:\n<video width=\"100%\" controls>\n  <source src=\"{{ $json.video.url }}\" type=\"video/mp4\">\n  Your browser does not support the video tag.\n</video>\n\nThis was the video prompt:\n{{ $('Set video prompt').last().json.video_prompt }}"
            }
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            1712,
            1088
          ],
          "id": "4ba885a6-40a0-4283-87b2-53868d0b8742",
          "name": "Video approval",
          "webhookId": "b4fd283b-aab4-4766-b444-12ecba728534"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "4c919b7b-8ddc-4c10-afa4-68cd7edf2176",
                  "leftValue": "={{ $json['Do you approve?'] }}",
                  "rightValue": "Yes",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1904,
            1088
          ],
          "id": "00c8abc4-1a0f-41df-b75d-3aeb88ab35bd",
          "name": "Approve video?"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "6ab73f03-24e1-40be-8a98-3148546f18d6",
                  "name": "video_prompt",
                  "value": "={{ $json['The video prompt'] }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2112,
            1232
          ],
          "id": "1d89eb1a-5679-45ae-b32b-b40ed8be8da4",
          "name": "Video variables"
        },
        {
          "parameters": {
            "httpRequestMethod": "POST",
            "graphApiVersion": "v22.0",
            "node": "={{ $('Get influencer for creating a post').item.json.instagram_business_id }}",
            "edge": "media",
            "options": {
              "queryParameters": {
                "parameter": [
                  {
                    "name": "video_url",
                    "value": "={{ $('Generate video').last().json.video }}"
                  },
                  {
                    "name": "caption",
                    "value": "={{ $('Generate new Instagram post for image').last().json.output.post_content }}"
                  },
                  {
                    "name": "media_type",
                    "value": "VIDEO"
                  }
                ]
              }
            }
          },
          "type": "n8n-nodes-base.facebookGraphApi",
          "typeVersion": 1,
          "position": [
            2400,
            1088
          ],
          "id": "225caaf8-27df-408b-870a-0493073425d1",
          "name": "Upload video to Instagram",
          "credentials": {
            "facebookGraphApi": {
              "id": "6QYA8nXTfX9mWQr4",
              "name": "Facebook Graph account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "httpRequestMethod": "POST",
            "graphApiVersion": "v22.0",
            "node": "={{ $('Get influencer for creating a post').item.json.instagram_business_id }}",
            "edge": "media_publish",
            "options": {
              "queryParameters": {
                "parameter": [
                  {
                    "name": "creation_id",
                    "value": "={{ $json.id }}"
                  }
                ]
              }
            }
          },
          "type": "n8n-nodes-base.facebookGraphApi",
          "typeVersion": 1,
          "position": [
            2592,
            1088
          ],
          "id": "bfe2fda4-e662-4e75-b129-567d83d11910",
          "name": "Post video post to Instagram",
          "credentials": {
            "facebookGraphApi": {
              "id": "6QYA8nXTfX9mWQr4",
              "name": "Facebook Graph account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "content": "# Create a new influencer",
            "height": 352,
            "width": 1056
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -800,
            -816
          ],
          "typeVersion": 1,
          "id": "2fac96fc-fac9-4abf-828d-81225dcfd003",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# Add a weekly plan",
            "height": 432,
            "width": 3920
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -800,
            -384
          ],
          "typeVersion": 1,
          "id": "ac16f82b-8c57-435d-92be-d50886950c94",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "content": "# Create a post",
            "height": 1264,
            "width": 4144
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -800,
            144
          ],
          "typeVersion": 1,
          "id": "6e05a38c-8c6b-4a42-8e3c-4201c88aa068",
          "name": "Sticky Note6"
        },
        {
          "parameters": {
            "content": "# ðŸ“š [Join our Skool community for video automations, support, premium content and more!](https://www.skool.com/ai-agents-az/about?w9)\n\n## Be part of a growing community and help us create more content like this\n\n## And get access to our premium workflows and our hosted GPU media server with voice cloning and video tools",
            "height": 372,
            "width": 1052,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -800,
            -1264
          ],
          "id": "a0a845c2-0ea2-4cbd-ab5d-2ecabdf21c7a",
          "name": "Sticky Note17"
        },
        {
          "parameters": {
            "content": "# How to set up this automation?\n\n## 0. Make sure you are using n8n 1.118.1+\n## 1. Follow the YouTube video and create the databases\n## 2. Setup the database ids in the configure me node (see the YouTube video)\n## 3. Download and import the subworkflows (links in the YouTube video's description or on GitHub). Setup the subworkflows (add your credential)]\n## 5. Select the LLM you want to use and connect it to the AI nodes. Disable the rest of the LLM providers\n## 6. Setup the Facebook Graph nodes, add your token (see the guide on how to create it and connect your Instagram account)\n## 4. Done! ðŸŽ‰\n\n# Resources:\n\n## [Watch the video](https://www.youtube.com/watch?v=PjXYr6M4fjY)\n## [Guide to connect Facebook](https://github.com/gyoridavid/ai_agents_az/blob/main/episode_8/guide-instagram.md)\n## [GitHub](https://github.com/gyoridavid/ai_agents_az/tree/main/episode_35)",
            "height": 788,
            "width": 1220,
            "color": 6
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            336,
            -1248
          ],
          "id": "d580d4ff-b3ff-4e73-b02f-a154d9d58750",
          "name": "Sticky Note14"
        },
        {
          "parameters": {
            "model": "qwen3:32b",
            "options": {
              "numCtx": 16048
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
          "typeVersion": 1,
          "position": [
            -1520,
            416
          ],
          "id": "5a03bcfa-cacf-482c-9b7f-6b5163375e3b",
          "name": "Ollama Chat Model",
          "credentials": {
            "ollamaApi": {
              "id": "cWXUsJ0LsqnzOEx0",
              "name": "Ollama account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
          "typeVersion": 1,
          "position": [
            -1184,
            416
          ],
          "id": "615ce328-b2f7-422d-a5d1-f8753bab36ad",
          "name": "DeepSeek Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": "tngtech/deepseek-r1t-chimera:free",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
          "typeVersion": 1,
          "position": [
            -1056,
            768
          ],
          "id": "7eae7ff1-499a-447f-b256-1cf2ca69b30d",
          "name": "OpenRouter Chat Model",
          "credentials": {
            "openRouterApi": {
              "id": "pKxg2Rhtt3cG3h19",
              "name": "OpenRouter account"
            }
          },
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "typeVersion": 1,
          "position": [
            -1520,
            768
          ],
          "id": "e1743b15-6cb0-4ea2-b141-784bed5a00e0",
          "name": "Google Gemini Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAzureOpenAi",
          "typeVersion": 1,
          "position": [
            -1520,
            576
          ],
          "id": "ecf00c57-588b-4129-bedc-efe9d506fe9f",
          "name": "Azure OpenAI Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            -1344,
            576
          ],
          "id": "7a1dfc5e-34a9-48d2-aedc-4bd23814381a",
          "name": "xAI Grok Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "claude-sonnet-4-20250514",
              "cachedResultName": "Claude 4 Sonnet"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
          "typeVersion": 1.3,
          "position": [
            -1184,
            576
          ],
          "id": "944c2068-9245-4186-af4c-50863bf8791e",
          "name": "Anthropic Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatXAiGrok",
          "typeVersion": 1,
          "position": [
            -1056,
            576
          ],
          "id": "012b7f68-0084-4d60-a08c-b68b337c3093",
          "name": "xAI Grok Chat Model1",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
          "typeVersion": 1,
          "position": [
            -1184,
            768
          ],
          "id": "2ae4898b-0523-49df-a1de-8e19a7cebf2b",
          "name": "Groq Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatAwsBedrock",
          "typeVersion": 1,
          "position": [
            -1344,
            416
          ],
          "id": "588b81d4-df0e-44ca-8039-97a23b622af3",
          "name": "AWS Bedrock Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
          "typeVersion": 1,
          "position": [
            -1344,
            768
          ],
          "id": "15493324-2136-4185-b47c-31103cd3b721",
          "name": "Mistral Cloud Chat Model",
          "disabled": true
        },
        {
          "parameters": {
            "content": "# Pick your choice of LLM âš ï¸\nâš ï¸ Make sure to deactive/delete the rest of the LLMs after selecting one",
            "height": 700,
            "width": 700,
            "color": 3
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1600,
            288
          ],
          "id": "32e5ed0d-39f0-4a13-8b3a-c952f6495155",
          "name": "Sticky Note7"
        },
        {
          "parameters": {
            "dataTableId": {
              "__rl": true,
              "value": "={{ $('Configure workflow').item.json.posts_db }}",
              "mode": "id"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "influencer_id": "={{ $('Get influencer for creating a post').item.json.id }}",
                "post_summary": "={{ $('Generate new Instagram post for video').last().json.output.summary }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "influencer_id",
                  "displayName": "influencer_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                },
                {
                  "id": "post_summary",
                  "displayName": "post_summary",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "readOnly": false,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.dataTable",
          "typeVersion": 1,
          "position": [
            2944,
            1088
          ],
          "id": "bec6a68f-0329-4f39-a032-cf75f501e325",
          "name": "Insert video post"
        },
        {
          "parameters": {
            "operation": "completion",
            "completionTitle": "The post was created",
            "completionMessage": "Posted, and saved to the database",
            "options": {}
          },
          "type": "n8n-nodes-base.form",
          "typeVersion": 2.3,
          "position": [
            3136,
            1088
          ],
          "id": "0861eb94-5b3c-4061-adcd-2fda1e5aea89",
          "name": "Video post saved",
          "webhookId": "9a7cb03a-7c1a-43c6-8ba1-d97dc3c0349e"
        }
      ],
      "pinData": {},
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "Configure workflow",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Influencer details",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get all influencers for weekly planning",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get all influencers for creating posts",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Convert images to base64": {
          "main": [
            [
              {
                "node": "Add influencer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Influencer details": {
          "main": [
            [
              {
                "node": "Convert images to base64",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add weekly plan?": {
          "main": [
            [
              {
                "node": "Set influencer id",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Influencer saved",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set influencer id": {
          "main": [
            [
              {
                "node": "Get influencer for weekly planning",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate weekly plan": {
          "main": [
            [
              {
                "node": "Plan approval",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Generate weekly plan",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Generate new Instagram post for video",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Generate new Instagram post for image",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Get all influencers for weekly planning": {
          "main": [
            [
              {
                "node": "Aggregate influencers",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate influencers": {
          "main": [
            [
              {
                "node": "If no influencer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get influencer for weekly planning": {
          "main": [
            [
              {
                "node": "Get previous plans",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate previous plans": {
          "main": [
            [
              {
                "node": "Generate week options",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get previous plans": {
          "main": [
            [
              {
                "node": "Aggregate previous plans",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insert plan": {
          "main": [
            [
              {
                "node": "Create post?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields2": {
          "main": [
            [
              {
                "node": "Set influencer id for creating a post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get influencer for creating a post": {
          "main": [
            [
              {
                "node": "Get the plan for the week",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Configure workflow": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Select post type": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate daily posts": {
          "main": [
            [
              {
                "node": "Select post type",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Generate new Instagram post for image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Generate new Instagram post for video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate new Instagram post for video": {
          "main": [
            [
              {
                "node": "Video post approval",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate new Instagram post for image": {
          "main": [
            [
              {
                "node": "Image post approval",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate seed image": {
          "main": [
            [
              {
                "node": "Seed image approval",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate video": {
          "main": [
            [
              {
                "node": "Video approval",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set video prompt": {
          "main": [
            [
              {
                "node": "Generate video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate image": {
          "main": [
            [
              {
                "node": "Image approval",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If no influencer": {
          "main": [
            [
              {
                "node": "Select influencer for planning",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Notify user to create an influencer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notify user to create an influencer": {
          "main": [
            [
              {
                "node": "Influencer details",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add influencer": {
          "main": [
            [
              {
                "node": "Add weekly plan?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Select influencer for planning": {
          "main": [
            [
              {
                "node": "Map influencer for planning",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map influencer for planning": {
          "main": [
            [
              {
                "node": "Set influencer id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate week options": {
          "main": [
            [
              {
                "node": "Select the week",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Select the week": {
          "main": [
            [
              {
                "node": "Generate weekly plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Plan approval": {
          "main": [
            [
              {
                "node": "Approve plan?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Approve plan?": {
          "main": [
            [
              {
                "node": "Insert plan",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Set plan variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set plan variables": {
          "main": [
            [
              {
                "node": "Generate weekly plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create post?": {
          "main": [
            [
              {
                "node": "Edit Fields2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Plan saved",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get all influencers for creating posts": {
          "main": [
            [
              {
                "node": "Aggregate influencers for creating post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate influencers for creating post": {
          "main": [
            [
              {
                "node": "Select influencer for creating post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Select influencer for creating post": {
          "main": [
            [
              {
                "node": "Map influencer for creating post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map influencer for creating post": {
          "main": [
            [
              {
                "node": "Set influencer id for creating a post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set influencer id for creating a post": {
          "main": [
            [
              {
                "node": "Get influencer for creating a post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get the plan for the week": {
          "main": [
            [
              {
                "node": "Has a plan for the week?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Has a plan for the week?": {
          "main": [
            [
              {
                "node": "Get previous posts for today",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Notify user about the missing plan",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get previous posts for today": {
          "main": [
            [
              {
                "node": "Aggregate daily posts",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Image post approval": {
          "main": [
            [
              {
                "node": "Approve image post?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Approve image post?": {
          "main": [
            [
              {
                "node": "Set image prompt for image post",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Set image post variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set image post variables": {
          "main": [
            [
              {
                "node": "Generate new Instagram post for image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set image prompt for image post": {
          "main": [
            [
              {
                "node": "Generate image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Image approval": {
          "main": [
            [
              {
                "node": "Approve image?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Approve image?": {
          "main": [
            [
              {
                "node": "Upload image to Instagram",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Setup image variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup image variables": {
          "main": [
            [
              {
                "node": "Set image prompt for image post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Post to Instagram": {
          "main": [
            [
              {
                "node": "Insert image post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload image to Instagram": {
          "main": [
            [
              {
                "node": "Post to Instagram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insert image post": {
          "main": [
            [
              {
                "node": "Image post saved",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video post approval": {
          "main": [
            [
              {
                "node": "Approve video post?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Approve video post?": {
          "main": [
            [
              {
                "node": "Set image prompt for seed image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Setup video post variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup video post variables": {
          "main": [
            [
              {
                "node": "Generate new Instagram post for video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notify user about the missing plan": {
          "main": [
            [
              {
                "node": "Setup the influencer id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup the influencer id": {
          "main": [
            [
              {
                "node": "Set influencer id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Seed image approval": {
          "main": [
            [
              {
                "node": "Approve seed image?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Approve seed image?": {
          "main": [
            [
              {
                "node": "Set video prompt",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Setup seed image variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Setup seed image variables": {
          "main": [
            [
              {
                "node": "Set image prompt for seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set image prompt for seed image": {
          "main": [
            [
              {
                "node": "Generate seed image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video approval": {
          "main": [
            [
              {
                "node": "Approve video?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Approve video?": {
          "main": [
            [
              {
                "node": "Upload video to Instagram",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Video variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video variables": {
          "main": [
            [
              {
                "node": "Set video prompt",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upload video to Instagram": {
          "main": [
            [
              {
                "node": "Post video post to Instagram",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Post video post to Instagram": {
          "main": [
            [
              {
                "node": "Insert video post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insert video post": {
          "main": [
            [
              {
                "node": "Video post saved",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenRouter Chat Model": {
          "ai_languageModel": [
            []
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "74c9dc3a-b292-45eb-91cc-5211aa206f42",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "636db6b6ab21a21c6458e2137f340e33dc3e49f5a1c560c8d1e2372c227cf40e"
      },
      "id": "iMREBdiBCOBD93Hv",
      "tags": []
    }
  },
  {
    "id": "seo-keyword-rank-tracker",
    "title": "Keyword Rank Tracker (Sheets)",
    "description": "Daily schedule that calls Serper, normalizes ranking data, and writes results plus deltas into Google Sheets dashboards.",
    "problem": "SEO teams need rank tracking without paying for SaaS limits; this workflow tracks unlimited keywords per site.",
    "tags": [
      "seo",
      "ranks",
      "google-sheets",
      "serper"
    ],
    "metadata": {
      "industries": [
        "seo",
        "analytics"
      ],
      "domains": [
        "rank-tracking"
      ],
      "channels": [
        "google-sheets"
      ],
      "trigger": "scheduled",
      "complexity": "medium",
      "integrations": [
        "Serper",
        "Google Sheets",
        "PostgreSQL"
      ]
    },
    "workflow": {
      "name": "keyword_rank_tracker_google_sheets",
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            260,
            820
          ],
          "id": "8acb9df9-dae5-41ec-b899-0cfb7c3853ea",
          "name": "When clicking â€˜Test workflowâ€™"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1AJRIe-IROQGRtqlBqeiyVP5ayjSlfOMC_nFDGwwLULU",
              "mode": "list",
              "cachedResultName": "tracked_keywords",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1AJRIe-IROQGRtqlBqeiyVP5ayjSlfOMC_nFDGwwLULU/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "={{ $json.domain }}",
              "mode": "name"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1340,
            280
          ],
          "id": "86f7ea65-9942-4886-9516-21553ac7a460",
          "name": "Get Tracked Keywords"
        },
        {
          "parameters": {
            "jsCode": "return [{\n  json: {\n    keywordString: $input.all().map(item => `'${item.json.keywords}'`).join(', ')\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1580,
            280
          ],
          "id": "3ca647b4-2613-4b31-b1da-9724911380ca",
          "name": "Code"
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "automations-451008",
              "mode": "list",
              "cachedResultName": "automations",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=automations-451008"
            },
            "sqlQuery": "WITH daily_metrics AS (\n  SELECT \n    data_date as date,\n    query as keyword,\n    url,\n    device,\n    SUM(clicks) as clicks,\n    SUM(impressions) as impressions,\n    ROUND(AVG(sum_position / impressions), 1) as position,\n    ROUND(SUM(clicks) / SUM(impressions) * 100, 2) as ctr\n  FROM `{{ $('Loop Over Items').all()[0].json.searchdata_url_impression }}`\n  WHERE \n    data_date > '{{ $('Merge Loop Data').all()[0].json.date }}'\n    AND NOT is_anonymized_query\n    AND lower(query) IN (\n    {{ $('Merge Loop Data').all()[1].json.keywordString }}\n    )\n  -- remove following line if you want to exclude toc rankings\n  AND url NOT LIKE '%#%'\n  GROUP BY date, keyword, url, device\n)\n\nSELECT \n  date,\n  keyword,\n  device,\n  url,\n  clicks,\n  impressions,\n  position,\n  ctr\nFROM daily_metrics\nORDER BY date ASC, keyword, position ASC",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQuery",
          "typeVersion": 2.1,
          "position": [
            2540,
            260
          ],
          "id": "f9245333-7f36-42f8-85c4-502ab8c15b92",
          "name": "Get Ranking Keywords by URL",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "19wCg-VAykAIYzeryWTeLfxJEr9G9Sj1Vf3h4DZUITqQ",
              "mode": "list",
              "cachedResultName": "rank_tracking",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19wCg-VAykAIYzeryWTeLfxJEr9G9Sj1Vf3h4DZUITqQ/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "={{ $('Loop Over Items').all()[0].json.domain }}",
              "mode": "name"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "date": "={{ $json.date }}",
                "keyword": "={{ $json.keyword }}",
                "url": "={{ $json.url }}",
                "device": "={{ $json.device }}",
                "clicks": "={{ $json.clicks }}",
                "position": "={{ $json.position }}",
                "ctr": "={{ $json.ctr }}",
                "impressions": "={{ $json.impressions }}"
              },
              "matchingColumns": [
                "date"
              ],
              "schema": [
                {
                  "id": "date",
                  "displayName": "date",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "url",
                  "displayName": "url",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "device",
                  "displayName": "device",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "keyword",
                  "displayName": "keyword",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "clicks",
                  "displayName": "clicks",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "impressions",
                  "displayName": "impressions",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "position",
                  "displayName": "position",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "ctr",
                  "displayName": "ctr",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2740,
            260
          ],
          "id": "47bd9243-26d3-4ba6-ae65-f3cbc86e7020",
          "name": "Insert URL Rankings"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "{\n  \"domains\": [\n    {\n      \"domain\": \"domain_1\",\n      \"searchdata_url_impression\": \"searchdata_url_impression\",\n      \"searchdata_site_impression\": \"searchdata_site_impression\"\n    },\n    {\n      \"domain\": \"domain_2\",\n      \"searchdata_url_impression\": \"searchdata_url_impression\",\n      \"searchdata_site_impression\": \"searchdata_site_impression\"\n    }\n  ]\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            460,
            820
          ],
          "id": "204a8fdf-f163-4c72-99b5-1babc3f1cdfd",
          "name": "Domains"
        },
        {
          "parameters": {
            "fieldToSplitOut": "domains",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            640,
            820
          ],
          "id": "e2d43fb3-20f1-433a-8b0e-a7aca6c28546",
          "name": "Split Out"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            980,
            180
          ],
          "id": "3e131334-a028-4513-999d-fedbe8ec1ec3",
          "name": "Loop Over Items"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            2340,
            260
          ],
          "id": "1db25f6f-9684-4c18-adbf-8f11a792cda8",
          "name": "Merge Loop Data"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "19wCg-VAykAIYzeryWTeLfxJEr9G9Sj1Vf3h4DZUITqQ",
              "mode": "list",
              "cachedResultName": "rank_tracking",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19wCg-VAykAIYzeryWTeLfxJEr9G9Sj1Vf3h4DZUITqQ/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "={{ $json.domain }}",
              "mode": "name"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1340,
            120
          ],
          "id": "ef8f0f8e-eef5-4528-a875-1c9d9af7682a",
          "name": "Google Sheets",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "sortFieldsUi": {
              "sortField": [
                {
                  "fieldName": "date"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.sort",
          "typeVersion": 1,
          "position": [
            1820,
            40
          ],
          "id": "d817e09f-c5a0-40a5-bbf6-64bc606b0796",
          "name": "Sort"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "1a376642-1bb3-43a3-802f-6844d3b9c2a7",
                  "leftValue": "={{ $('Google Sheets').all()[0].json.isEmpty()}}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "false",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1580,
            120
          ],
          "id": "3dd0c3e7-3898-4204-968c-6395f76303f2",
          "name": "If"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "e3ce8bf6-cbee-4949-a338-aeb1523b646a",
                  "name": "=date",
                  "value": "={{ $now.minus({ days: 7 }).format('yyyy-MM-dd') }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1820,
            220
          ],
          "id": "661b773d-3c02-4060-a023-407e2e981e2f",
          "name": "Set Date",
          "notes": "In case the pipeline has not been triggered before, then the tracking sheet is empty. If true, we will take as a starting point of today minus 7 days. "
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "4538ac52-c81c-460f-96ce-70ab74f313d9",
                  "name": "date",
                  "value": "={{ $json.date }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2100,
            40
          ],
          "id": "13c62280-43b6-4e5e-9f24-9d4c2adf27ec",
          "name": "Get date"
        },
        {
          "parameters": {
            "keep": "lastItems"
          },
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            1960,
            40
          ],
          "id": "4981a6af-44e3-43ca-bcbe-89540045278d",
          "name": "Get latest row"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            980,
            580
          ],
          "id": "0a3fe253-e489-4cf2-aea7-c3933b18e65c",
          "name": "Loop Over Items1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "32ae47a9-f7f5-41fc-b403-468094ba3f41",
                  "leftValue": "={{ $('Get Top Ranking Keywords Date').all()[0].json.isEmpty()}}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "false",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1360,
            680
          ],
          "id": "9e74b6c0-d63b-497e-a45f-860ef1680a8e",
          "name": "If1"
        },
        {
          "parameters": {
            "sortFieldsUi": {
              "sortField": [
                {
                  "fieldName": "data_date"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.sort",
          "typeVersion": 1,
          "position": [
            1600,
            540
          ],
          "id": "90662893-eeb1-4b70-8e63-22dbc1691932",
          "name": "Sort1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "4538ac52-c81c-460f-96ce-70ab74f313d9",
                  "name": "date",
                  "value": "={{ $json.data_date }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1920,
            540
          ],
          "id": "6ea5970f-2a06-4334-89a3-e5a2234f38af",
          "name": "Get date1"
        },
        {
          "parameters": {
            "operation": "appendOrUpdate",
            "documentId": {
              "__rl": true,
              "value": "1KWs-hsuxs_5leU6qELEDlzpFObkhHAFdKgJmDVq5aKg",
              "mode": "list",
              "cachedResultName": "Top Ranking Keywords",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1KWs-hsuxs_5leU6qELEDlzpFObkhHAFdKgJmDVq5aKg/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "={{ $('Loop Over Items1').item.json.domain }}",
              "mode": "name"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "data_date": "={{ $json.data_date }}",
                "query": "={{ $json.query }}",
                "url": "={{ $json.url }}",
                "device": "={{ $json.device }}",
                "result_type": "={{ $json.result_type }}",
                "total_impressions": "={{ $json.total_impressions }}",
                "total_clicks": "={{ $json.total_clicks }}",
                "avg_position": "={{ $json.avg_position }}",
                "ctr_percentage": "={{ $json.ctr_percentage }}",
                "position_bucket": "={{ $json.position_bucket }}"
              },
              "matchingColumns": [
                "data_date"
              ],
              "schema": [
                {
                  "id": "data_date",
                  "displayName": "data_date",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "query",
                  "displayName": "query",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "url",
                  "displayName": "url",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "device",
                  "displayName": "device",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "result_type",
                  "displayName": "result_type",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total_impressions",
                  "displayName": "total_impressions",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "total_clicks",
                  "displayName": "total_clicks",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "avg_position",
                  "displayName": "avg_position",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "ctr_percentage",
                  "displayName": "ctr_percentage",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "position_bucket",
                  "displayName": "position_bucket",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            2360,
            740
          ],
          "id": "0c6efb69-c1c2-47cd-a81e-6d6489796456",
          "name": "Insert Top Ranking Keywords"
        },
        {
          "parameters": {
            "documentId": {
              "__rl": true,
              "value": "1KWs-hsuxs_5leU6qELEDlzpFObkhHAFdKgJmDVq5aKg",
              "mode": "list",
              "cachedResultName": "Top Ranking Keywords",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1KWs-hsuxs_5leU6qELEDlzpFObkhHAFdKgJmDVq5aKg/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "={{ $json.domain }}",
              "mode": "name"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1200,
            680
          ],
          "id": "9d071923-bc79-45f8-967e-5f610bb8aa12",
          "name": "Get Top Ranking Keywords Date",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "keep": "lastItems"
          },
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            1760,
            540
          ],
          "id": "fe61c0ef-99bc-4f00-89ff-fbd09333e88b",
          "name": "Get last row by date"
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "automations-451008",
              "mode": "list",
              "cachedResultName": "automations",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=automations-451008"
            },
            "sqlQuery": "WITH filtered_queries AS (\n  SELECT \n    data_date,\n    device,\n    query,\n    url,\n    SUM(clicks) as clicks,\n    SUM(impressions) as impressions,\n    SUM(sum_position) as sum_position,\n    SUM(sum_position)/SUM(impressions) + 1 as avg_position,\n    MAX(CASE \n      WHEN is_tpf_faq THEN 'FAQ'\n      WHEN is_tpf_howto THEN 'HowTo'\n      WHEN is_review_snippet THEN 'Review'\n      ELSE 'Normal'\n    END) as result_type\n  FROM `{{ $('Loop Over Items1').all()[0].json.searchdata_url_impression }}`\n  WHERE SAFE_DIVIDE(sum_position, impressions) <= 50\n  AND is_anonymized_query = False\n  AND impressions >= 5\n  AND data_date > '{{ $json.date }}'\n  GROUP BY data_date, device, query, url\n)\n\nSELECT \n  data_date,\n  query,\n  url,\n  device,\n  result_type,\n  impressions as total_impressions,\n  clicks as total_clicks,\n  avg_position,\n  SAFE_DIVIDE(clicks, impressions) * 100 as ctr_percentage,\n  CASE \n    WHEN avg_position <= 3 THEN 'Top 3'\n    WHEN avg_position <= 10 THEN 'Top 10'\n    WHEN avg_position <= 20 THEN 'Top 20'\n    ELSE 'Above 20'\n  END as position_bucket\nFROM filtered_queries\nORDER BY \n  data_date DESC,\n  url",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQuery",
          "typeVersion": 2.1,
          "position": [
            2140,
            740
          ],
          "id": "a425bbf8-2dc2-4c5a-a870-423b1e4b6266",
          "name": "Get Keyword Opportunities",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "e3ce8bf6-cbee-4949-a338-aeb1523b646a",
                  "name": "=date",
                  "value": "={{ $now.minus({ days: 7 }).format('yyyy-MM-dd') }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1600,
            760
          ],
          "id": "b2101d06-4890-40bc-b7ba-40726f57f195",
          "name": "Today - 7d",
          "notes": "In case the pipeline has not been triggered before, then the tracking sheet is empty. If true, we will take as a starting point of today minus 7 days. "
        },
        {
          "parameters": {
            "content": "# Keyword Tracking by Keyword List",
            "height": 480,
            "width": 2120
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            840,
            0
          ],
          "id": "d53bc40e-ef62-4800-8909-da9e5435dd1e",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "# Keywords by URL and Top position",
            "height": 480,
            "width": 2120
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            840,
            500
          ],
          "id": "07c0101b-efbf-4bc9-bbc5-610145c44daf",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# Instructions\n\n## Description\nThis automation enables you to replace expensive SEO Rank Trackers and track any number of keywords for multiple domains.\n\n## Requirements & Setup (~20 minutes)\nTo use this template, you need bulk export enabled for your property connected to Google Search Console. The automation uses a BigQuery table for data processing.\n\nYou'll also need to set up credentials for accessing both BigQuery and Google Sheets.\n\n## Google Spreadsheets\nThis automation requires three spreadsheets:\n1. **Top Ranking Keywords**: Saves queries where you already rank at a decent position. This data helps identify low-hanging fruits.\n   - Columns: data_date, query, url, device, result_type, total_impressions, total_clicks, avg_position, ctr_percentage, position_bucket\n\n2. **Rank Tracking**: Tracks the daily performance of your monitored keywords.\n   - Columns: date, url, device, keyword, clicks, impressions, position, ctr\n\n3. **Tracked Keywords**: Stores all keywords you want to rank for.\n   - Columns: domain, keyword\n",
            "height": 980,
            "width": 640
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            180,
            0
          ],
          "id": "485c6d22-ac32-4024-926f-2768e008ffcb",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "adjust this node if you want to start with more historical data\n",
            "height": 200,
            "color": 5
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1580,
            680
          ],
          "id": "c04010cc-692c-4aac-9f30-a310d0ec4d5d",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "content": "adjust this node if you want to start with more historical data\n",
            "height": 200,
            "color": 5
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1780,
            160
          ],
          "id": "4b6fd09a-cb3d-4a8f-840d-9426e19dc83d",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "content": "add your domains and tables here",
            "height": 180,
            "color": 5
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            400,
            780
          ],
          "id": "1994ac61-8221-450a-a17e-4480f4bc5e2c",
          "name": "Sticky Note5"
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Test workflowâ€™": {
          "main": [
            [
              {
                "node": "Domains",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Tracked Keywords": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Merge Loop Data",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Get Ranking Keywords by URL": {
          "main": [
            [
              {
                "node": "Insert URL Rankings",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insert URL Rankings": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Domains": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Get Tracked Keywords",
                "type": "main",
                "index": 0
              },
              {
                "node": "Google Sheets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Loop Data": {
          "main": [
            [
              {
                "node": "Get Ranking Keywords by URL",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Sheets": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Sort": {
          "main": [
            [
              {
                "node": "Get latest row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Sort",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Set Date",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set Date": {
          "main": [
            [
              {
                "node": "Merge Loop Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get date": {
          "main": [
            [
              {
                "node": "Merge Loop Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get latest row": {
          "main": [
            [
              {
                "node": "Get date",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items1": {
          "main": [
            [],
            [
              {
                "node": "Get Top Ranking Keywords Date",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Sort1": {
          "main": [
            [
              {
                "node": "Get last row by date",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If1": {
          "main": [
            [
              {
                "node": "Sort1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Today - 7d",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Top Ranking Keywords Date": {
          "main": [
            [
              {
                "node": "If1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get last row by date": {
          "main": [
            [
              {
                "node": "Get date1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get date1": {
          "main": [
            [
              {
                "node": "Get Keyword Opportunities",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insert Top Ranking Keywords": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Keyword Opportunities": {
          "main": [
            [
              {
                "node": "Insert Top Ranking Keywords",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Today - 7d": {
          "main": [
            [
              {
                "node": "Get Keyword Opportunities",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "9181a9fe-0814-443c-86b3-d5237f88f693",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a"
      },
      "id": "nOzLedRb5STlMLxP",
      "tags": [
        {
          "createdAt": "2025-03-02T12:05:53.836Z",
          "updatedAt": "2025-03-02T12:05:53.836Z",
          "id": "utwtHTzeqUdktrxJ",
          "name": "SEO"
        },
        {
          "createdAt": "2025-03-12T18:27:08.298Z",
          "updatedAt": "2025-03-12T18:27:08.298Z",
          "id": "LJnByXT8PNh6CBUf",
          "name": "templates"
        }
      ]
    }
  },
  {
    "id": "seo-serp-analysis",
    "title": "SERP & Competitor Analyzer",
    "description": "Pulls SERP data from Serper, crawls top results via Crawl4AI, and builds structured competitor summaries for writers.",
    "problem": "Content teams spend 30+ minutes per article doing manual SERP research; this template automates the entire brief.",
    "tags": [
      "seo",
      "serp",
      "crawl",
      "briefs"
    ],
    "metadata": {
      "industries": [
        "seo"
      ],
      "domains": [
        "serp-analysis",
        "competitive-research"
      ],
      "channels": [
        "reports"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "Serper",
        "Crawl4AI",
        "Firecrawl",
        "Google Docs"
      ]
    },
    "workflow": {
      "name": "Product - SERP Analysis (Serper & Crawl4AI)",
      "nodes": [
        {
          "parameters": {
            "formTitle": "Keyword Research Form",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Focus Keyword",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Country",
                  "fieldType": "dropdown",
                  "fieldOptions": {
                    "values": [
                      {
                        "option": "de"
                      },
                      {
                        "option": "us"
                      },
                      {}
                    ]
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -1340,
            1080
          ],
          "id": "d841d3e0-650d-49e7-abba-d5f4186d2312",
          "name": "On form submission",
          "webhookId": "d361eaea-6612-4e11-8f2b-45bdaf5326d6"
        },
        {
          "parameters": {
            "url": "https://google.serper.dev/search",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "q",
                  "value": "={{ $json['Focus Keyword']}}"
                },
                {
                  "name": "gl",
                  "value": "={{ $json.Country }}"
                },
                {
                  "name": "device",
                  "value": "mobile"
                },
                {
                  "name": "exclude",
                  "value": "[\"video\", \"image\", \"news\", \"places\"]"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1120,
            980
          ],
          "id": "dbc11a68-1aa6-4462-b5e9-aa1ceaf9be49",
          "name": "get_mobile_serp_results",
          "credentials": {
            "serpApi": {
              "id": "ip84lDL75JMRWLKs",
              "name": "SerpAPI Account"
            },
            "httpHeaderAuth": {
              "id": "D3H3rAArrbUYZPOM",
              "name": "Serper"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            -400,
            900
          ],
          "id": "2d1692b9-0dcf-4074-a4ec-fa7a77780972",
          "name": "merge_faq"
        },
        {
          "parameters": {
            "fieldToSplitOut": "related_questions",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -180,
            900
          ],
          "id": "8d530a29-6caf-4641-9c25-bcd8e85f8a5d",
          "name": "get_questions"
        },
        {
          "parameters": {
            "compare": "selectedFields",
            "fieldsToCompare": "question",
            "options": {}
          },
          "type": "n8n-nodes-base.removeDuplicates",
          "typeVersion": 2,
          "position": [
            40,
            900
          ],
          "id": "e4fd59d3-6bd5-45f4-9c86-45c9bb55d49b",
          "name": "remove_duplicates_in_questions"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "",
              "mode": "list",
              "cachedResultName": "SERP Analysis (SerpApi + Crawl4AI)",
              "cachedResultUrl": ""
            },
            "sheetName": {
              "__rl": true,
              "value": 954676522,
              "mode": "list",
              "cachedResultName": "FAQs",
              "cachedResultUrl": ""
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "question": "={{ $json.question }}",
                "snippet": "={{ $json.snippet }}",
                "title": "={{ $json.title }}",
                "link": "={{ $json.link }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "question",
                  "displayName": "question",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "title",
                  "displayName": "title",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "link",
                  "displayName": "link",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "snippet",
                  "displayName": "snippet",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            260,
            900
          ],
          "id": "225cc152-7a2d-4d44-b36c-345b7af2a301",
          "name": "insert_faqs",
          "alwaysOutputData": false,
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "oYP1Bc15GY7emvD3",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "url": "https://google.serper.dev/search",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "q",
                  "value": "={{ $json['Focus Keyword']}}"
                },
                {
                  "name": "gl",
                  "value": "={{ $json.Country }}"
                },
                {
                  "name": "device",
                  "value": "desktop"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -1120,
            1180
          ],
          "id": "809d7e4c-af19-4b6a-932e-e4bb0984c957",
          "name": "get_desktop_serp_results",
          "credentials": {
            "serpApi": {
              "id": "ip84lDL75JMRWLKs",
              "name": "SerpAPI Account"
            },
            "httpHeaderAuth": {
              "id": "D3H3rAArrbUYZPOM",
              "name": "Serper"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            -420,
            500
          ],
          "id": "cdfd558a-1e56-445b-bdd7-ec0ff35404a4",
          "name": "merge_faq1"
        },
        {
          "parameters": {
            "fieldToSplitOut": "related_searches",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            -200,
            500
          ],
          "id": "ed5f875b-c8da-4f6d-adbe-d0fb2f65a967",
          "name": "get_queries"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "",
              "mode": "list",
              "cachedResultName": "SERP Analysis (SerpApi + Crawl4AI)",
              "cachedResultUrl": ""
            },
            "sheetName": {
              "__rl": true,
              "value": 227535755,
              "mode": "list",
              "cachedResultName": "Related Searches",
              "cachedResultUrl": "=227535755"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "query": "={{ $json.query }}"
              },
              "matchingColumns": [
                "query"
              ],
              "schema": [
                {
                  "id": "query",
                  "displayName": "query",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            240,
            500
          ],
          "id": "44fae620-9f03-4ded-a39e-f1ce2690303c",
          "name": "insert_related_searches",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "oYP1Bc15GY7emvD3",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0e112e59-ad43-4321-9de0-d1d502f98266",
                  "name": "related_questions",
                  "value": "={{ $json.peopleAlsoAsk }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -680,
            900
          ],
          "id": "212145e4-0a93-4708-a1b6-334dc44ad2db",
          "name": "get_faq_mobile",
          "alwaysOutputData": false
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "fcf16964-061d-4c9e-82c6-954e769e899c",
                  "name": "organic_results",
                  "value": "={{ $json.organic }}",
                  "type": "array"
                },
                {
                  "id": "44fba0e5-686c-4475-89dd-66f711bf910c",
                  "name": "search_parameters.device",
                  "value": "={{ $json.searchParameters.device }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -680,
            1160
          ],
          "id": "571d4620-6efb-4a48-9b13-2e80861270ff",
          "name": "get_organic_results_mobile"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "e76a9070-4782-4a54-84b6-bce1eb50023d",
                  "name": "organic_results",
                  "value": "={{ $json.organic }}",
                  "type": "array"
                },
                {
                  "id": "64fffe61-bb13-47e6-9555-c8adb9c3762d",
                  "name": "search_parameters.device",
                  "value": "={{ $json.searchParameters.device }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -680,
            1360
          ],
          "id": "f9288caa-9cb0-4718-aced-30be2e52cd03",
          "name": "get_organic_results_desktop"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0e112e59-ad43-4321-9de0-d1d502f98266",
                  "name": "related_questions",
                  "value": "={{ $json.peopleAlsoAsk }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -680,
            1560
          ],
          "id": "2c2e754e-dee2-4ad5-bda4-dac77155e3cd",
          "name": "get_faq_desktop"
        },
        {
          "parameters": {
            "content": "# Insert Related Searches\n",
            "height": 380,
            "width": 960,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            400
          ],
          "id": "487516d9-6f8d-45ca-85f8-fc1e0b233bb0",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "# Insert FAQs",
            "height": 380,
            "width": 960,
            "color": 4
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            800
          ],
          "id": "90104868-cd44-4c3f-8c6f-3cbaac7515e5",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# Get Data",
            "height": 1560,
            "width": 900
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -1400,
            400
          ],
          "id": "58d1d60d-b220-4cf1-9dbd-9947365c1322",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "content": "# SERP Analysis\n",
            "height": 760,
            "width": 2180,
            "color": 5
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            1200
          ],
          "id": "06106d0c-d558-4429-bb6e-ebd1aeeea4a0",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "content": "## Workflow Instructions\n#### Requirements\nTo use this workflow, you will need accounts and API access for the following services:\n- **Google Sheets**\n- **Serper Dev**\n- **Crawl4AI**\n- **OpenAI**\n#### Google Spreadsheet Setup\nCreate a Google Spreadsheet with **three sheets** named exactly as follows:\n1. **SERP Analysis**  \n   Columns (in order):  \n   `position`, `title`, `link`, `snippet`, `short_summary`, `potential_focus_keyword`, `relevant_long_tail_keywords`, `unigrams`, `bigrams`, `trigrams`\n2. **FAQs**  \n   Columns (in order):  \n   `question`, `title`, `link`, `snippet`\n3. **Related Searches**  \n   Columns (in order):  \n   `query`\n> **Tip:** Make sure the sheet names and column headers match exactly, including capitalization and spacing, to ensure the workflow functions correctly.\n#### Getting Started\n1. **Set up your Google Spreadsheet** as described above.\n2. **Configure your API credentials** for Serper Dev, Crawl4AI, and OpenAI within n8n.\n3. **Import the workflow** into your n8n instance.\n4. **Update any required variables or nodes** in the workflow to point to your specific spreadsheet and API keys.\n5. **Run the workflow** and monitor the results in your Google Sheets.\n#### Support & Contact\nDeveloped by **Marvomatic**\n- [Website](https://marvomatic.com)\n- [TikTok](https://www.tiktok.com/@marvomatic)\n- [YouTube](https://www.youtube.com/@marvomatic)\n\nFor business inquiries, email: [hello@marvomatic.com](mailto:hello@marvomatic.com)",
            "height": 780,
            "width": 1180
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            540,
            400
          ],
          "id": "a76581fa-63b9-4714-bb0f-d6e5b97a78d3",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "jsCode": "// Create an array to hold the cleaned items\nconst cleanedArray = [];\n\n// Loop through all input items\nfor (const item of $input.all()) {\n  // Create a copy of the item's JSON\n  const cleanedItem = {...item.json};\n  \n  // Filter organic results to remove any with youtube.com in the link\n  if (cleanedItem.organic) {\n    cleanedItem.organic = cleanedItem.organic.filter(result => \n      !result.link.includes('youtube.com')\n    );\n    \n    // Also filter any sitelinks that might contain youtube.com\n    for (const result of cleanedItem.organic) {\n      if (result.sitelinks) {\n        result.sitelinks = result.sitelinks.filter(sitelink => \n          !sitelink.link.includes('youtube.com')\n        );\n      }\n    }\n  }\n  \n  // Filter related searches if needed\n  if (cleanedItem.relatedSearches) {\n    cleanedItem.relatedSearches = cleanedItem.relatedSearches.filter(search => \n      !search.query.includes('youtube.com')\n    );\n  }\n  \n  // Add the cleaned item to our array\n  cleanedArray.push(cleanedItem);\n}\n\n// Return the cleaned array\nreturn cleanedArray;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -920,
            980
          ],
          "id": "8e1d466a-e70e-48bf-bd4c-0ffb4df58ff9",
          "name": "clean_results_mobile"
        },
        {
          "parameters": {
            "jsCode": "// Create an array to hold the cleaned items\nconst cleanedArray = [];\n\n// Loop through all input items\nfor (const item of $input.all()) {\n  // Create a copy of the item's JSON\n  const cleanedItem = {...item.json};\n  \n  // Filter organic results to remove any with youtube.com in the link\n  if (cleanedItem.organic) {\n    cleanedItem.organic = cleanedItem.organic.filter(result => \n      !result.link.includes('youtube.com')\n    );\n    \n    // Also filter any sitelinks that might contain youtube.com\n    for (const result of cleanedItem.organic) {\n      if (result.sitelinks) {\n        result.sitelinks = result.sitelinks.filter(sitelink => \n          !sitelink.link.includes('youtube.com')\n        );\n      }\n    }\n  }\n  \n  // Filter related searches if needed\n  if (cleanedItem.relatedSearches) {\n    cleanedItem.relatedSearches = cleanedItem.relatedSearches.filter(search => \n      !search.query.includes('youtube.com')\n    );\n  }\n  \n  // Add the cleaned item to our array\n  cleanedArray.push(cleanedItem);\n}\n\n// Return the cleaned array\nreturn cleanedArray;"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -920,
            1180
          ],
          "id": "03811174-be3a-4054-8d20-0d99772cd0b6",
          "name": "clean_results_desktop"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0e112e59-ad43-4321-9de0-d1d502f98266",
                  "name": "related_searches",
                  "value": "={{ $json.relatedSearches }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -680,
            500
          ],
          "id": "f7f8f3b7-c1b7-452d-b772-594f78c406b2",
          "name": "get_related_searches_mobile"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "0e112e59-ad43-4321-9de0-d1d502f98266",
                  "name": "related_searches",
                  "value": "={{ $json.relatedSearches }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -680,
            1760
          ],
          "id": "cebaf5a7-d4ff-4d55-ad5e-1e04e4410094",
          "name": "get_related_searches_desktop"
        },
        {
          "parameters": {
            "compare": "selectedFields",
            "fieldsToCompare": "query",
            "options": {}
          },
          "type": "n8n-nodes-base.removeDuplicates",
          "typeVersion": 2,
          "position": [
            20,
            500
          ],
          "id": "e5777b16-ec07-41f0-9d9e-bd11fe94d37f",
          "name": "remove_duplicates_in_questions1"
        },
        {
          "parameters": {
            "maxItems": 3
          },
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -400,
            1360
          ],
          "id": "5f44a0af-2db9-4683-ab5b-2d936a1c2775",
          "name": "top_3_by_mobile"
        },
        {
          "parameters": {
            "maxItems": 3
          },
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            -400,
            1560
          ],
          "id": "5696379e-fc4c-40a2-a6d1-e64ae9f27827",
          "name": "top_3_by_desktop"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            -180,
            1360
          ],
          "id": "da9d9a1e-1a18-4b2c-b949-5ba7e6245dff",
          "name": "get_urls_to_crawl"
        },
        {
          "parameters": {
            "fieldToSplitOut": "organic_results",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            40,
            1360
          ],
          "id": "72b8390f-4cca-435c-b620-bdaf492516a0",
          "name": "Split Out"
        },
        {
          "parameters": {
            "compare": "selectedFields",
            "fieldsToCompare": "link",
            "options": {}
          },
          "type": "n8n-nodes-base.removeDuplicates",
          "typeVersion": 2,
          "position": [
            260,
            1360
          ],
          "id": "3739f1f7-498d-42b1-b8de-074eb853c2e9",
          "name": "Remove Duplicates"
        },
        {
          "parameters": {
            "maxItems": 5
          },
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            500,
            1360
          ],
          "id": "83e25836-0066-4f4b-b685-bb29b117ce6a",
          "name": "Limit"
        },
        {
          "parameters": {
            "fieldToSplitOut": "link, snippet, position, title",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            700,
            1360
          ],
          "id": "6b38f0ef-79df-4db9-9781-7e6824e8f0e1",
          "name": "get_links"
        },
        {
          "parameters": {
            "url": "=http://crawl4ai:11235/task/{{ $json.task_id }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            380,
            1580
          ],
          "id": "2e2f9ba0-d6f6-4dfe-8d50-0b6c4050e5a6",
          "name": "get_status",
          "credentials": {
            "httpHeaderAuth": {
              "id": "MKoLytfiKC3rb7GP",
              "name": "crawl4ai"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "4eec2c04-b519-4c06-a911-bb7780b776b5",
                  "name": "result.metadata.title",
                  "value": "={{ $('get_status').item.json.result.metadata.title }}",
                  "type": "string"
                },
                {
                  "id": "0eac8d67-34d9-4809-92fc-69f47381e104",
                  "name": "result.metadata.description",
                  "value": "={{ $('get_status').item.json.result.metadata.description }}",
                  "type": "string"
                },
                {
                  "id": "58b74b11-74f8-42e3-b68f-a2aa4c380578",
                  "name": "result.metadata['og:url']",
                  "value": "={{ $('get_status').item.json.result.metadata['og:url'] }}",
                  "type": "string"
                },
                {
                  "id": "f57680c0-48ed-492f-a1d9-508a0c996198",
                  "name": "result.cleaned_html",
                  "value": "={{ $('get_status').item.json.result.cleaned_html }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            800,
            1580
          ],
          "id": "77a31dfd-94d9-4805-9600-de73e6995b36",
          "name": "get_metadata"
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "",
              "mode": "list",
              "cachedResultName": "SERP Analysis (Serper + Crawl4AI)",
              "cachedResultUrl": ""
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "SERPs",
              "cachedResultUrl": ""
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "short_summary": "={{ $json.message.content.short_summary ?  $json.message.content.short_summary: \"\" }}",
                "potential_focus_keyword": "={{ $json.message.content.potential_focus_keyword ?  $json.message.content.potential_focus_keyword: \"\" }}",
                "unigrams": "={{ $json.message.content.n_gram_analysis.unigrams ?  $json.message.content.n_gram_analysis.unigrams: \"\" }}",
                "bigrams": "={{ $json.message.content.n_gram_analysis.bigrams ?  $json.message.content.n_gram_analysis.bigrams: \"\" }}",
                "trigrams": "={{ $json.message.content.n_gram_analysis.trigrams ?  $json.message.content.n_gram_analysis.trigrams: \"\" }}",
                "relevant_long_tail_keywords": "={{ $json.message.content.relevant_long_tail_keywords ?  $json.message.content.relevant_long_tail_keywords: \"\" }}",
                "title": "={{ $('Loop Over Items').item.json.title }}",
                "link": "={{ $('Loop Over Items').item.json.link }}",
                "snippet": "={{ $('Loop Over Items').item.json.snippet }}",
                "position": "={{ $('Loop Over Items').item.json.position }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "position",
                  "displayName": "position",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "title",
                  "displayName": "title",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "link",
                  "displayName": "link",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "snippet",
                  "displayName": "snippet",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "short_summary",
                  "displayName": "short_summary",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "potential_focus_keyword",
                  "displayName": "potential_focus_keyword",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "relevant_long_tail_keywords",
                  "displayName": "relevant_long_tail_keywords",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "unigrams",
                  "displayName": "unigrams",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "bigrams",
                  "displayName": "bigrams",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "trigrams",
                  "displayName": "trigrams",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            1460,
            1580
          ],
          "id": "8a1d7086-25ef-4aba-89cb-6b5a0c33d62e",
          "name": "insert_serp_analysis",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "oYP1Bc15GY7emvD3",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "http://crawl4ai:11235/crawl",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "urls",
                  "value": "={{ $json.link }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -40,
            1580
          ],
          "id": "d80a9011-dda9-4629-ba68-d2d8ccb9dfd4",
          "name": "get_page_content",
          "credentials": {
            "httpHeaderAuth": {
              "id": "MKoLytfiKC3rb7GP",
              "name": "crawl4ai"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            180,
            1580
          ],
          "id": "c1f79552-9de1-4668-8ce2-5d305c2da8e0",
          "name": "sleep",
          "webhookId": "39bf1438-2316-4e3e-bb9d-0dd5d29b3509"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "100015ac-f73c-406d-acd5-49a41d60111a",
                  "leftValue": "={{ $json.status }}",
                  "rightValue": "completed",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            580,
            1580
          ],
          "id": "65201719-59c2-4c79-ab24-bf0dd6839588",
          "name": "check_status"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            1120,
            1360
          ],
          "id": "54697f10-4eed-42dc-97ad-cd67edaccab1",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "modelId": {
              "__rl": true,
              "value": "gpt-4o-mini",
              "mode": "list",
              "cachedResultName": "GPT-4O-MINI"
            },
            "messages": {
              "values": [
                {
                  "content": "You are a SEO-specialist and your task is to analyze the articles from our competitors. The ultimate goal is to write an article that is better than the competitors article. Apart from that, you are familiar with markdown and you are able to extract only relevant content.",
                  "role": "system"
                },
                {
                  "content": "=Your task is to analyze the following <article> =  {{ $json.content }} and provide me the following information:\n- Short Summary\n- Potential Focus Keyword\n- Relevant long-tail keywords\n- N-Gram-Analysis\n"
                }
              ]
            },
            "jsonOutput": true,
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            1140,
            1580
          ],
          "id": "f49c11dd-33ea-43a3-8462-fe0598482351",
          "name": "Analyze Content",
          "credentials": {
            "openAiApi": {
              "id": "RAj3VxCHt0rIwBTk",
              "name": "OpenAI"
            }
          }
        }
      ],
      "pinData": {
        "On form submission": [
          {
            "json": {
              "Focus Keyword": "mit ki musik erstellen",
              "Country": "de",
              "submittedAt": "2025-04-29T16:49:04.255-04:00",
              "formMode": "test"
            }
          }
        ],
        "get_mobile_serp_results": [
          {
            "json": {
              "searchParameters": {
                "q": "mit ki musik erstellen",
                "gl": "de",
                "type": "search",
                "device": "mobile",
                "engine": "google"
              },
              "organic": [
                {
                  "title": "MIT KI-Musik erstellen - Loudly",
                  "link": "https://www.loudly.com/ki-musik-erstellen",
                  "snippet": "Nutze die KI von Loudly, fÃ¼r deine Musikerstellung. Einfach das Genre wÃ¤hlen und innerhalb von Sekunden das gewÃ¼nschte Ergebnis erhalten.",
                  "date": "13 Dec 2023",
                  "position": 1
                },
                {
                  "title": "Die 15 besten KI-Song-Generatoren - Mindforce",
                  "link": "https://mind-force.de/marketing/ki-song-generatoren/",
                  "snippet": "KI-Song-Generatoren kÃ¶nnen selbststÃ¤ndig Musik generieren. ... Mit dem AI Song Generator lassen sich Songs mit Text und Melodie per KI erstellen.",
                  "date": "21 Mar 2025",
                  "position": 2
                },
                {
                  "title": "Gratis AI Music Generator: Erstelle Musik mit KI - Canva",
                  "link": "https://www.canva.com/de_de/funktionen/ai-music-generator/",
                  "snippet": "Kreiere einzigartige Soundtracks mit dem AI Music Generator von Canva. Erstelle ganz einfach Songs, auch ohne komponieren zu kÃ¶nnen.",
                  "position": 3
                },
                {
                  "title": "So produzierst du mit KI deine eigene Musik â€“ Einfach & schnell!",
                  "link": "https://www.youtube.com/watch?v=F5-NRSn1RAE",
                  "snippet": "In diesem Video lernst du, wie einfach es ist, mithilfe von kÃ¼nstlicher Intelligenz hochwertige Musik zu erstellen.",
                  "date": "18 Oct 2024",
                  "position": 4
                },
                {
                  "title": "KI Musik- & Song-Generator Online (Kostenlos, Leistungsstark)",
                  "link": "https://aisonggenerator.io/de",
                  "snippet": "KI Musik - Song Generator. Mit unserer modernen KI Song Generator-Technologie kannst du jede gewÃ¼nschte Musik oder jeden Song erstellen. 100% Lizenzfrei.",
                  "position": 5
                },
                {
                  "title": "Suno â€“ KI-Musik â€“ Apps bei Google Play",
                  "link": "https://play.google.com/store/apps/details?id=com.suno.android&hl=de",
                  "snippet": "Mit Suno kannst du jeden erdenklichen Song selbst produzieren. Suno ist ein KI-Musikstudio im Taschenformat. ... Starte mit 10 kostenlosen Songs (50 Gratis- ...",
                  "rating": 4.8,
                  "ratingCount": 308499,
                  "position": 6
                },
                {
                  "title": "Die 10 besten KI-Musikgeneratoren (April 2025) - Unite.AI",
                  "link": "https://www.unite.ai/de/Beste-KI-Musikgeneratoren/",
                  "snippet": "FlexClip AI Music Generator bietet eine nahtlose MÃ¶glichkeit, KI-generierte Songs zu erstellen, ohne dass musikalisches Fachwissen erforderlich ...",
                  "date": "13 Apr 2025",
                  "position": 7
                },
                {
                  "title": "Suno- KI-Musik im App Store",
                  "link": "https://apps.apple.com/de/app/suno-ki-musik/id6480136315",
                  "snippet": "Mit Suno kannst du jeden erdenklichen Song selbst produzieren. Suno ist ein KI-Musikstudio im Taschenformat. Entdecke folgende Funktionen: â€¢ Erstelle Songs ...",
                  "rating": 4.9,
                  "ratingCount": 10151,
                  "position": 8
                },
                {
                  "title": "#1 KI Song Generator - KI Song erstellen kostenlos online - Vidnoz AI",
                  "link": "https://de.vidnoz.com/ki-music-generator.html",
                  "snippet": "Mit KI Song Generator erstellen Sie eigene KI Songs & Musik aus Text oder Songtext online kostenlos ohne Anmeldung.",
                  "position": 9
                },
                {
                  "title": "KÃ¼nstliche Intelligenz produziert neue Lieder per Mausklick",
                  "link": "https://www.zdf.de/nachrichten/wissen/musik-kuenstliche-intelligenz-ki-suno-ai-100.html",
                  "snippet": "Die KI kann heute einen kompletten Song erstellen, der sich anhÃ¶rt, als hÃ¤tte jemand ihn geschrieben, der Musik studiert hat und seit 20 Jahren ...",
                  "date": "29 Mar 2024",
                  "position": 10
                }
              ],
              "peopleAlsoAsk": [
                {
                  "question": "Kann man mit KI-Musik machen?",
                  "snippet": "Es ist super einfach, KI-Musik mit AI-Music-Generator-Apps wie dem in Canva integrierten Soundraw zu erstellen. Wenn du KI-Songs produzierst, solltest du diese Tipps beachten: WÃ¤hle die richtige Stimmung, das richtige Genre, Thema und die richtige LÃ¤nge fÃ¼r deinen Musik-Track.",
                  "title": "Gratis AI Music Generator: Erstelle Musik mit KI - Canva",
                  "link": "https://www.canva.com/de_de/funktionen/ai-music-generator/"
                },
                {
                  "question": "Wie kann ich kostenlos eine Melodie erstellen?",
                  "snippet": "DIE 9 BESTEN KOSTENLOSEN MUSIKPROGRAMME\n1\nTracktion Waveform Free. ...\n2\nGarageband. ...\n3\nOhm Studio. ...\n4\nAudacity. ...\n5\nPro Tools First. ...\n6\nCubase LE. ...\n7\nCakewalk by BandLab. ...\n8\nPreSonus Studio One 5 Prime.",
                  "title": "Die 9 besten kostenlosen Musikprogramme - iMusician",
                  "link": "https://imusician.pro/de/ressourcen/blog/die-besten-kostenlosen-musikprogramme"
                },
                {
                  "question": "Gibt es eine KI, die Musik mixen kann?",
                  "snippet": "Ja, KI kann Musik mischen . Tools wie RoEx und LANDR nutzen KI, um Tracks zu analysieren und Pegel, EQ und Effekte automatisch anzupassen.",
                  "title": "Ich habe die 4 besten KI-Mixing- und Mastering-Tools im Jahr 2025 getestet",
                  "link": "https://translate.google.com/translate?u=https://www.aimusicpreneur.com/ai-tools-news/the-4-best-ai-mixing-and-mastering-tools/&hl=de&sl=en&tl=de&client=rq"
                },
                {
                  "question": "Kann man mit KI Songs Geld verdienen?",
                  "snippet": "So kannst du mit KI-Musik Geld verdienen Erstelle professionell klingende Songs mit KI-Tools und verÃ¶ffentliche sie auf Plattformen wie Spotify, YouTube oder SoundCloud, um durch Streams oder DirektverkÃ¤ufe Einnahmen zu erzielen.",
                  "title": "So kannst du KI-Musik erstellen und Geld verdienen! - GrÃ¼nder.de",
                  "link": "https://www.gruender.de/kuenstliche-intelligenz/ki-musik-erstellen/"
                }
              ],
              "relatedSearches": [
                {
                  "query": "AIVA"
                },
                {
                  "query": "Musik mit KI erstellen kostenlos"
                },
                {
                  "query": "Mit ki musik erstellen free"
                },
                {
                  "query": "ki-song erstellen mit text"
                },
                {
                  "query": "Mit ki musik erstellen songs"
                },
                {
                  "query": "Ki song erstellen kostenlos suno"
                },
                {
                  "query": "KI-Song Generator Deutsch"
                },
                {
                  "query": "Musik KI kostenlos"
                },
                {
                  "query": "KI-Musik Suno"
                }
              ],
              "credits": 1
            }
          }
        ],
        "get_desktop_serp_results": [
          {
            "json": {
              "searchParameters": {
                "q": "mit ki musik erstellen",
                "gl": "de",
                "type": "search",
                "device": "desktop",
                "engine": "google"
              },
              "organic": [
                {
                  "title": "MIT KI-Musik erstellen - Loudly",
                  "link": "https://www.loudly.com/ki-musik-erstellen",
                  "snippet": "Nutze die KI von Loudly, fÃ¼r deine Musikerstellung. Einfach das Genre wÃ¤hlen und innerhalb von Sekunden das gewÃ¼nschte Ergebnis erhalten.",
                  "date": "13 Dec 2023",
                  "position": 1
                },
                {
                  "title": "Die 15 besten KI-Song-Generatoren - Mindforce",
                  "link": "https://mind-force.de/marketing/ki-song-generatoren/",
                  "snippet": "KI-Song-Generatoren kÃ¶nnen selbststÃ¤ndig Musik generieren. ... Mit dem AI Song Generator lassen sich Songs mit Text und Melodie per KI erstellen.",
                  "date": "21 Mar 2025",
                  "position": 2
                },
                {
                  "title": "Gratis AI Music Generator: Erstelle Musik mit KI - Canva",
                  "link": "https://www.canva.com/de_de/funktionen/ai-music-generator/",
                  "snippet": "Kreiere einzigartige Soundtracks mit dem AI Music Generator von Canva. Erstelle ganz einfach Songs, auch ohne komponieren zu kÃ¶nnen.",
                  "position": 3
                },
                {
                  "title": "So produzierst du mit KI deine eigene Musik â€“ Einfach & schnell!",
                  "link": "https://www.youtube.com/watch?v=F5-NRSn1RAE",
                  "snippet": "In diesem Video lernst du, wie einfach es ist, mithilfe von kÃ¼nstlicher Intelligenz hochwertige Musik zu erstellen.",
                  "date": "18 Oct 2024",
                  "position": 4
                },
                {
                  "title": "KI Musik- & Song-Generator Online (Kostenlos, Leistungsstark)",
                  "link": "https://aisonggenerator.io/de",
                  "snippet": "KI Musik - Song Generator. Mit unserer modernen KI Song Generator-Technologie kannst du jede gewÃ¼nschte Musik oder jeden Song erstellen. 100% Lizenzfrei.",
                  "position": 5
                },
                {
                  "title": "Suno â€“ KI-Musik â€“ Apps bei Google Play",
                  "link": "https://play.google.com/store/apps/details?id=com.suno.android&hl=de",
                  "snippet": "Mit Suno kannst du jeden erdenklichen Song selbst produzieren. Suno ist ein KI-Musikstudio im Taschenformat. ... Starte mit 10 kostenlosen Songs (50 Gratis- ...",
                  "rating": 4.8,
                  "ratingCount": 308499,
                  "position": 6
                },
                {
                  "title": "Die 10 besten KI-Musikgeneratoren (April 2025) - Unite.AI",
                  "link": "https://www.unite.ai/de/Beste-KI-Musikgeneratoren/",
                  "snippet": "FlexClip AI Music Generator bietet eine nahtlose MÃ¶glichkeit, KI-generierte Songs zu erstellen, ohne dass musikalisches Fachwissen erforderlich ...",
                  "date": "13 Apr 2025",
                  "position": 7
                },
                {
                  "title": "Suno- KI-Musik im App Store",
                  "link": "https://apps.apple.com/de/app/suno-ki-musik/id6480136315",
                  "snippet": "Mit Suno kannst du jeden erdenklichen Song selbst produzieren. Suno ist ein KI-Musikstudio im Taschenformat. Entdecke folgende Funktionen: â€¢ Erstelle Songs ...",
                  "rating": 4.9,
                  "ratingCount": 10151,
                  "position": 8
                },
                {
                  "title": "#1 KI Song Generator - KI Song erstellen kostenlos online - Vidnoz AI",
                  "link": "https://de.vidnoz.com/ki-music-generator.html",
                  "snippet": "Mit KI Song Generator erstellen Sie eigene KI Songs & Musik aus Text oder Songtext online kostenlos ohne Anmeldung.",
                  "position": 9
                },
                {
                  "title": "KÃ¼nstliche Intelligenz produziert neue Lieder per Mausklick",
                  "link": "https://www.zdf.de/nachrichten/wissen/musik-kuenstliche-intelligenz-ki-suno-ai-100.html",
                  "snippet": "Die KI kann heute einen kompletten Song erstellen, der sich anhÃ¶rt, als hÃ¤tte jemand ihn geschrieben, der Musik studiert hat und seit 20 Jahren ...",
                  "date": "29 Mar 2024",
                  "position": 10
                }
              ],
              "peopleAlsoAsk": [
                {
                  "question": "Kann man mit KI-Musik machen?",
                  "snippet": "Es ist super einfach, KI-Musik mit AI-Music-Generator-Apps wie dem in Canva integrierten Soundraw zu erstellen. Wenn du KI-Songs produzierst, solltest du diese Tipps beachten: WÃ¤hle die richtige Stimmung, das richtige Genre, Thema und die richtige LÃ¤nge fÃ¼r deinen Musik-Track.",
                  "title": "Gratis AI Music Generator: Erstelle Musik mit KI - Canva",
                  "link": "https://www.canva.com/de_de/funktionen/ai-music-generator/"
                },
                {
                  "question": "Wie kann ich kostenlos eine Melodie erstellen?",
                  "snippet": "DIE 9 BESTEN KOSTENLOSEN MUSIKPROGRAMME\n1\nTracktion Waveform Free. ...\n2\nGarageband. ...\n3\nOhm Studio. ...\n4\nAudacity. ...\n5\nPro Tools First. ...\n6\nCubase LE. ...\n7\nCakewalk by BandLab. ...\n8\nPreSonus Studio One 5 Prime.",
                  "title": "Die 9 besten kostenlosen Musikprogramme - iMusician",
                  "link": "https://imusician.pro/de/ressourcen/blog/die-besten-kostenlosen-musikprogramme"
                },
                {
                  "question": "Gibt es eine KI, die Musik mixen kann?",
                  "snippet": "Ja, KI kann Musik mischen . Tools wie RoEx und LANDR nutzen KI, um Tracks zu analysieren und Pegel, EQ und Effekte automatisch anzupassen.",
                  "title": "Ich habe die 4 besten KI-Mixing- und Mastering-Tools im Jahr 2025 getestet",
                  "link": "https://translate.google.com/translate?u=https://www.aimusicpreneur.com/ai-tools-news/the-4-best-ai-mixing-and-mastering-tools/&hl=de&sl=en&tl=de&client=rq"
                },
                {
                  "question": "Kann man mit KI Songs Geld verdienen?",
                  "snippet": "So kannst du mit KI-Musik Geld verdienen Erstelle professionell klingende Songs mit KI-Tools und verÃ¶ffentliche sie auf Plattformen wie Spotify, YouTube oder SoundCloud, um durch Streams oder DirektverkÃ¤ufe Einnahmen zu erzielen.",
                  "title": "So kannst du KI-Musik erstellen und Geld verdienen! - GrÃ¼nder.de",
                  "link": "https://www.gruender.de/kuenstliche-intelligenz/ki-musik-erstellen/"
                }
              ],
              "relatedSearches": [
                {
                  "query": "AIVA"
                },
                {
                  "query": "Musik mit KI erstellen kostenlos"
                },
                {
                  "query": "Mit ki musik erstellen free"
                },
                {
                  "query": "ki-song erstellen mit text"
                },
                {
                  "query": "Mit ki musik erstellen songs"
                },
                {
                  "query": "Ki song erstellen kostenlos suno"
                },
                {
                  "query": "KI-Song Generator Deutsch"
                },
                {
                  "query": "Musik KI kostenlos"
                },
                {
                  "query": "KI-Musik Suno"
                }
              ],
              "credits": 1
            }
          }
        ]
      },
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "get_mobile_serp_results",
                "type": "main",
                "index": 0
              },
              {
                "node": "get_desktop_serp_results",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_mobile_serp_results": {
          "main": [
            [
              {
                "node": "clean_results_mobile",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "merge_faq": {
          "main": [
            [
              {
                "node": "get_questions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_questions": {
          "main": [
            [
              {
                "node": "remove_duplicates_in_questions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "remove_duplicates_in_questions": {
          "main": [
            [
              {
                "node": "insert_faqs",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_desktop_serp_results": {
          "main": [
            [
              {
                "node": "clean_results_desktop",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "merge_faq1": {
          "main": [
            [
              {
                "node": "get_queries",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_queries": {
          "main": [
            [
              {
                "node": "remove_duplicates_in_questions1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_faq_mobile": {
          "main": [
            [
              {
                "node": "merge_faq",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_organic_results_mobile": {
          "main": [
            [
              {
                "node": "top_3_by_mobile",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_organic_results_desktop": {
          "main": [
            [
              {
                "node": "top_3_by_desktop",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_faq_desktop": {
          "main": [
            [
              {
                "node": "merge_faq",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "clean_results_mobile": {
          "main": [
            [
              {
                "node": "get_related_searches_mobile",
                "type": "main",
                "index": 0
              },
              {
                "node": "get_organic_results_mobile",
                "type": "main",
                "index": 0
              },
              {
                "node": "get_faq_mobile",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "clean_results_desktop": {
          "main": [
            [
              {
                "node": "get_organic_results_desktop",
                "type": "main",
                "index": 0
              },
              {
                "node": "get_faq_desktop",
                "type": "main",
                "index": 0
              },
              {
                "node": "get_related_searches_desktop",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_related_searches_mobile": {
          "main": [
            [
              {
                "node": "merge_faq1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_related_searches_desktop": {
          "main": [
            [
              {
                "node": "merge_faq1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "remove_duplicates_in_questions1": {
          "main": [
            [
              {
                "node": "insert_related_searches",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "top_3_by_mobile": {
          "main": [
            [
              {
                "node": "get_urls_to_crawl",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "top_3_by_desktop": {
          "main": [
            [
              {
                "node": "get_urls_to_crawl",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "get_urls_to_crawl": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Remove Duplicates",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Remove Duplicates": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "get_links",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_links": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_status": {
          "main": [
            [
              {
                "node": "check_status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_metadata": {
          "main": [
            [
              {
                "node": "Analyze Content",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "insert_serp_analysis": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_page_content": {
          "main": [
            [
              {
                "node": "sleep",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "sleep": {
          "main": [
            [
              {
                "node": "get_status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "check_status": {
          "main": [
            [
              {
                "node": "get_metadata",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "sleep",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "get_page_content",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Analyze Content": {
          "main": [
            [
              {
                "node": "insert_serp_analysis",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "0359ea11-47b9-4805-a228-06c4a5489c3a",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a"
      },
      "id": "3lBbvTOrzMpMGgIH",
      "tags": [
        {
          "createdAt": "2025-03-02T12:05:53.836Z",
          "updatedAt": "2025-03-02T12:05:53.836Z",
          "id": "utwtHTzeqUdktrxJ",
          "name": "SEO"
        },
        {
          "createdAt": "2025-03-29T14:05:42.024Z",
          "updatedAt": "2025-03-29T14:05:42.024Z",
          "id": "FTx17qhhXpcrm35X",
          "name": "Template"
        }
      ]
    }
  },
  {
    "id": "gsc-ai-writer",
    "title": "GSC AI SEO Writer",
    "description": "Fetches page/query data from Google Search Console, feeds it into Gemini, and outputs rewrite suggestions plus new sections.",
    "problem": "Optimizing underperforming articles requires juggling GSC data and AI prompts; this workflow packages insights automatically.",
    "tags": [
      "seo",
      "gsc",
      "ai",
      "writer"
    ],
    "metadata": {
      "industries": [
        "seo",
        "content"
      ],
      "domains": [
        "content-optimization"
      ],
      "channels": [
        "google-docs",
        "notion"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "Google Search Console",
        "Gemini",
        "Notion"
      ]
    },
    "workflow": {
      "name": "Data-driven SEO Optimization",
      "nodes": [
        {
          "parameters": {
            "formTitle": "Form",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Link",
                  "requiredField": true
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            -500,
            280
          ],
          "id": "ba0f4b1f-40be-4c8b-86a8-b880960224d4",
          "name": "On form submission",
          "webhookId": "c0791596-ada8-407c-9669-f54396d88940"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "http://crawl4ai:11235/crawl",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "urls",
                  "value": "={{ $json.Link }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -280,
            60
          ],
          "id": "1b6e074c-b5f3-4fd2-a6c0-b0d2d1f9275d",
          "name": "get_article_content"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            -80,
            60
          ],
          "id": "435d5eb7-f2a2-4b2e-ad27-712e7fd304b7",
          "name": "5_sec",
          "webhookId": "ac0bb2e9-a1f8-47df-823b-074a0e825f6c"
        },
        {
          "parameters": {
            "url": "=http://crawl4ai:11235/task/{{ $json.task_id }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            60,
            60
          ],
          "id": "5f582f3d-616d-433b-9b62-d1c646dea679",
          "name": "get_status"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "f42941b7-46c6-44f9-95d6-80065c27c3a9",
                  "leftValue": "={{ $json.status }}",
                  "rightValue": "completed",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            200,
            60
          ],
          "id": "5326213d-ffd6-4048-81d2-1c1dd44a3485",
          "name": "is_completed"
        },
        {
          "parameters": {
            "html": "={{ $json.result.cleaned_html }}",
            "destinationKey": "markdown",
            "options": {}
          },
          "type": "n8n-nodes-base.markdown",
          "typeVersion": 1,
          "position": [
            540,
            -20
          ],
          "id": "9a5897bb-30f6-4e7c-90e2-4b8995a22aeb",
          "name": "Markdown"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "9177b0ac-024c-4088-a1b4-9254a53244e0",
                  "name": "result.url",
                  "value": "={{ $json.result.url }}",
                  "type": "string"
                },
                {
                  "id": "bb4b7ad9-dc32-40d5-93d7-51582c64d99f",
                  "name": "result.metadata.title",
                  "value": "={{ $json.result.metadata.title }}",
                  "type": "string"
                },
                {
                  "id": "64dfd766-9b2e-4349-8f4f-8771202cb0d4",
                  "name": "result.cleaned_html",
                  "value": "={{ $json.result.cleaned_html }}",
                  "type": "string"
                },
                {
                  "id": "a74a89ab-aa6e-4ff5-934a-c6176702c127",
                  "name": "result.metadata.description",
                  "value": "={{ $json.result.metadata.description }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            360,
            -20
          ],
          "id": "3fc6b9e7-755e-4f0a-bef5-54e3f4f62f21",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "resource": "fileFolder",
            "searchMethod": "query",
            "queryString": "={{ \"name=\" + \"'\"+$json.Link.split('/').filter(Boolean).pop()+\"'\" }}",
            "limit": 1,
            "filter": {
              "includeTrashed": "={{ false }}"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            -280,
            500
          ],
          "id": "2bd3d92a-6035-4f9e-b491-5ca18643d93c",
          "name": "Google Drive",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "bf20030a-7234-4e88-bcc9-cb815ac8dcd9",
                  "leftValue": "={{ $json }}",
                  "rightValue": "",
                  "operator": {
                    "type": "object",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -100,
            500
          ],
          "id": "38e4200b-6e9d-4f4b-b2be-c0156ffc5a54",
          "name": "if_sheet_exists"
        },
        {
          "parameters": {
            "resource": "spreadsheet",
            "title": "={{ $('On form submission').item.json.Link.split('/').filter(Boolean).pop()  }}",
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            60,
            580
          ],
          "id": "10ab4494-e56d-4854-9557-63702aa92edd",
          "name": "create_new_spreadsheet",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "automations-451008",
              "mode": "list",
              "cachedResultName": "automations",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=automations-451008"
            },
            "sqlQuery": "DECLARE target_url STRING DEFAULT '{{ $('On form submission').item.json.Link }}';\nDECLARE current_period_start DATE DEFAULT DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY);\nDECLARE previous_period_start DATE DEFAULT DATE_SUB(current_period_start, INTERVAL 30 DAY);\n\nWITH \n-- Current period query performance (last 30 days)\ncurrent_period AS (\n  SELECT\n    query,\n    SUM(clicks) AS current_clicks,\n    SUM(impressions) AS current_impressions,\n    SAFE_DIVIDE(SUM(clicks), SUM(impressions)) AS current_ctr,\n    SAFE_DIVIDE(SUM(sum_position), SUM(impressions)) AS current_avg_position\n  FROM `your_bigquery_table`\n  WHERE \n    url = target_url\n    AND data_date >= current_period_start\n    AND data_date < CURRENT_DATE()\n    AND is_anonymized_query = False\n  GROUP BY query\n),\n\n-- Previous period query performance (30-60 days ago)\nprevious_period AS (\n  SELECT\n    query,\n    SUM(clicks) AS previous_clicks,\n    SUM(impressions) AS previous_impressions,\n    SAFE_DIVIDE(SUM(clicks), SUM(impressions)) AS previous_ctr,\n    SAFE_DIVIDE(SUM(sum_position), SUM(impressions)) AS previous_avg_position\n  FROM `your_bigquery_table`\n  WHERE \n    url = target_url\n    AND data_date >= previous_period_start\n    AND data_date < current_period_start\n    AND is_anonymized_query = False\n  GROUP BY query\n),\n\n-- Combined data with differences\ncombined_data AS (\n  SELECT\n    COALESCE(c.query, p.query) AS query,\n    \n    -- Current period metrics\n    IFNULL(c.current_clicks, 0) AS current_clicks,\n    IFNULL(p.previous_clicks, 0) AS previous_clicks,\n    \n    IFNULL(c.current_impressions, 0) AS current_impressions,\n    IFNULL(p.previous_impressions, 0) AS previous_impressions,\n    \n    IFNULL(c.current_ctr, 0) AS current_ctr,\n    IFNULL(p.previous_ctr, 0) AS previous_ctr,\n    \n    IFNULL(c.current_avg_position, 0) AS current_avg_position,\n    IFNULL(p.previous_avg_position, 0) AS previous_avg_position,\n    \n    -- Absolute differences\n    IFNULL(c.current_clicks, 0) - IFNULL(p.previous_clicks, 0) AS clicks_diff,\n    IFNULL(c.current_impressions, 0) - IFNULL(p.previous_impressions, 0) AS impressions_diff,\n    IFNULL(c.current_ctr, 0) - IFNULL(p.previous_ctr, 0) AS ctr_diff,\n    IFNULL(p.previous_avg_position, 0) - IFNULL(c.current_avg_position, 0) AS position_diff,\n    \n    -- Percentage differences\n    CASE \n      WHEN IFNULL(p.previous_clicks, 0) = 0 AND IFNULL(c.current_clicks, 0) > 0 THEN 100\n      WHEN IFNULL(p.previous_clicks, 0) = 0 THEN 0\n      ELSE ROUND((IFNULL(c.current_clicks, 0) - IFNULL(p.previous_clicks, 0)) / IFNULL(p.previous_clicks, 0) * 100, 2)\n    END AS clicks_diff_pct,\n    \n    CASE \n      WHEN IFNULL(p.previous_impressions, 0) = 0 AND IFNULL(c.current_impressions, 0) > 0 THEN 100\n      WHEN IFNULL(p.previous_impressions, 0) = 0 THEN 0\n      ELSE ROUND((IFNULL(c.current_impressions, 0) - IFNULL(p.previous_impressions, 0)) / IFNULL(p.previous_impressions, 0) * 100, 2)\n    END AS impressions_diff_pct,\n    \n    CASE \n      WHEN IFNULL(p.previous_ctr, 0) = 0 AND IFNULL(c.current_ctr, 0) > 0 THEN 100\n      WHEN IFNULL(p.previous_ctr, 0) = 0 THEN 0\n      ELSE ROUND((IFNULL(c.current_ctr, 0) - IFNULL(p.previous_ctr, 0)) / IFNULL(p.previous_ctr, 0) * 100, 2)\n    END AS ctr_diff_pct\n  FROM current_period c\n  FULL OUTER JOIN previous_period p ON c.query = p.query\n)\n\n-- Main query with categorization\nSELECT\n  query,\n  \n  -- Paired metrics (current next to previous)\n  current_clicks,\n  previous_clicks,\n  clicks_diff,\n  clicks_diff_pct,\n  \n  current_impressions,\n  previous_impressions,\n  impressions_diff,\n  impressions_diff_pct,\n  \n  current_ctr,\n  previous_ctr,\n  ctr_diff,\n  ctr_diff_pct,\n  \n  current_avg_position,\n  previous_avg_position,\n  position_diff,\n  \n  -- Categorization\n  CASE\n    WHEN clicks_diff > 0 THEN 'Gaining'\n    WHEN clicks_diff < 0 THEN 'Declining'\n    ELSE 'Stable'\n  END AS trend_category\n\nFROM combined_data\nWHERE \n  -- Filter to include only keywords with meaningful data\n  (current_clicks > 0 OR previous_clicks > 0 OR current_impressions > 10 OR previous_impressions > 10)\nORDER BY \n  -- Default ordering by absolute click difference (biggest gains/losses first)\n  ABS(clicks_diff) DESC,\n  current_impressions DESC",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQuery",
          "typeVersion": 2.1,
          "position": [
            540,
            500
          ],
          "id": "d8864e24-c4b0-4848-8abd-6fddac21bf8f",
          "name": "get_article_performance"
        },
        {
          "parameters": {
            "operation": "create",
            "documentId": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "title": "={{$now.format('yyyy-MM-dd')}}",
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            60,
            420
          ],
          "id": "ef356758-0b7f-4984-a11f-44a39ec86fc7",
          "name": "add_sheet_0",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "operation": "create",
            "documentId": {
              "__rl": true,
              "value": "={{ $json.spreadsheetId }}",
              "mode": "id"
            },
            "title": "={{ $now.format('yyyy-MM-dd')}}",
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            240,
            580
          ],
          "id": "46a01b97-6576-4c7d-8198-d21a5cedbcd7",
          "name": "add_sheet_1",
          "alwaysOutputData": true
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            400,
            500
          ],
          "id": "18066faf-8a89-4ed7-b612-b9fe6a3b85a7",
          "name": "Merge",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "={{ $('Merge').item.json.spreadsheetId }}",
              "mode": "id"
            },
            "sheetName": {
              "__rl": true,
              "value": "={{ $now.format('yyyy-MM-dd') }}",
              "mode": "name"
            },
            "columns": {
              "mappingMode": "autoMapInputData",
              "value": {},
              "matchingColumns": [],
              "schema": [
                {
                  "id": "query",
                  "displayName": "query",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "current_clicks",
                  "displayName": "current_clicks",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "previous_clicks",
                  "displayName": "previous_clicks",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "clicks_diff",
                  "displayName": "clicks_diff",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "clicks_diff_pct",
                  "displayName": "clicks_diff_pct",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "current_impressions",
                  "displayName": "current_impressions",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "previous_impressions",
                  "displayName": "previous_impressions",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "impressions_diff",
                  "displayName": "impressions_diff",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "impressions_diff_pct",
                  "displayName": "impressions_diff_pct",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "current_ctr",
                  "displayName": "current_ctr",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "previous_ctr",
                  "displayName": "previous_ctr",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ctr_diff",
                  "displayName": "ctr_diff",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "ctr_diff_pct",
                  "displayName": "ctr_diff_pct",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "current_avg_position",
                  "displayName": "current_avg_position",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "previous_avg_position",
                  "displayName": "previous_avg_position",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "position_diff",
                  "displayName": "position_diff",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "trend_category",
                  "displayName": "trend_category",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheets",
          "typeVersion": 4.5,
          "position": [
            700,
            500
          ],
          "id": "17a2c863-c55f-458a-8a7c-ffc016c7acf6",
          "name": "insert_performance"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            900,
            60
          ],
          "id": "3a5d7bf9-8fb4-4d1c-8770-c39f57afd39c",
          "name": "Merge1",
          "executeOnce": false
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "performance",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            720,
            160
          ],
          "id": "0716f221-9819-4533-98fe-34bec5e9ac83",
          "name": "set_key"
        },
        {
          "parameters": {
            "modelId": {
              "__rl": true,
              "value": "gpt-4o-mini",
              "mode": "list",
              "cachedResultName": "GPT-4O-MINI"
            },
            "messages": {
              "values": [
                {
                  "content": "Du bist Copywriter mit einem vielseitigen Skillset an SEO-FÃ¤higkeiten. Du bist auf die datengetriebene Optimierung spezialisiert und verbesserst bestehende Artikel auf Basis von realen Traffic-Daten. Deine Daten stammen aus der Google Search Console und zeigen, wie gut Keywords performen. Du stÃ¼tzt dich ausschlieÃŸlich auf die zugrundeliegenden Daten und erfindest keine falschen Informationen. Dein Ziel ist es immer, den Artikel datengetrieben zu verbessern. Des Weiteren bist du HTML-Experte und gibst deine Antworten ausschlieÃŸlich als HTML-formatiert zurÃ¼ck. Wir benÃ¶tigen kein DOCTYPE, meta oder title tag. AusschlieÃŸlich HTML der den Inhalt strukturiert darstellt.",
                  "role": "system"
                },
                {
                  "content": "=Analysiere den vorhandenen Artikel: <{{ $json.content }}> im Detail und verstehe den Inhalt sowie die Suchintention, die dieser Artikel befriedigen soll. AnschlieÃŸend analysierst du ALLE Keywords aus der Google Search Console. Diese Keywords zeigen dir, wie gut der Artikel fÃ¼r bestimmte Suchanfragen performt.\nDie Performance-Daten sind wie folgt:\n\"\"\n{{ JSON.stringify($('Merge1').all()[1].json.performance) }}\n\"\"\nFÃ¼hre folgende Optimierungen durch:\n    1. Analysiere den bestehenden Artikelinhalt auf Struktur, Lesbarkeit und SEO-Relevanz.\n    2. Identifiziere Optimierungspotenziale im Artikel basierend auf den analysierten Daten.\n    3. Entwickle neue VorschlÃ¤ge fÃ¼r den Titel und die Meta-Beschreibung. \n\t- Die Titel dÃ¼rften nicht mehr wie 60 Zeichen lang sein.\n\t- Die Meta-Beschreibung muss relevante Keywords aus den Performance-Daten enthalten.\n    4. Erstelle optimierte Textpassagen, die die relevanten Keywords aus der Google Search Console natÃ¼rlich integrieren.\n \t- Gib an, aus welchem Kapitel die Textpassage stammen, so dass man diese schnell erkennen und optimieren kann.\n \t- Erstelle mindestens fÃ¼r jeden Paragraphen eine optimierte Textpassage.\n\t- Gib an, aus welchem Kapitel die Textpassage stammen, so dass man diese schnell erkennen und optimieren kann.\n\t- (Die Textpassagen mÃ¼ssen so aufgebaut sein, dass ich diese schnell finden und ersetzen kann)\n    5. Erstelle neue Textpassagen mit Keywords aus den Google Search Console Daten, die man nicht im vorherigen Schritt einfÃ¼gen konnte.\n      - Verwende hier als Ãœberschrift \"Neue Textpassagen\".\n    6. Erstelle eine HTML Tabelle die deine Auswahl der selektieren Keywords aus der Google Search Console darstellt.\n\nFormatiere deine Ausgabe wie folgt und vermeide Fehler:\n    - Ein kurzer Analysebericht des aktuellen Artikelinhalts.\n    - Pro Verbesserungsvorschlag einmal die originale Passage und direkt daruntere die SEO-freundliche ErgÃ¤nzung.\n    - 5 VorschlÃ¤ge fÃ¼r optimierte Titel.\n    - 5 VorschlÃ¤ge fÃ¼r optimierte Meta-Beschreibungen.\n    - Eine Liste von Ã¼berarbeiteten Textpassagen, die die identifizierten Keywords und Phrasen natÃ¼rlich integrieren. Bearbeite mindestens\n     5 Textpassagen. Wenn mÃ¶glich, dann auch mehr, so dass der Text die Keywords aus der Google Search Console beinhaltet.\n    - HTML Tabelle mit selektieren Keywords aus der Google Search Console.\n    Alles in HTML formatiert.\nWir benÃ¶tigen kein DOCTYPE, meta oder title tag. AusschlieÃŸlich HTML der den Inhalt strukturiert darstellt."
                }
              ]
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            1140,
            60
          ],
          "id": "4a96ce2e-ca8b-4bb3-b252-3c0c1ddb5fab",
          "name": "create_report",
          "executeOnce": true
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "6c07931f-d135-44cb-a9f5-d0e80887a0b4",
                  "name": "url",
                  "value": "={{ $json.result.url }}",
                  "type": "string"
                },
                {
                  "id": "d3223ba3-1e08-47b2-9265-f3fb178a49ee",
                  "name": "title",
                  "value": "={{ $json.result.metadata.title }}",
                  "type": "string"
                },
                {
                  "id": "13da4adc-a125-4410-b2ca-c0c239b939ab",
                  "name": "description",
                  "value": "={{ $json.result.metadata.description }}",
                  "type": "string"
                },
                {
                  "id": "03d09f45-3ece-4da2-953b-fdbe54cd2896",
                  "name": "content",
                  "value": "={{ $json.markdown }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            720,
            -20
          ],
          "id": "a46ffc94-4651-4481-89e6-ed073735a41f",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "654e6696-7705-4021-87df-1edf19bbe439",
                  "name": "message.content",
                  "value": "={{ $json.message.content}}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1460,
            60
          ],
          "id": "878b56fc-b988-412a-90eb-0b2d87b3c1d5",
          "name": "get_clean_html",
          "notes": ".replace('html', '').replaceAll(\"```\", '').replaceAll(\"\\n\", \"\") "
        },
        {
          "parameters": {
            "operation": "toBinary",
            "sourceProperty": "base64",
            "options": {
              "fileName": "test.html",
              "mimeType": "={{ $json.mimetype }}"
            }
          },
          "type": "n8n-nodes-base.convertToFile",
          "typeVersion": 1.1,
          "position": [
            1780,
            60
          ],
          "id": "203ca372-670e-4db6-a2f6-99f01c5a4841",
          "name": "convert_to_html_file"
        },
        {
          "parameters": {
            "jsCode": "return [\n  {\n    json: {\n      base64: Buffer.from($input.all()[0].json.message.content).toString('base64'),\n      mimetype: \"text/html\"\n    }\n  }\n];\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1620,
            60
          ],
          "id": "74ba8692-7d3d-4f32-bb74-c075b6a58d83",
          "name": "convert_to_base64"
        },
        {
          "parameters": {
            "name": "test123",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "folderId": {
              "__rl": true,
              "mode": "list",
              "value": "root",
              "cachedResultName": "/ (Root folder)"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleDrive",
          "typeVersion": 3,
          "position": [
            1940,
            60
          ],
          "id": "ede28035-8a35-40a6-89df-ffa196470765",
          "name": "save_report"
        },
        {
          "parameters": {
            "content": "# Crawl Article",
            "height": 420,
            "width": 1420
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -340,
            -100
          ],
          "id": "9b518a2a-5b18-4cbb-8afd-0de2fc17a4a0",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "# Generate Optimized Report",
            "height": 420,
            "width": 1040
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1100,
            -100
          ],
          "id": "caffcc7c-7af1-49ee-b513-1840a6a7ba73",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "content": "# Generate and Save Performance Report",
            "height": 420,
            "width": 2480
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -340,
            340
          ],
          "id": "bb48be15-d76d-4e75-ad17-54ad27cfaf87",
          "name": "Sticky Note"
        }
      ],
      "pinData": {},
      "connections": {
        "On form submission": {
          "main": [
            [
              {
                "node": "get_article_content",
                "type": "main",
                "index": 0
              },
              {
                "node": "Google Drive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_article_content": {
          "main": [
            [
              {
                "node": "5_sec",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "5_sec": {
          "main": [
            [
              {
                "node": "get_status",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_status": {
          "main": [
            [
              {
                "node": "is_completed",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "is_completed": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "5_sec",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Markdown",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive": {
          "main": [
            [
              {
                "node": "if_sheet_exists",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "if_sheet_exists": {
          "main": [
            [
              {
                "node": "add_sheet_0",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "create_new_spreadsheet",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "create_new_spreadsheet": {
          "main": [
            [
              {
                "node": "add_sheet_1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_article_performance": {
          "main": [
            [
              {
                "node": "insert_performance",
                "type": "main",
                "index": 0
              },
              {
                "node": "set_key",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "add_sheet_1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "add_sheet_0": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "get_article_performance",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Markdown": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "create_report",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "set_key": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "create_report": {
          "main": [
            [
              {
                "node": "get_clean_html",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_clean_html": {
          "main": [
            [
              {
                "node": "convert_to_base64",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "convert_to_base64": {
          "main": [
            [
              {
                "node": "convert_to_html_file",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "convert_to_html_file": {
          "main": [
            [
              {
                "node": "save_report",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "35ba3601-2edb-4bfd-8f0a-c41298ab9d21",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a"
      },
      "id": "cO3xILd89yLoQPGu",
      "tags": [
        {
          "createdAt": "2025-03-02T12:05:53.836Z",
          "updatedAt": "2025-03-02T12:05:53.836Z",
          "id": "utwtHTzeqUdktrxJ",
          "name": "SEO"
        }
      ]
    }
  },
  {
    "id": "ai-overview-audit",
    "title": "AI Overview Analyzer",
    "description": "Scrapes Google's AI Overviews for a keyword, extracts entities/sources, and generates a content blueprint to earn inclusion.",
    "problem": "Brands want to appear inside AI Overview answers, but it's unclear what structure Google expects; this agent reverse engineers it.",
    "tags": [
      "seo",
      "ai-overview",
      "analysis"
    ],
    "metadata": {
      "industries": [
        "seo"
      ],
      "domains": [
        "ai-overview",
        "research"
      ],
      "channels": [
        "reports"
      ],
      "trigger": "manual",
      "complexity": "medium",
      "integrations": [
        "Google Search",
        "OpenAI"
      ]
    },
    "workflow": {
      "name": "AI Overview Analyzer",
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.3,
          "position": [
            0,
            0
          ],
          "id": "72ac6c8d-a373-4d71-849a-75ed6716b9b1",
          "name": "When chat message received",
          "webhookId": "715bcc67-a6b6-4334-8141-83c123f35917"
        },
        {
          "parameters": {
            "contextWindowLength": 10
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            304,
            240
          ],
          "id": "f16346fd-e166-4d5e-973e-0db4412d20e6",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {
              "temperature": 0
            }
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            144,
            240
          ],
          "id": "7887d008-b881-4387-91cb-cd824bbd553f",
          "name": "GPT-4.1",
          "credentials": {
            "openAiApi": {
              "id": "RAj3VxCHt0rIwBTk",
              "name": "OpenAI"
            }
          }
        },
        {
          "parameters": {
            "description": "Call this tool to get the AI Overview from Google.",
            "workflowId": {
              "__rl": true,
              "value": "4ViOjawp2E5PbJsu",
              "mode": "list",
              "cachedResultName": "Analyze AI Overview"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "gl": "={{ $fromAI('country') }}",
                "q": "={{ $fromAI('query') }}",
                "location": "={{ $fromAI('location') }}",
                "hl": "={{ $fromAI('host_language') }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "gl",
                  "displayName": "gl",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "q",
                  "displayName": "q",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "location",
                  "displayName": "location",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "hl",
                  "displayName": "hl",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "typeVersion": 2.2,
          "position": [
            464,
            240
          ],
          "id": "38bb6138-e3c9-4850-aa4b-bc5b5d28f2ed",
          "name": "Analyze AI Overview"
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "=You are an elite SEO Analyst Agent. Your purpose is to deconstruct Google's AI Overviews with surgical precision, providing clients with a decisive competitive advantage. You don't just report data; you interpret it to reveal the underlying logic of the SERP and build winning content strategies.\n\n**1. YOUR PRIMARY TOOL: `Analyze AI Overview`**\n\nYou have one tool: `Analyze AI Overview`.\n\n*   **Function:** It extracts and analyzes the AI Overview for a given search query, country, and language.\n*   **Parameters:**\n    *   `query` (string, required): The search term to analyze.\n    *   `gl` (string, required): The country code (**two-letter ISO 3166-1 alpha-2**).\n    *   `hl` (string, required): The language code (**two-letter ISO 3166-1 alpha-2**).\n    *   `location` (string, optional): A specific geographic location.\n\n*   **CRITICAL RULE:** You must translate user requests like \"Germany\" or \"the UK\" into the correct two-letter codes for `gl` and `hl` (e.g., Germany -> `gl: 'de'`, `hl: 'de'`). This is a core responsibility.\n\n**2. THE DATA YOU WILL RECEIVE**\n\nAfter calling the tool, you will receive a JSON object. Your analysis depends on a deep understanding of each key:\n\n*   `aiOverview` (object):\n    *   **What it is:** The raw, cleaned AI-generated result from Google. This is your **ground truth**.\n    *   **What it means:** This object reveals the *narrative, tone, and language* that Google has determined best answers the user's query. It provides the context for everything else. Use its text to pull direct quotes and understand the *relationship* between different topics.\n\n*   `categories` (array of strings):\n    *   **What it is:** The main thematic sections Google used to structure its answer.\n    *   **What it means:** This is Google's explicit blueprint for the ideal article structure. These are your `<h2>` tags. They reveal the critical sub-intents you must satisfy.\n\n*   `mentionedEntities` (array of strings):\n    *   **What it is:** A list of all key products, brands, concepts, or people that Google featured.\n    *   **What it means:** These are the non-negotiable topics for your content. Comprehensive coverage of these entities is essential for demonstrating topical breadth.\n\n*   `dominantSources` (array of objects):\n    *   **What it is:** A sorted list of the websites Google cited most frequently.\n    *   **What it means:** This is your direct measure of **topical authority**. These are your primary competitors. Analyze their article `titles` to decode the winning content format (e.g., \"Top 10...\", \"Ultimate Guide...\", \"X vs Y...\").\n\n**3. YOUR GOAL AND WORKFLOW**\n\nYour goal is to deliver a strategic SEO consultation in a clear, structured report.\n\n1.  **Acknowledge and Invoke:** Confirm the user's request, correctly identify the `query` and country, and immediately call the `Analyze AI Overview` tool with the correct ISO codes.\n2.  **Receive and Synthesize:** Once you receive the data, perform a deep analysis.\n3.  **Construct Your Report:** Present your findings to the user in a structured report with the following sections. **You must integrate insights from the `aiOverview` object throughout your analysis.**\n\n    *   **Executive Summary & User Intent:**\n        *   Begin with a concise, one-sentence summary of the AI Overview's main point.\n        *   Examine the initial paragraphs in `aiOverview.text_blocks`â€”Google often provides a direct thesis statement here.\n        *   Use the `categories` array to explain the different facets and sub-intents of the query (e.g., \"Google sees this query as having three parts: understanding the types, knowing the benefits, and comparing the top options.\").\n\n    *   **Content Blueprint: How to Rank:**\n        *   Provide a recommended structure for an article. Advise the user to use the `categories` as their main headings (`<h2>`s).\n        *   Instruct them to create sections for each of the `mentionedEntities`.\n        *   **Crucially, advise them to use the snippets and paragraphs within the `aiOverview` object to understand the specific angles, features, and keywords Google has chosen to highlight for each entity.** This is the guide for *what to write* in each section.\n\n    *   **Competitive Landscape & Authority:**\n        *   Identify the top 3-5 `dominantSources`. Explain *why* they are authoritative (high citation count).\n        *   Analyze their article titles to reveal the proven content format. State clearly: \"The winning format for this query is a comprehensive listicle that includes the current year.\"\n\n    *   **Actionable SEO Strategy:**\n        *   Provide a final, powerful summary. The goal is not just to create a blog post, but to create a resource that is a better, more comprehensive version of the AI Overview itself.\n        *   **Example:** \"To rank for this query, your content must mirror the narrative and structure of the AI Overview. Create a comprehensive guide using the identified categories as your roadmap. Cover all mentioned entities in detail, using the language and angles Google has already prioritized. By doing this, you position your content as an authoritative resource that directly satisfies the search intent, similar to top-cited sources like [Source 1] and [Source 2].\""
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            208,
            0
          ],
          "id": "070d5d59-e2c9-4577-9391-2107be8d9abd",
          "name": "AI Overview Analyzer"
        }
      ],
      "pinData": {},
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Overview Analyzer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Overview Analyzer",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "GPT-4.1": {
          "ai_languageModel": [
            [
              {
                "node": "AI Overview Analyzer",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Analyze AI Overview": {
          "ai_tool": [
            [
              {
                "node": "AI Overview Analyzer",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "a2ce017e-2921-486a-a414-6a4bb0614743",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a"
      },
      "id": "3BRvyoqRuX4QYWWV",
      "tags": []
    }
  },
  {
    "id": "gsc-api-toolkit",
    "title": "Google Search Console API Toolkit",
    "description": "Bundle of 12 prebuilt nodes/queries that pull query, page, device, and indexing metrics for advanced SEO analysis.",
    "problem": "Analysts spend hours wiring up GSC for each use case; this template provides ready-made building blocks.",
    "tags": [
      "gsc",
      "api",
      "analytics"
    ],
    "metadata": {
      "industries": [
        "seo",
        "analytics"
      ],
      "domains": [
        "data-pipelines"
      ],
      "channels": [
        "bigquery",
        "google-sheets"
      ],
      "trigger": "manual",
      "complexity": "medium",
      "integrations": [
        "Google Search Console",
        "BigQuery"
      ]
    },
    "workflow": {
      "name": "Product - Google Search Console API Examples",
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -1000,
            200
          ],
          "id": "5d1adc86-fe51-412e-8aea-cbaf4e9cf708",
          "name": "When clicking â€˜Test workflowâ€™"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/v1/urlInspection/index:inspect",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"inspectionUrl\": \"https://your-domain.com/slug/\",\n  \"siteUrl\": \"https://your-domain.com/\"\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -400,
            340
          ],
          "id": "561fd96f-17af-45d5-90ac-a8f14e833d35",
          "name": "Inspect URL",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "content": "## Inspect URLs",
            "height": 240,
            "width": 260
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            260
          ],
          "id": "48d24e88-5869-4d91-b3a4-97ecad871d4c",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"device\"],\n  \"rowLimit\": 5000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            380,
            340
          ],
          "id": "007c4c43-20d1-486f-b817-b5e0de051191",
          "name": "Get Device Performance",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows;\n\n// Map each row to a cleaner format with calculations\nconst deviceData = rows.map(row => {\n  return {\n    device: row.keys[0],\n    clicks: row.clicks,\n    impressions: row.impressions,\n    ctr: row.ctr,\n    position: row.position,\n    ctrFormatted: `${(row.ctr * 100).toFixed(2)}%`,\n    positionRounded: Math.round(row.position * 10) / 10\n  };\n});\n\n// Calculate totals for percentage analysis\nconst totals = deviceData.reduce((acc, item) => {\n  acc.totalClicks += item.clicks;\n  acc.totalImpressions += item.impressions;\n  return acc;\n}, { totalClicks: 0, totalImpressions: 0 });\n\n// Add percentage calculations\nreturn deviceData.map(item => {\n  const clickShare = ((item.clicks / totals.totalClicks) * 100).toFixed(2);\n  const impressionShare = ((item.impressions / totals.totalImpressions) * 100).toFixed(2);\n  \n  return {\n    ...item,\n    clickShare: `${clickShare}%`,\n    impressionShare: `${impressionShare}%`\n  };\n});"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            560,
            340
          ],
          "id": "2d7ae797-9838-43f7-a084-f2eb7f103a2c",
          "name": "Parse Device Performance"
        },
        {
          "parameters": {
            "content": "## Performance by Devices",
            "height": 240,
            "width": 440
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            320,
            260
          ],
          "id": "3cddb3c0-7b87-46de-ad7c-48ff58f7c903",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"page\"],\n  \"rowLimit\": 5000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -120,
            340
          ],
          "id": "bb70e67a-46aa-4b14-8ae8-c8adf3eb19da",
          "name": "Get Top Performing Pages",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows;\n\n// Map and calculate metrics for each page\nconst pageData = rows.map(row => {\n  return {\n    page: row.keys[0],\n    clicks: row.clicks,\n    impressions: row.impressions,\n    ctr: row.ctr,\n    position: row.position,\n    ctrFormatted: `${(row.ctr * 100).toFixed(2)}%`,\n    positionRounded: Math.round(row.position * 10) / 10\n  };\n});\n\n// Calculate totals for percentage analysis\nconst totals = pageData.reduce((acc, item) => {\n  acc.totalClicks += item.clicks;\n  acc.totalImpressions += item.impressions;\n  return acc;\n}, { totalClicks: 0, totalImpressions: 0 });\n\n// Sort by clicks (top performers first)\nconst sortedPages = pageData.sort((a, b) => b.clicks - a.clicks);\n\n// Add comprehensive SEO metrics\nreturn sortedPages.map((item, index) => {\n  const clickShare = ((item.clicks / totals.totalClicks) * 100).toFixed(2);\n  const impressionShare = ((item.impressions / totals.totalImpressions) * 100).toFixed(2);\n  \n  // SEO Performance Categories\n  let performanceCategory = 'Monitor';\n  if (item.ctr > 0.05 && item.position < 10) performanceCategory = 'Star Performer';\n  else if (item.ctr > 0.03 && item.position < 15) performanceCategory = 'Good Performer';\n  else if (item.impressions > 1000 && item.ctr < 0.02) performanceCategory = 'CTR Opportunity';\n  else if (item.position > 10 && item.position < 20 && item.impressions > 500) performanceCategory = 'Ranking Opportunity';\n  \n  // Precise Action Items based on data patterns\n  let actionItem = 'Monitor performance';\n  \n  if (item.impressions > 5000 && item.ctr < 0.015) {\n    actionItem = 'Rewrite title tag - very low CTR with high visibility';\n  } else if (item.impressions > 2000 && item.ctr < 0.025 && item.position < 10) {\n    actionItem = 'Optimize meta description - good position, poor CTR';\n  } else if (item.position >= 11 && item.position <= 20 && item.impressions > 1000) {\n    actionItem = 'Content optimization - close to page 1, good search volume';\n  } else if (item.position >= 4 && item.position <= 10 && item.ctr < 0.05) {\n    actionItem = 'A/B test titles - page 1 position with below-average CTR';\n  } else if (item.position > 20 && item.impressions > 500) {\n    actionItem = 'Content audit - poor ranking despite search interest';\n  } else if (item.clicks < 10 && item.impressions > 1000) {\n    actionItem = 'Title/snippet mismatch - high visibility, no clicks';\n  } else if (item.position <= 3 && item.ctr > 0.15) {\n    actionItem = 'Maintain excellence - top performer';\n  }\n  \n  return {\n    rank: index + 1,\n    page: item.page,\n    clicks: item.clicks,\n    impressions: item.impressions,\n    ctr: item.ctrFormatted,\n    position: item.positionRounded,\n    clickShare: `${clickShare}%`,\n    impressionShare: `${impressionShare}%`,\n    performanceCategory: performanceCategory,\n    actionItem: actionItem\n  };\n});"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            100,
            340
          ],
          "id": "f3df4333-d507-4c22-8965-04ef308a1223",
          "name": "Parse Top Performing Pages"
        },
        {
          "parameters": {
            "content": "## Top Performing Pages",
            "height": 240,
            "width": 480
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -180,
            260
          ],
          "id": "5ce2ec33-a1ac-4d41-a302-7d24521436b5",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"page\", \"query\"],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            120,
            -200
          ],
          "id": "6af3fbd7-6057-4290-bdd5-fb4deec856b5",
          "name": "Get Keyword Analysis by Pages",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows;\n\n// Group keywords by page\nconst pageKeywords = {};\n\nrows.forEach(row => {\n  const page = row.keys[0];\n  const query = row.keys[1];\n  \n  if (!pageKeywords[page]) {\n    pageKeywords[page] = {\n      page: page,\n      totalClicks: 0,\n      totalImpressions: 0,\n      keywords: []\n    };\n  }\n  \n  // Add keyword data\n  pageKeywords[page].keywords.push({\n    query: query,\n    clicks: row.clicks,\n    impressions: row.impressions,\n    ctr: row.ctr,\n    position: row.position,\n    ctrFormatted: `${(row.ctr * 100).toFixed(2)}%`,\n    positionRounded: Math.round(row.position * 10) / 10\n  });\n  \n  // Update page totals\n  pageKeywords[page].totalClicks += row.clicks;\n  pageKeywords[page].totalImpressions += row.impressions;\n});\n\n// Process each page's keyword data\nconst result = [];\n\nObject.values(pageKeywords).forEach(pageData => {\n  // Sort keywords by clicks (most valuable first)\n  pageData.keywords.sort((a, b) => b.clicks - a.clicks);\n  \n  // Calculate keyword performance metrics\n  const processedKeywords = pageData.keywords.map((keyword, index) => {\n    const clickShare = ((keyword.clicks / pageData.totalClicks) * 100).toFixed(2);\n    const impressionShare = ((keyword.impressions / pageData.totalImpressions) * 100).toFixed(2);\n    \n    // Keyword categorization\n    let keywordType = 'Long-tail';\n    if (keyword.query.split(' ').length <= 2) keywordType = 'Short-tail';\n    else if (keyword.query.split(' ').length === 3) keywordType = 'Medium-tail';\n    \n    // Performance assessment\n    let keywordStatus = 'Monitor';\n    if (keyword.position <= 3 && keyword.clicks > 10) keywordStatus = 'Top Performer';\n    else if (keyword.position <= 10 && keyword.ctr > 0.05) keywordStatus = 'Strong Performer';\n    else if (keyword.position > 10 && keyword.position <= 20 && keyword.impressions > 100) keywordStatus = 'Opportunity';\n    else if (keyword.impressions > 500 && keyword.ctr < 0.02) keywordStatus = 'CTR Issue';\n    \n    // Specific action items per keyword\n    let keywordAction = 'Monitor performance';\n    if (keyword.position > 10 && keyword.position <= 20 && keyword.impressions > 200) {\n      keywordAction = 'Optimize content for this keyword - close to page 1';\n    } else if (keyword.impressions > 1000 && keyword.ctr < 0.015) {\n      keywordAction = 'Improve title/meta - high visibility, low CTR';\n    } else if (keyword.position <= 5 && keyword.ctr < 0.08) {\n      keywordAction = 'Enhance snippet appeal - good position, poor CTR';\n    } else if (keyword.clicks > 50) {\n      keywordAction = 'Maintain and expand - money keyword';\n    }\n    \n    return {\n      keywordRank: index + 1,\n      query: keyword.query,\n      clicks: keyword.clicks,\n      impressions: keyword.impressions,\n      ctr: keyword.ctrFormatted,\n      position: keyword.positionRounded,\n      clickShare: `${clickShare}%`,\n      impressionShare: `${impressionShare}%`,\n      keywordType: keywordType,\n      keywordStatus: keywordStatus,\n      keywordAction: keywordAction\n    };\n  });\n  \n  // Page summary with top keywords\n  const topKeywords = processedKeywords.slice(0, 5).map(k => k.query).join(', ');\n  const avgPosition = (pageData.keywords.reduce((sum, k) => sum + k.position, 0) / pageData.keywords.length).toFixed(1);\n  const avgCTR = ((pageData.totalClicks / pageData.totalImpressions) * 100).toFixed(2);\n  \n  result.push({\n    page: pageData.page,\n    totalClicks: pageData.totalClicks,\n    totalImpressions: pageData.totalImpressions,\n    avgPosition: parseFloat(avgPosition),\n    avgCTR: `${avgCTR}%`,\n    keywordCount: pageData.keywords.length,\n    topKeywords: topKeywords,\n    keywords: processedKeywords\n  });\n});\n\n// Sort pages by total clicks\nreturn result.sort((a, b) => b.totalClicks - a.totalClicks);"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            340,
            -200
          ],
          "id": "64b2aa1f-5f13-4023-9d9d-782e43cfd89c",
          "name": "Parse Keyword Analysis by Pages"
        },
        {
          "parameters": {
            "content": "## Keyword Analysis by Pages",
            "height": 240,
            "width": 480
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            60,
            -260
          ],
          "id": "a478ea9a-839f-454d-a37e-021edb955f76",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"query\", \"page\"],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            660,
            580
          ],
          "id": "a8364bf9-3255-4d11-b665-80d7e696cb0f",
          "name": "Get Keyword Cannibalization Detection",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "content": "## Keyword Cannibalization Analysis\n",
            "height": 240,
            "width": 460
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            600,
            520
          ],
          "id": "b4b249a7-a314-4e50-bb34-d1abd5bc9018",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "jsCode": "// Combine all paginated responses\nconst allResponses = $input.all();\nconst combinedRows = [];\n\nallResponses.forEach(response => {\n  if (response.json.rows && response.json.rows.length > 0) {\n    combinedRows.push(...response.json.rows);\n  }\n});\n\n// Group by query to find cannibalization\nconst queryGroups = {};\n\ncombinedRows.forEach(row => {\n  const query = row.keys[0];\n  const page = row.keys[1];\n  \n  if (!queryGroups[query]) {\n    queryGroups[query] = {\n      query: query,\n      pages: [],\n      totalClicks: 0,\n      totalImpressions: 0,\n      pageCount: 0\n    };\n  }\n  \n  queryGroups[query].pages.push({\n    page: page,\n    clicks: row.clicks,\n    impressions: row.impressions,\n    ctr: row.ctr,\n    position: row.position,\n    ctrFormatted: `${(row.ctr * 100).toFixed(2)}%`,\n    positionRounded: Math.round(row.position * 10) / 10\n  });\n  \n  queryGroups[query].totalClicks += row.clicks;\n  queryGroups[query].totalImpressions += row.impressions;\n  queryGroups[query].pageCount += 1;\n});\n\n// Identify cannibalization cases\nconst cannibalizationIssues = [];\nconst healthyKeywords = [];\n\nObject.values(queryGroups).forEach(queryData => {\n  // Sort pages by performance for this query\n  queryData.pages.sort((a, b) => b.clicks - a.clicks);\n  \n  if (queryData.pageCount > 1) {\n    // Multiple pages competing for same keyword\n    const topPage = queryData.pages[0];\n    const competingPages = queryData.pages.slice(1);\n    \n    // Calculate cannibalization severity\n    const topPageClicks = topPage.clicks;\n    const competingClicks = competingPages.reduce((sum, page) => sum + page.clicks, 0);\n    const clicksDistribution = competingClicks > 0 ? (competingClicks / queryData.totalClicks * 100).toFixed(1) : 0;\n    \n    // Determine severity level\n    let severity = 'Low';\n    let issue = 'Minor cannibalization';\n    let recommendation = 'Monitor performance';\n    \n    if (queryData.pageCount >= 5) {\n      severity = 'Critical';\n      issue = 'Severe cannibalization - too many competing pages';\n      recommendation = 'Consolidate content or implement canonical tags';\n    } else if (queryData.pageCount >= 3 && parseFloat(clicksDistribution) > 30) {\n      severity = 'High';\n      issue = 'Significant traffic split across multiple pages';\n      recommendation = 'Merge similar content or redirect weaker pages';\n    } else if (queryData.pageCount === 2 && parseFloat(clicksDistribution) > 40) {\n      severity = 'Medium';\n      issue = 'Two pages splitting traffic significantly';\n      recommendation = 'Optimize page targeting or consolidate';\n    }\n    \n    // Check for position confusion (pages flip-flopping)\n    const positionSpread = Math.max(...queryData.pages.map(p => p.position)) - \n                          Math.min(...queryData.pages.map(p => p.position));\n    \n    if (positionSpread > 20) {\n      severity = severity === 'Low' ? 'Medium' : severity;\n      issue += ' - wide position spread indicates confusion';\n    }\n    \n    // Calculate potential impact\n    const bestPosition = Math.min(...queryData.pages.map(p => p.position));\n    const worstPosition = Math.max(...queryData.pages.map(p => p.position));\n    \n    cannibalizationIssues.push({\n      query: queryData.query,\n      severity: severity,\n      issue: issue,\n      recommendation: recommendation,\n      pageCount: queryData.pageCount,\n      totalClicks: queryData.totalClicks,\n      totalImpressions: queryData.totalImpressions,\n      clicksDistribution: `${clicksDistribution}%`,\n      bestPosition: Math.round(bestPosition * 10) / 10,\n      worstPosition: Math.round(worstPosition * 10) / 10,\n      positionSpread: Math.round(positionSpread * 10) / 10,\n      topPerformer: {\n        page: topPage.page,\n        clicks: topPage.clicks,\n        position: topPage.positionRounded,\n        ctr: topPage.ctrFormatted\n      },\n      competingPages: competingPages.map(page => ({\n        page: page.page,\n        clicks: page.clicks,\n        position: page.positionRounded,\n        ctr: page.ctrFormatted,\n        clickShare: `${((page.clicks / queryData.totalClicks) * 100).toFixed(1)}%`\n      }))\n    });\n  } else {\n    // Single page for keyword - healthy\n    const page = queryData.pages[0];\n    if (queryData.totalClicks > 10) { // Only include meaningful keywords\n      healthyKeywords.push({\n        query: queryData.query,\n        page: page.page,\n        clicks: page.clicks,\n        impressions: page.impressions,\n        position: page.positionRounded,\n        ctr: page.ctrFormatted,\n        status: 'Healthy - Single page targeting'\n      });\n    }\n  }\n});\n\n// Sort by severity and impact\ncannibalizationIssues.sort((a, b) => {\n  const severityOrder = { 'Critical': 4, 'High': 3, 'Medium': 2, 'Low': 1 };\n  if (severityOrder[a.severity] !== severityOrder[b.severity]) {\n    return severityOrder[b.severity] - severityOrder[a.severity];\n  }\n  return b.totalClicks - a.totalClicks; // Then by traffic impact\n});\n\n// Summary statistics\nconst summary = {\n  totalKeywords: Object.keys(queryGroups).length,\n  cannibalizationIssues: cannibalizationIssues.length,\n  healthyKeywords: healthyKeywords.length,\n  criticalIssues: cannibalizationIssues.filter(issue => issue.severity === 'Critical').length,\n  highIssues: cannibalizationIssues.filter(issue => issue.severity === 'High').length,\n  mediumIssues: cannibalizationIssues.filter(issue => issue.severity === 'Medium').length,\n  lowIssues: cannibalizationIssues.filter(issue => issue.severity === 'Low').length,\n  cannibalizationRate: `${((cannibalizationIssues.length / Object.keys(queryGroups).length) * 100).toFixed(1)}%`\n};\n\nreturn {\n  summary: summary,\n  cannibalizationIssues: cannibalizationIssues,\n  healthyKeywords: healthyKeywords.slice(0, 50) // Top 50 healthy keywords\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            860,
            580
          ],
          "id": "a73552d8-afc0-421e-befc-3f0fff6c7513",
          "name": "Parse Keyword Cannibalization Detection"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"query\"],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -400,
            600
          ],
          "id": "dbfd4cd0-40c7-4902-b8af-e36dd196e87c",
          "name": "Get Content Gap Analysis",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows;\n\n// Analyze queries for content gaps\nconst contentGaps = rows\n  .filter(row => {\n    // Filter criteria for content gaps:\n    // 1. High impressions (people are searching)\n    // 2. Poor position (we're not ranking well)\n    // 3. Low clicks (not getting traffic despite visibility)\n    return row.impressions > 100 && \n           row.position > 20 && \n           row.clicks < 10;\n  })\n  .map(row => {\n    const query = row.keys[0];\n    const searchVolume = row.impressions;\n    const currentPosition = Math.round(row.position * 10) / 10;\n    const missedClicks = Math.round(searchVolume * 0.05); // Potential clicks at decent position\n    \n    // Categorize gap severity\n    let gapSeverity = 'Low';\n    let opportunity = 'Minor opportunity';\n    let recommendation = 'Monitor and optimize existing content';\n    \n    if (searchVolume > 5000 && currentPosition > 50) {\n      gapSeverity = 'Critical';\n      opportunity = 'High-volume keyword with very poor ranking';\n      recommendation = 'Create dedicated content or major content overhaul';\n    } else if (searchVolume > 1000 && currentPosition > 30) {\n      gapSeverity = 'High';\n      opportunity = 'Good search volume with poor visibility';\n      recommendation = 'Optimize existing content or create new targeted page';\n    } else if (searchVolume > 500 && currentPosition > 25) {\n      gapSeverity = 'Medium';\n      opportunity = 'Decent search volume, needs content improvement';\n      recommendation = 'Enhance existing content with better keyword targeting';\n    }\n    \n    // Analyze query intent and type\n    const queryWords = query.toLowerCase().split(' ');\n    let queryIntent = 'Informational';\n    let queryType = 'Long-tail';\n    \n    // Intent detection\n    if (queryWords.some(word => ['buy', 'purchase', 'price', 'cost', 'cheap'].includes(word))) {\n      queryIntent = 'Commercial';\n    } else if (queryWords.some(word => ['how', 'what', 'why', 'when', 'where'].includes(word))) {\n      queryIntent = 'Informational';\n    } else if (queryWords.some(word => ['best', 'top', 'review', 'compare'].includes(word))) {\n      queryIntent = 'Commercial Investigation';\n    } else if (queryWords.length <= 2) {\n      queryIntent = 'Navigational';\n    }\n    \n    // Query type\n    if (queryWords.length <= 2) queryType = 'Short-tail';\n    else if (queryWords.length === 3) queryType = 'Medium-tail';\n    \n    return {\n      query: query,\n      currentPosition: currentPosition,\n      impressions: searchVolume,\n      clicks: row.clicks,\n      ctr: `${(row.ctr * 100).toFixed(2)}%`,\n      gapSeverity: gapSeverity,\n      opportunity: opportunity,\n      recommendation: recommendation,\n      missedClicksPotential: missedClicks,\n      queryIntent: queryIntent,\n      queryType: queryType,\n      competitorAdvantage: currentPosition > 30 ? 'High' : currentPosition > 20 ? 'Medium' : 'Low'\n    };\n  })\n  .sort((a, b) => {\n    // Sort by severity first, then by missed potential\n    const severityOrder = { 'Critical': 4, 'High': 3, 'Medium': 2, 'Low': 1 };\n    if (severityOrder[a.gapSeverity] !== severityOrder[b.gapSeverity]) {\n      return severityOrder[b.gapSeverity] - severityOrder[a.gapSeverity];\n    }\n    return b.missedClicksPotential - a.missedClicksPotential;\n  });\n\n// Summary statistics\nconst gapSummary = {\n  totalGaps: contentGaps.length,\n  criticalGaps: contentGaps.filter(gap => gap.gapSeverity === 'Critical').length,\n  highGaps: contentGaps.filter(gap => gap.gapSeverity === 'High').length,\n  mediumGaps: contentGaps.filter(gap => gap.gapSeverity === 'Medium').length,\n  totalMissedPotential: contentGaps.reduce((sum, gap) => sum + gap.missedClicksPotential, 0),\n  topOpportunityQueries: contentGaps.slice(0, 10).map(gap => gap.query)\n};\n\nreturn {\n  summary: gapSummary,\n  contentGaps: contentGaps\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -160,
            600
          ],
          "id": "7d371aba-2f68-4a0e-a8b6-70a27582fe57",
          "name": "Parse Content Gap Analysis"
        },
        {
          "parameters": {
            "content": "## Content Gap Analysis\n",
            "height": 240,
            "width": 500
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            520
          ],
          "id": "133bf6a3-9dd5-4559-ad42-69ac1053f771",
          "name": "Sticky Note5"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-01-26\",\n  \"endDate\": \"2025-02-26\",\n  \"dimensions\": [\"query\", \"page\"],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            120,
            580
          ],
          "id": "d195381f-2a0d-4c81-92c2-164a4cc91031",
          "name": "Get Keyword Opportunities Analysis",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows;\n\n// Process emerging keywords with their specific pages\nconst emergingKeywords = rows\n  .filter(row => {\n    // Filter criteria for emerging opportunities:\n    // 1. Recently started ranking (position 10-50)\n    // 2. Decent search volume\n    // 3. Improving performance indicators\n    return row.position >= 10 && \n           row.position <= 50 && \n           row.impressions > 50 &&\n           row.clicks >= 0;\n  })\n  .map(row => {\n    const query = row.keys[0];\n    const page = row.keys[1];\n    const currentPosition = Math.round(row.position * 10) / 10;\n    const impressions = row.impressions;\n    const clicks = row.clicks;\n    \n    // Calculate opportunity potential\n    let opportunityLevel = 'Monitor';\n    let potentialImpact = 'Low';\n    let pageOptimization = 'Basic monitoring';\n    let specificActions = [];\n    \n    if (currentPosition <= 20 && impressions > 500) {\n      opportunityLevel = 'High Priority';\n      potentialImpact = 'High';\n      pageOptimization = 'Immediate content optimization required';\n      specificActions = [\n        'Optimize title tag to include target keyword',\n        'Enhance meta description for better CTR',\n        'Add keyword to H1 and H2 headers',\n        'Increase content depth and relevance',\n        'Build internal links to this page'\n      ];\n    } else if (currentPosition <= 30 && impressions > 200) {\n      opportunityLevel = 'Medium Priority';\n      potentialImpact = 'Medium';\n      pageOptimization = 'Content optimization and technical improvements';\n      specificActions = [\n        'Review and optimize existing content',\n        'Add related keywords and semantic terms',\n        'Improve internal linking structure',\n        'Check page loading speed',\n        'Enhance user experience signals'\n      ];\n    } else if (currentPosition <= 50 && impressions > 100) {\n      opportunityLevel = 'Low Priority';\n      potentialImpact = 'Low';\n      pageOptimization = 'Basic content improvements';\n      specificActions = [\n        'Add keyword mentions naturally in content',\n        'Improve content structure and readability',\n        'Monitor performance trends',\n        'Consider content expansion'\n      ];\n    }\n    \n    // Analyze query characteristics\n    const queryWords = query.toLowerCase().split(' ');\n    let queryIntent = 'Informational';\n    let competitionLevel = 'Medium';\n    \n    // Intent detection\n    if (queryWords.some(word => ['buy', 'purchase', 'price', 'cost'].includes(word))) {\n      queryIntent = 'Commercial';\n      competitionLevel = 'High';\n    } else if (queryWords.some(word => ['how', 'what', 'guide', 'tutorial'].includes(word))) {\n      queryIntent = 'Informational';\n      competitionLevel = 'Medium';\n    } else if (queryWords.some(word => ['best', 'top', 'review', 'vs'].includes(word))) {\n      queryIntent = 'Commercial Investigation';\n      competitionLevel = 'High';\n    }\n    \n    // Page-specific analysis using string manipulation\n    const pagePath = page.split('://')[1] ? page.split('://')[1].split('/').slice(1).join('/') : page;\n    const pageType = pagePath.includes('blog/') ? 'Blog Post' :\n                    pagePath.includes('product/') ? 'Product Page' :\n                    pagePath.includes('category/') ? 'Category Page' :\n                    pagePath === '' || pagePath === '/' ? 'Homepage' : 'Content Page';\n    \n    // Content-keyword alignment check\n    const queryInUrl = queryWords.some(word => \n      pagePath.toLowerCase().includes(word.toLowerCase())\n    );\n    \n    let contentAlignment = 'Good';\n    if (!queryInUrl && queryWords.length <= 3) {\n      contentAlignment = 'Poor - URL doesn\\'t match target keyword';\n      specificActions.unshift('Consider URL optimization or content realignment');\n    } else if (!queryInUrl) {\n      contentAlignment = 'Fair - Could improve keyword-URL alignment';\n    }\n    \n    return {\n      query: query,\n      page: page,\n      pageType: pageType,\n      currentPosition: currentPosition,\n      impressions: impressions,\n      clicks: clicks,\n      ctr: `${(row.ctr * 100).toFixed(2)}%`,\n      opportunityLevel: opportunityLevel,\n      potentialImpact: potentialImpact,\n      pageOptimization: pageOptimization,\n      specificActions: specificActions,\n      queryIntent: queryIntent,\n      competitionLevel: competitionLevel,\n      contentAlignment: contentAlignment,\n      queryType: queryWords.length <= 2 ? 'Short-tail' : \n                 queryWords.length === 3 ? 'Medium-tail' : 'Long-tail',\n      priorityScore: (impressions / 100) + (51 - currentPosition) // Custom scoring\n    };\n  })\n  .sort((a, b) => {\n    // Sort by opportunity level, then by priority score\n    const priorityOrder = { 'High Priority': 3, 'Medium Priority': 2, 'Low Priority': 1, 'Monitor': 0 };\n    if (priorityOrder[a.opportunityLevel] !== priorityOrder[b.opportunityLevel]) {\n      return priorityOrder[b.opportunityLevel] - priorityOrder[a.opportunityLevel];\n    }\n    return b.priorityScore - a.priorityScore;\n  });\n\n// Group by page for easier optimization planning\nconst pageOptimizationPlan = {};\nemergingKeywords.forEach(keyword => {\n  if (!pageOptimizationPlan[keyword.page]) {\n    pageOptimizationPlan[keyword.page] = {\n      page: keyword.page,\n      pageType: keyword.pageType,\n      keywordOpportunities: [],\n      totalImpressions: 0,\n      highPriorityKeywords: 0,\n      overallPriority: 'Low'\n    };\n  }\n  \n  pageOptimizationPlan[keyword.page].keywordOpportunities.push({\n    query: keyword.query,\n    currentPosition: keyword.currentPosition,\n    impressions: keyword.impressions,\n    opportunityLevel: keyword.opportunityLevel,\n    specificActions: keyword.specificActions\n  });\n  \n  pageOptimizationPlan[keyword.page].totalImpressions += keyword.impressions;\n  \n  if (keyword.opportunityLevel === 'High Priority') {\n    pageOptimizationPlan[keyword.page].highPriorityKeywords += 1;\n    pageOptimizationPlan[keyword.page].overallPriority = 'High';\n  } else if (keyword.opportunityLevel === 'Medium Priority' && \n             pageOptimizationPlan[keyword.page].overallPriority !== 'High') {\n    pageOptimizationPlan[keyword.page].overallPriority = 'Medium';\n  }\n});\n\n// Convert to array and sort by priority\nconst pageOptimizationArray = Object.values(pageOptimizationPlan)\n  .sort((a, b) => {\n    const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };\n    if (priorityOrder[a.overallPriority] !== priorityOrder[b.overallPriority]) {\n      return priorityOrder[b.overallPriority] - priorityOrder[a.overallPriority];\n    }\n    return b.totalImpressions - a.totalImpressions;\n  });\n\n// Summary statistics\nconst opportunitySummary = {\n  totalOpportunities: emergingKeywords.length,\n  totalPagesToOptimize: Object.keys(pageOptimizationPlan).length,\n  highPriorityPages: pageOptimizationArray.filter(page => page.overallPriority === 'High').length,\n  mediumPriorityPages: pageOptimizationArray.filter(page => page.overallPriority === 'Medium').length,\n  quickWins: emergingKeywords.filter(kw => kw.currentPosition <= 20).length,\n  commercialOpportunities: emergingKeywords.filter(kw => kw.queryIntent === 'Commercial').length\n};\n\nreturn {\n  summary: opportunitySummary,\n  emergingKeywords: emergingKeywords,\n  pageOptimizationPlan: pageOptimizationArray\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            340,
            580
          ],
          "id": "01f911b8-4170-474f-aa7a-42e59999d4de",
          "name": "Parse Keyword Opportunities Analysis"
        },
        {
          "parameters": {
            "content": "## Keyword Opportunities Analysis\n",
            "height": 240,
            "width": 520
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            60,
            520
          ],
          "id": "08a48dc8-d7a8-44c4-9650-7e92174c0cec",
          "name": "Sticky Note6"
        },
        {
          "parameters": {
            "content": "## Keywords Ranking 4-10\n",
            "height": 240,
            "width": 480
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            560,
            0
          ],
          "id": "60ac93e8-ff43-49a5-9808-2467e8a79de4",
          "name": "Sticky Note7"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-01-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"query\", \"date\"],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            120,
            60
          ],
          "id": "9f959a20-6552-42c3-a789-9c3ec20e3f90",
          "name": "Get Query Performance Drop Detection",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows || [];\n\n// Define comparison periods (adjust dates as needed)\nconst currentPeriodStart = \"2025-03-01\";\nconst currentPeriodEnd = \"2025-03-26\";\nconst previousPeriodStart = \"2025-02-01\"; \nconst previousPeriodEnd = \"2025-02-28\";\n\n// Group data by query and period\nconst queryData = {};\n\nrows.forEach(row => {\n  const query = row.keys[0];\n  const date = row.keys[1];\n  \n  if (!queryData[query]) {\n    queryData[query] = {\n      current: { clicks: 0, impressions: 0, positions: [], dates: 0 },\n      previous: { clicks: 0, impressions: 0, positions: [], dates: 0 }\n    };\n  }\n  \n  // Determine which period this data belongs to\n  if (date >= currentPeriodStart && date <= currentPeriodEnd) {\n    queryData[query].current.clicks += parseInt(row.clicks);\n    queryData[query].current.impressions += parseInt(row.impressions);\n    queryData[query].current.positions.push(parseFloat(row.position));\n    queryData[query].current.dates++;\n  } else if (date >= previousPeriodStart && date <= previousPeriodEnd) {\n    queryData[query].previous.clicks += parseInt(row.clicks);\n    queryData[query].previous.impressions += parseInt(row.impressions);\n    queryData[query].previous.positions.push(parseFloat(row.position));\n    queryData[query].previous.dates++;\n  }\n});\n\n// Calculate averages and detect drops with dynamic thresholds\nreturn Object.entries(queryData)\n  .filter(([query, data]) => {\n    // Only include queries with data in both periods and minimum volume\n    return data.current.dates > 0 && \n           data.previous.dates > 0 && \n           data.previous.impressions >= 100; // Higher minimum threshold\n  })\n  .map(([query, data]) => {\n    // Calculate average positions\n    const currentAvgPosition = data.current.positions.length > 0 \n      ? data.current.positions.reduce((a, b) => a + b, 0) / data.current.positions.length \n      : 0;\n    const previousAvgPosition = data.previous.positions.length > 0 \n      ? data.previous.positions.reduce((a, b) => a + b, 0) / data.previous.positions.length \n      : 0;\n    \n    // Calculate CTRs\n    const currentCTR = data.current.impressions > 0 \n      ? (data.current.clicks / data.current.impressions) * 100 \n      : 0;\n    const previousCTR = data.previous.impressions > 0 \n      ? (data.previous.clicks / data.previous.impressions) * 100 \n      : 0;\n    \n    // Calculate percentage changes\n    const clicksChange = data.previous.clicks > 0 \n      ? ((data.current.clicks - data.previous.clicks) / data.previous.clicks) * 100 \n      : 0;\n    const impressionsChange = data.previous.impressions > 0 \n      ? ((data.current.impressions - data.previous.impressions) / data.previous.impressions) * 100 \n      : 0;\n    const positionChange = previousAvgPosition > 0 \n      ? currentAvgPosition - previousAvgPosition \n      : 0;\n    \n    // Calculate absolute changes for dynamic thresholds\n    const absoluteClicksChange = data.current.clicks - data.previous.clicks;\n    const absoluteImpressionsChange = data.current.impressions - data.previous.impressions;\n    \n    return {\n      query: query,\n      // Previous period data\n      previousClicks: data.previous.clicks,\n      previousImpressions: data.previous.impressions,\n      previousPosition: Math.round(previousAvgPosition * 10) / 10,\n      previousCTR: Math.round(previousCTR * 10) / 10,\n      // Current period data  \n      currentClicks: data.current.clicks,\n      currentImpressions: data.current.impressions,\n      currentPosition: Math.round(currentAvgPosition * 10) / 10,\n      currentCTR: Math.round(currentCTR * 10) / 10,\n      // Changes\n      clicksChange: Math.round(clicksChange * 10) / 10,\n      impressionsChange: Math.round(impressionsChange * 10) / 10,\n      positionChange: Math.round(positionChange * 10) / 10,\n      ctrChange: Math.round((currentCTR - previousCTR) * 10) / 10,\n      // Absolute changes for filtering\n      absoluteClicksChange: absoluteClicksChange,\n      absoluteImpressionsChange: absoluteImpressionsChange\n    };\n  })\n  .filter(row => {\n    // Dynamic thresholds based on volume\n    const previousClicks = row.previousClicks;\n    const previousImpressions = row.previousImpressions;\n    \n    // Define volume-based thresholds\n    let clicksThreshold, impressionsThreshold, positionThreshold;\n    \n    if (previousClicks >= 100) {\n      // High volume: stricter percentage, lower absolute threshold\n      clicksThreshold = row.clicksChange <= -15 && row.absoluteClicksChange <= -10;\n    } else if (previousClicks >= 20) {\n      // Medium volume: moderate thresholds\n      clicksThreshold = row.clicksChange <= -25 && row.absoluteClicksChange <= -5;\n    } else if (previousClicks >= 5) {\n      // Low volume: focus on absolute change\n      clicksThreshold = row.absoluteClicksChange <= -3;\n    } else {\n      // Very low volume: ignore percentage, focus on meaningful absolute drops\n      clicksThreshold = row.absoluteClicksChange <= -2 && previousClicks >= 3;\n    }\n    \n    // Similar logic for impressions\n    if (previousImpressions >= 1000) {\n      impressionsThreshold = row.impressionsChange <= -15 && row.absoluteImpressionsChange <= -100;\n    } else if (previousImpressions >= 500) {\n      impressionsThreshold = row.impressionsChange <= -20 && row.absoluteImpressionsChange <= -50;\n    } else {\n      impressionsThreshold = row.impressionsChange <= -25 && row.absoluteImpressionsChange <= -25;\n    }\n    \n    // Position threshold (always meaningful if 1.5+ positions drop)\n    positionThreshold = row.positionChange >= 1.5;\n    \n    return clicksThreshold || impressionsThreshold || positionThreshold;\n  })\n  .sort((a, b) => {\n    // Sort by impact score: combine absolute change with percentage for prioritization\n    const impactA = Math.abs(a.absoluteClicksChange) * (Math.abs(a.clicksChange) / 100);\n    const impactB = Math.abs(b.absoluteClicksChange) * (Math.abs(b.clicksChange) / 100);\n    return impactB - impactA;\n  });"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            320,
            60
          ],
          "id": "c65886ee-10ca-429d-91d5-8b21d0683f0c",
          "name": "Parse Query Performance Drop Detection"
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows || [];\n\n// Group by query+page and get the most recent position for each\nconst latestPositions = {};\n\nrows.forEach(row => {\n  const query = row.keys[0];\n  const page = row.keys[1];\n  const date = row.keys[2]; // Date dimension\n  const key = `${query}|${page}`;\n  \n  // Keep only the most recent date for each query+page combination\n  if (!latestPositions[key] || date > latestPositions[key].date) {\n    latestPositions[key] = {\n      query,\n      page,\n      date,\n      position: parseFloat(row.position),\n      clicks: parseInt(row.clicks),\n      impressions: parseInt(row.impressions),\n      ctr: parseFloat(row.ctr)\n    };\n  }\n});\n\n// Convert to array, filter for positions 4-10\nreturn Object.values(latestPositions)\n  .filter(row => {\n    const position = row.position;\n    return position >= 4 && position <= 10 && row.impressions >= 10;\n  })\n  .map(row => {\n    return {\n      query: row.query,\n      page: row.page,\n      lastDate: row.date,\n      currentPosition: Math.round(row.position * 10) / 10,\n      clicks: row.clicks,\n      impressions: row.impressions,\n      ctr: Math.round(row.ctr * 1000) / 10 // Convert to percentage with 1 decimal\n    };\n  })\n  .sort((a, b) => b.impressions - a.impressions); // Sort by highest impressions first"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            820,
            60
          ],
          "id": "5f3c8059-1ff8-40c8-977c-1e4f69831ff0",
          "name": "Parse Keywords Ranking 4-10"
        },
        {
          "parameters": {
            "content": "## Query Performance Drop Detection\n",
            "height": 240,
            "width": 480
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            60,
            0
          ],
          "id": "771a833e-0e32-4c1b-895d-334e9f169196",
          "name": "Sticky Note8"
        },
        {
          "parameters": {
            "content": "## Get Queries by Period\n",
            "height": 240,
            "width": 500
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            0
          ],
          "id": "54faee61-66d5-49e2-96a7-0c20c44e1e6b",
          "name": "Sticky Note9"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"query\"],\n  \"dimensionFilterGroups\": [{\n    \"filters\": [{\n      \"dimension\": \"page\",\n      \"operator\": \"equals\",\n      \"expression\": \"https://your-domain.com/slug/\"\n    }]\n  }],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -400,
            80
          ],
          "id": "c7081520-a1b8-45a5-983c-9bfc6e42e056",
          "name": " Get Queries by Period",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows || $input.item.json;\n\n// Map each row to a cleaner format\nreturn rows.map(row => {\n  return {\n    query: row.keys[0],\n    clicks: row.clicks,\n    impressions: row.impressions,\n    ctr: row.ctr,\n    position: row.position\n  };\n});"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -200,
            80
          ],
          "id": "7eddae09-b55b-40f3-a867-c13aebb75fe6",
          "name": "Parse Queries by Period"
        },
        {
          "parameters": {
            "content": "## Get Queries by Day\n\n",
            "height": 240,
            "width": 500
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -460,
            -260
          ],
          "id": "59b2d2bb-8564-4e6b-b6ea-117a38aa3fef",
          "name": "Sticky Note10"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"query\", \"date\"],\n  \"dimensionFilterGroups\": [{\n    \"filters\": [{\n      \"dimension\": \"page\",\n      \"operator\": \"equals\",\n      \"expression\": \"https://your-domain.com/slug/\"\n    }]\n  }],\n  \"rowLimit\": 10000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -400,
            -180
          ],
          "id": "7db5f524-23c1-4fe8-891c-5c5f5d17d419",
          "name": "Get Queries by Day",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows || $input.item.json;\n\n// Map each row to a cleaner format with query, date and metrics\nreturn rows.map(row => {\n  return {\n    query: row.keys[0],\n    date: row.keys[1],\n    clicks: row.clicks,\n    impressions: row.impressions,\n    ctr: row.ctr,\n    position: row.position\n  };\n});"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -200,
            -180
          ],
          "id": "7c5c7b57-e11a-4ef2-9128-41bf0fbae6d3",
          "name": "Parse Queries by Day"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-02-26\",\n  \"endDate\": \"2025-03-26\",\n  \"dimensions\": [\"query\", \"page\", \"date\"],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            620,
            60
          ],
          "id": "178f7e22-8596-4540-b092-23a62894f0fb",
          "name": "Get Keywords Ranking 4-10",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "content": "## Brand Visibility Analysis",
            "height": 240,
            "width": 480
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            780,
            260
          ],
          "id": "0ef4efc8-3283-4748-9feb-0257d5419e4e",
          "name": "Sticky Note11"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://searchconsole.googleapis.com/webmasters/v3/sites/sc-domain:your-domain.com/searchAnalytics/query",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "googleOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"startDate\": \"2025-05-01\",\n  \"endDate\": \"2025-06-17\",\n  \"dimensions\": [\"query\"],\n  \"rowLimit\": 25000\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            840,
            320
          ],
          "id": "43cf54bf-3c44-4872-ad40-aaf6de887348",
          "name": "Get Brand Visibility Analysis",
          "credentials": {
            "googleOAuth2Api": {
              "id": "R0UFaLH10cOpcIL4",
              "name": "Google account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const rows = $input.item.json.rows || [];\n\n// Define brand terms for regex (adjust to your brand)\nconst brandTerms = ['midjourney'];\n\n// Create regex pattern that matches any brand term (case insensitive)\nconst brandRegex = new RegExp(brandTerms.join('|'), 'i');\n\n// Initialize data structures\nlet brandData = {\n  clicks: 0,\n  impressions: 0,\n  positionSum: 0,\n  queries: []\n};\n\nlet nonBrandData = {\n  clicks: 0,\n  impressions: 0,\n  positionSum: 0,\n  queries: []\n};\n\n// Process each row\nrows.forEach(row => {\n  const query = row.keys[0];\n  const clicks = parseInt(row.clicks);\n  const impressions = parseInt(row.impressions);\n  const position = parseFloat(row.position);\n  const ctr = parseFloat(row.ctr);\n  \n  const queryData = {\n    query: query,\n    clicks: clicks,\n    impressions: impressions,\n    position: Math.round(position * 10) / 10,\n    ctr: Math.round(ctr * 1000) / 10\n  };\n  \n  // Check if query matches brand regex\n  const brandMatch = query.match(brandRegex);\n  \n  if (brandMatch) {\n    // Brand query - add match details\n    queryData.matchedBrandTerm = brandMatch[0];\n    queryData.matchIndex = brandMatch.index;\n    \n    brandData.clicks += clicks;\n    brandData.impressions += impressions;\n    brandData.positionSum += (position * impressions);\n    brandData.queries.push(queryData);\n  } else {\n    // Non-brand query\n    nonBrandData.clicks += clicks;\n    nonBrandData.impressions += impressions;\n    nonBrandData.positionSum += (position * impressions);\n    nonBrandData.queries.push(queryData);\n  }\n});\n\n// Calculate averages\nconst brandAvgPosition = brandData.impressions > 0 \n  ? Math.round((brandData.positionSum / brandData.impressions) * 10) / 10 \n  : 0;\n\nconst nonBrandAvgPosition = nonBrandData.impressions > 0 \n  ? Math.round((nonBrandData.positionSum / nonBrandData.impressions) * 10) / 10 \n  : 0;\n\nconst brandCTR = brandData.impressions > 0 \n  ? Math.round((brandData.clicks / brandData.impressions) * 1000) / 10 \n  : 0;\n\nconst nonBrandCTR = nonBrandData.impressions > 0 \n  ? Math.round((nonBrandData.clicks / nonBrandData.impressions) * 1000) / 10 \n  : 0;\n\n// Calculate totals for percentages\nconst totalClicks = brandData.clicks + nonBrandData.clicks;\nconst totalImpressions = brandData.impressions + nonBrandData.impressions;\n\n// Sort queries by performance\nbrandData.queries.sort((a, b) => b.clicks - a.clicks);\nnonBrandData.queries.sort((a, b) => b.clicks - a.clicks);\n\n// Analyze brand query patterns\nconst brandQueryAnalysis = {\n  totalBrandQueries: brandData.queries.length,\n  uniqueBrandTermsFound: [...new Set(brandData.queries.map(q => q.matchedBrandTerm.toLowerCase()))],\n  topBrandQueries: brandData.queries.slice(0, 10),\n  brandQueriesWithHighImpressions: brandData.queries.filter(q => q.impressions >= 100),\n  brandQueriesWithLowCTR: brandData.queries.filter(q => q.ctr < 50 && q.impressions >= 10) // Brand queries should have high CTR\n};\n\n// Check for brand visibility issues\nconst brandVisibilityIssues = {\n  lowRankingBrandQueries: brandData.queries.filter(q => q.position > 3 && q.impressions >= 10),\n  brandQueriesNotRanking1: brandData.queries.filter(q => q.position > 1 && q.impressions >= 50)\n};\n\n// Return detailed analysis\nreturn [{\n  // Summary metrics\n  summary: {\n    brandClicks: brandData.clicks,\n    brandImpressions: brandData.impressions,\n    brandAvgPosition: brandAvgPosition,\n    brandCTR: brandCTR,\n    brandClickShare: totalClicks > 0 ? Math.round((brandData.clicks / totalClicks) * 100) : 0,\n    \n    nonBrandClicks: nonBrandData.clicks,\n    nonBrandImpressions: nonBrandData.impressions,\n    nonBrandAvgPosition: nonBrandAvgPosition,\n    nonBrandCTR: nonBrandCTR,\n    nonBrandClickShare: totalClicks > 0 ? Math.round((nonBrandData.clicks / totalClicks) * 100) : 0,\n    \n    // Key insights\n    positionGap: Math.round((nonBrandAvgPosition - brandAvgPosition) * 10) / 10,\n    ctrGap: Math.round((brandCTR - nonBrandCTR) * 10) / 10,\n    diversificationRatio: brandData.clicks > 0 ? Math.round((nonBrandData.clicks / brandData.clicks) * 100) / 100 : 0\n  },\n  \n  // Brand analysis details\n  brandAnalysis: {\n    totalBrandQueries: brandQueryAnalysis.totalBrandQueries,\n    uniqueBrandTermsFound: brandQueryAnalysis.uniqueBrandTermsFound,\n    brandQueriesWithHighVolume: brandQueryAnalysis.brandQueriesWithHighImpressions.length,\n    brandQueriesWithLowCTR: brandQueryAnalysis.brandQueriesWithLowCTR.length\n  },\n  \n  // Brand visibility issues\n  brandIssues: {\n    lowRankingBrandQueries: brandVisibilityIssues.lowRankingBrandQueries.length,\n    brandQueriesNotPosition1: brandVisibilityIssues.brandQueriesNotRanking1.length,\n    issueQueries: brandVisibilityIssues.lowRankingBrandQueries.slice(0, 5) // Top 5 problem queries\n  },\n  \n  // Top performing queries\n  topBrandQueries: brandQueryAnalysis.topBrandQueries.slice(0, 5),\n  topNonBrandQueries: nonBrandData.queries.slice(0, 5),\n  \n  // Regex match details\n  regexMatchDetails: {\n    brandTermsUsed: brandTerms,\n    regexPattern: brandRegex.source,\n    totalMatches: brandData.queries.length,\n    sampleMatches: brandData.queries.slice(0, 3).map(q => ({\n      query: q.query,\n      matchedTerm: q.matchedBrandTerm,\n      matchPosition: q.matchIndex\n    }))\n  }\n}];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1040,
            320
          ],
          "id": "baab32cd-0b52-4b7e-8464-bc4a2b77fed3",
          "name": "Parse Brand Visibility"
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Test workflowâ€™": {
          "main": [
            []
          ]
        },
        "Get Device Performance": {
          "main": [
            [
              {
                "node": "Parse Device Performance",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Top Performing Pages": {
          "main": [
            [
              {
                "node": "Parse Top Performing Pages",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Keyword Analysis by Pages": {
          "main": [
            [
              {
                "node": "Parse Keyword Analysis by Pages",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Keyword Cannibalization Detection": {
          "main": [
            [
              {
                "node": "Parse Keyword Cannibalization Detection",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Content Gap Analysis": {
          "main": [
            [
              {
                "node": "Parse Content Gap Analysis",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Keyword Opportunities Analysis": {
          "main": [
            [
              {
                "node": "Parse Keyword Opportunities Analysis",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Query Performance Drop Detection": {
          "main": [
            [
              {
                "node": "Parse Query Performance Drop Detection",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        " Get Queries by Period": {
          "main": [
            [
              {
                "node": "Parse Queries by Period",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse Queries by Period": {
          "main": [
            []
          ]
        },
        "Get Queries by Day": {
          "main": [
            [
              {
                "node": "Parse Queries by Day",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Keywords Ranking 4-10": {
          "main": [
            [
              {
                "node": "Parse Keywords Ranking 4-10",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Brand Visibility Analysis": {
          "main": [
            [
              {
                "node": "Parse Brand Visibility",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "f1dc51ba-dc7f-4ef0-99f4-7b51272e58c4",
      "meta": {
        "templateCredsSetupCompleted": true,
        "instanceId": "558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a"
      },
      "id": "kydAlmMqrzOoYp0y",
      "tags": [
        {
          "createdAt": "2025-03-02T12:05:53.836Z",
          "updatedAt": "2025-03-02T12:05:53.836Z",
          "id": "utwtHTzeqUdktrxJ",
          "name": "SEO"
        }
      ]
    }
  },
  {
    "id": "json-report-generator",
    "title": "JSON â†’ HTML Report Generator",
    "description": "Accepts arbitrary JSON payloads and renders a styled HTML report with sections, tables, and download links.",
    "problem": "Teams need sharable reports from automation outputs; this template formats data for stakeholders automatically.",
    "tags": [
      "reports",
      "html",
      "automation"
    ],
    "metadata": {
      "industries": [
        "analytics",
        "operations"
      ],
      "domains": [
        "reporting"
      ],
      "channels": [
        "html",
        "email"
      ],
      "trigger": "manual",
      "complexity": "low",
      "integrations": [
        "Custom JSON"
      ]
    },
    "workflow": {
      "name": "Report Examples Demo",
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -100,
            100
          ],
          "id": "0b4e2c14-3b21-4463-b1a8-44a8f6fd20ed",
          "name": "When clicking â€˜Execute workflowâ€™"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "{\n  \"title\": \"SEO Report July\",\n  \"filename\": \"seo_report\",\n  \"content\": {\n    \"website\": \"example-store.com\",\n    \"analysis_date\": \"2025-07-31\",\n    \"overall_score\": 78,\n    \"critical_issues\": [\n      \"Missing meta descriptions on 15 pages\",\n      \"Slow page load times (average 4.2 seconds)\",\n      \"Broken internal links found\"\n    ],\n    \"technical_seo\": {\n      \"page_speed\": {\n        \"desktop_score\": 65,\n        \"mobile_score\": 42,\n        \"recommendations\": [\n          \"Optimize images (reduce file sizes by 60%)\",\n          \"Enable browser caching\",\n          \"Minify CSS and JavaScript files\"\n        ]\n      },\n      \"crawlability\": {\n        \"status\": \"Good\",\n        \"sitemap_url\": \"https://example-store.com/sitemap.xml\",\n        \"robots_txt\": \"Present and properly configured\",\n        \"issues\": []\n      }\n    },\n    \"content_analysis\": {\n      \"keyword_optimization\": {\n        \"primary_keywords\": [\"organic skincare\", \"natural beauty products\", \"eco-friendly cosmetics\"],\n        \"keyword_density\": \"2.3%\",\n        \"missing_keywords\": [\"sustainable beauty\", \"cruelty-free products\"]\n      },\n      \"content_quality\": {\n        \"readability_score\": 82,\n        \"average_word_count\": 450,\n        \"duplicate_content\": \"3 pages with similar content detected\"\n      }\n    },\n    \"recommendations\": {\n      \"high_priority\": [\n        \"Add meta descriptions to all product pages\",\n        \"Implement image compression to improve load times\",\n        \"Fix 12 broken internal links in navigation\"\n      ],\n      \"medium_priority\": [\n        \"Optimize title tags for better CTR\",\n        \"Add schema markup for products\",\n        \"Improve mobile responsiveness\"\n      ],\n      \"low_priority\": [\n        \"Add social media meta tags\",\n        \"Consider implementing breadcrumb navigation\"\n      ]\n    },\n    \"next_review_date\": \"2025-10-31\"\n  }\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            200,
            100
          ],
          "id": "4238e624-1664-4d45-95ec-b5dadfda7ea3",
          "name": "Mock SEO Report"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "{\n  \"title\": \"Mediterranean Recipe\",\n  \"filename\": \"recipe\",\n  \"content\": {\n    \"dish_name\": \"Mediterranean Herb-Crusted Salmon with Roasted Vegetables\",\n    \"cuisine_type\": \"Mediterranean\",\n    \"difficulty_level\": \"Intermediate\",\n    \"prep_time\": \"25 minutes\",\n    \"cook_time\": \"35 minutes\",\n    \"serves\": 4,\n    \"ingredients\": {\n      \"main_protein\": [\n        \"4 salmon fillets (6 oz each)\",\n        \"2 tablespoons olive oil\",\n        \"1 teaspoon sea salt\",\n        \"1/2 teaspoon black pepper\"\n      ],\n      \"herb_crust\": [\n        \"1/2 cup fresh breadcrumbs\",\n        \"2 tablespoons fresh parsley, chopped\",\n        \"1 tablespoon fresh dill, chopped\",\n        \"1 tablespoon fresh oregano, chopped\",\n        \"2 cloves garlic, minced\",\n        \"2 tablespoons lemon zest\"\n      ],\n      \"roasted_vegetables\": [\n        \"2 medium zucchini, sliced\",\n        \"1 red bell pepper, cut into strips\",\n        \"1 yellow bell pepper, cut into strips\",\n        \"1 red onion, sliced\",\n        \"12 cherry tomatoes, halved\",\n        \"3 tablespoons olive oil\",\n        \"1 teaspoon dried thyme\"\n      ]\n    },\n    \"cooking_instructions\": {\n      \"preparation\": {\n        \"step_1\": \"Preheat oven to 425Â°F (220Â°C)\",\n        \"step_2\": \"Line two baking sheets with parchment paper\",\n        \"step_3\": \"Pat salmon fillets dry and season with salt and pepper\"\n      },\n      \"herb_crust_preparation\": {\n        \"mixing\": \"Combine breadcrumbs, herbs, garlic, and lemon zest in a bowl\",\n        \"binding\": \"Add 1 tablespoon olive oil to create a paste-like consistency\",\n        \"application\": \"Press herb mixture firmly onto top of each salmon fillet\"\n      },\n      \"vegetable_preparation\": {\n        \"cutting\": \"Cut all vegetables into uniform pieces for even cooking\",\n        \"seasoning\": \"Toss vegetables with olive oil, thyme, salt, and pepper\",\n        \"arrangement\": \"Spread vegetables in single layer on prepared baking sheet\"\n      },\n      \"cooking_process\": {\n        \"vegetables_first\": \"Roast vegetables for 15 minutes before adding salmon\",\n        \"salmon_cooking\": \"Place herb-crusted salmon on second baking sheet\",\n        \"final_cooking\": \"Cook both salmon and vegetables for additional 12-15 minutes\",\n        \"doneness_check\": \"Salmon should flake easily and reach internal temperature of 145Â°F\"\n      }\n    },\n    \"nutritional_information\": {\n      \"per_serving\": {\n        \"calories\": 485,\n        \"protein\": \"38g\",\n        \"carbohydrates\": \"18g\",\n        \"fat\": \"28g\",\n        \"fiber\": \"5g\",\n        \"sodium\": \"420mg\"\n      },\n      \"health_benefits\": [\n        \"Rich in omega-3 fatty acids for heart health\",\n        \"High protein content supports muscle maintenance\",\n        \"Antioxidants from colorful vegetables boost immune system\",\n        \"Mediterranean herbs provide anti-inflammatory compounds\"\n      ]\n    },\n    \"serving_suggestions\": {\n      \"accompaniments\": [\n        \"Lemon wedges for extra citrus flavor\",\n        \"Tzatziki sauce or Greek yogurt\",\n        \"Warm pita bread or crusty sourdough\",\n        \"Mixed green salad with olive oil dressing\"\n      ],\n      \"wine_pairings\": [\n        \"Sauvignon Blanc - crisp and herbaceous\",\n        \"Pinot Grigio - light and fresh\",\n        \"RosÃ© - complements the Mediterranean flavors\"\n      ]\n    },\n    \"storage_and_leftovers\": {\n      \"refrigeration\": {\n        \"duration\": \"Store leftovers for up to 3 days in refrigerator\",\n        \"container\": \"Use airtight containers to maintain freshness\",\n        \"reheating\": \"Reheat gently in 350Â°F oven for 8-10 minutes\"\n      },\n      \"meal_prep_tips\": [\n        \"Prepare herb crust mixture up to 2 days ahead\",\n        \"Cut vegetables the night before and store in refrigerator\",\n        \"Cook extra vegetables for easy weekday sides\"\n      ]\n    },\n    \"chef_notes\": {\n      \"substitutions\": {\n        \"fish_alternatives\": [\"Cod fillets\", \"Halibut steaks\", \"Sea bass\"],\n        \"herb_variations\": [\"Basil and thyme\", \"Rosemary and sage\", \"Cilantro and mint\"],\n        \"vegetable_swaps\": [\"Asparagus\", \"Brussels sprouts\", \"Eggplant\"]\n      },\n      \"pro_tips\": [\n        \"Don't overcrowd vegetables on baking sheet for proper roasting\",\n        \"Let salmon rest at room temperature for 15 minutes before cooking\",\n        \"Use a meat thermometer for perfectly cooked salmon every time\"\n      ]\n    },\n    \"recipe_source\": \"Chef Maria's Mediterranean Kitchen\",\n    \"recipe_url\": \"https://mediterranean-kitchen.com/herb-crusted-salmon\"\n  }\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            200,
            -100
          ],
          "id": "50ab8c9b-368d-4357-b250-486b228cbba8",
          "name": "Mock Recipe"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "{\n  \"title\": \"SEO Report July\",\n  \"filename\": \"project\",\n  \"content\": {\n    \"project_name\": \"TaskFlow Pro - Project Management API\",\n    \"version\": \"2.4.1\",\n    \"release_date\": \"2025-07-15\",\n    \"overview\": \"A comprehensive REST API for managing projects, tasks, and team collaboration with real-time updates and advanced reporting capabilities.\",\n    \"system_requirements\": {\n      \"minimum_requirements\": {\n        \"operating_system\": [\"Windows 10\", \"macOS 12.0\", \"Ubuntu 20.04 LTS\"],\n        \"memory\": \"8GB RAM minimum\",\n        \"storage\": \"2GB available disk space\",\n        \"network\": \"Stable internet connection required\"\n      },\n      \"recommended_requirements\": {\n        \"operating_system\": [\"Windows 11\", \"macOS 13.0\", \"Ubuntu 22.04 LTS\"],\n        \"memory\": \"16GB RAM or higher\",\n        \"storage\": \"5GB available disk space\",\n        \"processor\": \"Multi-core processor (4+ cores recommended)\"\n      }\n    },\n    \"installation_guide\": {\n      \"prerequisites\": {\n        \"software_dependencies\": [\n          \"Node.js version 18.0 or higher\",\n          \"PostgreSQL 14.0 or higher\",\n          \"Redis 6.2 or higher\",\n          \"Docker (optional but recommended)\"\n        ],\n        \"environment_setup\": {\n          \"development\": \"Set NODE_ENV=development in your environment variables\",\n          \"production\": \"Configure SSL certificates and set NODE_ENV=production\",\n          \"database\": \"Create a new PostgreSQL database named 'taskflow_db'\"\n        }\n      },\n      \"installation_steps\": {\n        \"step_1\": {\n          \"title\": \"Clone the Repository\",\n          \"command\": \"git clone https://github.com/taskflow/taskflow-api.git\",\n          \"description\": \"Download the latest version from our GitHub repository\"\n        },\n        \"step_2\": {\n          \"title\": \"Install Dependencies\",\n          \"command\": \"npm install --production\",\n          \"description\": \"Install all required Node.js packages and dependencies\"\n        },\n        \"step_3\": {\n          \"title\": \"Configure Environment\",\n          \"files\": [\".env.example\", \".env.production\"],\n          \"description\": \"Copy .env.example to .env and configure your database credentials\"\n        },\n        \"step_4\": {\n          \"title\": \"Database Migration\",\n          \"command\": \"npm run migrate:latest\",\n          \"description\": \"Set up database tables and initial schema\"\n        },\n        \"step_5\": {\n          \"title\": \"Start the Application\",\n          \"command\": \"npm start\",\n          \"description\": \"Launch the API server on default port 3000\"\n        }\n      }\n    },\n    \"api_endpoints\": {\n      \"authentication\": {\n        \"login\": {\n          \"method\": \"POST\",\n          \"endpoint\": \"/api/v2/auth/login\",\n          \"description\": \"Authenticate user and receive JWT token\",\n          \"required_fields\": [\"email\", \"password\"],\n          \"response_format\": \"JSON with access_token and user_info\"\n        },\n        \"register\": {\n          \"method\": \"POST\",\n          \"endpoint\": \"/api/v2/auth/register\",\n          \"description\": \"Create new user account\",\n          \"required_fields\": [\"email\", \"password\", \"first_name\", \"last_name\"],\n          \"optional_fields\": [\"company\", \"phone\"]\n        }\n      },\n      \"project_management\": {\n        \"create_project\": {\n          \"method\": \"POST\",\n          \"endpoint\": \"/api/v2/projects\",\n          \"description\": \"Create a new project with initial settings\",\n          \"required_fields\": [\"name\", \"description\", \"start_date\"],\n          \"optional_fields\": [\"end_date\", \"budget\", \"team_members\"]\n        },\n        \"list_projects\": {\n          \"method\": \"GET\",\n          \"endpoint\": \"/api/v2/projects\",\n          \"description\": \"Retrieve all projects for authenticated user\",\n          \"query_parameters\": [\"status\", \"sort_by\", \"limit\", \"offset\"],\n          \"filters\": [\"active\", \"completed\", \"archived\", \"on_hold\"]\n        },\n        \"update_project\": {\n          \"method\": \"PUT\",\n          \"endpoint\": \"/api/v2/projects/{project_id}\",\n          \"description\": \"Update existing project details\",\n          \"updatable_fields\": [\"name\", \"description\", \"status\", \"budget\", \"end_date\"]\n        }\n      },\n      \"task_management\": {\n        \"create_task\": {\n          \"method\": \"POST\",\n          \"endpoint\": \"/api/v2/projects/{project_id}/tasks\",\n          \"description\": \"Add new task to specified project\",\n          \"required_fields\": [\"title\", \"description\", \"priority\"],\n          \"priority_levels\": [\"low\", \"medium\", \"high\", \"urgent\"]\n        },\n        \"assign_task\": {\n          \"method\": \"PATCH\",\n          \"endpoint\": \"/api/v2/tasks/{task_id}/assign\",\n          \"description\": \"Assign task to team member\",\n          \"required_fields\": [\"assignee_id\", \"due_date\"],\n          \"notification\": \"Automatic email notification sent to assignee\"\n        }\n      }\n    },\n    \"configuration_options\": {\n      \"database_settings\": {\n        \"connection_pool\": {\n          \"min_connections\": 5,\n          \"max_connections\": 20,\n          \"idle_timeout\": \"30 seconds\"\n        },\n        \"backup_settings\": {\n          \"automatic_backup\": true,\n          \"backup_frequency\": \"Daily at 2:00 AM UTC\",\n          \"retention_period\": \"30 days\",\n          \"backup_location\": \"AWS S3 bucket or local storage\"\n        }\n      },\n      \"security_configuration\": {\n        \"jwt_settings\": {\n          \"token_expiry\": \"24 hours\",\n          \"refresh_token_expiry\": \"7 days\",\n          \"algorithm\": \"HS256\"\n        },\n        \"rate_limiting\": {\n          \"requests_per_minute\": 100,\n          \"burst_limit\": 200,\n          \"blocked_duration\": \"15 minutes\"\n        },\n        \"cors_settings\": {\n          \"allowed_origins\": [\"https://app.taskflow.com\", \"https://admin.taskflow.com\"],\n          \"allowed_methods\": [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"],\n          \"credentials\": true\n        }\n      }\n    },\n    \"troubleshooting\": {\n      \"common_issues\": {\n        \"database_connection_failed\": {\n          \"symptoms\": [\"Connection timeout errors\", \"Unable to connect to database\"],\n          \"solutions\": [\n            \"Verify database credentials in .env file\",\n            \"Check if PostgreSQL service is running\",\n            \"Ensure database exists and user has proper permissions\",\n            \"Test connection using psql command line tool\"\n          ]\n        },\n        \"authentication_errors\": {\n          \"symptoms\": [\"401 Unauthorized responses\", \"Invalid token errors\"],\n          \"solutions\": [\n            \"Check JWT secret key configuration\",\n            \"Verify token hasn't expired\",\n            \"Ensure proper Authorization header format\",\n            \"Clear browser cache and cookies\"\n          ]\n        },\n        \"performance_issues\": {\n          \"symptoms\": [\"Slow API responses\", \"High memory usage\", \"Timeout errors\"],\n          \"solutions\": [\n            \"Enable database query optimization\",\n            \"Implement Redis caching for frequent queries\",\n            \"Monitor and optimize database indexes\",\n            \"Scale horizontally with load balancer\"\n          ]\n        }\n      }\n    },\n    \"support_resources\": {\n      \"documentation_links\": [\n        \"https://docs.taskflow.com/api-reference\",\n        \"https://docs.taskflow.com/getting-started\",\n        \"https://docs.taskflow.com/best-practices\"\n      ],\n      \"community_support\": [\n        \"GitHub Issues: https://github.com/taskflow/taskflow-api/issues\",\n        \"Discord Community: https://discord.gg/taskflow\",\n        \"Stack Overflow tag: taskflow-api\"\n      ],\n      \"contact_information\": {\n        \"technical_support\": \"support@taskflow.com\",\n        \"sales_inquiries\": \"sales@taskflow.com\",\n        \"business_hours\": \"Monday-Friday, 9:00 AM - 6:00 PM EST\"\n      }\n    }\n  }\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            200,
            280
          ],
          "id": "6ba13623-d42a-4785-9537-8022521f9397",
          "name": "Mock Project Data"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "lr4FCy9jvt89twbt",
              "mode": "list",
              "cachedResultName": "Tools - Report Generator"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "title": "={{ $json.title }}",
                "filename": "={{ $json.filename }}",
                "content": "={{ $json.content }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "filename",
                  "displayName": "filename",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "title",
                  "displayName": "title",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "content",
                  "displayName": "content",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            420,
            -100
          ],
          "id": "0181fe75-a134-43f5-aa3d-8b33c4a08bc8",
          "name": "Generate Report 1"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "lr4FCy9jvt89twbt",
              "mode": "list",
              "cachedResultName": "Tools - Report Generator"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "title": "={{ $json.title }}",
                "filename": "={{ $json.filename }}",
                "content": "={{ $json.content }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "filename",
                  "displayName": "filename",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "title",
                  "displayName": "title",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "content",
                  "displayName": "content",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            420,
            100
          ],
          "id": "2437b60c-a6a1-4d5f-9cb9-d1f25da5f808",
          "name": "Generate Report 2"
        },
        {
          "parameters": {
            "workflowId": {
              "__rl": true,
              "value": "lr4FCy9jvt89twbt",
              "mode": "list",
              "cachedResultName": "Tools - Report Generator"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "title": "={{ $json.title }}",
                "filename": "={{ $json.filename }}",
                "content": "={{ $json.content }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "filename",
                  "displayName": "filename",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "title",
                  "displayName": "title",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string"
                },
                {
                  "id": "content",
                  "displayName": "content",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": true
            },
            "options": {}
          },
          "type": "n8n-nodes-base.executeWorkflow",
          "typeVersion": 1.2,
          "position": [
            420,
            280
          ],
          "id": "a4f69396-d7b2-4d4e-99ca-1194d1ff97df",
          "name": "Generate Report 3"
        }
      ],
      "pinData": {},
      "connections": {
        "When clicking â€˜Execute workflowâ€™": {
          "main": [
            [
              {
                "node": "Mock SEO Report",
                "type": "main",
                "index": 0
              },
              {
                "node": "Mock Recipe",
                "type": "main",
                "index": 0
              },
              {
                "node": "Mock Project Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mock SEO Report": {
          "main": [
            [
              {
                "node": "Generate Report 2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mock Recipe": {
          "main": [
            [
              {
                "node": "Generate Report 1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mock Project Data": {
          "main": [
            [
              {
                "node": "Generate Report 3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "active": false,
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "6108b1b3-101f-48a6-b19a-e334acc08afb",
      "meta": {
        "instanceId": "558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a"
      },
      "id": "hxQH8WTuPlGTfMm5",
      "tags": []
    }
  },
  {
    "id": "notion-todoist-two-way-sync",
    "title": "Realtime Notion â†” Todoist Sync",
    "description": "Complex two-way sync handling webhook events, batching, Redis dedupe, and SSE notifications between Notion and Todoist.",
    "problem": "Teams maintaining parallel task systems need reliable bidirectional sync with conflict handling.",
    "tags": [
      "notion",
      "todoist",
      "sync",
      "webhook",
      "redis"
    ],
    "metadata": {
      "industries": [
        "productivity"
      ],
      "domains": [
        "two-way-sync"
      ],
      "channels": [
        "notion",
        "todoist"
      ],
      "trigger": "multi",
      "complexity": "high",
      "integrations": [
        "Notion",
        "Todoist",
        "Redis",
        "Webhook"
      ]
    },
    "workflow": {
      "id": "k9abwUyVzl7OCsAl",
      "meta": {
        "instanceId": "fb8bc2e315f7f03c97140b30aa454a27bc7883a19000fa1da6e6b571bf56ad6d"
      },
      "name": "Realtime Notion Todoist 2-way Sync Template",
      "tags": [
        {
          "id": "RKga6I6NviNI12bx",
          "name": "template",
          "createdAt": "2024-09-19T19:09:21.997Z",
          "updatedAt": "2024-09-19T19:09:21.997Z"
        }
      ],
      "nodes": [
        {
          "id": "5e0488a3-270d-46b3-8b4b-f4ee459a3016",
          "name": "Get projects",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            -700,
            260
          ],
          "parameters": {
            "url": "https://api.todoist.com/rest/v2/projects",
            "options": {},
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "e52b0a6d-4697-4c42-91c9-6c786752877c",
          "name": "Get sections",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            180,
            260
          ],
          "parameters": {
            "url": "https://api.todoist.com/rest/v2/sections",
            "options": {},
            "sendQuery": true,
            "authentication": "predefinedCredentialType",
            "queryParameters": {
              "parameters": [
                {
                  "name": "project_id",
                  "value": "={{ $json.project_id }}"
                }
              ]
            },
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "8af0c04f-a46e-4fb8-ab5a-09952a3c1360",
          "name": "Get Notion Databases",
          "type": "n8n-nodes-base.notion",
          "position": [
            -1580,
            260
          ],
          "parameters": {
            "resource": "database",
            "operation": "getAll"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "09e43e00-6df6-4844-bda3-f5e8be0aed3a",
          "name": "Prep Dropdown",
          "type": "n8n-nodes-base.code",
          "position": [
            -1360,
            260
          ],
          "parameters": {
            "jsCode": "let dropDownValues = [];\n\nfor (const item of $input.all()) {\n  if (item.json.name == \"Inbox\") continue;\n  dropDownValues.push({\"option\": item.json.name});\n}\n\nreturn { \"options\": JSON.stringify(dropDownValues) };"
          },
          "typeVersion": 2
        },
        {
          "id": "426872eb-228a-4b1c-b992-cf17893d29d2",
          "name": "Prep Dropdown1",
          "type": "n8n-nodes-base.code",
          "position": [
            -480,
            260
          ],
          "parameters": {
            "jsCode": "let dropDownValues = [];\n\nfor (const item of $input.all()) {\n  if (item.json.name == \"Inbox\") continue;\n  dropDownValues.push({\"option\": item.json.name});\n}\n\nreturn { \"options\": JSON.stringify(dropDownValues) };"
          },
          "typeVersion": 2
        },
        {
          "id": "bebc6443-6187-4b97-82ff-45b6ce75cd7e",
          "name": "Generate config",
          "type": "n8n-nodes-base.code",
          "position": [
            400,
            260
          ],
          "parameters": {
            "jsCode": "let sections = [];\nfor (const item of $('Get sections').all()) {\n  sections.push({ id: item.json.id, name: item.json.name }); \n}\n\nreturn { json: \n{\n  \"database_id\": $('Get Notion Database ID').first().json.database_id,\n  \"project_id\": $('Get Todoist Project ID').first().json.project_id,\n  \"sections\": sections\n}  \n};"
          },
          "typeVersion": 2
        },
        {
          "id": "52692c9c-a490-4c2c-8df4-93870bf52ded",
          "name": "Choose Notion Database",
          "type": "n8n-nodes-base.form",
          "position": [
            -1140,
            260
          ],
          "webhookId": "971affb1-c55c-4025-9b4b-743c8f3fcfcf",
          "parameters": {
            "options": {
              "buttonLabel": "Continue"
            },
            "defineForm": "json",
            "jsonOutput": "=[\n   {\n      \"fieldLabel\": \"Select Notion Database\",\n      \"fieldType\": \"dropdown\",\n      \"requiredField\": true,\n      \"fieldOptions\": {\n        \"values\": {{ $json.options }}\n      }\n   }\n]"
          },
          "typeVersion": 1
        },
        {
          "id": "7db73660-3f99-42b6-843d-ee4adf758441",
          "name": "Choose Todoist Project",
          "type": "n8n-nodes-base.form",
          "position": [
            -260,
            260
          ],
          "webhookId": "971affb1-c55c-4025-9b4b-743c8f3fcfcf",
          "parameters": {
            "options": {
              "buttonLabel": "Continue"
            },
            "defineForm": "json",
            "jsonOutput": "=[\n   {\n      \"fieldLabel\": \"Select Todoist Project\",\n      \"fieldType\": \"dropdown\",\n      \"requiredField\": true,\n      \"fieldOptions\": {\n        \"values\": {{ $json.options }}\n      }\n   }\n]"
          },
          "typeVersion": 1
        },
        {
          "id": "3fe51a88-765f-469e-9846-191506b0a894",
          "name": "Verify security token",
          "type": "n8n-nodes-base.if",
          "position": [
            -580,
            980
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "286fafb0-a200-4963-a19f-e63162c484b4",
                  "operator": {
                    "name": "filter.operator.equals",
                    "type": "string",
                    "operation": "equals"
                  },
                  "leftValue": "={{ $('OAuth redirect').first().json.query.state }}",
                  "rightValue": "={{ $json.state }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "7a040b65-5cc3-44d6-8bf6-c6bb7dfe5128",
          "name": "Generate security token",
          "type": "n8n-nodes-base.crypto",
          "position": [
            -800,
            620
          ],
          "parameters": {
            "action": "generate",
            "dataPropertyName": "state"
          },
          "typeVersion": 1
        },
        {
          "id": "7033d868-2d83-45bb-a48b-f4fd6eb14e0d",
          "name": "Store variables",
          "type": "n8n-nodes-base.code",
          "position": [
            -580,
            620
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const staticData = $getWorkflowStaticData('global');\nstaticData.clientID = $('Todoist Webhook Setup Helper').first().json['Client ID'];\nstaticData.clientSecret = $('Todoist Webhook Setup Helper').first().json['Client secret'];\nstaticData.state = $json.state;\n\nreturn $input.item;"
          },
          "typeVersion": 2
        },
        {
          "id": "d538d40a-599b-4255-a5e0-83d9b72f671e",
          "name": "Get variables",
          "type": "n8n-nodes-base.code",
          "position": [
            -800,
            980
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const staticData = $getWorkflowStaticData('global');\n$input.item.json.clientID = staticData.clientID;\n$input.item.json.clientSecret = staticData.clientSecret;\n$input.item.json.state = staticData.state;\n\nreturn $input.item;"
          },
          "typeVersion": 2
        },
        {
          "id": "7c895d16-e522-4b63-bee6-0cea3e3177dd",
          "name": "Redirect to Auth Page",
          "type": "n8n-nodes-base.form",
          "position": [
            -360,
            620
          ],
          "webhookId": "41b4bc95-2938-4a53-a051-7a3079001329",
          "parameters": {
            "operation": "completion",
            "redirectUrl": "=https://todoist.com/oauth/authorize?client_id={{ $json['Client ID'] }}&scope=task:add,data:read_write,data:delete&state={{ $json.state }}",
            "respondWith": "redirect"
          },
          "typeVersion": 1
        },
        {
          "id": "b72c6f9f-f821-4859-b75d-192541ce0d34",
          "name": "OAuth redirect",
          "type": "n8n-nodes-base.webhook",
          "position": [
            -1020,
            980
          ],
          "webhookId": "7aee8b09-29e3-4e12-9b66-c6e8ab080bf7",
          "parameters": {
            "path": "7aee8b09-29e3-4e12-9b66-c6e8ab080bf7",
            "options": {},
            "httpMethod": [
              "GET"
            ],
            "responseMode": "responseNode",
            "multipleMethods": true
          },
          "typeVersion": 2
        },
        {
          "id": "d0adcb66-4817-44f9-ad7e-320cff86aefe",
          "name": "Exchange Tokens",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueErrorOutput",
          "position": [
            -360,
            880
          ],
          "parameters": {
            "url": "https://todoist.com/oauth/access_token",
            "method": "POST",
            "options": {},
            "sendBody": true,
            "contentType": "form-urlencoded",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "client_id",
                  "value": "={{ $json.clientID }}"
                },
                {
                  "name": "client_secret",
                  "value": "={{ $json.clientSecret }}"
                },
                {
                  "name": "code",
                  "value": "={{ $('OAuth redirect').first().json.query.code }}"
                }
              ]
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "4fda8614-308c-4d66-ac7d-c2491ab5a86a",
          "name": "Respond with success",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            -140,
            780
          ],
          "parameters": {
            "options": {},
            "respondWith": "text",
            "responseBody": "=Developer App activated successfully. The window can be closed now."
          },
          "typeVersion": 1.1
        },
        {
          "id": "347fb99f-861f-483a-bc39-7341fe41439f",
          "name": "Respond with error",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            -140,
            980
          ],
          "parameters": {
            "options": {},
            "respondWith": "text",
            "responseBody": "Something went wrong."
          },
          "typeVersion": 1.1
        },
        {
          "id": "754727b6-1122-46b2-a956-79ed277c8b32",
          "name": "Get Notion Database ID",
          "type": "n8n-nodes-base.code",
          "position": [
            -920,
            260
          ],
          "parameters": {
            "jsCode": "let database_id = null;\n\nfor (const item of $('Get Notion Databases').all()) {\n  if (item.json.name == $('Choose Notion Database').first().json['Select Notion Database']) {\n    database_id = item.json.id;\n  }\n}\n\nreturn { json: { database_id: database_id } };"
          },
          "typeVersion": 2
        },
        {
          "id": "565f4144-549e-4adc-b51b-2d87767c3dc3",
          "name": "Get Todoist Project ID",
          "type": "n8n-nodes-base.code",
          "position": [
            -40,
            260
          ],
          "parameters": {
            "jsCode": "let project_id = null;\n\nfor (const item of $('Get projects').all()) {\n  if (item.json.name == $('Choose Todoist Project').first().json['Select Todoist Project']) {\n    project_id = item.json.id;\n  }\n}\n\nreturn { json: { project_id: project_id } };"
          },
          "typeVersion": 2
        },
        {
          "id": "6f79cd9e-493a-46b2-a3fb-853852a299be",
          "name": "Notion-Todoist Sync Setup Helper",
          "type": "n8n-nodes-base.formTrigger",
          "position": [
            -1800,
            260
          ],
          "webhookId": "7edf515f-bd69-4875-a5d8-eca8b4679896",
          "parameters": {
            "options": {
              "buttonLabel": "Begin"
            },
            "formTitle": "Notion-Todoist Sync Setup Helper",
            "formFields": {
              "values": [
                {
                  "fieldLabel": " ",
                  "placeholder": "Click \"Begin\" to continue"
                }
              ]
            },
            "formDescription": "This tool gathers all necessary information and builds a JSON config which is needed as globals in the sync workflows."
          },
          "typeVersion": 2.2
        },
        {
          "id": "684e5eea-8148-4ddf-8972-dab890083ce2",
          "name": "Todoist Webhook Setup Helper",
          "type": "n8n-nodes-base.formTrigger",
          "position": [
            -1020,
            620
          ],
          "webhookId": "feb96ecb-a7c0-41d3-9368-2299cdce492e",
          "parameters": {
            "options": {},
            "formTitle": "Todoist Webhook Setup Helper",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "Client ID",
                  "requiredField": true
                },
                {
                  "fieldLabel": "Client secret",
                  "requiredField": true
                }
              ]
            },
            "responseMode": "lastNode",
            "formDescription": "This tool helps activating the Todoist Webhook for a registered Developer App by connecting to the App vie OAuth."
          },
          "typeVersion": 2.2
        },
        {
          "id": "05f938b9-f2b3-4535-8fea-5c378bbf7944",
          "name": "Return config JSON",
          "type": "n8n-nodes-base.form",
          "position": [
            620,
            260
          ],
          "webhookId": "739f32d1-356d-429d-8698-a166485cc36f",
          "parameters": {
            "options": {},
            "operation": "completion",
            "completionTitle": "Copy this to the Globals Nodes",
            "completionMessage": "={{ $json.toJsonString() }}"
          },
          "typeVersion": 1
        },
        {
          "id": "e5101689-8b9d-4896-aad6-b39ea2ec654d",
          "name": "Todoist",
          "type": "n8n-nodes-base.todoist",
          "position": [
            2980,
            600
          ],
          "parameters": {
            "filters": {
              "projectId": "={{ $('Globals').first().json.project_id }}"
            },
            "operation": "getAll",
            "returnAll": true
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.1,
          "waitBetweenTries": 5000
        },
        {
          "id": "c588831b-99c1-4c4b-9d33-4cb14687d896",
          "name": "Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            2980,
            400
          ],
          "parameters": {
            "simple": false,
            "options": {},
            "resource": "databasePage",
            "operation": "getAll",
            "returnAll": true,
            "databaseId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Globals').first().json.database_id }}"
            },
            "filterJson": "={\n  \"and\": [\n    {\n      \"and\": [\n        {\n          \"property\": \"Status\",\n          \"status\": {\n            \"does_not_equal\": \"Done\"\n          }\n        },\n        {\n          \"property\": \"Status\",\n          \"status\": {\n            \"does_not_equal\": \"Obsolete\"\n          }\n        }\n      ]\n    },\n    {\n      \"or\": [\n        {\n          \"property\": \"Focus\",\n          \"checkbox\": {\n            \"equals\": true\n          }\n        },\n        {\n          \"property\": \"Due\",\n          \"date\": {\n            \"is_not_empty\": true\n          }\n        }\n      ]\n    }\n  ]\n}",
            "filterType": "json"
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "72c05668-ed66-4a17-abd1-d848890d23d2",
          "name": "Compare Datasets",
          "type": "n8n-nodes-base.compareDatasets",
          "position": [
            3420,
            500
          ],
          "parameters": {
            "options": {},
            "resolve": "mix",
            "mergeByFields": {
              "values": [
                {
                  "field1": "id",
                  "field2": "id"
                }
              ]
            }
          },
          "typeVersion": 2.3
        },
        {
          "id": "4fe3e94e-cd61-49e3-a37c-1a4a45ae990d",
          "name": "Exists/Completed in Notion",
          "type": "n8n-nodes-base.if",
          "position": [
            3880,
            1220
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "455d4c70-c774-44d4-b3ba-78754073c2db",
                  "operator": {
                    "type": "object",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "e6917957-0511-489e-aef1-268d54d1ae1b",
          "name": "Get Todoist Task",
          "type": "n8n-nodes-base.todoist",
          "onError": "continueErrorOutput",
          "maxTries": 2,
          "position": [
            4540,
            -280
          ],
          "parameters": {
            "taskId": "={{ $json.id }}",
            "operation": "get"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.1,
          "waitBetweenTries": 2000
        },
        {
          "id": "7ee99bf2-7316-4106-820b-71fb7dc62a69",
          "name": "If Todoist ID exists",
          "type": "n8n-nodes-base.if",
          "position": [
            4100,
            -180
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "71e9af47-a275-4dd4-a984-0b7ba2cb8733",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.id }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "c54b47a5-8c6e-4656-841b-12e64d0dc3af",
          "name": "Store Todoist ID",
          "type": "n8n-nodes-base.notion",
          "position": [
            5200,
            -180
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Notion').item.json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Todoist ID|rich_text",
                  "textContent": "={{ $json.id }}"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "29ccfeb0-f3c1-4141-a7ba-211ae6195e63",
          "name": "Mark as Incomplete in Todoist",
          "type": "n8n-nodes-base.todoist",
          "position": [
            4980,
            -480
          ],
          "parameters": {
            "taskId": "={{ $json.id }}",
            "operation": "reopen"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.1,
          "waitBetweenTries": 5000
        },
        {
          "id": "7322844b-0f2b-4f33-9aa6-117845bf90e5",
          "name": "Mark as Completed in Todoist",
          "type": "n8n-nodes-base.todoist",
          "position": [
            4980,
            1120
          ],
          "parameters": {
            "taskId": "={{ $('Todoist').item.json.id }}",
            "operation": "close"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "44d117ae-f3a1-47ae-8e6d-c668e721add7",
          "name": "Delete Task in Todoist",
          "type": "n8n-nodes-base.todoist",
          "position": [
            4980,
            1320
          ],
          "parameters": {
            "taskId": "={{ $('Todoist').item.json.id }}",
            "operation": "delete"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "57176531-6186-40d4-9306-65eea976583f",
          "name": "Loop Over Items",
          "type": "n8n-nodes-base.splitInBatches",
          "position": [
            3660,
            1320
          ],
          "parameters": {
            "options": {}
          },
          "typeVersion": 3
        },
        {
          "id": "25bc1156-cfa2-4633-a635-f7bb2f4f25f2",
          "name": "Get Notion Task",
          "type": "n8n-nodes-base.notion",
          "position": [
            3880,
            1420
          ],
          "parameters": {
            "limit": 1,
            "simple": false,
            "filters": {
              "conditions": [
                {
                  "key": "Todoist ID|rich_text",
                  "condition": "equals",
                  "richTextValue": "={{ $('Todoist').item.json.id }}"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Globals').first().json.database_id }}"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "alwaysOutputData": true,
          "waitBetweenTries": 5000
        },
        {
          "id": "01ec4ae8-22df-45ef-8593-4f16e3571c2e",
          "name": "Update Task in Todoist",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            3880,
            520
          ],
          "parameters": {
            "url": "=https://api.todoist.com/rest/v2/tasks/{{ $json.id }}",
            "method": "POST",
            "options": {},
            "jsonQuery": "={{ $json.toJsonString() }}",
            "sendQuery": true,
            "specifyQuery": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "4961331b-7cab-4c5e-b700-cb35e9258426",
          "name": "Pick Todoist Fields",
          "type": "n8n-nodes-base.set",
          "position": [
            3200,
            600
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "18fbd156-06db-4991-bee7-14d8bde6bbf5",
                  "name": "id",
                  "type": "string",
                  "value": "={{ $json.id }}"
                },
                {
                  "id": "a0c01dca-6cfa-4461-8c93-fe3f2191d624",
                  "name": "content",
                  "type": "string",
                  "value": "={{ $json.content }}"
                },
                {
                  "id": "a9bae78e-1a70-4b8e-be0c-ce74e546b0de",
                  "name": "priority",
                  "type": "string",
                  "value": "={{ $json.priority }}"
                },
                {
                  "id": "6ed4364e-6f62-464d-a841-e520b5bf3d96",
                  "name": "due_datetime",
                  "type": "string",
                  "value": "={{ $if($json.due.datetime !== undefined, $json.due.datetime.toDateTime().toISO(), $json.due.date) }}"
                },
                {
                  "id": "23035cde-aea0-459d-9886-06cd7f20dd61",
                  "name": "description",
                  "type": "string",
                  "value": "={{ $json.description }}"
                },
                {
                  "id": "6795fa58-4d52-4e88-8a1c-10e574ed2c3d",
                  "name": "section_id",
                  "type": "string",
                  "value": "={{ $json.section_id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "283370f2-93ff-4272-82bf-ad45c54e47f7",
          "name": "Map Notion to Todoist",
          "type": "n8n-nodes-base.code",
          "position": [
            3200,
            400
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const globals = $('Globals').first().json;\nconst properties = $json.properties;\n\nlet output = {};\n\noutput.id = properties['Todoist ID'].rich_text.length > 0 ? \n  properties['Todoist ID'].rich_text[0].text.content : \n  null;\n\noutput.content = properties['Name'].title.length > 0 ? properties['Name'].title[0].text.content : '[empty]';\n\noutput.description = \"[â†— Open in Notion](\" + $json.url + \")\"\n\n// Map priority\nif (properties['Priority'].select === null) {\n  output.priority = \"1\"; // P4\n} else {\n  output.priority = {\n    \"do first\": \"4\", // P1\n    \"urgent\": \"3\", // P2\n    \"important\": \"2\" // P3\n  }[properties['Priority'].select.name] ?? \"1\"; // P4\n}\n\n// Map section\nconst statusName = properties['Status'].status.name;\noutput.section_id = null;\nif (!['Done', 'Obsolete'].includes(statusName)) {\n  const sectionMap = Object.fromEntries(\n      globals.sections.map(section => [section.name, section.id])\n  );\n  if (!sectionMap.hasOwnProperty(statusName)) {\n      throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n  }\n  output.section_id = sectionMap[statusName];\n}\n\n// Set UTC if time is set\noutput.due_datetime = null;\nif (properties['Due'].date !== null) {\n  output.due_datetime = properties.Due.date.start;\n  if (properties.Due.date.start.length > 10) {\n    output.due_datetime = new Date(properties.Due.date.start).toISOString();\n  }\n}\n\nreturn { json: output };"
          },
          "typeVersion": 2
        },
        {
          "id": "ca33c90f-3204-45e1-9d66-20e7e740a4d7",
          "name": "Update task in Todoist before closing",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            4540,
            1120
          ],
          "parameters": {
            "url": "=https://api.todoist.com/rest/v2/tasks/{{ $json.id }}",
            "method": "POST",
            "options": {},
            "jsonQuery": "={{ $json.toJsonString() }}",
            "sendQuery": true,
            "specifyQuery": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "dd79e458-8c60-4de8-bdde-ec0009b2d4dc",
          "name": "Map Notion to Todoist1",
          "type": "n8n-nodes-base.code",
          "position": [
            4100,
            1120
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const globals = $('Globals').first().json;\nconst properties = $json.properties;\n\nlet output = {};\n\noutput.id = properties['Todoist ID'].rich_text.length > 0 ? \n  properties['Todoist ID'].rich_text[0].text.content : \n  null;\n\noutput.content = properties['Name'].title.length > 0 ? properties['Name'].title[0].text.content : '[empty]';\n\noutput.description = \"[â†— Open in Notion](\" + $json.url + \")\"\n\n// Map priority\nif (properties['Priority'].select === null) {\n  output.priority = \"1\"; // P4\n} else {\n  output.priority = {\n    \"do first\": \"4\", // P1\n    \"urgent\": \"3\", // P2\n    \"important\": \"2\" // P3\n  }[properties['Priority'].select.name] ?? \"1\"; // P4\n}\n\n// Map section\nconst statusName = properties['Status'].status.name;\noutput.section_id = null;\nif (!['Done', 'Obsolete'].includes(statusName)) {\n  const sectionMap = Object.fromEntries(\n      globals.sections.map(section => [section.name, section.id])\n  );\n  if (!sectionMap.hasOwnProperty(statusName)) {\n      throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n  }\n  output.section_id = sectionMap[statusName];\n}\n\n// Set UTC if time is set\noutput.due_datetime = null;\nif (properties['Due'].date !== null) {\n  output.due_datetime = properties.Due.date.start;\n  if (properties.Due.date.start.length > 10) {\n    output.due_datetime = new Date(properties.Due.date.start).toISOString();\n  }\n}\n\nreturn { json: output };"
          },
          "typeVersion": 2
        },
        {
          "id": "7dec20dc-c1a9-4fd7-85b0-c3425a73ff66",
          "name": "Handle empty dates",
          "type": "n8n-nodes-base.code",
          "position": [
            3660,
            520
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// API requires due_string instead of due_datetime when date/time is removed\nif ($json.due_datetime === null) {\n  delete $json.due_datetime;\n  $input.item.json.due_string = \"no date\";\n}\n\nreturn $input.item;"
          },
          "typeVersion": 2
        },
        {
          "id": "b1bf65ad-b9b1-49ba-a892-678966c520a3",
          "name": "Handle empty dates1",
          "type": "n8n-nodes-base.code",
          "position": [
            4320,
            1120
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// API requires due_string instead of due_datetime when date/time is removed\nif ($json.due_datetime === null) {\n  delete $json.due_datetime;\n  $input.item.json.due_string = \"no date\";\n}\n\nreturn $input.item;"
          },
          "typeVersion": 2
        },
        {
          "id": "8dbd2213-4a7f-44ef-9276-67672c6bb1ec",
          "name": "Handle empty dates2",
          "type": "n8n-nodes-base.code",
          "position": [
            3660,
            -180
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// API requires due_string instead of due_datetime when date/time is removed\nif ($json.due_datetime === null) {\n  delete $json.due_datetime;\n  $input.item.json.due_string = \"no date\";\n}\n\nreturn $input.item;"
          },
          "typeVersion": 2
        },
        {
          "id": "4a538bb6-80f6-4920-b96a-0756e0dc5449",
          "name": "Create task in Todoist",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            4980,
            -280
          ],
          "parameters": {
            "url": "=https://api.todoist.com/rest/v2/tasks",
            "method": "POST",
            "options": {},
            "jsonQuery": "={{ $('If Todoist ID exists').item.json.toJsonString() }}",
            "sendQuery": true,
            "specifyQuery": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "afdad4ec-e8bc-48c0-b80d-e1f4066871c2",
          "name": "Add project ID",
          "type": "n8n-nodes-base.set",
          "position": [
            3880,
            -180
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "38aef493-8125-46fd-82bc-93c6d7d6f66e",
                  "name": "project_id",
                  "type": "string",
                  "value": "={{ $('Globals').first().json.project_id }}"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "fb2f5730-5a69-4bed-983f-9597da7a0065",
          "name": "Lock Todoist ID",
          "type": "n8n-nodes-base.redis",
          "position": [
            5200,
            -380
          ],
          "parameters": {
            "key": "=lock_{{ $('Compare Datasets').item.json.id }}",
            "ttl": 15,
            "value": "={{ $now.toISO() }}",
            "expire": true,
            "keyType": "string",
            "operation": "set"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "8f4e1ffd-a46c-4161-b6ed-89c0e78c47b1",
          "name": "Generate UUID",
          "type": "n8n-nodes-base.crypto",
          "position": [
            6080,
            -80
          ],
          "parameters": {
            "action": "generate",
            "dataPropertyName": "uuid"
          },
          "typeVersion": 1
        },
        {
          "id": "28b4e10e-a9cb-40c0-9a2c-d45303f4b64e",
          "name": "Update section (Sync API)",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            6740,
            -80
          ],
          "parameters": {
            "url": "https://api.todoist.com/sync/v9/sync",
            "method": "POST",
            "options": {},
            "sendBody": true,
            "contentType": "form-urlencoded",
            "authentication": "predefinedCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "commands",
                  "value": "={{ $json.commands.toJsonString() }}"
                }
              ]
            },
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "82cabb00-43bf-404a-9b3b-0a95bee0ba26",
          "name": "Status changed",
          "type": "n8n-nodes-base.filter",
          "position": [
            4100,
            520
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "or",
              "conditions": [
                {
                  "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist').item.json.section_id }}",
                  "rightValue": "={{ $json.section_id }}"
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "d4242f35-f49f-4b3e-a99d-dacc90ea912a",
          "name": "Aggregate",
          "type": "n8n-nodes-base.aggregate",
          "position": [
            6520,
            -80
          ],
          "parameters": {
            "options": {},
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "commands"
          },
          "typeVersion": 1
        },
        {
          "id": "4f6d649b-94c7-4826-950c-1f1632037d56",
          "name": "Prepare Batching Items",
          "type": "n8n-nodes-base.set",
          "position": [
            6300,
            -80
          ],
          "parameters": {
            "mode": "raw",
            "options": {},
            "jsonOutput": "={\n    \"type\": \"item_move\",\n    \"uuid\": \"{{ $json.uuid }}\",\n    \"args\": {\n      \"id\": \"{{ $('Merge').item.json.item.id }}\",\n      \"section_id\": \"{{ $json.item.section_id }}\"\n    }\n  }\n"
          },
          "typeVersion": 3.4
        },
        {
          "id": "4d5993d2-13af-47e3-b17a-9c19db7d0489",
          "name": "Loop Over Items1",
          "type": "n8n-nodes-base.splitInBatches",
          "position": [
            5860,
            -180
          ],
          "parameters": {
            "options": {},
            "batchSize": 100
          },
          "typeVersion": 3
        },
        {
          "id": "5235aab4-70f2-4d21-b9d3-a11ab817dd13",
          "name": "Status is Done",
          "type": "n8n-nodes-base.if",
          "position": [
            4760,
            1220
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "a4a40d08-7929-46da-8369-c6d33b14e4f3",
                  "operator": {
                    "name": "filter.operator.equals",
                    "type": "string",
                    "operation": "equals"
                  },
                  "leftValue": "={{ $('Exists/Completed in Notion').item.json.properties['Status'].status.name }}",
                  "rightValue": "Done"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "608efb15-5e9b-49c2-96ea-ad35445c82bd",
          "name": "Lock Todoist ID1",
          "type": "n8n-nodes-base.redis",
          "position": [
            4760,
            1020
          ],
          "parameters": {
            "key": "=lock_{{ $('Compare Datasets').item.json.id }}",
            "ttl": 15,
            "value": "={{ $now.toISO() }}",
            "expire": true,
            "keyType": "string",
            "operation": "set"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "2d571e77-6162-4f5c-a147-99878d5b559a",
          "name": "Lock Todoist ID2",
          "type": "n8n-nodes-base.redis",
          "position": [
            4100,
            320
          ],
          "parameters": {
            "key": "=lock_{{ $('Compare Datasets').item.json.id }}",
            "ttl": 15,
            "value": "={{ $now.toISO() }}",
            "expire": true,
            "keyType": "string",
            "operation": "set"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "cee5f777-4763-490e-a89f-8ba715cfd5b8",
          "name": "Update task in Todoist",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            5200,
            -580
          ],
          "parameters": {
            "url": "=https://api.todoist.com/rest/v2/tasks/{{ $('If Todoist ID exists').item.json.id }}",
            "method": "POST",
            "options": {},
            "jsonQuery": "={{ $('If Todoist ID exists').item.json.toJsonString() }}",
            "sendQuery": true,
            "specifyQuery": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "0b2c57af-c3b6-4bed-8e4c-ec2f84576a47",
          "name": "Get mapped item",
          "type": "n8n-nodes-base.set",
          "position": [
            5420,
            -580
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "7419f1e6-2978-4e4d-9147-61dcb693260b",
                  "name": "item",
                  "type": "object",
                  "value": "={{ $('Map Notion to Todoist').item.json }}"
                },
                {
                  "id": "7684427f-3267-4092-a5d3-0d13fe4e2ebb",
                  "name": "action",
                  "type": "string",
                  "value": "reopened"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "e6d335b2-e848-4802-9809-15ea9eb3fd29",
          "name": "Get mapped item1",
          "type": "n8n-nodes-base.set",
          "position": [
            5000,
            520
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "7679df9c-ccdb-425c-ad60-c8bd85379e87",
                  "name": "item",
                  "type": "object",
                  "value": "={{ $('Map Notion to Todoist').item.json }}"
                },
                {
                  "id": "d6bc106f-ed01-49be-9c27-13429684d573",
                  "name": "action",
                  "type": "string",
                  "value": "updated_status"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "ce49a060-0a2b-491f-b6f5-efa49b54e8d3",
          "name": "Schedule Trigger",
          "type": "n8n-nodes-base.scheduleTrigger",
          "position": [
            2760,
            500
          ],
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 6
                }
              ]
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "4402861c-7b7e-47c4-9e5c-91589262c556",
          "name": "Prepare summary data",
          "type": "n8n-nodes-base.set",
          "position": [
            4100,
            720
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "2d823132-c41f-4685-9443-8ee143809ccb",
                  "name": "item",
                  "type": "object",
                  "value": "={{ $('Map Notion to Todoist').item.json }}"
                },
                {
                  "id": "45b155c2-4254-45b3-bdd4-127ee356f8d4",
                  "name": "action",
                  "type": "string",
                  "value": "updated"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "3a26cfc0-3e4e-4e14-80ef-2ad00236ae38",
          "name": "Prepare summary data1",
          "type": "n8n-nodes-base.set",
          "position": [
            5200,
            1120
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "9614bc29-d8fa-4531-a8fc-5974f58e0f7a",
                  "name": "item",
                  "type": "object",
                  "value": "={{ $('Todoist').item.json }}"
                },
                {
                  "id": "6c0ffc23-a595-49ce-82b9-b02c3f9766d8",
                  "name": "action",
                  "type": "string",
                  "value": "completed"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "a3e4e83d-6789-4c55-9699-41da5eeac9e4",
          "name": "Merge",
          "type": "n8n-nodes-base.merge",
          "position": [
            5640,
            -180
          ],
          "parameters": {},
          "typeVersion": 3
        },
        {
          "id": "9b93f9ff-0c11-49eb-8425-7d3dc71eaa0b",
          "name": "Prepare summary data2",
          "type": "n8n-nodes-base.set",
          "position": [
            5200,
            1320
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "833becab-363d-48f1-8911-12abd34f16a0",
                  "name": "item",
                  "type": "object",
                  "value": "={{ $('Todoist').item.json }}"
                },
                {
                  "id": "306997a6-442e-44cc-ace1-c9bfe83ef28e",
                  "name": "action",
                  "type": "string",
                  "value": "deleted"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "f6ea7bc7-093b-47ea-8bb0-48a487566218",
          "name": "Filter out status changes",
          "type": "n8n-nodes-base.filter",
          "position": [
            6100,
            720
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "db22023d-a3ff-4891-8c14-5316be7e5334",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $json.action }}",
                  "rightValue": "updated_status"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "63990a2a-7380-4799-9037-bd98ed779ddd",
          "name": "Map Todoist to Notion",
          "type": "n8n-nodes-base.code",
          "position": [
            6320,
            720
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const globals = $('Globals').first().json;\nlet eventData = $json.item;\n\nlet output = {};\n\noutput.name = eventData.content\n\n// Map priority\noutput.priority = {\n  \"4\": \"do first\", // P1\n  \"3\": \"urgent\", // P2\n  \"2\": \"important\" // P3\n}[eventData.priority] ?? \"\"; // P4\n\n// Map section\nconst sectionId = eventData.section_id;\nconst sectionMap = Object.fromEntries(\n    globals.sections.map(section => [section.id, section.name])\n);\n\noutput.status = \"Backlog\";\nif (sectionId !== null) {\n  if (!sectionMap.hasOwnProperty(sectionId)) {\n    //throw new Error(\"No status name found for section ID '\" + sectionId + \"'\");\n  }\n  output.status = sectionMap[sectionId];\n}\n\n// Since there is no Done section in Todoist, override status if completed\nif (eventData.is_completed) {\n  output.status = \"Done\";\n}\n\nif ($json.action == \"deleted\") {\n  output.status = \"Obsolete\";\n}\n\n// Format due date\noutput.due = eventData.due ? eventData.due.date : eventData.due_datetime || \"\"\n\nreturn { json: output };"
          },
          "typeVersion": 2
        },
        {
          "id": "a5f3a1ed-1a97-441e-afbc-604b5011928e",
          "name": "Map summary fields",
          "type": "n8n-nodes-base.set",
          "position": [
            6540,
            720
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "e0fcdd39-1bd8-44e7-b84f-0b6ba834fb46",
                  "name": "name",
                  "type": "string",
                  "value": "=<a href=\"{{ $('Merge summary').item.json.item.description.extractUrl().replaceAll(')', '') }}\">{{ $json.name }}</a>"
                },
                {
                  "id": "f3bdfee8-1671-4e80-b8da-febe6f463756",
                  "name": "priority",
                  "type": "string",
                  "value": "={{ $json.priority }}"
                },
                {
                  "id": "060bfe55-0dfa-406b-99cc-ad8592a209dc",
                  "name": "status",
                  "type": "string",
                  "value": "={{ $json.status }}"
                },
                {
                  "id": "7b0ee321-0631-4cde-b1a7-b3547aff3561",
                  "name": "due",
                  "type": "string",
                  "value": "={{ $if(!$json.due, '', $if($json.due.length > 10, $json.due.toDateTime().toLocaleString({ dateStyle: 'medium', timeStyle: 'short' }), $json.due.toDateTime().toLocaleString({ dateStyle: 'medium' }))) }}"
                },
                {
                  "id": "11184572-1126-4b21-aa72-1540969200f3",
                  "name": "action",
                  "type": "string",
                  "value": "={{ $('Merge summary').item.json.action }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "50a844e8-5c5c-43e6-b774-993af828cb11",
          "name": "Convert to HTML Table",
          "type": "n8n-nodes-base.html",
          "position": [
            6760,
            720
          ],
          "parameters": {
            "options": {
              "capitalize": true
            },
            "operation": "convertToHtmlTable"
          },
          "typeVersion": 1.2
        },
        {
          "id": "53e56e25-4931-4a1a-b70f-1eda8520c649",
          "name": "Generate email body",
          "type": "n8n-nodes-base.html",
          "position": [
            6980,
            720
          ],
          "parameters": {
            "html": "<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            margin: 0;\n            padding: 20px;\n        }\n        .container {\n            max-width: 800px;\n            margin: 0 auto;\n            background-color: #ffffff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n        }\n        h1 {\n            color: #2c3e50;\n            text-align: center;\n            margin-bottom: 30px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #3498db;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 20px;\n        }\n        th {\n            background-color: #3498db;\n            color: white;\n            padding: 12px;\n            text-align: left;\n        }\n        td {\n            padding: 10px;\n            border-bottom: 1px solid #ddd;\n        }\n        tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n        tr:hover {\n            background-color: #f5f5f5;\n        }\n        a {\n            color: #333;\n            text-decoration: underline;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Notion-Todoist Sync Report</h1>\n        <p>The following changes have been applied to Todoist:</p>\n        {{ $json.table }}\n    </div>\n</body>\n</html>\n"
          },
          "typeVersion": 1.2
        },
        {
          "id": "aa0507f8-e5b4-45b1-89bb-6ced3dd9b27e",
          "name": "Get mapped item2",
          "type": "n8n-nodes-base.set",
          "position": [
            5420,
            -180
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "7679df9c-ccdb-425c-ad60-c8bd85379e87",
                  "name": "item",
                  "type": "object",
                  "value": "={{ $('Map Notion to Todoist').item.json }}"
                },
                {
                  "id": "d6bc106f-ed01-49be-9c27-13429684d573",
                  "name": "action",
                  "type": "string",
                  "value": "created"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "60826717-078e-4509-9dbd-8b3896078a9c",
          "name": "Gmail",
          "type": "n8n-nodes-base.gmail",
          "position": [
            7200,
            720
          ],
          "webhookId": "5af8a60e-a295-40c1-8f03-0a920ba1de17",
          "parameters": {
            "message": "={{ $json.html }}",
            "options": {
              "appendAttribution": false
            },
            "subject": "Notion-Todoist Sync Report"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "TWM2BLjDHQtGAFQn",
              "name": "Gmail (octionicsolutions)"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "29ea508e-eba9-40a3-9840-d70d4ec51ddb",
          "name": "Merge summary",
          "type": "n8n-nodes-base.merge",
          "position": [
            5880,
            680
          ],
          "parameters": {
            "numberInputs": 5
          },
          "typeVersion": 3
        },
        {
          "id": "9773c5d4-a910-4b26-858d-2abf30c9602f",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3140,
            260
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 300,
            "content": "## Keep in sync\nif you update the mapping, make sure to change it in the other node as well!"
          },
          "typeVersion": 1
        },
        {
          "id": "e4224f99-4063-49a2-a5cd-c2515b117bc5",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            4040,
            980
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 300,
            "content": "## Keep in sync\nif you update the mapping, make sure to change it in the other node as well!"
          },
          "typeVersion": 1
        },
        {
          "id": "3d5662ad-81a4-4a02-abe3-38d59a08bf9f",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2920,
            20
          ],
          "parameters": {
            "width": 220,
            "height": 300,
            "content": "## Set Globals\nUse Sync Setup Helper Workflow to generate the JSON and paste it in every Globals Nodes"
          },
          "typeVersion": 1
        },
        {
          "id": "e78779d9-32f9-467f-ae2c-ad0cec69f506",
          "name": "Globals",
          "type": "n8n-nodes-base.set",
          "position": [
            2980,
            160
          ],
          "parameters": {
            "mode": "raw",
            "options": {},
            "jsonOutput": "{\n  \"database_id\": \"165beaa8f4448063be17d105a9898961\",\n  \"project_id\": \"2327925123\",\n  \"sections\": [\n    {\"id\": \"177308158\", \"name\": \"Backlog\"},\n    {\"id\": \"175778849\", \"name\": \"In progress\"},\n    {\"id\": \"175778857\", \"name\": \"On hold\"}\n  ]\n}"
          },
          "executeOnce": false,
          "typeVersion": 3.4
        },
        {
          "id": "f01855a1-e9bf-469a-ad68-bef8d0286e3a",
          "name": "Sticky Note14",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            5800,
            -260
          ],
          "parameters": {
            "color": 7,
            "width": 1100,
            "height": 380,
            "content": "Update section for each task in Todoist using the Sync API in full sync mode. Use batching and split into multiple batches, if needed, since there is a request limit of 100 full syncs within a 15 minute period."
          },
          "typeVersion": 1
        },
        {
          "id": "2ec59ee5-5ffb-4b57-9a2d-0f7d10a580ba",
          "name": "Sticky Note15",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2640,
            -740
          ],
          "parameters": {
            "color": 5,
            "width": 4760,
            "height": 2420,
            "content": "# Unidirectional sync from Notion to Todoist"
          },
          "typeVersion": 1
        },
        {
          "id": "a6f87f39-6885-4fff-99f0-1f29f0db25b7",
          "name": "Sticky Note16",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2920,
            320
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 440,
            "content": "Get open/incomplete tasks from both Notion and Todoist"
          },
          "typeVersion": 1
        },
        {
          "id": "fcffe10e-4ab3-4172-8be3-d060a4070922",
          "name": "Sticky Note17",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6040,
            660
          ],
          "parameters": {
            "color": 7,
            "width": 1100,
            "height": 220,
            "content": "Generate an email report containing all changes made by this workflow, since changes in Todoist are being overwritten."
          },
          "typeVersion": 1
        },
        {
          "id": "af70e38e-eca7-4eba-9125-69a8ff222ac0",
          "name": "Execute Workflow Trigger",
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "disabled": true,
          "position": [
            2800,
            3540
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "8e09225d-5d7b-468e-a8f6-c0836469799a",
          "name": "Differences exist1",
          "type": "n8n-nodes-base.filter",
          "position": [
            6980,
            2720
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "or",
              "conditions": [
                {
                  "id": "db8871d6-7f3f-468e-9a6e-3975c9f003f5",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Todoist to Notion1').item.json.name }}",
                  "rightValue": "={{ $json.name }}"
                },
                {
                  "id": "df493beb-52a8-47f7-90c6-fb5786b1deed",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Todoist to Notion1').item.json.priority }}",
                  "rightValue": "={{ $json.property_priority }}"
                },
                {
                  "id": "8942df51-6aa3-46d6-91f3-c6949bfd2361",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Todoist to Notion1').item.json.status }}",
                  "rightValue": "={{ $json.property_status }}"
                },
                {
                  "id": "5484e1f8-4fbc-4c63-829a-4b45b9090702",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $if($('Map Todoist to Notion1').item.json.due !== null, $('Map Todoist to Notion1').item.json.due.toDateTime().toISO(), null) }}",
                  "rightValue": "={{ $if($json.property_due !== null, $json.property_due.start.toDateTime().toISO(), null) }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "d30a9839-6ff4-49d3-8413-4c4786c47a0a",
          "name": "Requires completion change1",
          "type": "n8n-nodes-base.filter",
          "position": [
            6980,
            3100
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "b9e134c4-66a7-4a83-8372-282c19fdc98e",
                  "operator": {
                    "type": "boolean",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Get Todoist Task1').item.json.is_completed }}",
                  "rightValue": "={{ $if($json.property_status == \"Done\", true, false) }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "38edc95d-ae92-46bb-9cc5-338588d720af",
          "name": "Create task in Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            7420,
            2220
          ],
          "parameters": {
            "title": "={{ $('Map Todoist to Notion1').item.json.name }}",
            "options": {},
            "resource": "databasePage",
            "databaseId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Globals1').first().json.database_id }}"
            },
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Todoist ID|rich_text",
                  "textContent": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}"
                },
                {
                  "key": "Priority|select",
                  "selectValue": "={{ $('Map Todoist to Notion1').item.json.priority }}"
                },
                {
                  "key": "Status|status",
                  "statusValue": "={{ $('Map Todoist to Notion1').item.json.status }}"
                },
                {
                  "key": "Due|date",
                  "date": "={{ $('Map Todoist to Notion1').item.json.due || '' }}",
                  "includeTime": "={{ $('Map Todoist to Notion1').item.json.due !== null && $('Map Todoist to Notion1').item.json.due.length > 10 }}"
                },
                {
                  "key": "Focus|checkbox",
                  "checkboxValue": true
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "fd60280f-aef7-43f6-835c-0086adad3952",
          "name": "Update task in Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            7640,
            2720
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Name|title",
                  "title": "={{ $('Map Todoist to Notion1').item.json.name }}"
                },
                {
                  "key": "Priority|select",
                  "selectValue": "={{ $('Map Todoist to Notion1').item.json.priority }}"
                },
                {
                  "key": "Status|status",
                  "statusValue": "={{ $('Map Todoist to Notion1').item.json.status }}"
                },
                {
                  "key": "Due|date",
                  "date": "={{ $ifEmpty($('Map Todoist to Notion1').item.json.due, \"\") }}",
                  "includeTime": "={{ $('Map Todoist to Notion1').item.json.due !== null && $('Map Todoist to Notion1').item.json.due.length > 10 }}"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "5aecc1ce-f83b-43a2-b2a3-44b00b59f26b",
          "name": "Mark as Done in Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            7640,
            3380
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Status|status",
                  "statusValue": "Done"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "fb2c809e-50ad-4627-ad7e-4919cf30b845",
          "name": "Mark as Obsolete in Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            7640,
            3700
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Status|status",
                  "statusValue": "Obsolete"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "6cb3caa1-45f5-4675-ae06-5c15163ccac1",
          "name": "Mark as In Progress in Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            7640,
            3180
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Status|status",
                  "statusValue": "In progress"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "7aa800dd-620a-40b3-86a3-9fc07aeb51fb",
          "name": "Only continue if not locked",
          "type": "n8n-nodes-base.filter",
          "position": [
            3860,
            2900
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.item }}",
                  "rightValue": "={{ null }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "ddf2093b-3528-4141-9694-0bc164851919",
          "name": "Lock Notion ID",
          "type": "n8n-nodes-base.redis",
          "position": [
            8300,
            3040
          ],
          "parameters": {
            "key": "=lock_{{ $json.id }}",
            "ttl": 15,
            "value": "={{ $now.toISO() }}",
            "expire": true,
            "keyType": "string",
            "operation": "set"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "05aac18c-e591-430e-9bc9-93a581cb0e89",
          "name": "Check if Todoist ID is locked",
          "type": "n8n-nodes-base.redis",
          "position": [
            3640,
            2900
          ],
          "parameters": {
            "key": "=lock_{{ $json.body.event_data.id }}",
            "keyType": "string",
            "options": {},
            "operation": "get",
            "propertyName": "item"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "4df2d7a9-ca8e-4b64-a797-1cf9ec4786cc",
          "name": "Update Description in Todoist",
          "type": "n8n-nodes-base.todoist",
          "position": [
            7860,
            2220
          ],
          "parameters": {
            "taskId": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}",
            "operation": "update",
            "updateFields": {
              "description": "={{ \"[â†— Open in Notion](\" + $('Create task in Notion').item.json.url + \")\" }}"
            }
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "a2b07adf-6e01-4bbc-a852-8b59fb20046f",
          "name": "Description has changed in Todoist",
          "type": "n8n-nodes-base.filter",
          "position": [
            6980,
            2920
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "or",
              "conditions": [
                {
                  "id": "db8871d6-7f3f-468e-9a6e-3975c9f003f5",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Get Todoist Task1').item.json.description }}",
                  "rightValue": "={{ \"[â†— Open in Notion](\" + $json.url + \")\" }}"
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "5fe846b7-9869-4d1f-a6f0-6cd14e3127d4",
          "name": "Update Description in Todoist1",
          "type": "n8n-nodes-base.todoist",
          "position": [
            7200,
            2920
          ],
          "parameters": {
            "taskId": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}",
            "operation": "update",
            "updateFields": {
              "description": "={{ \"[â†— Open in Notion](\" + $json.url + \")\" }}"
            }
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "879b47ad-5d32-4a40-ad61-690762e202b0",
          "name": "Generate UUID1",
          "type": "n8n-nodes-base.crypto",
          "position": [
            7420,
            2440
          ],
          "parameters": {
            "action": "generate",
            "dataPropertyName": "uuid"
          },
          "typeVersion": 1
        },
        {
          "id": "106f7e35-0cc2-4054-817c-6c3d50407e88",
          "name": "Update section (Sync API)1",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            7640,
            2440
          ],
          "parameters": {
            "url": "https://api.todoist.com/sync/v9/sync",
            "method": "POST",
            "options": {},
            "sendBody": true,
            "contentType": "form-urlencoded",
            "authentication": "predefinedCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "commands",
                  "value": "=[ { \"type\": \"item_move\", \"uuid\": \"{{ $json.uuid }}\", \"args\": { \"id\": \"{{ $('Map Todoist to Notion1').item.json.todoist_id }}\", \"section_id\": \"{{ $json.section_id }}\" } }]"
                }
              ]
            },
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "20d2cdc2-92ca-497d-a606-445ecf52e908",
          "name": "Get Backlog Section ID",
          "type": "n8n-nodes-base.code",
          "position": [
            7200,
            2440
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const globals = $('Globals1').first().json;\n\nlet output = {};\n\nconst statusName = $('Map Todoist to Notion1').item.json.status;\nconst sectionMap = Object.fromEntries(\n    globals.sections.map(section => [section.name, section.id])\n);\nif (!sectionMap.hasOwnProperty(statusName)) {\n    throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n}\noutput.section_id = sectionMap[statusName];\n\nreturn { json: output };"
          },
          "typeVersion": 2
        },
        {
          "id": "72819157-59db-4a4e-ad13-1bf73c583be7",
          "name": "Notion Task not found",
          "type": "n8n-nodes-base.if",
          "position": [
            6280,
            2760
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "27ce7ba1-43e5-4534-a759-1bafb979c190",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "3b5d3da8-e8b6-46d0-8706-88a9d1a5e95a",
          "name": "Check if creating flag exists1",
          "type": "n8n-nodes-base.redis",
          "position": [
            6540,
            2440
          ],
          "parameters": {
            "key": "=creating_for_{{ $('Todoist trigger reference').item.json.body.event_data.id }}",
            "keyType": "string",
            "options": {},
            "operation": "get",
            "propertyName": "item"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "1dc24cdd-63e7-4307-a945-6cc07babd535",
          "name": "Only continue if flag does not exist1",
          "type": "n8n-nodes-base.filter",
          "position": [
            6760,
            2440
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.item }}",
                  "rightValue": "={{ null }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "2e64fc80-428b-4f14-a7a1-db158bc58b06",
          "name": "Set creating flag1",
          "type": "n8n-nodes-base.redis",
          "position": [
            6980,
            2440
          ],
          "parameters": {
            "key": "=creating_for_{{ $('Todoist trigger reference').item.json.body.event_data.id }}",
            "ttl": 10,
            "value": "={{ $now.toISO() }}",
            "expire": true,
            "keyType": "string",
            "operation": "set"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "4a2cb838-40d6-4e16-bb41-c04548d3394c",
          "name": "Neither focussed nor planned1",
          "type": "n8n-nodes-base.filter",
          "position": [
            7420,
            3020
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "95c47aa4-249c-4235-89c2-44c16c5b65bb",
                  "operator": {
                    "type": "boolean",
                    "operation": "false",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.property_focus }}",
                  "rightValue": ""
                },
                {
                  "id": "a611c1d2-d01a-4f5a-8ad8-cfaa65b11202",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.property_due }}",
                  "rightValue": ""
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "56df5752-6beb-4ebe-8b6c-1b5752633db3",
          "name": "Mark as Focussed in Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            7640,
            2920
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Focus|checkbox",
                  "checkboxValue": true
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "e031cb0d-41bf-4273-a198-5485cdaa3758",
          "name": "Todoist trigger reference",
          "type": "n8n-nodes-base.noOp",
          "position": [
            3200,
            2900
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "539bac50-20c8-4212-aaa5-a99b7f2c3cdb",
          "name": "Get Notion Task2",
          "type": "n8n-nodes-base.notion",
          "position": [
            6760,
            3700
          ],
          "parameters": {
            "limit": 1,
            "filters": {
              "conditions": [
                {
                  "key": "Todoist ID|rich_text",
                  "condition": "equals",
                  "richTextValue": "={{ $('Todoist trigger reference').item.json.body.event_data.id }}"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Globals1').first().json.database_id }}"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "typeVersion": 2.2,
          "alwaysOutputData": true
        },
        {
          "id": "1585da72-5578-456b-a092-21e66b033350",
          "name": "Notion Task found1",
          "type": "n8n-nodes-base.filter",
          "position": [
            6980,
            3700
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "d644079f-b140-42b3-85c5-f1283a6d21d8",
                  "operator": {
                    "type": "object",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "c5df6b20-a7ed-4e57-9814-091f76ee677b",
          "name": "Switch by Event",
          "type": "n8n-nodes-base.switch",
          "position": [
            6760,
            2920
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "item:updated",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "4ffd3f5d-dc24-47cb-a4df-1a6f6a6dc2b9",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
                        "rightValue": "item:updated"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "item:completed",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "d5290195-6595-4c91-af86-6df724bb0980",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
                        "rightValue": "item:completed"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "item:uncompleted",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "e047ade5-ce68-4bc8-b799-7130bd0eb917",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
                        "rightValue": "item:uncompleted"
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 3.2
        },
        {
          "id": "74859244-46a3-45a2-8e90-923c6bdc0d40",
          "name": "If event is not :deleted",
          "type": "n8n-nodes-base.if",
          "position": [
            4080,
            2900
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "4fb65ecf-dbb9-4bd1-a5a8-614441aa2963",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
                  "rightValue": "item:deleted"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "f3404606-51e8-4b53-b332-20f9cf26a969",
          "name": "Execution Data",
          "type": "n8n-nodes-base.executionData",
          "position": [
            3420,
            2900
          ],
          "parameters": {
            "dataToSave": {
              "values": [
                {
                  "key": "database_id",
                  "value": "={{ $('Globals1').first().json.database_id }}"
                },
                {
                  "key": "project_id",
                  "value": "={{ $('Globals1').first().json.project_id }}"
                },
                {
                  "key": "todoist_id",
                  "value": "={{ $json.body.event_data.id }}"
                },
                {
                  "key": "source",
                  "value": "Todoist"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "643b67db-43e2-47fb-8f7f-1c5ad7b780fc",
          "name": "Execution Data1",
          "type": "n8n-nodes-base.executionData",
          "position": [
            5840,
            2760
          ],
          "parameters": {
            "dataToSave": {
              "values": [
                {
                  "key": "task_name",
                  "value": "={{ $json.name }}"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "ad4ff5a0-ab39-48f9-82fd-9f920b8160d5",
          "name": "Execution Data2",
          "type": "n8n-nodes-base.executionData",
          "position": [
            7640,
            2220
          ],
          "parameters": {
            "dataToSave": {
              "values": [
                {
                  "key": "notion_id",
                  "value": "={{ $json.id }}"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "ee82b160-35ce-4943-b8f7-6297382f0656",
          "name": "Execution Data3",
          "type": "n8n-nodes-base.executionData",
          "position": [
            6540,
            2920
          ],
          "parameters": {
            "dataToSave": {
              "values": [
                {
                  "key": "notion_id",
                  "value": "={{ $json.id }}"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "591f2447-1a81-436c-b073-838cb3011f51",
          "name": "Execution Data4",
          "type": "n8n-nodes-base.executionData",
          "position": [
            7200,
            3700
          ],
          "parameters": {
            "dataToSave": {
              "values": [
                {
                  "key": "notion_id",
                  "value": "={{ $json.id }}"
                },
                {
                  "key": "task_name",
                  "value": "={{ $json.name }}"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "558f1a95-56ad-43c0-b924-b8a6ad50cf36",
          "name": "Globals1",
          "type": "n8n-nodes-base.set",
          "position": [
            3420,
            2640
          ],
          "parameters": {
            "mode": "raw",
            "options": {},
            "jsonOutput": "{\n  \"database_id\": \"165beaa8-f444-8063-be17-d105a9898961\",\n  \"project_id\": \"2327925123\",\n  \"sections\": [\n    {\"id\": \"177308158\", \"name\": \"Backlog\"},\n    {\"id\": \"175778849\", \"name\": \"In progress\"},\n    {\"id\": \"175778857\", \"name\": \"On hold\"}\n  ]\n}"
          },
          "executeOnce": true,
          "typeVersion": 3.4
        },
        {
          "id": "3f39ff17-8700-475e-9ae7-ef3dbef299af",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3360,
            2500
          ],
          "parameters": {
            "width": 220,
            "height": 300,
            "content": "## Set Globals\nUse Sync Setup Helper Workflow to generate the JSON and paste it in every Globals Nodes"
          },
          "typeVersion": 1
        },
        {
          "id": "44393b98-739a-4478-a485-67b8bb59e901",
          "name": "Map Todoist to Notion1",
          "type": "n8n-nodes-base.code",
          "position": [
            5620,
            2760
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const globals = $('Globals1').first().json;\nlet eventData = $json;\n\nlet output = {};\n\noutput.todoist_id = eventData.id;\n\noutput.name = eventData.content\n\n// Map priority\noutput.priority = {\n  \"4\": \"do first\", // P1\n  \"3\": \"urgent\", // P2\n  \"2\": \"important\" // P3\n}[eventData.priority] ?? \"\"; // P4\n\n// Map section\nconst sectionId = eventData.section_id;\nconst sectionMap = Object.fromEntries(\n    globals.sections.map(section => [section.id, section.name])\n);\n\noutput.status = \"Backlog\";\nif (sectionId !== null) {\n  if (!sectionMap.hasOwnProperty(sectionId)) {\n    throw new Error(\"No status name found for section ID '\" + sectionId + \"'\");\n  }\n  output.status = sectionMap[sectionId];\n}\n\n// Since there is no Done section in Todoist, override status if completed\nif (eventData.is_completed) {\n  output.status = \"Done\";\n}\n\n// Map date and time\noutput.due = null;\nif (eventData.due !== null) {\n  output.due = eventData.due.date\n  if (eventData.due.datetime !== undefined) {\n    output.due = eventData.due.datetime\n  }\n}\n\nreturn { json: output };"
          },
          "typeVersion": 2
        },
        {
          "id": "9c9bf784-1318-4891-a6d8-3303aa09bd82",
          "name": "Get Todoist Task1",
          "type": "n8n-nodes-base.todoist",
          "onError": "continueErrorOutput",
          "maxTries": 3,
          "position": [
            4740,
            2760
          ],
          "parameters": {
            "taskId": "={{ $('Todoist trigger reference').item.json.body.event_data.id }}",
            "operation": "get"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.1,
          "waitBetweenTries": 3000
        },
        {
          "id": "0d64962d-079a-4991-9442-8cf1f18b4b4f",
          "name": "Get Notion Task1",
          "type": "n8n-nodes-base.notion",
          "position": [
            6060,
            2760
          ],
          "parameters": {
            "limit": 1,
            "filters": {
              "conditions": [
                {
                  "key": "Todoist ID|rich_text",
                  "condition": "equals",
                  "richTextValue": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Globals1').first().json.database_id }}"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "typeVersion": 2.2,
          "alwaysOutputData": true
        },
        {
          "id": "0380f6c3-a3e8-4dba-8e45-f98a53dfa60f",
          "name": "Sticky Note23",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            5780,
            2660
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Store more information, which was not available earlier"
          },
          "typeVersion": 1
        },
        {
          "id": "a36cf7d4-d467-428b-b6cc-2ff7c9ccd1ad",
          "name": "Sticky Note26",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7360,
            2140
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 240,
            "content": "Set focussed flag, so it remains in Todoist even after updating in Notion"
          },
          "typeVersion": 1
        },
        {
          "id": "79a16ed2-2cc9-4dc0-9efd-996ec3409b73",
          "name": "Sticky Note27",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6460,
            1880
          ],
          "parameters": {
            "color": 7,
            "width": 1800,
            "height": 760,
            "content": "**Create Notion page** if it does not exist"
          },
          "typeVersion": 1
        },
        {
          "id": "124820ca-86d1-4b99-8437-2fcdc399cef7",
          "name": "Sticky Note28",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6460,
            2660
          ],
          "parameters": {
            "color": 7,
            "width": 1340,
            "height": 900,
            "content": "**Update Notion page** if it needs to be changed"
          },
          "typeVersion": 1
        },
        {
          "id": "597e44ec-8c2c-4e2e-9d8c-e9fd8495dcd3",
          "name": "Sticky Note29",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3580,
            2800
          ],
          "parameters": {
            "color": 7,
            "width": 440,
            "height": 280,
            "content": "Checking for a cached flag in Redis, to prevent overrides and endless loops."
          },
          "typeVersion": 1
        },
        {
          "id": "88302c02-82d5-4e5d-9716-49e01d4d1b12",
          "name": "Sticky Note31",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6000,
            2660
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Retrieve Notion page, so it can be compared against"
          },
          "typeVersion": 1
        },
        {
          "id": "31f3c572-4f38-4133-85ff-699ab6359d0e",
          "name": "Sticky Note32",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6480,
            2820
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Store more information, which was not available earlier"
          },
          "typeVersion": 1
        },
        {
          "id": "f2f6d6b4-3c6e-46ef-906b-7293d16a0ce2",
          "name": "Sticky Note33",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3360,
            2800
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Store relevant information in highlighted execution data, in case of debugging"
          },
          "typeVersion": 1
        },
        {
          "id": "3529a085-c1dc-4467-927f-cebbbc7ec128",
          "name": "Sticky Note35",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2640,
            1780
          ],
          "parameters": {
            "color": 5,
            "width": 5880,
            "height": 2160,
            "content": "## Trigger based synchronization from Todoist to Notion (part of bi-directional sync)"
          },
          "typeVersion": 1
        },
        {
          "id": "7bd78d2f-8452-48d0-8b85-c2ec9023336f",
          "name": "Sticky Note36",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3140,
            2800
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Following nodes reference to this node, so the trigger can easily be replaced"
          },
          "typeVersion": 1
        },
        {
          "id": "e87ad29c-5eb8-4abb-86a2-d2dd937ab81d",
          "name": "Sticky Note37",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6480,
            2380
          ],
          "parameters": {
            "color": 7,
            "width": 660,
            "height": 240,
            "content": "This prevents the creation of duplicates in Notion, by storing a special flag in Redis containing the Todoist ID"
          },
          "typeVersion": 1
        },
        {
          "id": "e496f9f0-28be-4ae2-8a69-47805e858724",
          "name": "Requires completion change",
          "type": "n8n-nodes-base.filter",
          "position": [
            1220,
            2560
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "b9e134c4-66a7-4a83-8372-282c19fdc98e",
                  "operator": {
                    "type": "boolean",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.is_completed }}",
                  "rightValue": "={{ $json.is_completed }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "6f0f1698-638a-49ec-af54-8a11ddfb4a3a",
          "name": "Has been completed?",
          "type": "n8n-nodes-base.if",
          "position": [
            1440,
            2560
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "a8595a9c-fc03-4bb1-b1fc-ecde223d19aa",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.is_completed }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "dab457b1-f419-4916-bc93-35029e8a8136",
          "name": "Differences exist",
          "type": "n8n-nodes-base.filter",
          "position": [
            1220,
            2260
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "or",
              "conditions": [
                {
                  "id": "3a400a40-a25b-4e88-81ba-1aa9ada9d3aa",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.content }}",
                  "rightValue": "={{ $json.content }}"
                },
                {
                  "id": "8a649292-a21e-4d3f-9e3c-0047b21a7487",
                  "operator": {
                    "type": "number",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.priority }}",
                  "rightValue": "={{ $json.priority }}"
                },
                {
                  "id": "65f02b94-18de-4883-b5b1-f58fe5459828",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.due_datetime || null }}",
                  "rightValue": "={{ $json.due === null ? null : $json.due.date}}"
                },
                {
                  "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.section_id }}",
                  "rightValue": "={{ $json.section_id }}"
                },
                {
                  "id": "0b24cd35-b8b0-4d21-943c-fad905c4542a",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.description }}",
                  "rightValue": "={{ $json.description }}"
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "57489d22-0081-48f5-883d-d646cde35908",
          "name": "Only continue if not locked1",
          "type": "n8n-nodes-base.filter",
          "position": [
            -1680,
            3040
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.item }}",
                  "rightValue": "={{ null }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "6bbb506e-407b-4357-935e-692cdccac165",
          "name": "Check if Notion ID is locked",
          "type": "n8n-nodes-base.redis",
          "position": [
            -1900,
            3040
          ],
          "parameters": {
            "key": "=lock_{{ $json.body.data.id }}",
            "keyType": "string",
            "options": {},
            "operation": "get",
            "propertyName": "item"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "abd91f47-f21c-4805-ae8a-d52a6b576304",
          "name": "Get Notion task",
          "type": "n8n-nodes-base.notion",
          "maxTries": 2,
          "position": [
            -1460,
            3040
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Notion trigger reference').item.json.body.data.id }}"
            },
            "simple": false,
            "resource": "databasePage",
            "operation": "get"
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "62a7503b-d605-484b-95c0-864ea698f31b",
          "name": "Check if creating flag exists",
          "type": "n8n-nodes-base.redis",
          "position": [
            1440,
            3400
          ],
          "parameters": {
            "key": "=creating_for_{{ $('Notion trigger reference').item.json.body.data.id }}",
            "keyType": "string",
            "options": {},
            "operation": "get",
            "propertyName": "item"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "e7981df5-7d8e-4f2d-b25f-9b74b177c95e",
          "name": "Only continue if flag does not exist",
          "type": "n8n-nodes-base.filter",
          "position": [
            1660,
            3400
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.item }}",
                  "rightValue": "={{ null }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "22869aac-c36b-4aad-ab3b-00971cfe7c4e",
          "name": "Set creating flag",
          "type": "n8n-nodes-base.redis",
          "position": [
            1880,
            3400
          ],
          "parameters": {
            "key": "=creating_for_{{ $('Notion trigger reference').item.json.body.data.id }}",
            "ttl": 10,
            "value": "={{ $now.toISO() }}",
            "expire": true,
            "keyType": "string",
            "operation": "set"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "86e4a245-d8e3-4a2a-adab-57f908fadaca",
          "name": "Todoist ID exists?",
          "type": "n8n-nodes-base.if",
          "position": [
            -360,
            3240
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "8b074088-25e0-4975-9356-bd2d9c17c0d3",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.id }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "0f49f736-eeec-4159-bd12-056ef4270fb5",
          "name": "Get todoist ID",
          "type": "n8n-nodes-base.set",
          "position": [
            1880,
            2560
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "be85c68d-e9a8-4a88-ae12-54ec9cc685e5",
                  "name": "id",
                  "type": "string",
                  "value": "={{ $('Get Todoist Task2').item.json.id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "0f1eea07-0750-46a8-801b-76254461437f",
          "name": "Todoist ID exists",
          "type": "n8n-nodes-base.filter",
          "position": [
            1220,
            2000
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "d20ece89-96d3-4324-894f-860711138952",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.id }}",
                  "rightValue": ""
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "5fe0975a-9b10-4046-8037-54e20ebd8804",
          "name": "Get todoist ID1",
          "type": "n8n-nodes-base.set",
          "position": [
            1880,
            2000
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "be85c68d-e9a8-4a88-ae12-54ec9cc685e5",
                  "name": "id",
                  "type": "string",
                  "value": "={{ $('Todoist ID exists').item.json.id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "7025479a-b14e-471e-bc7d-211241b37d8f",
          "name": "Status changed but not empty",
          "type": "n8n-nodes-base.filter",
          "position": [
            1220,
            2900
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.section_id }}",
                  "rightValue": "={{ $json.section_id }}"
                },
                {
                  "id": "2ea2a63b-9968-4f95-af48-fc71fa210ffd",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $('Map Notion to Todoist2').item.json.section_id }}",
                  "rightValue": ""
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "e8b84dd0-9f5e-4670-a2ee-50e75448b611",
          "name": "Status is Obsolete?",
          "type": "n8n-nodes-base.if",
          "position": [
            -800,
            3040
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "9118fe29-c592-430e-8877-57cb81e6bf75",
                  "operator": {
                    "name": "filter.operator.equals",
                    "type": "string",
                    "operation": "equals"
                  },
                  "leftValue": "={{ $('Get Notion task').item.json.properties['Status'].status.name }}",
                  "rightValue": "Obsolete"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "aba681f0-a079-442f-9538-fb81abe8a9b7",
          "name": "Status is not Done",
          "type": "n8n-nodes-base.filter",
          "position": [
            1220,
            3240
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $('Get Notion task').item.json.properties['Status'].status.name }}",
                  "rightValue": "Done"
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "8262fbbd-3fc4-478c-8ffc-3d8d6ece743c",
          "name": "Neither focussed nor planned",
          "type": "n8n-nodes-base.if",
          "position": [
            -580,
            3140
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "990a9ac6-c358-4aae-8c4e-4c49f9830ef5",
                  "operator": {
                    "type": "object",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $('Get Notion task').item.json.properties.Due.date }}",
                  "rightValue": ""
                },
                {
                  "id": "93c8c7eb-1979-4eaf-90a6-be659290cded",
                  "operator": {
                    "type": "boolean",
                    "operation": "false",
                    "singleValue": true
                  },
                  "leftValue": "={{ $('Get Notion task').item.json.properties.Focus.checkbox }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "d0ab88eb-deed-4a2f-85f9-7aa381659c55",
          "name": "Notion trigger reference",
          "type": "n8n-nodes-base.noOp",
          "position": [
            -2340,
            3040
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "1895a6d2-71dc-4f58-a746-9b59c71bedcb",
          "name": "Notion Webhook",
          "type": "n8n-nodes-base.webhook",
          "position": [
            -3220,
            3040
          ],
          "webhookId": "7e1a4d8a-9cdc-4991-817c-1429ccfbece2",
          "parameters": {
            "path": "7e1a4d8a-9cdc-4991-817c-1429ccfbece2",
            "options": {},
            "httpMethod": "POST"
          },
          "typeVersion": 2
        },
        {
          "id": "35178847-629c-4672-858a-9b7de7344ef7",
          "name": "Store Todoist ID1",
          "type": "n8n-nodes-base.notion",
          "position": [
            2320,
            3500
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Notion trigger reference').item.json.body.data.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Todoist ID|rich_text",
                  "textContent": "={{ $json.id }}"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "1310034f-b035-43d0-9448-122bf0018e63",
          "name": "Mark as Completed in Todoist1",
          "type": "n8n-nodes-base.todoist",
          "position": [
            1660,
            2460
          ],
          "parameters": {
            "taskId": "={{ $('Get Todoist Task2').item.json.id }}",
            "operation": "close"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.1,
          "waitBetweenTries": 3000
        },
        {
          "id": "baa2d8ad-3eee-46ec-bd20-cea4615f5cec",
          "name": "Update task in Todoist1",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1660,
            2260
          ],
          "parameters": {
            "url": "=https://api.todoist.com/rest/v2/tasks/{{ $json.id }}",
            "method": "POST",
            "options": {},
            "jsonQuery": "={{ $('Map Notion to Todoist2').item.json.toJsonString() }}",
            "sendQuery": true,
            "specifyQuery": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "ad9d9069-a09b-41d0-a4f5-e83ac28f04cf",
          "name": "Globals2",
          "type": "n8n-nodes-base.set",
          "position": [
            -2120,
            2780
          ],
          "parameters": {
            "mode": "raw",
            "options": {},
            "jsonOutput": "{\n  \"database_id\": \"165beaa8-f444-8063-be17-d105a9898961\",\n  \"project_id\": \"2327925123\",\n  \"sections\": [\n    {\"id\": \"177308158\", \"name\": \"Backlog\"},\n    {\"id\": \"175778849\", \"name\": \"In progress\"},\n    {\"id\": \"175778857\", \"name\": \"On hold\"}\n  ]\n}"
          },
          "executeOnce": true,
          "typeVersion": 3.4
        },
        {
          "id": "165db83b-47fd-4aa6-9d04-c7ce07e8f8bf",
          "name": "Mark as Incomplete in Todoist1",
          "type": "n8n-nodes-base.todoist",
          "position": [
            1660,
            2660
          ],
          "parameters": {
            "taskId": "={{ $json.id }}",
            "operation": "reopen"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.1,
          "waitBetweenTries": 3000
        },
        {
          "id": "a5bca570-f213-4d40-ac5f-7f4bbd532432",
          "name": "Generate UUID2",
          "type": "n8n-nodes-base.crypto",
          "position": [
            1440,
            2900
          ],
          "parameters": {
            "action": "generate",
            "dataPropertyName": "uuid"
          },
          "typeVersion": 1
        },
        {
          "id": "00cea352-9026-433b-b351-28720e0b6a40",
          "name": "Update section (Sync API)2",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1660,
            2900
          ],
          "parameters": {
            "url": "https://api.todoist.com/sync/v9/sync",
            "method": "POST",
            "options": {},
            "sendBody": true,
            "contentType": "form-urlencoded",
            "authentication": "predefinedCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "commands",
                  "value": "=[ { \"type\": \"item_move\", \"uuid\": \"{{ $json.uuid }}\", \"args\": { \"id\": \"{{ $('Get Todoist Task2').item.json.id }}\", \"section_id\": \"{{ $('Map Notion to Todoist2').item.json.section_id }}\" } }]"
                }
              ]
            },
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "1cd9bf69-0e3c-4ace-8e79-894fea1c0045",
          "name": "Lock Todoist ID4",
          "type": "n8n-nodes-base.redis",
          "position": [
            2320,
            2580
          ],
          "parameters": {
            "key": "=lock_{{ $json.id }}",
            "ttl": 15,
            "value": "={{ $now.toISO() }}",
            "expire": true,
            "keyType": "string",
            "operation": "set"
          },
          "credentials": {
            "redis": {
              "id": "t7IN9qSccRezBIzV",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "dc21db22-41a0-4a3b-aeba-dc3c81fdf251",
          "name": "Delete Task in Todoist2",
          "type": "n8n-nodes-base.todoist",
          "onError": "continueRegularOutput",
          "position": [
            1660,
            2000
          ],
          "parameters": {
            "taskId": "={{ $json.id }}",
            "operation": "delete"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.1,
          "waitBetweenTries": 3000
        },
        {
          "id": "e90c2ef5-61f9-4e16-879f-14c9d7974f88",
          "name": "Map Notion to Todoist2",
          "type": "n8n-nodes-base.code",
          "position": [
            -1240,
            3040
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const globals = $('Globals2').first().json;\nconst properties = $('Get Notion task').item.json.properties;\n\nlet output = {};\n\noutput.project_id = globals.project_id;\n\noutput.id = properties['Todoist ID'].rich_text.length > 0 ? \n  properties['Todoist ID'].rich_text[0].text.content : \n  null;\n\noutput.content = properties['Name'].title.length > 0 ? properties['Name'].title[0].text.content : '[empty]';\n\noutput.description = \"[â†— Open in Notion](\" + $('Get Notion task').item.json.url + \")\"\n\n// Map priority\nif (properties['Priority'].select === null) {\n  output.priority = \"1\"; // P4\n} else {\n  output.priority = {\n    \"do first\": \"4\", // P1\n    \"urgent\": \"3\", // P2\n    \"important\": \"2\" // P3\n  }[properties['Priority'].select.name] ?? \"1\"; // P4\n}\n\n// Map section\nconst statusName = properties['Status'].status.name;\noutput.section_id = null;\nif (!['Done', 'Obsolete'].includes(statusName)) {\n  const sectionMap = Object.fromEntries(\n      globals.sections.map(section => [section.name, section.id])\n  );\n  if (!sectionMap.hasOwnProperty(statusName)) {\n      throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n  }\n  output.section_id = sectionMap[statusName];\n}\n\n// Map completed by status \"Done\"\noutput.is_completed = false;\nif (properties['Status'].status.name == \"Done\") {\n  output.is_completed = true;\n}\n\n// Set UTC if time is set\nif (properties['Due'].date !== null) {\n  output.due_datetime = properties.Due.date.start\n  if (properties.Due.date.start.length > 10) {\n    output.due_datetime = new Date(properties.Due.date.start).toISOString();\n  }\n} else {\n  // API requires due_string instead of due_datetime when date/time is removed\n  output.due_string = \"no date\";\n}\n\nreturn { json: output };"
          },
          "typeVersion": 2
        },
        {
          "id": "e5e12b26-6c45-4c63-9c7d-05ae88a457aa",
          "name": "Get Todoist Task2",
          "type": "n8n-nodes-base.todoist",
          "onError": "continueErrorOutput",
          "position": [
            300,
            3140
          ],
          "parameters": {
            "taskId": "={{ $json.id }}",
            "operation": "get"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "05441894-9904-44b3-94f7-bb600bcbe7ba",
          "name": "Create task in Todoist1",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            2100,
            3400
          ],
          "parameters": {
            "url": "=https://api.todoist.com/rest/v2/tasks",
            "method": "POST",
            "options": {},
            "jsonQuery": "={{ $('Map Notion to Todoist2').item.json.toJsonString() }}",
            "sendQuery": true,
            "specifyQuery": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "todoistApi"
          },
          "credentials": {
            "todoistApi": {
              "id": "Dp3VoWGH5IhrK22k",
              "name": "Todoist (mario.haarmann)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 3000
        },
        {
          "id": "354b6df0-b51e-476c-bb54-baaa1a6ca788",
          "name": "Execution Data5",
          "type": "n8n-nodes-base.executionData",
          "position": [
            -2120,
            3040
          ],
          "parameters": {
            "dataToSave": {
              "values": [
                {
                  "key": "database_id",
                  "value": "={{ $('Globals2').first().json.database_id }}"
                },
                {
                  "key": "project_id",
                  "value": "={{ $('Globals2').first().json.project_id }}"
                },
                {
                  "key": "notion_id",
                  "value": "={{ $json.body.data.id }}"
                },
                {
                  "key": "source",
                  "value": "Notion"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "04fe1427-30ba-45ae-904a-05c7b4c2269f",
          "name": "Execution Data6",
          "type": "n8n-nodes-base.executionData",
          "position": [
            -1020,
            3040
          ],
          "parameters": {
            "dataToSave": {
              "values": [
                {
                  "key": "todoist_id",
                  "value": "={{ $json.id }}"
                },
                {
                  "key": "task_name",
                  "value": "={{ $json.content }}"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "2b8262d7-298b-4a70-a420-50d8d066cb40",
          "name": "Sticky Note22",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1380,
            2840
          ],
          "parameters": {
            "color": 7,
            "width": 440,
            "height": 220,
            "content": "Update section for in Todoist using the Sync API in full sync mode (**maximum of 100 requests within a 15 minute period!**)"
          },
          "typeVersion": 1
        },
        {
          "id": "10571edb-ed79-43d3-bcb9-a64273c3eeb7",
          "name": "Sticky Note24",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            1880
          ],
          "parameters": {
            "color": 7,
            "width": 900,
            "height": 300,
            "content": "**Delete the task** if it does not fit into the filter anymore"
          },
          "typeVersion": 1
        },
        {
          "id": "85124819-6f06-44e8-a5dd-0c31c1aec5e3",
          "name": "Sticky Note25",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            2200
          ],
          "parameters": {
            "color": 7,
            "width": 900,
            "height": 880,
            "content": "**Update the task** if it needs to be changed"
          },
          "typeVersion": 1
        },
        {
          "id": "6a9d1e64-39d1-4361-aa60-2368ba36a2cd",
          "name": "Sticky Note38",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1520,
            2940
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Notion tries to deliver webhooks again. To ensure the data is up to date, the payload must be retrieved again."
          },
          "typeVersion": 1
        },
        {
          "id": "4787a4de-f5d2-4983-a658-916c497ce683",
          "name": "Sticky Note39",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2180,
            2640
          ],
          "parameters": {
            "width": 220,
            "height": 300,
            "content": "## Set Globals\nUse Sync Setup Helper Workflow to generate the JSON and paste it in every Globals Nodes"
          },
          "typeVersion": 1
        },
        {
          "id": "5afdea5e-e6ed-463a-99bb-35bda66c25e6",
          "name": "Sticky Note41",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1600,
            1920
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 240,
            "content": "Continues on error, so it is not necessary to retrieve task beforehand"
          },
          "typeVersion": 1
        },
        {
          "id": "6353737c-ea2b-4907-94d1-d5b4c743ca29",
          "name": "Sticky Note42",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2400,
            2940
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Following nodes reference to this node, so the trigger can easily be replaced"
          },
          "typeVersion": 1
        },
        {
          "id": "caa80f7d-1c1a-4bbf-a92d-4df2a65e6e2f",
          "name": "Sticky Note43",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2180,
            2940
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Store relevant information in highlighted execution data, in case of debugging"
          },
          "typeVersion": 1
        },
        {
          "id": "58332f57-5bee-4559-922b-f2ec025af90d",
          "name": "Sticky Note44",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1080,
            2940
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Store more information, which was not available earlier"
          },
          "typeVersion": 1
        },
        {
          "id": "785526ba-39e6-42aa-83f0-731a81e821ec",
          "name": "Sticky Note45",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -860,
            2940
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Instead of deleting pages in Notion, it is a safer practice to mark them as obsolete instead."
          },
          "typeVersion": 1
        },
        {
          "id": "933c2fd0-c378-4984-b34a-6a1f89d61299",
          "name": "Sticky Note46",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1380,
            3320
          ],
          "parameters": {
            "color": 7,
            "width": 660,
            "height": 260,
            "content": "In rare cases Notion fires multiple webhooks within a short period of time, when creating a new task. This prevents the creation of duplicates in Todoist."
          },
          "typeVersion": 1
        },
        {
          "id": "14b97b13-0689-481b-8a21-61940e742b2a",
          "name": "Sticky Note47",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1300,
            2940
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "The mapping is more advanced and also includes fall-back values for edge-cases"
          },
          "typeVersion": 1
        },
        {
          "id": "ce6ed70d-4fa0-4291-9ac8-13cd23e899cc",
          "name": "Sticky Note48",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1960,
            2940
          ],
          "parameters": {
            "color": 7,
            "width": 440,
            "height": 280,
            "content": "Checking for a cached flag in Redis, to prevent overrides and endless loops."
          },
          "typeVersion": 1
        },
        {
          "id": "21378455-34e5-42bf-857d-543a7a972c33",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -3340,
            1780
          ],
          "parameters": {
            "color": 5,
            "width": 5880,
            "height": 1960,
            "content": "# Trigger based synchronization from Notion to Todoist (part of bi-directional sync)"
          },
          "typeVersion": 1
        },
        {
          "id": "0688c57e-9de6-43b5-8b75-b214760a8445",
          "name": "Sticky Note20",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -3280,
            2820
          ],
          "parameters": {
            "width": 220,
            "height": 400,
            "content": "## Configure Webhook\nGrab the webhook URL and use it in the Notion automation. If using the NotionWebhookEmulator instead, replace this node with the nodes shown below."
          },
          "typeVersion": 1
        },
        {
          "id": "d3a90492-d62f-4b01-bf2b-1b82b74c04cc",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -640,
            3040
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Only sync focussed & planned tasks for efficiency reasons"
          },
          "typeVersion": 1
        },
        {
          "id": "d0b03cb0-8c69-4a6a-854a-afdfc690219f",
          "name": "Sticky Note19",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -420,
            3120
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "The mapping between the Notion and Todoist tasks is stored in Notion"
          },
          "typeVersion": 1
        },
        {
          "id": "c34e228b-eee5-43f4-9876-8ffcd3f64488",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2260,
            2460
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "The Todoist ID is being cached in Redis for 15 seconds, so the other Diff sync does not get triggered."
          },
          "typeVersion": 1
        },
        {
          "id": "c78c9264-683f-4ee5-9cd2-086627ce4fd1",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            3100
          ],
          "parameters": {
            "color": 7,
            "width": 1340,
            "height": 580,
            "content": "**Create task** if it does not exist (anymore)"
          },
          "typeVersion": 1
        },
        {
          "id": "7940c709-6107-4efa-83dc-639b88286a84",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1160,
            3160
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 240,
            "content": "Edge case: the task has been moved from Obsolete to Done"
          },
          "typeVersion": 1
        },
        {
          "id": "2d6b7423-0818-4a2d-b672-0d09f7eaab59",
          "name": "Sticky Note49",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2700,
            3180
          ],
          "parameters": {
            "color": 7,
            "width": 1020,
            "height": 700,
            "content": "## Todoist Webhook Router Example (optional)\nSince Todoist sends the updates of all projects to a single webhook, the requests need to be routed accordingly.\nTo do so, create a separate workflow, each containing the flow above, except replace the webhook and switch nodes with an \"Execute Workflow Trigger\".\nThen activate the nodes below and configure it, so it calls the sub-workflows accordingly."
          },
          "typeVersion": 1
        },
        {
          "id": "b1b38cc8-3dda-43de-9fd3-8341b5fcd798",
          "name": "Sticky Note51",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            4020,
            2800
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Using the event type from Todoist is the only option to actually recognize, if a task was deleted"
          },
          "typeVersion": 1
        },
        {
          "id": "5eb3caf9-ae18-47ce-80c1-52b1029e627d",
          "name": "Sticky Note52",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            5560,
            2660
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "The mapping is more advanced and also includes fall-back values for edge-cases"
          },
          "typeVersion": 1
        },
        {
          "id": "d8935c51-34a4-4d69-890e-23a7194ba5ea",
          "name": "Sticky Note53",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6220,
            2660
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "Previous node always returns output data, since it uses a filter to retrieve a matching item"
          },
          "typeVersion": 1
        },
        {
          "id": "d7f254d6-026a-48bb-b3db-1104181db443",
          "name": "Sticky Note54",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7140,
            2380
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 240,
            "content": "Reverse mapping the Section/Status"
          },
          "typeVersion": 1
        },
        {
          "id": "68536590-3bd2-443a-804a-e433910b0ccc",
          "name": "Sticky Note55",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7360,
            2380
          ],
          "parameters": {
            "color": 7,
            "width": 440,
            "height": 240,
            "content": "Update section for in Todoist using the Sync API in full sync mode (**maximum of 100 requests within a 15 minute period!**)"
          },
          "typeVersion": 1
        },
        {
          "id": "18013962-c950-4976-8639-b00b3c2c43ed",
          "name": "Sticky Note56",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7580,
            2140
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 240,
            "content": "Store more information, which was not available earlier"
          },
          "typeVersion": 1
        },
        {
          "id": "02b2cddc-565e-46b1-aaec-b3fc3db0611c",
          "name": "Sticky Note57",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            8240,
            2920
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 280,
            "content": "The Notion ID is being cached in Redis for 15 seconds, so the other Diff sync does not get triggered."
          },
          "typeVersion": 1
        },
        {
          "id": "9d1db117-f41a-4529-a2e8-503d65cff0ad",
          "name": "Sticky Note58",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            6460,
            3580
          ],
          "parameters": {
            "color": 7,
            "width": 1340,
            "height": 320,
            "content": "**Delete Notion page** if Todoist task has been deleted"
          },
          "typeVersion": 1
        },
        {
          "id": "9de565e0-3edb-4ea0-bace-8c17b10d5aac",
          "name": "Sticky Note59",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7140,
            3620
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 260,
            "content": "Store more information, which was not available earlier"
          },
          "typeVersion": 1
        },
        {
          "id": "b8aeecf7-28fb-433e-b045-147e6080cc30",
          "name": "Todoist Webhook",
          "type": "n8n-nodes-base.webhook",
          "position": [
            2760,
            2900
          ],
          "webhookId": "81107d16-d839-4507-a627-f607f1d53d4e",
          "parameters": {
            "path": "47b150f3-12a3-4fe9-97cc-5d139daa3b00",
            "options": {},
            "httpMethod": "POST"
          },
          "typeVersion": 2
        },
        {
          "id": "d48d3e29-d1b1-4751-adad-692cddaf49e7",
          "name": "Sticky Note60",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3600,
            -640
          ],
          "parameters": {
            "color": 7,
            "width": 1980,
            "height": 860,
            "content": "Handle tasks **only found in Notion**. This can still mean, that the task exists in Todoist, but does not match the filter, since it has been completed. In that case the Todoist task is being retrieved. If it exist, the Todoist Task will be reopened, otherwise it will be created.\nThe Todoist ID is being cached in Redis for 15 seconds, so the Diff sync does not get triggered."
          },
          "typeVersion": 1
        },
        {
          "id": "bfbf04c7-8e27-4afd-998c-1720eb7f05bd",
          "name": "Sticky Note61",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3600,
            240
          ],
          "parameters": {
            "color": 7,
            "width": 1760,
            "height": 640,
            "content": "Handle tasks which show **differences** between both systems. If there are differences, the Todoist task will be overwritten by all properties from Notion. Also the status is being updated in the following step accordingly.\nThe Todoist ID is being cached in Redis for 15 seconds, so the Diff sync does not get triggered."
          },
          "typeVersion": 1
        },
        {
          "id": "8edde5d8-649a-42a3-bf81-83c36ac1ff03",
          "name": "Sticky Note62",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3600,
            900
          ],
          "parameters": {
            "color": 7,
            "width": 1760,
            "height": 720,
            "content": "Handle tasks **only found in Todoist**. This can still mean, that the task exists in Notion, but does not match the filter, since it has been completed. In that case the Notion page is being retrieved. If it does not exist, because it was deleted, the Todoist Task will be deleted as well.\nThe Todoist ID is being cached in Redis for 15 seconds, so the Diff sync does not get triggered."
          },
          "typeVersion": 1
        },
        {
          "id": "284199c4-40ba-4590-9eb8-1af4dedfedf4",
          "name": "Sticky Note63",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2700,
            360
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "## Set Schedule\nSet the preferred period. Usually once a day, likely outside working hours should be a solid option."
          },
          "typeVersion": 1
        },
        {
          "id": "2cad2f03-b24d-4146-883d-78bdd11ac127",
          "name": "Sticky Note64",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3140,
            560
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 200,
            "content": "Preparing data for comparing"
          },
          "typeVersion": 1
        },
        {
          "id": "453dd0b4-1163-46dd-849b-39179f8ddb7c",
          "name": "Sticky Note65",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7140,
            560
          ],
          "parameters": {
            "width": 220,
            "height": 320,
            "content": "## Set mail address\nProvide the email address where the report should be sent to. This node can also be replaced by an SMTP or similar node."
          },
          "typeVersion": 1
        },
        {
          "id": "f77d8d57-0a5c-4b33-be07-9806c55330c3",
          "name": "Execute Workflow",
          "type": "n8n-nodes-base.executeWorkflow",
          "disabled": true,
          "position": [
            3520,
            3440
          ],
          "parameters": {
            "options": {},
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": ""
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "4bd15a48-39d1-41c3-8b15-7de6abf3d35d",
          "name": "Extract IDs",
          "type": "n8n-nodes-base.set",
          "position": [
            -2560,
            2940
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "7f0c61dc-87ae-4fbe-9e40-d9d27a0d61a8",
                  "name": "body.data.id",
                  "type": "string",
                  "value": "={{ $json.data.id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "6e61887e-8022-44ee-b9ab-94058b08a07b",
          "name": "Split out Notion changes",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            -2780,
            2940
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "body"
          },
          "typeVersion": 1
        },
        {
          "id": "5ed59854-c972-42bd-9b41-8e6c1d616c8f",
          "name": "Body is array?",
          "type": "n8n-nodes-base.if",
          "position": [
            -3000,
            3040
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "0479a702-9ec0-4203-bcaa-e4bdbd872f4e",
                  "operator": {
                    "type": "object",
                    "operation": "exists",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.body[0] }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "a6003e6f-84a7-4c5e-99d7-47b31dee10d1",
          "name": "Sticky Note66",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -3060,
            2880
          ],
          "parameters": {
            "color": 7,
            "width": 660,
            "height": 340,
            "content": "If consuming data from the Notion Webhook Emulator instead of a regular Notion Webhook, the data is structured differently and can contain multiple items. This section makes the workflow compatible with both approaches."
          },
          "typeVersion": 1
        },
        {
          "id": "07740ae3-3472-4125-bae9-d1c54e9584f1",
          "name": "Switch by project",
          "type": "n8n-nodes-base.switch",
          "position": [
            2980,
            2900
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "[project name]",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "loose"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.body.event_data.project_id }}",
                        "rightValue": "2346249328"
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {},
            "looseTypeValidation": true
          },
          "typeVersion": 3.2
        },
        {
          "id": "a76190bf-f467-4bbe-82f3-581c2ab27e2a",
          "name": "Sticky Note21",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2700,
            2680
          ],
          "parameters": {
            "width": 220,
            "height": 400,
            "content": "## Register Webhook in Todoist App\nGrab the URL from here and add it to the Todosit developer app as described in the setup instructions"
          },
          "typeVersion": 1
        },
        {
          "id": "689992a3-c8bc-4d2e-856b-2c512afdb2da",
          "name": "Sticky Note67",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2920,
            2680
          ],
          "parameters": {
            "width": 220,
            "height": 400,
            "content": "## Set project ID and name\nThe ID can be copied from JSON in Globals Node.\nIf syncing multiple Todoist projects, use the router described below."
          },
          "typeVersion": 1
        },
        {
          "id": "f2243125-18c3-4484-9a06-85c638b1895f",
          "name": "Webhook",
          "type": "n8n-nodes-base.webhook",
          "disabled": true,
          "position": [
            3080,
            3540
          ],
          "webhookId": "1d758ef5-a9b9-4313-b81e-1c7dfe230a33",
          "parameters": {
            "path": "1d758ef5-a9b9-4313-b81e-1c7dfe230a33",
            "options": {}
          },
          "typeVersion": 2
        },
        {
          "id": "f875a8c7-2223-4296-bd55-8f42789d11b7",
          "name": "Switch",
          "type": "n8n-nodes-base.switch",
          "disabled": true,
          "position": [
            3300,
            3540
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "project1",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.body.event_data.project_id }}",
                        "rightValue": ""
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "project2",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "759db81d-4d1a-463f-9773-1db73b6a7829",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.body.event_data.project_id }}",
                        "rightValue": ""
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 3.2
        },
        {
          "id": "e603a21c-238f-45a9-8d7d-d8ccabe25217",
          "name": "Execute Workflow1",
          "type": "n8n-nodes-base.executeWorkflow",
          "disabled": true,
          "position": [
            3520,
            3640
          ],
          "parameters": {
            "options": {},
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": ""
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "91fe0191-0c57-404b-95e8-c3257426ccde",
          "name": "Sticky Note50",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2740,
            3440
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "### Replace trigger\nUse this trigger in the sub-workflows instead"
          },
          "typeVersion": 1
        },
        {
          "id": "98bbef00-86b5-46b2-8242-45f8eec47de4",
          "name": "Sticky Note68",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3020,
            3420
          ],
          "parameters": {
            "width": 220,
            "height": 300,
            "content": "### Register Webhook\nConfigure this webhook in the Todoist App as mentioned above"
          },
          "typeVersion": 1
        },
        {
          "id": "650d3da2-4dee-44ab-afcd-680fb0a0d74a",
          "name": "Sticky Note69",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3240,
            3380
          ],
          "parameters": {
            "width": 220,
            "height": 340,
            "content": "### Set project IDs and names\nCopy each project ID from the JSON of the different Globals Nodes and name the branches by the projects."
          },
          "typeVersion": 1
        },
        {
          "id": "b9c01e3c-bb9c-4bfd-aa22-b1b4a7824e42",
          "name": "Sticky Note70",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3460,
            3320
          ],
          "parameters": {
            "width": 220,
            "height": 500,
            "content": "### Select sub-workflows\nChoose the sub-workflows based on the branch of the Switch Node"
          },
          "typeVersion": 1
        },
        {
          "id": "007599a2-8c60-423c-80a8-7599ba709db8",
          "name": "Sticky Note72",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1920,
            -580
          ],
          "parameters": {
            "width": 980,
            "height": 560,
            "content": "# 0. Start here\n### Notion\n- A database must already exist (get a basic template [here](https://steadfast-banjo-d1f.notion.site/17682b476c848086b002de766879aa71)) with the following properties (case matters!):\n  - Text: \"Name\"\n  - Status: \"Status\", containing at least the options \"Backlog\", \"In progress\", \"Done\", \"Obsolete\"\n  - Select: \"Priority\", containing the options \"do first\", \"urgent\", \"important\"\n  - Date: \"Due\"\n  - Checkbox: \"Focus\"\n  - Text: \"Todoist ID\"\n### Todoist\n- A project must already exist with the same sections like defined as Status in Notion (except Done and Obsolete)\n### Redis\n- Create a [Free Redis Cloud](https://redis.io/try-free/) instance or self-host\n### Setup credentials in n8n\n- Notion: https://docs.n8n.io/integrations/builtin/credentials/notion/\n- Todoist: https://docs.n8n.io/integrations/builtin/credentials/todoist/\n- Redis: https://docs.n8n.io/integrations/builtin/credentials/redis/\n### Clone workflow\n- Clone this workflow into your n8n environment and map the credentials (beware, Todoist credentials are also used in HTTP request nodes)\n- Check for every yellow sticky notes. They show instructions which need to be done once"
          },
          "typeVersion": 1
        },
        {
          "id": "a30814bb-205c-488b-aa0b-bf315f3e32b2",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1920,
            0
          ],
          "parameters": {
            "width": 2780,
            "height": 460,
            "content": "# 1. Generate config JSON for Globals Nodes\nThe sync workflows have a Node named \"Globals\", which contain mapping information for both Notion and Todoist. This flow helps to generate the config, using a multi-form.\n### How to use\n- Check if the credentials in the Notion and HTTP Request Nodes are set correctly\n- Activate this workflow\n- Open production URL of the form trigger and complete the form\n- Copy the resulting JSON code into all 3 \"Globals\" nodes"
          },
          "typeVersion": 1
        },
        {
          "id": "1f273075-0648-44b1-a8b7-7e226671293a",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1920,
            480
          ],
          "parameters": {
            "width": 800,
            "height": 680,
            "content": "# 2. Setup Todoist Webhook\n- In the Todoist App open Settings > Integrations > Developer > Build Integrations\n- Click \"Create a new app\"\n  - App name: \"Notion-Todoist Sync\" / Name of your n8n instance\n  - App service URL: (leave empty)\n- Click \"Create app\"\n- Update settings of the app:\n  - OAuth redirect URL: Grab the production URL of the \"OAuth redirect\" Node (from step 3 on the right)\n- Click on \"Save settings\", leave tab open\n\n- Activate this workflow\n- Open the Production URL of the \"Todoist Webhook Setup Helper\" Node (from step 3 on the right)\n- Copy the Client ID and secret from the App settings into the form and submit it\n- When prompted for permissions, click on \"Agree\"\n\n- Go back to App settings tab\n- Scroll further down to \"Webhook\"\n- Update settings of the app:\n  - Webhook callback URL: Grab the production URL of the \"Todoist Webhook\" Node (Todoist to Notion Diff sync)\n  - Select these options:\n    - item:added\n    - item:updated\n    - item:completed\n    - item:uncompleted\n    - item:deleted\n- Click \"Save webhook configuration\"\n- Click \"Activate webhook\"\n- Settings can now be closed"
          },
          "typeVersion": 1
        },
        {
          "id": "4915c92e-aca2-409a-909f-7b2efa440bed",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            60,
            480
          ],
          "parameters": {
            "width": 800,
            "height": 680,
            "content": "# 4. Setup Notion Webhook\nYou can choose from two options and also choose different options for different workspaces, e.g. optionA for a business related workspace and option B for a private workspace. Both options work similarly, option A is a bit easier to setup, yet it is more expensive.\n\n## Option A: Notion Webhook via Automation (paid plan required)\n- Create a new [automation](https://www.notion.com/help/database-automations) on the database which should be synced\n- Rename the automation to \"Notion-Todoist Sync\" or similar\n- Add trigger: \"Any property edited\"\n- Add action: \"Send webhook\"\n  - URL: Grab the production URL from the \"Notion Webhook\" Node of this workflow (Notion to Todoist Diff sync)\n  - Content: Select all existing properties\n- Click \"Save\"\n\n## Option B: Notion Webhook Emulator (no subscription required)\n- Follow the instructions here: https://n8n.io/workflows/2284-provide-real-time-updates-for-notion-databases-via-webhooks-with-supabase/\n- Use the Webhook URL from the \"Notion Webhook\" Node of this workflow to push the updates to"
          },
          "typeVersion": 1
        },
        {
          "id": "de16a551-7864-4758-9da0-8f25856ca33d",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1100,
            480
          ],
          "parameters": {
            "width": 1140,
            "height": 680,
            "content": "# 3. Activate Todoist Webhook\nWebhooks are a bit different in Todoist then usual. A Developer App needs to be created and once be connected to via OAuth, to activate the webhook functionality.\nThis flow only works when using the **production URL** of it's form trigger."
          },
          "typeVersion": 1
        },
        {
          "id": "921e8fea-c860-4943-b9f8-9dee42a36688",
          "name": "Due date empty",
          "type": "n8n-nodes-base.filter",
          "position": [
            7420,
            2820
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "9e948541-8c3b-4b99-99ab-0966319500ac",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $if($('Map Todoist to Notion1').item.json.due !== null, $('Map Todoist to Notion1').item.json.due.toDateTime().toISO(), null) }}",
                  "rightValue": "null"
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "6ae7b8f4-32b5-4a08-9061-07399fc87631",
          "name": "Has not been completed?",
          "type": "n8n-nodes-base.if",
          "position": [
            7200,
            3100
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "a8595a9c-fc03-4bb1-b1fc-ecde223d19aa",
                  "operator": {
                    "type": "boolean",
                    "operation": "false",
                    "singleValue": true
                  },
                  "leftValue": "={{ $('Get Todoist Task1').item.json.is_completed }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "dae00353-4b24-4ab1-a2c3-86ffd6860ae3",
          "name": "End here",
          "type": "n8n-nodes-base.noOp",
          "position": [
            5180,
            2860
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "11685bda-e714-4183-87b5-47dd1dd45123",
          "name": "Retry limit reached",
          "type": "n8n-nodes-base.stopAndError",
          "position": [
            4320,
            20
          ],
          "parameters": {
            "errorMessage": "Retry limit reached"
          },
          "typeVersion": 1
        },
        {
          "id": "05386c19-1529-48e6-b158-1eaca54ac19f",
          "name": "Set tries",
          "type": "n8n-nodes-base.set",
          "position": [
            4320,
            -280
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "cd93a7f6-4c06-4e8a-8d0d-e812c5ec4bc5",
                  "name": "tries",
                  "type": "number",
                  "value": "={{ $json.tries || 0 }}"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "21d1ab05-c6fe-44c8-831c-095d24e7251f",
          "name": "Update tries",
          "type": "n8n-nodes-base.set",
          "position": [
            5200,
            20
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "df3c9b29-afa6-4e08-868d-5b7e8202eefa",
                  "name": "tries",
                  "type": "number",
                  "value": "={{ $('Set tries').item.json.tries + 1 }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "c67ba192-2207-47a3-a3c5-91d059bc4e91",
          "name": "Wait",
          "type": "n8n-nodes-base.wait",
          "position": [
            4980,
            20
          ],
          "webhookId": "9d3b561f-4afd-478c-8f6e-60641d4f1d0b",
          "parameters": {},
          "typeVersion": 1.1
        },
        {
          "id": "ca20fd60-2b56-4590-ae22-a43c6dd05973",
          "name": "Catch known error",
          "type": "n8n-nodes-base.if",
          "position": [
            4760,
            -180
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6a379b06-0b04-4ae4-9bf9-394bd40744b7",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  },
                  "leftValue": "={{ $json.error }}",
                  "rightValue": "could not be found"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "feb6c1ec-2696-49df-94ed-e257361b92a0",
          "name": "If tries left",
          "type": "n8n-nodes-base.if",
          "position": [
            4100,
            20
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "b18f784a-4386-4ced-a9e1-ce5a21ad036e",
                  "operator": {
                    "type": "number",
                    "operation": "lt"
                  },
                  "leftValue": "={{ $json.tries }}",
                  "rightValue": 3
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "a7f467fb-4ef2-4251-aa0d-47b069fe1cd1",
          "name": "Sticky Note18",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -200,
            3060
          ],
          "parameters": {
            "color": 7,
            "width": 1320,
            "height": 480,
            "content": "Retrieve Todoist task, which can be completed or deleted at this point.\nUsing advanced retry logic, since the \"Get many tasks\" endpoint does not return completed tasks."
          },
          "typeVersion": 1
        },
        {
          "id": "6b1cc5de-e44e-4a8a-ba28-b05273abba18",
          "name": "Retry limit reached1",
          "type": "n8n-nodes-base.stopAndError",
          "position": [
            80,
            3340
          ],
          "parameters": {
            "errorMessage": "Retry limit reached"
          },
          "typeVersion": 1
        },
        {
          "id": "5e38207a-bf7c-4d0d-9e19-ba387a5c68a9",
          "name": "Set tries1",
          "type": "n8n-nodes-base.set",
          "position": [
            80,
            3140
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "cd93a7f6-4c06-4e8a-8d0d-e812c5ec4bc5",
                  "name": "tries",
                  "type": "number",
                  "value": "={{ $json.tries || 0 }}"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "1ba45fd2-c7e3-40de-a341-27a342892765",
          "name": "Update tries1",
          "type": "n8n-nodes-base.set",
          "position": [
            960,
            3340
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "df3c9b29-afa6-4e08-868d-5b7e8202eefa",
                  "name": "tries",
                  "type": "number",
                  "value": "={{ $('Set tries1').item.json.tries + 1 }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "a9696b6e-f134-46ba-9b25-862ae73df812",
          "name": "Wait1",
          "type": "n8n-nodes-base.wait",
          "position": [
            740,
            3340
          ],
          "webhookId": "9d3b561f-4afd-478c-8f6e-60641d4f1d0b",
          "parameters": {},
          "typeVersion": 1.1
        },
        {
          "id": "84e88ff7-bf50-4911-8f30-7027d68abe2a",
          "name": "Catch known error1",
          "type": "n8n-nodes-base.if",
          "position": [
            520,
            3240
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6a379b06-0b04-4ae4-9bf9-394bd40744b7",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  },
                  "leftValue": "={{ $json.error }}",
                  "rightValue": "could not be found"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "0482d2b4-4327-4a71-b473-9d12e07e24a7",
          "name": "If tries left1",
          "type": "n8n-nodes-base.if",
          "position": [
            -140,
            3340
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "b18f784a-4386-4ced-a9e1-ce5a21ad036e",
                  "operator": {
                    "type": "number",
                    "operation": "lt"
                  },
                  "leftValue": "={{ $json.tries }}",
                  "rightValue": 3
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "92ff51e9-b9c7-47b4-a0ed-a5a0fddd7ef7",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            4240,
            2660
          ],
          "parameters": {
            "color": 7,
            "width": 1320,
            "height": 600,
            "content": "Todoist webhooks can arrive late. To ensure the data is up to date, the payload must be retrieved again. Triggers on deletion can overlap, thus try 3 times, then just stop.\nUsing advanced retry logic, since the \"Get many tasks\" endpoint does not return completed tasks.\nNo more retries needed, if Task does not exist."
          },
          "typeVersion": 1
        },
        {
          "id": "a611b837-4c77-4092-a0ee-db5ed7eee17c",
          "name": "Set tries2",
          "type": "n8n-nodes-base.set",
          "position": [
            4520,
            2760
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "cd93a7f6-4c06-4e8a-8d0d-e812c5ec4bc5",
                  "name": "tries",
                  "type": "number",
                  "value": "={{ $json.tries || 0 }}"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "ac1787c5-a25e-4916-a537-7e9a0854fdc9",
          "name": "Update tries2",
          "type": "n8n-nodes-base.set",
          "position": [
            5400,
            3060
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "df3c9b29-afa6-4e08-868d-5b7e8202eefa",
                  "name": "tries",
                  "type": "number",
                  "value": "={{ $('Set tries2').item.json.tries + 1 }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "614e1fa0-aac4-425f-87e0-85ba084319cb",
          "name": "Wait2",
          "type": "n8n-nodes-base.wait",
          "position": [
            5180,
            3060
          ],
          "webhookId": "9d3b561f-4afd-478c-8f6e-60641d4f1d0b",
          "parameters": {},
          "typeVersion": 1.1
        },
        {
          "id": "5c205ac1-0c4c-4441-b49f-6e0fd12ead4a",
          "name": "Catch known error2",
          "type": "n8n-nodes-base.if",
          "position": [
            4960,
            2860
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6a379b06-0b04-4ae4-9bf9-394bd40744b7",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  },
                  "leftValue": "={{ $json.error }}",
                  "rightValue": "could not be found"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "e00655f6-fe5d-4d16-ac8f-303687aa17a9",
          "name": "If tries left2",
          "type": "n8n-nodes-base.if",
          "position": [
            4300,
            3060
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "b18f784a-4386-4ced-a9e1-ce5a21ad036e",
                  "operator": {
                    "type": "number",
                    "operation": "lt"
                  },
                  "leftValue": "={{ $json.tries }}",
                  "rightValue": 3
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "a78d5103-9c36-4660-8823-6dbc99a90b3b",
          "name": "Retry limit reached2",
          "type": "n8n-nodes-base.stopAndError",
          "position": [
            4520,
            3060
          ],
          "parameters": {
            "errorMessage": "Retry limit reached"
          },
          "typeVersion": 1
        },
        {
          "id": "a760a6a7-f93c-4674-a21e-d10867c523de",
          "name": "Sticky Note30",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7800,
            2140
          ],
          "parameters": {
            "color": 7,
            "width": 220,
            "height": 240,
            "content": "Overwrite description with Notion URL"
          },
          "typeVersion": 1
        },
        {
          "id": "5a7190f7-78e7-4362-8129-72e461abb099",
          "name": "Turn Markdown into Notion Blocks",
          "type": "n8n-nodes-base.code",
          "position": [
            7640,
            1960
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "// Get the markdown from the input\nconst markdown = $('Get Todoist Task').item.json.description || '';\n\n// Split the markdown into lines and remove empty lines\nconst lines = markdown.split('\\n').filter(line => line.trim());\n\n// Initialize result array\nconst result = [];\n\n// Helper function to split long text into chunks\nfunction splitIntoChunks(text, maxLength) {\n    const chunks = [];\n    let remaining = text;\n    \n    while (remaining.length > maxLength) {\n        // Find the last space before maxLength\n        let splitIndex = remaining.lastIndexOf(' ', maxLength);\n        // If no space found, force split at maxLength\n        if (splitIndex === -1) splitIndex = maxLength;\n        \n        chunks.push(remaining.substring(0, splitIndex).trim());\n        remaining = remaining.substring(splitIndex).trim();\n    }\n    \n    if (remaining.length > 0) {\n        chunks.push(remaining);\n    }\n    \n    return chunks;\n}\n\nfor (const line of lines) {\n    const trimmedLine = line.trim();\n    \n    // Skip if empty line\n    if (!trimmedLine) continue;\n    \n    // Check for different types of markdown elements\n    if (trimmedLine.startsWith('# ')) {\n        result.push({\n            type: 'heading_1',\n            content: trimmedLine.substring(2).trim()\n        });\n    }\n    else if (trimmedLine.startsWith('## ')) {\n        result.push({\n            type: 'heading_2',\n            content: trimmedLine.substring(3).trim()\n        });\n    }\n    else if (trimmedLine.startsWith('### ')) {\n        result.push({\n            type: 'heading_3',\n            content: trimmedLine.substring(4).trim()\n        });\n    }\n    else if (trimmedLine.match(/^\\d+\\./)) {\n        result.push({\n            type: 'numbered_list_item',\n            content: trimmedLine.replace(/^\\d+\\.\\s*/, '').trim()\n        });\n    }\n    else if (trimmedLine.startsWith('- ')) {\n        result.push({\n            type: 'bulleted_list_item',\n            content: trimmedLine.substring(2).trim()\n        });\n    }\n    else {\n        // For paragraphs, check if they need to be split\n        if (trimmedLine.length > 2000) {\n            const chunks = splitIntoChunks(trimmedLine, 2000);\n            for (const chunk of chunks) {\n                result.push({\n                    type: 'paragraph',\n                    content: chunk\n                });\n            }\n        } else {\n            result.push({\n                type: 'paragraph',\n                content: trimmedLine\n            });\n        }\n    }\n}\n\n// Return the result in the format n8n expects\nreturn { blocks: result };\n"
          },
          "typeVersion": 2
        },
        {
          "id": "edb96637-26f5-49e7-ad33-a9be019f874c",
          "name": "Handle each block separately",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            7860,
            1960
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "blocks"
          },
          "typeVersion": 1
        },
        {
          "id": "8c4722b7-87ae-42e3-a97e-16f4bb112b74",
          "name": "Append Notion Block",
          "type": "n8n-nodes-base.notion",
          "position": [
            8080,
            1960
          ],
          "parameters": {
            "blockId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Create task in Notion').item.json.id }}"
            },
            "blockUi": {
              "blockValues": [
                {
                  "type": "={{ $json.type }}",
                  "textContent": "={{ $json.content }}"
                }
              ]
            },
            "resource": "block"
          },
          "credentials": {
            "notionApi": {
              "id": "5AJPpSLgA5nVypUf",
              "name": "Notion (octionic)"
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "8ba90a10-f79d-4bac-af19-f61e7bbad979",
          "name": "Sticky Note34",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            7580,
            1900
          ],
          "parameters": {
            "color": 7,
            "width": 660,
            "height": 240,
            "content": "Copy task description initially to Notion, before it get's replaced in Todoist by the Notion URL"
          },
          "typeVersion": 1
        },
        {
          "id": "888f3904-cd9a-4b7b-ab7e-af2eda62aa68",
          "name": "Sticky Note40",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            60,
            1180
          ],
          "parameters": {
            "width": 800,
            "height": 380,
            "content": "# 5. Finishing Touches\n\n### Cleanup\nNow technically everything is ready, but it is missing better usability and maintainability. So start by moving (cut & paste) the 3 big flows (outlined in blue) to separate n8n workflows. You can name them as follows:\n- Notion-Todoist Full Sync (<workspace-name>)\n- Notion-Todoist Diff Sync (<workspace-name>)\n- Todoist-Notion Diff Sync (<workspace-name>)\n \nMake sure to **activate every workflow** which requires it.\nAlso save this workflow to avoid duplicates.\n\n### First run\n- Execute the **Notion-Todoist Full Sync** workflow manually first\n- Now that the initial sync is done and you can start using the realtime sync"
          },
          "typeVersion": 1
        }
      ],
      "active": false,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "a3febb48-a786-4168-8e4f-61821e15858e",
      "connections": {
        "Wait": {
          "main": [
            [
              {
                "node": "Update tries",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge summary",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait1": {
          "main": [
            [
              {
                "node": "Update tries1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait2": {
          "main": [
            [
              {
                "node": "Update tries2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion": {
          "main": [
            [
              {
                "node": "Map Notion to Todoist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Execute Workflow",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Execute Workflow1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Todoist": {
          "main": [
            [
              {
                "node": "Pick Todoist Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Update section (Sync API)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set tries": {
          "main": [
            [
              {
                "node": "Get Todoist Task",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set tries1": {
          "main": [
            [
              {
                "node": "Get Todoist Task2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set tries2": {
          "main": [
            [
              {
                "node": "Get Todoist Task1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract IDs": {
          "main": [
            [
              {
                "node": "Notion trigger reference",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get projects": {
          "main": [
            [
              {
                "node": "Prep Dropdown1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get sections": {
          "main": [
            [
              {
                "node": "Generate config",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update tries": {
          "main": [
            [
              {
                "node": "If tries left",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate UUID": {
          "main": [
            [
              {
                "node": "Prepare Batching Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get variables": {
          "main": [
            [
              {
                "node": "Verify security token",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If tries left": {
          "main": [
            [
              {
                "node": "Set tries",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Retry limit reached",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge summary": {
          "main": [
            [
              {
                "node": "Filter out status changes",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Dropdown": {
          "main": [
            [
              {
                "node": "Choose Notion Database",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update tries1": {
          "main": [
            [
              {
                "node": "If tries left1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update tries2": {
          "main": [
            [
              {
                "node": "If tries left2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add project ID": {
          "main": [
            [
              {
                "node": "If Todoist ID exists",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Body is array?": {
          "main": [
            [
              {
                "node": "Split out Notion changes",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Notion trigger reference",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Due date empty": {
          "main": [
            [
              {
                "node": "Mark as Focussed in Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execution Data": {
          "main": [
            [
              {
                "node": "Check if Todoist ID is locked",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate UUID1": {
          "main": [
            [
              {
                "node": "Update section (Sync API)1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate UUID2": {
          "main": [
            [
              {
                "node": "Update section (Sync API)2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get todoist ID": {
          "main": [
            [
              {
                "node": "Lock Todoist ID4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If tries left1": {
          "main": [
            [
              {
                "node": "Set tries1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Retry limit reached1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If tries left2": {
          "main": [
            [
              {
                "node": "Set tries2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Retry limit reached2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion Webhook": {
          "main": [
            [
              {
                "node": "Body is array?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OAuth redirect": {
          "main": [
            [
              {
                "node": "Get variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Dropdown1": {
          "main": [
            [
              {
                "node": "Choose Todoist Project",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Status changed": {
          "main": [
            [
              {
                "node": "Get mapped item1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Status is Done": {
          "main": [
            [
              {
                "node": "Mark as Completed in Todoist",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Delete Task in Todoist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Exchange Tokens": {
          "main": [
            [
              {
                "node": "Respond with success",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respond with error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execution Data1": {
          "main": [
            [
              {
                "node": "Get Notion Task1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execution Data2": {
          "main": [
            [
              {
                "node": "Update Description in Todoist",
                "type": "main",
                "index": 0
              },
              {
                "node": "Lock Notion ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execution Data3": {
          "main": [
            [
              {
                "node": "Switch by Event",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execution Data4": {
          "main": [
            [
              {
                "node": "Mark as Obsolete in Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execution Data5": {
          "main": [
            [
              {
                "node": "Check if Notion ID is locked",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execution Data6": {
          "main": [
            [
              {
                "node": "Status is Obsolete?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate config": {
          "main": [
            [
              {
                "node": "Return config JSON",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Notion Task": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Notion task": {
          "main": [
            [
              {
                "node": "Map Notion to Todoist2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get mapped item": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get todoist ID1": {
          "main": [
            [
              {
                "node": "Lock Todoist ID4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [
              {
                "node": "Exists/Completed in Notion",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get Notion Task",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Store variables": {
          "main": [
            [
              {
                "node": "Redirect to Auth Page",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch by Event": {
          "main": [
            [
              {
                "node": "Differences exist1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Description has changed in Todoist",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Requires completion change1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Requires completion change1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Todoist Webhook": {
          "main": [
            [
              {
                "node": "Switch by project",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Compare Datasets": {
          "main": [
            [
              {
                "node": "Handle empty dates2",
                "type": "main",
                "index": 0
              }
            ],
            [],
            [
              {
                "node": "Handle empty dates",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Notion Task1": {
          "main": [
            [
              {
                "node": "Notion Task not found",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Notion Task2": {
          "main": [
            [
              {
                "node": "Notion Task found1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Todoist Task": {
          "main": [
            [
              {
                "node": "Mark as Incomplete in Todoist",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Catch known error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get mapped item1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Get mapped item2": {
          "main": [
            [
              {
                "node": "Merge summary",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Loop Over Items1": {
          "main": [
            [],
            [
              {
                "node": "Generate UUID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Notion",
                "type": "main",
                "index": 0
              },
              {
                "node": "Todoist",
                "type": "main",
                "index": 0
              },
              {
                "node": "Globals",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Store Todoist ID": {
          "main": [
            [
              {
                "node": "Get mapped item2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Catch known error": {
          "main": [
            [
              {
                "node": "Create task in Todoist",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Differences exist": {
          "main": [
            [
              {
                "node": "Update task in Todoist1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Todoist Task1": {
          "main": [
            [
              {
                "node": "Map Todoist to Notion1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Catch known error2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Todoist Task2": {
          "main": [
            [
              {
                "node": "Differences exist",
                "type": "main",
                "index": 0
              },
              {
                "node": "Requires completion change",
                "type": "main",
                "index": 0
              },
              {
                "node": "Status changed but not empty",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Catch known error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set creating flag": {
          "main": [
            [
              {
                "node": "Create task in Todoist1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch by project": {
          "main": [
            [
              {
                "node": "Todoist trigger reference",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Todoist ID exists": {
          "main": [
            [
              {
                "node": "Delete Task in Todoist2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Catch known error1": {
          "main": [
            [
              {
                "node": "Status is not Done",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Catch known error2": {
          "main": [
            [
              {
                "node": "End here",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Wait2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Differences exist1": {
          "main": [
            [
              {
                "node": "Update task in Notion",
                "type": "main",
                "index": 0
              },
              {
                "node": "Due date empty",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Handle empty dates": {
          "main": [
            [
              {
                "node": "Update Task in Todoist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map summary fields": {
          "main": [
            [
              {
                "node": "Convert to HTML Table",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion Task found1": {
          "main": [
            [
              {
                "node": "Execution Data4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set creating flag1": {
          "main": [
            [
              {
                "node": "Get Backlog Section ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Status is not Done": {
          "main": [
            [
              {
                "node": "Check if creating flag exists",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Todoist ID exists?": {
          "main": [
            [
              {
                "node": "Set tries1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Check if creating flag exists",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Append Notion Block": {
          "main": [
            [
              {
                "node": "Lock Notion ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate email body": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Handle empty dates1": {
          "main": [
            [
              {
                "node": "Update task in Todoist before closing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Handle empty dates2": {
          "main": [
            [
              {
                "node": "Add project ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Has been completed?": {
          "main": [
            [
              {
                "node": "Mark as Completed in Todoist1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Mark as Incomplete in Todoist1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pick Todoist Fields": {
          "main": [
            [
              {
                "node": "Compare Datasets",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Status is Obsolete?": {
          "main": [
            [
              {
                "node": "Todoist ID exists",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Neither focussed nor planned",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Notion Databases": {
          "main": [
            [
              {
                "node": "Prep Dropdown",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If Todoist ID exists": {
          "main": [
            [
              {
                "node": "Set tries",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create task in Todoist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prepare summary data": {
          "main": [
            [
              {
                "node": "Merge summary",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Convert to HTML Table": {
          "main": [
            [
              {
                "node": "Generate email body",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create task in Notion": {
          "main": [
            [
              {
                "node": "Execution Data2",
                "type": "main",
                "index": 0
              },
              {
                "node": "Turn Markdown into Notion Blocks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Notion to Todoist": {
          "main": [
            [
              {
                "node": "Compare Datasets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Todoist to Notion": {
          "main": [
            [
              {
                "node": "Map summary fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion Task not found": {
          "main": [
            [
              {
                "node": "Check if creating flag exists1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Execution Data3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prepare summary data1": {
          "main": [
            [
              {
                "node": "Merge summary",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "Prepare summary data2": {
          "main": [
            [
              {
                "node": "Merge summary",
                "type": "main",
                "index": 4
              }
            ]
          ]
        },
        "Update task in Notion": {
          "main": [
            [
              {
                "node": "Lock Notion ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Verify security token": {
          "main": [
            [
              {
                "node": "Exchange Tokens",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respond with error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Choose Notion Database": {
          "main": [
            [
              {
                "node": "Get Notion Database ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Choose Todoist Project": {
          "main": [
            [
              {
                "node": "Get Todoist Project ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create task in Todoist": {
          "main": [
            [
              {
                "node": "Store Todoist ID",
                "type": "main",
                "index": 0
              },
              {
                "node": "Lock Todoist ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete Task in Todoist": {
          "main": [
            [
              {
                "node": "Prepare summary data2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Backlog Section ID": {
          "main": [
            [
              {
                "node": "Generate UUID1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Create task in Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Notion Database ID": {
          "main": [
            [
              {
                "node": "Get projects",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Todoist Project ID": {
          "main": [
            [
              {
                "node": "Get sections",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Notion to Todoist1": {
          "main": [
            [
              {
                "node": "Handle empty dates1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Notion to Todoist2": {
          "main": [
            [
              {
                "node": "Execution Data6",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Todoist to Notion1": {
          "main": [
            [
              {
                "node": "Execution Data1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Done in Notion": {
          "main": [
            [
              {
                "node": "Lock Notion ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prepare Batching Items": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Task in Todoist": {
          "main": [
            [
              {
                "node": "Status changed",
                "type": "main",
                "index": 0
              },
              {
                "node": "Lock Todoist ID2",
                "type": "main",
                "index": 0
              },
              {
                "node": "Prepare summary data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update task in Todoist": {
          "main": [
            [
              {
                "node": "Get mapped item",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create task in Todoist1": {
          "main": [
            [
              {
                "node": "Store Todoist ID1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Lock Todoist ID4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete Task in Todoist2": {
          "main": [
            [
              {
                "node": "Get todoist ID1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Generate security token": {
          "main": [
            [
              {
                "node": "Store variables",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Has not been completed?": {
          "main": [
            [
              {
                "node": "Mark as In Progress in Notion",
                "type": "main",
                "index": 0
              },
              {
                "node": "Neither focussed nor planned1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Mark as Done in Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update task in Todoist1": {
          "main": [
            [
              {
                "node": "Get todoist ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execute Workflow Trigger": {
          "main": [
            []
          ]
        },
        "If event is not :deleted": {
          "main": [
            [
              {
                "node": "Set tries2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get Notion Task2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion trigger reference": {
          "main": [
            [
              {
                "node": "Globals2",
                "type": "main",
                "index": 0
              },
              {
                "node": "Execution Data5",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split out Notion changes": {
          "main": [
            [
              {
                "node": "Extract IDs",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter out status changes": {
          "main": [
            [
              {
                "node": "Map Todoist to Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Todoist trigger reference": {
          "main": [
            [
              {
                "node": "Execution Data",
                "type": "main",
                "index": 0
              },
              {
                "node": "Globals1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update section (Sync API)": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Exists/Completed in Notion": {
          "main": [
            [
              {
                "node": "Map Notion to Todoist1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Delete Task in Todoist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Focussed in Notion": {
          "main": [
            [
              {
                "node": "Lock Notion ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Obsolete in Notion": {
          "main": [
            [
              {
                "node": "Lock Notion ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Requires completion change": {
          "main": [
            [
              {
                "node": "Has been completed?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update section (Sync API)2": {
          "main": [
            [
              {
                "node": "Get todoist ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Only continue if not locked": {
          "main": [
            [
              {
                "node": "If event is not :deleted",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Requires completion change1": {
          "main": [
            [
              {
                "node": "Has not been completed?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check if Notion ID is locked": {
          "main": [
            [
              {
                "node": "Only continue if not locked1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Handle each block separately": {
          "main": [
            [
              {
                "node": "Append Notion Block",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Completed in Todoist": {
          "main": [
            [
              {
                "node": "Prepare summary data1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Neither focussed nor planned": {
          "main": [
            [
              {
                "node": "Todoist ID exists",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Todoist ID exists?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Only continue if not locked1": {
          "main": [
            [
              {
                "node": "Get Notion task",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Status changed but not empty": {
          "main": [
            [
              {
                "node": "Generate UUID2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Todoist Webhook Setup Helper": {
          "main": [
            [
              {
                "node": "Generate security token",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check if Todoist ID is locked": {
          "main": [
            [
              {
                "node": "Only continue if not locked",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check if creating flag exists": {
          "main": [
            [
              {
                "node": "Only continue if flag does not exist",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Completed in Todoist1": {
          "main": [
            [
              {
                "node": "Get todoist ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as In Progress in Notion": {
          "main": [
            [
              {
                "node": "Lock Notion ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Incomplete in Todoist": {
          "main": [
            [
              {
                "node": "Update task in Todoist",
                "type": "main",
                "index": 0
              },
              {
                "node": "Lock Todoist ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Neither focussed nor planned1": {
          "main": [
            [
              {
                "node": "Mark as Focussed in Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check if creating flag exists1": {
          "main": [
            [
              {
                "node": "Only continue if flag does not exist1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mark as Incomplete in Todoist1": {
          "main": [
            [
              {
                "node": "Get todoist ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notion-Todoist Sync Setup Helper": {
          "main": [
            [
              {
                "node": "Get Notion Databases",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Turn Markdown into Notion Blocks": {
          "main": [
            [
              {
                "node": "Handle each block separately",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Description has changed in Todoist": {
          "main": [
            [
              {
                "node": "Update Description in Todoist1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Only continue if flag does not exist": {
          "main": [
            [
              {
                "node": "Set creating flag",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Only continue if flag does not exist1": {
          "main": [
            [
              {
                "node": "Set creating flag1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update task in Todoist before closing": {
          "main": [
            [
              {
                "node": "Status is Done",
                "type": "main",
                "index": 0
              },
              {
                "node": "Lock Todoist ID1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "youtube-playlist-summarizer",
    "title": "AI YouTube Playlist Summaries",
    "description": "Fetches playlists, downloads transcripts, caches data in Redis/Qdrant, and produces long-form summaries with Gemini.",
    "problem": "Knowledge workers want digestible summaries of hours-long playlists without manual watching.",
    "tags": [
      "youtube",
      "summaries",
      "redis",
      "qdrant",
      "gemini"
    ],
    "metadata": {
      "industries": [
        "media",
        "knowledge"
      ],
      "domains": [
        "summaries",
        "research"
      ],
      "channels": [
        "slack",
        "docs"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "YouTube",
        "Redis",
        "Qdrant",
        "Gemini"
      ]
    },
    "workflow": {
      "id": "4Tq5HZBdETVe7jEb",
      "meta": {
        "instanceId": "2cb7a61f866faf57392b91b31f47e08a2b3640258f0abd08dd71f087f3243a5a",
        "templateCredsSetupCompleted": true
      },
      "name": "âš¡AI-Powered YouTube Playlist & Video Summarization and Analysis v2",
      "tags": [],
      "nodes": [
        {
          "id": "505077d1-a2e4-4b0d-99d6-756940022c3d",
          "name": "Google Gemini Chat Model1",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            -440,
            -40
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-pro-exp"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "5da369db-b801-4653-888d-0e6042620298",
          "name": "Handle Queries",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            -160,
            -280
          ],
          "parameters": {
            "text": "={{ $('Chat').item.json.chatInput }}",
            "options": {
              "systemMessage": "=You are an intelligent assistant that can respond to queries related to the content of a Youtube Playlist or a single Video.\n\n# YOUR TASK\nDecide if the user has provided the info required and reply accordingly. If there is no url in context you have to suggest the user to provide one. \n\n\n1. If the user provided a YouTube Playlist or Video URL: reply in structured markdown format to the user based on the formulated questions and context. Assume the user is here because they don't won't / have time to watch such videos so:\n- Use the tool called `chat_playlist_data`, which can analyze YouTube videos. Use this tool effectively to process video content and generate structured summaries.\n- Your answers needs to be exhaustive and minimise bullet points\n- Be verbose in your response\n\n2. 1. If the user provided a YouTube Playlist or Video URL:\n- Do not ask for more specific details - always try to summarize the videos with the data from the tool `chat_playlist_data`\n- Never reply \"already provided a detailed summary\" - always try to summarize again the videos with more info from the tool `chat_playlist_data` - even if you have already provided the data before (so repeat yourself).\n\n3. If the user HAS NOT provided a YouTube Playlist URL or a invaid URL: gently invite the user to provide the URL so you can process it. \n\n# Rules\n\n## YouTube Playlist URL Definition\n- A URL from www.youtube.com or youtube.com.\n- Contains the query parameter `list=` followed by a playlist ID.\n- Example: https://www.youtube.com/playlist?list=PLXXXXXX (where PLXXXXXX is the playlist ID).\n\n## YouTube Video URL Definition\n- A URL from www.youtube.com, youtube.com, or youtu.be.\n- For www.youtube.com or youtube.com, it contains the query parameter `v=` followed by a video ID.\n- For youtu.be, it follows the format https://youtu.be/VIDEO_ID.\n- Examples:\n  - https://www.youtube.com/watch?v=VIDEO_ID (where VIDEO_ID is the video ID).\n  - https://youtu.be/VIDEO_ID\n- Does NOT have a query parameter `list=`\n\n# Context\n{\n  \"intent\": {{ $('Default Intent').item.json.output?.intent || \"NONE\" }},\n  \"url\": {{ $('Default Intent').item.json.output?.url || \"\" }},\n  \"id\": {{ $('Default Intent').item.json.output?.id || \"\" }},\n  \"limit\": {{ $('Default Intent').item.json.output?.limit || 0 }},\n  \"status\": {{ $('Default Intent').item.json.output?.status || 'PENDING' }}\n}"
            },
            "promptType": "define"
          },
          "typeVersion": 1.7
        },
        {
          "id": "866bf387-3482-4615-94d5-fd72d5db21da",
          "name": "Split Out",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            1380,
            -200
          ],
          "parameters": {
            "include": "selectedOtherFields",
            "options": {},
            "fieldToSplitOut": "transcript",
            "fieldsToInclude": "youtubeId"
          },
          "typeVersion": 1
        },
        {
          "id": "359404ce-4bc9-4e4d-9a26-22b9f9b176c9",
          "name": "Summarize & Analyze Transcript",
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "position": [
            660,
            540
          ],
          "parameters": {
            "text": "=Please analyze the given text and create a structured summary following these guidelines:\n\n1. Break down the content into main topics using Level 2 headers (##)\n2. Under each header:\n   - List only the most essential concepts and key points\n   - Use bullet points for clarity\n   - Keep explanations concise\n   - Preserve technical accuracy\n   - Highlight key terms in bold\n3. Format requirements:\n   - Use markdown formatting\n   - Keep bullet points simple (no nesting)\n   - Bold important terms using **term**\n   - Use tables for comparisons\n   - Include relevant technical details\n\nPlease provide a clear, structured summary that captures the core concepts while maintaining technical accuracy.\n\n**Make sure the summary is 300-400 max characters long.**\n\nInclude metadata such as video number, id, and title in the summary.\n\n**Here is the text**\n\nVideo number: {{ $json.video_number }}\nTitle: {{ $json.title }}\nYoutube ID: {{ $json.youtubeId }}\nTranscript:\n{{ $json.transcript_text }}",
            "promptType": "define"
          },
          "typeVersion": 1.4
        },
        {
          "id": "036765df-6da4-4430-bcea-af4066fb7c24",
          "name": "Concatenate",
          "type": "n8n-nodes-base.summarize",
          "position": [
            1700,
            -200
          ],
          "parameters": {
            "options": {},
            "fieldsToSplitBy": "youtubeId",
            "fieldsToSummarize": {
              "values": [
                {
                  "field": "transcript.text",
                  "separateBy": " ",
                  "aggregation": "concatenate"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "9152725c-15ca-41a0-8f98-108834e0c8be",
          "name": "Split Out1",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            660,
            40
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "videos"
          },
          "typeVersion": 1
        },
        {
          "id": "fee0e045-614a-41f0-ac75-051dff773e77",
          "name": "Limit",
          "type": "n8n-nodes-base.limit",
          "position": [
            860,
            40
          ],
          "parameters": {
            "maxItems": "={{ $('Update Context Intent').item.json.output.limit }}"
          },
          "typeVersion": 1
        },
        {
          "id": "a691c1c7-d8c4-4eab-861b-f7cfcbeb0fc8",
          "name": "Qdrant Vector Store",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
          "position": [
            1680,
            480
          ],
          "parameters": {
            "mode": "insert",
            "options": {},
            "qdrantCollection": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Update Context Intent').first().json.output.id }}"
            }
          },
          "credentials": {
            "qdrantApi": {
              "id": "mb8rw8tmUeP6aPJm",
              "name": "QdrantApi account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "c3949e8f-0deb-4106-aaa5-e64403024243",
          "name": "Recursive Character Text Splitter",
          "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
          "position": [
            1800,
            860
          ],
          "parameters": {
            "options": {},
            "chunkSize": 1200,
            "chunkOverlap": 200
          },
          "typeVersion": 1
        },
        {
          "id": "a3b23c6b-14c0-4805-8220-7c6166268276",
          "name": "Embeddings Google Gemini",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            1660,
            700
          ],
          "parameters": {
            "modelName": "models/text-embedding-004"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "6f4ee00d-dcdc-4468-9713-115912c1e571",
          "name": "Google Gemini Chat Model2",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            640,
            740
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-flash"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "75442631-512e-4b0e-a5a8-ed3e3a3e1f94",
          "name": "Embeddings Google Gemini1",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            -120,
            320
          ],
          "parameters": {
            "modelName": "models/text-embedding-004"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "c33ceeca-9bf0-4dd2-b8df-fc2a1ccdf512",
          "name": "Chat",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            -2780,
            -460
          ],
          "webhookId": "e66183cc-1eed-4968-b34b-bcecf1bb55e8",
          "parameters": {
            "public": true,
            "options": {
              "loadPreviousSession": "notSupported"
            },
            "initialMessages": "Hi there! ðŸ‘‹\nPlease provide a URL of a Youtube playlist you would like me to analise."
          },
          "typeVersion": 1.1
        },
        {
          "id": "06bb2dfd-027c-4902-9559-2de080f6c145",
          "name": "Video Titles",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            1160,
            40
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "id,title"
          },
          "typeVersion": 1
        },
        {
          "id": "d9bbdda2-ef26-4b6c-94d0-7542f88f1530",
          "name": "Merge",
          "type": "n8n-nodes-base.merge",
          "position": [
            1700,
            20
          ],
          "parameters": {
            "mode": "combineBySql",
            "query": "SELECT \n  ROW_NUMBER() AS video_number,\n  input1.youtubeId, input2.title, input1.concatenated_transcript_text as transcript_text FROM input1 LEFT JOIN input2 ON input1.youtubeId = input2.id"
          },
          "typeVersion": 3
        },
        {
          "id": "e6febdb9-370b-478d-b470-d6c2d3314d7b",
          "name": "Edit Fields",
          "type": "n8n-nodes-base.set",
          "position": [
            980,
            540
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "b5e935c5-4973-40a3-adb9-fa76904d2ed9",
                  "name": "video_number",
                  "type": "number",
                  "value": "={{ $('Merge').item.json.video_number }}"
                },
                {
                  "id": "e98f417d-123f-4a85-b2f7-64430e7b0250",
                  "name": "youtubeId",
                  "type": "string",
                  "value": "={{ $('Merge').item.json.youtubeId }}"
                },
                {
                  "id": "d0ced7fd-c9a3-4a09-bf09-e4b5e45dd03d",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Merge').item.json.title }}"
                },
                {
                  "id": "31a80e6d-9b02-4d21-b888-1a00c036a04b",
                  "name": "summary",
                  "type": "string",
                  "value": "={{ $json.text }}"
                },
                {
                  "id": "ef12f3f2-3d63-4e78-835f-7da004393a07",
                  "name": "transcript_text",
                  "type": "string",
                  "value": "={{ $('Merge').item.json.transcript_text }}"
                },
                {
                  "id": "afa841e2-6f8b-4b27-9f28-10368ee32c2e",
                  "name": "playlistId",
                  "type": "string",
                  "value": "={{ $('Update Context Intent').first().json.output.id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "2736a1e6-a982-4f60-aa8d-658e9a3e9193",
          "name": "AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            2720,
            480
          ],
          "parameters": {
            "text": "=Please analyze the given \"Transcript summary\" and create a full summary overview, following the below guidelines.\n\n1. Provide a full descriptive break down of the content of each video. Assume the user does not won't or have time to watch such videos, so:\n- Your summary needs to be exhaustive, descriptive, and minimise bullet points\n- Your summary needs to captures all the core concepts while maintaining technical accuracy\n- Your summary will be verbose\n\n2. Consider that the intent of the user is not to watch the videos but rather have all the content required and summaries from on the \"Transcript summary\".\n\n3. Use the tool called `chat_playlist_data`, which can analyze YouTube videos. Use this tool effectively to process video content and generate structured summaries.\n\nUser message:\n{{ $('Chat').item.json.chatInput }}\n\nTranscript summary:\n{{ $('Full Summary').item.json.concatenated_summary }}",
            "agent": "conversationalAgent",
            "options": {},
            "promptType": "define"
          },
          "executeOnce": true,
          "typeVersion": 1.7
        },
        {
          "id": "cf1e5c50-9c89-465f-beca-482cbd9affba",
          "name": "Google Gemini Chat Model4",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            2520,
            720
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-flash"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "1cbcec5e-b58c-4fce-b944-08c47a7385db",
          "name": "Delete Collection",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueRegularOutput",
          "position": [
            1340,
            480
          ],
          "parameters": {
            "url": "=https://3114dbb7-bd13-4807-8815-c3c8784f66d6.eu-west-1-0.aws.cloud.qdrant.io/collections/{{ $('Update Context Intent').first().json.playlistID }}/points/delete",
            "method": "POST",
            "options": {},
            "jsonBody": "{\n  \"filter\": {}\n}",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "nodeCredentialType": "qdrantApi"
          },
          "credentials": {
            "qdrantApi": {
              "id": "mb8rw8tmUeP6aPJm",
              "name": "QdrantApi account"
            }
          },
          "executeOnce": true,
          "typeVersion": 4.2
        },
        {
          "id": "16d7eaec-1d98-42dd-89aa-2681a9d1697d",
          "name": "Default Data Loader",
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "position": [
            1820,
            700
          ],
          "parameters": {
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "video_number",
                    "value": "={{ $input.item.json.video_number }}"
                  },
                  {
                    "name": "=youtubeId",
                    "value": "={{ $input.item.json.youtubeId }}"
                  },
                  {
                    "name": "summary",
                    "value": "={{ $input.item.json.summary }}"
                  },
                  {
                    "name": "title",
                    "value": "={{ $input.item.json.title }}"
                  },
                  {
                    "name": "playlistId",
                    "value": "={{ $input.item.json.playlistId }}"
                  }
                ]
              }
            }
          },
          "typeVersion": 1
        },
        {
          "id": "d3bc9db2-7618-46fd-b825-2cc0ad45fc22",
          "name": "Chat Buffer Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            -260,
            -40
          ],
          "parameters": {
            "sessionKey": "={{ $('Chat').item.json.sessionId }}",
            "sessionIdType": "customKey",
            "contextWindowLength": 10
          },
          "typeVersion": 1.3
        },
        {
          "id": "fb55b13f-880f-404c-9446-9f8a238c8a5c",
          "name": "Full Summary",
          "type": "n8n-nodes-base.summarize",
          "position": [
            2520,
            480
          ],
          "parameters": {
            "options": {},
            "fieldsToSummarize": {
              "values": [
                {
                  "field": "summary",
                  "separateBy": "\n",
                  "aggregation": "concatenate"
                }
              ]
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "efc2fc99-c738-425e-9ee1-669e378e197f",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -560,
            -400
          ],
          "parameters": {
            "color": 7,
            "width": 1080,
            "height": 900,
            "content": "## RAG & Reply to User Query\n- Retrieves and provides answers to user queries combining retrieval-augmented generation.\n- Processes messages without specific routing rules.\n     "
          },
          "typeVersion": 1
        },
        {
          "id": "0040adf6-2cfc-4b79-ba81-b76740bfd158",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            560,
            -400
          ],
          "parameters": {
            "color": 7,
            "width": 1380,
            "height": 700,
            "content": "## Fetch and prepare Playlist video transcripts data for processing \n- Collects and organizes playlist video transcripts.\n- Prepares data for analysis and summarization."
          },
          "typeVersion": 1
        },
        {
          "id": "59b29fc5-5d88-40c0-a273-9dc71d9f009e",
          "name": "Chat Buffer Memory1",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            2700,
            720
          ],
          "parameters": {
            "sessionKey": "={{ $('Chat').item.json.sessionId }}",
            "sessionIdType": "customKey",
            "contextWindowLength": 10
          },
          "typeVersion": 1.3
        },
        {
          "id": "afb6f6be-d299-402e-a9c6-2c60fbf4974e",
          "name": "YouTube Transcript",
          "type": "n8n-nodes-youtube-transcription-dmr.youtubeTranscripter",
          "position": [
            1160,
            -200
          ],
          "parameters": {
            "videoId": "={{ $json.id }}",
            "continueOnFail": true
          },
          "typeVersion": 1
        },
        {
          "id": "9a43eb4a-9d4c-4fce-b19c-94485aa8af76",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            560,
            340
          ],
          "parameters": {
            "color": 7,
            "width": 640,
            "height": 700,
            "content": "## Summarize & Analyze Transcript\n- Creates summarized data from transcripts."
          },
          "typeVersion": 1
        },
        {
          "id": "676677f0-3dae-4873-a449-92930ced534e",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1240,
            340
          ],
          "parameters": {
            "color": 7,
            "width": 980,
            "height": 700,
            "content": "## Store Embeddings\n- Saves embedded data for future use.\n- Updates current context to maintain the flow of the conversation.     "
          },
          "typeVersion": 1
        },
        {
          "id": "9ecd4d0d-b8bd-4a5d-981f-49fa515c17be",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2260,
            340
          ],
          "parameters": {
            "color": 7,
            "width": 940,
            "height": 880,
            "content": "## First Summary Analysis\n- Conducts initial analysis of summarized data.\n- Return to the user insights from processed transcripts."
          },
          "typeVersion": 1
        },
        {
          "id": "45ae8377-0848-45fb-a7a3-aba8d44e3d35",
          "name": "Message Intent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "onError": "continueRegularOutput",
          "position": [
            -2260,
            -460
          ],
          "parameters": {
            "text": "= {{ $('Chat').item.json.chatInput }}",
            "options": {
              "systemMessage": "=**# YOUR TASK:**\nPlease analyze the user's message and decide if the user has provided the info required - and ALWAYS reply using the **Output format** defined below.\n\n# Output format\nYou use the following JSON structure to reply, don't include anything else, and alway inlude all the fields:\n```\n{\n  \"intent\": PLAYLIST|VIDEO|NONE,\n  \"url\": Youtube Playlist or Video URL or empty string,\n  \"id\": Youtube Playlist or Video ID or empty string,\n  \"limit\": number, default 0,\n  \"status\": Previous context status `{{ $json.context_intent?.status }}` or \"PENDING\"\n}\n```\n\n## INTENT field GUIDELINES:\n\n**Respond with \"PLAYLIST\" if:**\n- The messsage contains a valid Youtube Playlist URL\n\n**Respond with \"VIDEO\" if:**\n- The messsage contains a valid Youtube Video URL\n\n**Respond with \"NONE\" if:**\n- The messsage does not contains a valid Youtube Playlist or Video URL\n\n## LIMIT field GUIDELINE:\nIf the \"Previous Context\" intent or the current intent is a Playlist: Based on current or most recent user message, check if there is an indication of how many videos to process, otherwise default to 0.\n\n## STATUS field GUIDELINE\nIf intent is a Playlist or Video and _different_ from the the \"Previous Context\" then use \"PENDING\" since the user intent is to run a new process. Otherwise use the \"Previous Context\" status value.\n\n\n# Rules for Playlist and Video\n\n## YouTube Playlist URL Definition\n- A URL from www.youtube.com or youtube.com.\n- Contains the query parameter `&list=` followed by a playlist ID.\n- Example: https://www.youtube.com/...&list=PLXXXXXX (where PLXXXXXX is the playlist ID).\n\n## YouTube Video URL Definition\n- A URL from www.youtube.com, youtube.com, or youtu.be.\n- For www.youtube.com or youtube.com, it contains the query parameter `v=` followed by a video ID.\n- For youtu.be, it follows the format https://youtu.be/VIDEO_ID.\n- Examples:\n  - https://www.youtube.com/watch?v=VIDEO_ID (where VIDEO_ID is the video ID).\n  - https://youtu.be/VIDEO_ID\n- IMPORTANT: YouTube Video URL **Does NOT have a query parameter `list=`**\n\n\n# Previous Context\n{{ JSON.stringify($json.context_intent) }}\n"
            },
            "promptType": "define",
            "hasOutputParser": true
          },
          "retryOnFail": true,
          "typeVersion": 1.7,
          "alwaysOutputData": true
        },
        {
          "id": "a29403f0-ed5c-465c-a43d-84e8dee69662",
          "name": "Structured Output Parser1",
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "position": [
            -2020,
            -220
          ],
          "parameters": {
            "jsonSchemaExample": "{\n  \"intent\": \"PLAYLIST|VIDEO|NONE\",\n  \"url\": \"Youtube Playlist or Video URL or empty string,\",\n  \"id\": \"Youtube Playlist or Video ID or empty string,\",\n  \"limit\": \"number of playlist videos to process or 0\",\n  \"status\": \"PENDING|READY|DONE\"\n}"
          },
          "typeVersion": 1.2
        },
        {
          "id": "b3f43325-aa7b-47f3-8bbb-e27fa0c44a1e",
          "name": "Update Context Intent",
          "type": "n8n-nodes-base.redis",
          "position": [
            -1160,
            -640
          ],
          "parameters": {
            "key": "=context_intent_{{ $('Chat').item.json.sessionId }}",
            "value": "=intent {{ $('Process Status').item.json.output?.intent || null }} url {{ $('Process Status').item.json.output?.url || \"\" }} id {{ $('Process Status').item.json.output?.id || \"\" }} limit {{ $('Process Status').item.json.output?.limit || 0 }} status {{ $('Process Status').item.json.output?.status || 'PENDING'  }}",
            "keyType": "hash",
            "operation": "set",
            "valueIsJSON": false
          },
          "credentials": {
            "redis": {
              "id": "mA0f9F1ROUThyrRW",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "9c296501-049c-44b5-ae8d-8dda2c523278",
          "name": "Get Previous Context Intent",
          "type": "n8n-nodes-base.redis",
          "onError": "continueRegularOutput",
          "position": [
            -2440,
            -460
          ],
          "parameters": {
            "key": "=context_intent_{{ $('Chat').item.json.sessionId }}",
            "keyType": "hash",
            "options": {
              "dotNotation": false
            },
            "operation": "get",
            "valueIsJSON": false,
            "propertyName": "context_intent"
          },
          "credentials": {
            "redis": {
              "id": "mA0f9F1ROUThyrRW",
              "name": "Redis account"
            }
          },
          "typeVersion": 1,
          "alwaysOutputData": true
        },
        {
          "id": "9499d9f2-7d6d-432b-bdde-b4b98b90b224",
          "name": "Route Message Intent",
          "type": "n8n-nodes-base.switch",
          "position": [
            -1700,
            -460
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "PROCESS",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "44e008af-4a1a-429d-adb6-039e74b643a6",
                        "operator": {
                          "type": "boolean",
                          "operation": "true",
                          "singleValue": true
                        },
                        "leftValue": "={{ \n  ($json.output.intent == \"VIDEO\" || $json.output.intent == \"PLAYLIST\")\n  && $json.output.status != \"DONE\" \n}}",
                        "rightValue": "/PLAYLIST|VIDEO/"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "QUERY",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "12641857-945d-4470-968e-f3f805bfe1cd",
                        "operator": {
                          "type": "boolean",
                          "operation": "true",
                          "singleValue": true
                        },
                        "leftValue": "={{ \n  $json.output.intent == \"NONE\" || $json.output.status == \"DONE\"\n}}",
                        "rightValue": "NONE"
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "typeVersion": 3.2
        },
        {
          "id": "dfd329e8-98b1-4ae8-8cc1-a1a5215b1c09",
          "name": "Process Status",
          "type": "n8n-nodes-base.code",
          "position": [
            -1340,
            -640
          ],
          "parameters": {
            "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nif ($input.last().json.output.intent == 'VIDEO') {\n  $input.last().json.output.status = 'READY'\n}\n\nelse if ($input.last().json.output.intent == 'PLAYLIST' && parseInt($input.last().json.output.limit) > 0) {\n  $input.last().json.output.status = 'READY'\n}\n\nelse {\n  $input.last().json.output = {\n    intent: $('Default Intent').first().json.output.intent,\n    url: $('Default Intent').first().json.output.url,\n    id: $('Default Intent').first().json.output.id,\n    limit: $('Default Intent').first().json.output.limit,\n    status: 'PENDING',\n  }\n}\n\n\nreturn $input.all();"
          },
          "typeVersion": 2
        },
        {
          "id": "c84c21c6-0948-4628-b7a8-7cd2a5602cdc",
          "name": "Simple Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            -2180,
            -220
          ],
          "parameters": {
            "sessionKey": "=intent_{{ $('Chat').item.json.sessionId }}",
            "sessionIdType": "customKey"
          },
          "typeVersion": 1.3
        },
        {
          "id": "8ad2e1d1-b657-47cd-afa5-4fc49dc7e0e6",
          "name": "Simple Memory3",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            1040,
            -1180
          ],
          "parameters": {
            "sessionKey": "=pl_n_{{ $('Chat').item.json.sessionId }}",
            "sessionIdType": "customKey"
          },
          "typeVersion": 1.3
        },
        {
          "id": "cf4d7c73-d9b1-42da-9ccc-6abccde4110c",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2540,
            -620
          ],
          "parameters": {
            "color": 7,
            "width": 1080,
            "height": 580,
            "content": "## Message intent routing\n- Retrieves the previous context for continuity.\n- Ensures data integrity before processing.\n- Routes incoming messages based on intent.\n     "
          },
          "typeVersion": 1
        },
        {
          "id": "c0ecf826-b803-421a-aa2a-cb713131fbb7",
          "name": "Google Gemini Chat Model6",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            -2340,
            -220
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-flash-lite"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "513a8c71-e982-47df-87bd-1e3d3ae9c613",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1420,
            -1020
          ],
          "parameters": {
            "color": 7,
            "width": 460,
            "height": 580,
            "content": "## Update Context\n- Updates any issues detected in the context.\n- Prepares data for workflow progression.\n     "
          },
          "typeVersion": 1
        },
        {
          "id": "d4a9d7aa-dfee-418f-900a-9649f0405861",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            800,
            -1480
          ],
          "parameters": {
            "color": 7,
            "width": 480,
            "height": 460,
            "content": "## Ask number of Playlist videos to process"
          },
          "typeVersion": 1
        },
        {
          "id": "f89481a4-64a2-4895-821f-effe48f7d331",
          "name": "Numb of Videos",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            900,
            -1380
          ],
          "parameters": {
            "text": "={{ $('Chat').item.json.chatInput }}",
            "options": {
              "systemMessage": "=**Objective:**\n\nWe are here because the user wants to analyse a playlist in context, but we are missing how many videos he would like to process. Please reply to the user asking user to provide a number.\n\n## Context\n{{ JSON.stringify($json.output) }}"
            },
            "promptType": "define"
          },
          "typeVersion": 1.7
        },
        {
          "id": "bb8fa898-4953-4148-8339-2d205b86fc91",
          "name": "Default Intent",
          "type": "n8n-nodes-base.code",
          "position": [
            -1920,
            -460
          ],
          "parameters": {
            "jsCode": "if(\n  ($('Message Intent').first().json?.output?.intent == 'NONE' \n     || Object.keys($('Message Intent').first().json?.output || {}).length == 0)\n  && Object.keys($('Get Previous Context Intent').first().json.context_intent).length > 0\n) {\n  //use prev context intent\n  if(!$input.first().json.output) {\n    $input.first().json.output = {}\n  }\n  $input.first().json.output.intent = $('Get Previous Context Intent').first().json.context_intent?.intent || \"NONE\";\n  $input.first().json.output.url = $('Get Previous Context Intent').first().json.context_intent?.url || \"\";\n  $input.first().json.output.id = $('Get Previous Context Intent').first().json.context_intent?.id || \"\";\n  $input.first().json.output.limit = $('Get Previous Context Intent').first().json.context_intent?.limit || 0;\n  $input.first().json.output.status = $('Get Previous Context Intent').first().json.context_intent?.status || \"PENDING\";\n} else {\n  // $input.first().json.output.intent = $('Message Intent').first().json.context_intent?.intent || \"NONE\";\n  // $input.first().json.output.url = $('Message Intent').first().json.context_intent?.url || \"\";\n  // $input.first().json.output.id = $('Message Intent').first().json.context_intent?.id || \"\";\n  // $input.first().json.output.limit = $('Message Intent').first().json.context_intent?.limit || 0;\n  // $input.first().json.output.status = $('Message Intent').first().json.context_intent?.status || \"PENDING\";\n}\n\n// else use message intent\n\nreturn $input.all();"
          },
          "typeVersion": 2
        },
        {
          "id": "0f1d1bb6-22c0-4b65-beaf-eaf4401d7550",
          "name": "Playlist Limit",
          "type": "n8n-nodes-base.if",
          "position": [
            160,
            -860
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "6ee01f0a-9533-4fb3-b023-cfcc422d9011",
                  "operator": {
                    "name": "filter.operator.equals",
                    "type": "string",
                    "operation": "equals"
                  },
                  "leftValue": "={{ $('Process Status').item.json.output.intent }}",
                  "rightValue": "PLAYLIST"
                },
                {
                  "id": "e9575bb2-3c60-498b-b2c7-436b62e5195c",
                  "operator": {
                    "type": "number",
                    "operation": "lte"
                  },
                  "leftValue": "={{ parseInt($('Process Status').item.json.output.limit) }}",
                  "rightValue": 0
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "083c17aa-de83-4f3c-8d71-f665903ce3d5",
          "name": "Playlist or Video",
          "type": "n8n-nodes-base.switch",
          "position": [
            160,
            -640
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "VIDEO",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "cc3ec644-7c3d-4d9f-b7a7-89b85824e3e3",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $('Route Message Intent').item.json.output.intent }}",
                        "rightValue": "VIDEO"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "PLAYLIST",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "33beac83-b96b-4e76-9d18-e22df163ea4d",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $('Route Message Intent').item.json.output.intent }}",
                        "rightValue": "PLAYLIST"
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 3.2
        },
        {
          "id": "0626bc2d-9e3a-4a4f-a331-62e8b6c69840",
          "name": "Get Fields for Summary",
          "type": "n8n-nodes-base.code",
          "position": [
            2340,
            480
          ],
          "parameters": {
            "jsCode": "return $('Edit Fields').all();"
          },
          "typeVersion": 2
        },
        {
          "id": "4aaaed18-ce90-4296-aba2-b5fa9492655d",
          "name": "Update Context Process Done1",
          "type": "n8n-nodes-base.redis",
          "position": [
            2040,
            480
          ],
          "parameters": {
            "key": "=context_intent_{{ $('Chat').first().json.sessionId }}",
            "value": "=intent {{ $('Process Status').first().json.output?.intent || null }} url {{ $('Process Status').first().json.output?.url || \"\" }} id {{ $('Process Status').first().json.output?.id || \"\" }} limit {{ $('Process Status').first().json.output?.limit || 0 }} status DONE",
            "keyType": "hash",
            "operation": "set",
            "valueIsJSON": false
          },
          "credentials": {
            "redis": {
              "id": "mA0f9F1ROUThyrRW",
              "name": "Redis account"
            }
          },
          "executeOnce": true,
          "typeVersion": 1
        },
        {
          "id": "d3f71d59-a158-43e2-bfbd-a3bec20dea5b",
          "name": "Google Gemini Chat Model8",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            880,
            -1180
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-flash-thinking-exp"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "fa6b8a79-436e-4742-9732-cd5c1b2d3c88",
          "name": "Playlist HTTP Request",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            660,
            -200
          ],
          "parameters": {
            "url": "={{ $('Update Context Intent').item.json.output.url }}",
            "options": {}
          },
          "typeVersion": 4.2
        },
        {
          "id": "99d6da96-8983-4e7d-8343-b9ac975f5d20",
          "name": "YouTube Transcript1",
          "type": "n8n-nodes-youtube-transcription-dmr.youtubeTranscripter",
          "position": [
            1200,
            -860
          ],
          "parameters": {
            "videoId": "={{ $('Update Context Intent').item.json.output.id }}",
            "continueOnFail": true
          },
          "typeVersion": 1
        },
        {
          "id": "41a07802-3fba-42fa-8482-f526a7e1b173",
          "name": "Video HTTP Request",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            900,
            -860
          ],
          "parameters": {
            "url": "={{ $('Update Context Intent').item.json.output.url }}",
            "options": {}
          },
          "typeVersion": 4.2
        },
        {
          "id": "02103114-9c22-49b1-9dee-746b84cdef66",
          "name": "Get Title and Desc",
          "type": "n8n-nodes-base.code",
          "position": [
            1200,
            -640
          ],
          "parameters": {
            "jsCode": "/**\n * This code node contains a modified version of play-dl,\n * which is licensed under the GNU General Public License Version 3 (GPLv3).\n *\n * Original Library Name: play-dl\n * Original Library Source: https://github.com/play-dl/play-dl/tree/main\n * Original Library License: GNU General Public License Version 3 (GPLv3)\n * (See: https://www.gnu.org/licenses/gpl-3.0.en.html)\n *\n * Modifications were made to the original library for use within this N8N workflow.\n * These modifications are also licensed under the GNU General Public License Version 3 (GPLv3).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\n\n/**\n * Basic function to get specific data (title, description, duration)\n * from pre-fetched HTML body data of a YouTube video page.\n * Assumes the HTML body is passed as the first argument.\n *\n * @param {string} body HTML body data of the YouTube video page.\n * @param {string} video_id YouTube video ID.\n * @param {string} url YouTube video URL.\n * @returns {Promise<{title: string, description: string, duration: number}>} Video Basic Info.\n * @throws {Error} If video ID cannot be extracted, captcha is detected,\n * or necessary data cannot be parsed.\n */\nasync function video_basic_info(body, video_id, url) {\n  // --- Input Validation ---\n  if (typeof body !== 'string') {\n    throw new Error('body parameter must be a string of HTML');\n  }\n  if (typeof video_id !== 'string' || !video_id.trim()) {\n    throw new Error('video_id parameter must be a non-empty string');\n  }\n  if (typeof url !== 'string' || !url.trim()) {\n    throw new Error('url parameter must be a non-empty URL string');\n  }\n\n  // --- Captcha Check ---\n  // Added check for consent page as well\n  if (body.includes('Our systems have detected unusual traffic') || body.includes('consent.google.com')) {\n    throw new Error('Captcha or Consent page encountered: YouTube likely requires interaction or detected bot-like activity.');\n  }\n\n  // --- Extract Player Data ---\n  let player_data;\n  try {\n    // More robust regex to find ytInitialPlayerResponse, stopping at the next semicolon\n    const player_data_match = body.match(/var ytInitialPlayerResponse\\s*=\\s*({.+?});\\s*(?:var |<\\/script)/);\n    if (!player_data_match || !player_data_match[1]) {\n      // Fallback attempt with simpler split (less reliable)\n      const split_data = body.split('var ytInitialPlayerResponse = ');\n      player_data = split_data?.[1]?.split(';</script>')?.[0];\n    } else {\n      player_data = player_data_match[1];\n    }\n\n    if (!player_data) {\n      // Check for common failure indicators in the HTML if data isn't found\n      if (body.includes('<title>YouTube</title>') && !body.includes('videoDetails')) {\n        throw new Error('Could not find ytInitialPlayerResponse data. The page might be a generic YouTube page, not a video page, or the structure changed.');\n      }\n      throw new Error('Could not find ytInitialPlayerResponse data.');\n    }\n  } catch (error) {\n    console.log(\"Error during player_data extraction:\", error);\n    throw new Error(`Failed during player data extraction: ${error}`);\n  }\n\n\n  let player_response;\n  try {\n    player_response = JSON.parse(player_data);\n  } catch (e) {\n    console.log(\"Raw player_data that failed parsing:\", player_data.substring(0, 500) + '...'); // Log start of data\n    throw new Error(`Failed to parse ytInitialPlayerResponse JSON: ${e}`);\n  }\n\n  // --- Extract Required Video Details ---\n  // Use optional chaining for safety\n  const vid = player_response?.videoDetails;\n\n  // Add more robust checking, including playability status\n  if (!vid) {\n    const playabilityStatus = player_response?.playabilityStatus;\n    let reason = \"videoDetails object not found in the response.\";\n    if (playabilityStatus?.status && playabilityStatus.status !== 'OK') {\n      reason = ` Playability status: ${playabilityStatus.status}. Reason: ${playabilityStatus.reason ||\n        playabilityStatus.errorScreen?.playerErrorMessageRenderer?.reason?.simpleText ||\n        playabilityStatus.errorScreen?.playerKavRenderer?.reason?.simpleText ||\n        'No specific reason provided.'\n        }`;\n    } else if (playabilityStatus?.status === 'OK' && !vid) {\n      reason = \" Playability status is OK, but videoDetails is still missing. Response structure might have changed.\";\n    }\n    throw new Error(`Could not get video details. ${reason}`);\n  }\n\n  // --- Return Simplified Data ---\n  // Ensure values exist before accessing, provide defaults if necessary\n  return {\n    title: vid.title || 'N/A',\n    description: vid.shortDescription || '', // Default to empty string if missing\n    duration: Number(vid.lengthSeconds) || 0, // Default to 0 if missing/invalid\n  };\n}\n\n\nreturn video_basic_info($input.first().json.data, $('Update Context Intent').first().json.output.id, $('Update Context Intent').first().json.output.url);"
          },
          "retryOnFail": true,
          "typeVersion": 2,
          "alwaysOutputData": true,
          "waitBetweenTries": 500
        },
        {
          "id": "6cea694e-0147-4cd0-a601-9b232813a1d3",
          "name": "Split Out2",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            1440,
            -860
          ],
          "parameters": {
            "include": "selectedOtherFields",
            "options": {},
            "fieldToSplitOut": "transcript",
            "fieldsToInclude": "youtubeId"
          },
          "typeVersion": 1
        },
        {
          "id": "c479fb51-e17d-477a-b40b-65458cc3e679",
          "name": "Concatenate1",
          "type": "n8n-nodes-base.summarize",
          "position": [
            1660,
            -860
          ],
          "parameters": {
            "options": {},
            "fieldsToSplitBy": "youtubeId",
            "fieldsToSummarize": {
              "values": [
                {
                  "field": "transcript.text",
                  "separateBy": " ",
                  "aggregation": "concatenate"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "ccca5021-248b-4a98-af6b-ee92b2d63dca",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            800,
            -1000
          ],
          "parameters": {
            "color": 7,
            "width": 1140,
            "height": 560,
            "content": "## Fetch and prepare single video transcripts data for processing\n- Retrieves and pre-processes single video transcripts.\n- Prepares data for analysis and summarization.\n"
          },
          "typeVersion": 1
        },
        {
          "id": "1e9ecc6e-2b4d-4ae8-8949-d4b92eaf9287",
          "name": "Get Videos",
          "type": "n8n-nodes-base.code",
          "position": [
            1520,
            480
          ],
          "parameters": {
            "jsCode": "return $('Edit Fields').all();"
          },
          "typeVersion": 2
        },
        {
          "id": "f8ea7a40-b1f9-4dc2-959d-0e765331b191",
          "name": "Get Playlist Videos Data",
          "type": "n8n-nodes-base.code",
          "position": [
            860,
            -200
          ],
          "parameters": {
            "jsCode": "/**\n * This code node contains a modified version of play-dl,\n * which is licensed under the GNU General Public License Version 3 (GPLv3).\n *\n * Original Library Name: play-dl\n * Original Library Source: https://github.com/play-dl/play-dl/tree/main\n * Original Library License: GNU General Public License Version 3 (GPLv3)\n * (See: https://www.gnu.org/licenses/gpl-3.0.en.html)\n *\n * Modifications were made to the original library for use within this N8N workflow.\n * These modifications are also licensed under the GNU General Public License Version 3 (GPLv3).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\n\n/**\n * Gets YouTube playlist info from a playlist url.\n *\n * Example\n * ```js\n * const playlist = await play.playlist_info('youtube playlist url')\n *\n * const playlist = await play.playlist_info('youtube playlist url', { incomplete : true })\n * ```\n * @param body HTML body of the playlist page\n * @param url Playlist URL\n * @returns YouTube Playlist\n */\nfunction playlist_info(body, url) {\n  let url_ = url.trim();\n  if (body.indexOf('Our systems have detected unusual traffic from your computer network.') !== -1)\n    throw new Error('Captcha page: YouTube has detected that you are a bot!');\n\n  const response = JSON.parse(\n    body\n      .split('var ytInitialData = ')[1]\n      .split(';</script>')[0]\n      .split(/;\\s*(var|const|let)\\s/)[0]\n  );\n\n  if (response.alerts) {\n    if (response.alerts[0].alertWithButtonRenderer?.type === 'INFO') {\n      throw new Error(\n        `While parsing playlist url\\n${response.alerts[0].alertWithButtonRenderer.text.simpleText}`\n      );\n    } else if (response.alerts[0].alertRenderer?.type === 'ERROR')\n      throw new Error(`While parsing playlist url\\n${response.alerts[0].alertRenderer.text.runs[0].text}`);\n    else throw new Error('While parsing playlist url\\nUnknown Playlist Error');\n  }\n  if (response.currentVideoEndpoint) {\n    return getWatchPlaylist(response, body, url_);\n  } else return getNormalPlaylist(response, body);\n}\n\n/**\n * Function to parse Playlist from YouTube search\n * @param data html data of that request\n * @param limit No. of videos to parse\n * @returns Array of YouTube Video objects.\n */\nfunction getPlaylistVideos(data, limit = Infinity) {\n  const videos = [];\n\n  for (let i = 0; i < data.length; i++) {\n    if (limit === videos.length) break;\n    const info = data[i].playlistVideoRenderer;\n    if (!info || !info.shortBylineText) continue;\n\n    videos.push({\n      id: info.videoId,\n      duration: parseInt(info.lengthSeconds) || 0,\n      duration_raw: info.lengthText?.simpleText ?? '0:00',\n      thumbnails: info.thumbnail.thumbnails,\n      title: info.title.runs[0].text,\n      upcoming: info.upcomingEventData?.startTime\n        ? new Date(parseInt(info.upcomingEventData.startTime) * 1000)\n        : undefined,\n      channel: {\n        id: info.shortBylineText.runs[0].navigationEndpoint.browseEndpoint.browseId || undefined,\n        name: info.shortBylineText.runs[0].text || undefined,\n        url: `https://www.youtube.com${info.shortBylineText.runs[0].navigationEndpoint.browseEndpoint.canonicalBaseUrl ||\n          info.shortBylineText.runs[0].navigationEndpoint.commandMetadata.webCommandMetadata.url\n          }`,\n        icon: undefined\n      }\n    });\n  }\n  return videos;\n}\n\n\nfunction getWatchPlaylist(response, body, url) {\n  const playlist_details = response.contents.twoColumnWatchNextResults.playlist?.playlist;\n  if (!playlist_details)\n    throw new Error(\"Watch playlist unavailable due to YouTube layout changes.\")\n\n  const videos = getWatchPlaylistVideos(playlist_details.contents);\n  const videoCount = playlist_details.totalVideos;\n  const channel = playlist_details.shortBylineText?.runs?.[0];\n  const badge = playlist_details.badges?.[0]?.metadataBadgeRenderer?.style.toLowerCase();\n\n  return {\n    id: playlist_details.playlistId || '',\n    title: playlist_details.title || '',\n    videoCount: parseInt(videoCount) || 0,\n    videos: videos,\n    url: url,\n    channel: {\n      id: channel?.navigationEndpoint?.browseEndpoint?.browseId || null,\n      name: channel?.text || null,\n      url: `https://www.youtube.com${channel?.navigationEndpoint?.browseEndpoint?.canonicalBaseUrl ||\n        channel?.navigationEndpoint?.commandMetadata?.webCommandMetadata?.url\n        }`,\n      verified: Boolean(badge?.includes('verified')),\n      artist: Boolean(badge?.includes('artist'))\n    }\n  };\n}\n\nfunction getNormalPlaylist(response, body) {\n  const json_data =\n    response.contents.twoColumnBrowseResultsRenderer.tabs[0].tabRenderer.content.sectionListRenderer.contents[0]\n      .itemSectionRenderer.contents[0].playlistVideoListRenderer.contents;\n  const playlist_details = response.sidebar.playlistSidebarRenderer.items;\n  const videos = getPlaylistVideos(json_data, 100);\n\n  const data = playlist_details[0].playlistSidebarPrimaryInfoRenderer;\n  if (!data.title.runs || !data.title.runs.length) throw new Error('Failed to Parse Playlist info.');\n\n  const author = playlist_details[1]?.playlistSidebarSecondaryInfoRenderer.videoOwner;\n  const views = data.stats.length === 3 ? data.stats[1].simpleText.replace(/\\D/g, '') : 0;\n  const lastUpdate =\n    data.stats\n      .find((x) => 'runs' in x && x['runs'].find((y) => y.text.toLowerCase().includes('last update')))\n      ?.runs.pop()?.text ?? null;\n  const videosCount = data.stats[0].runs[0].text.replace(/\\D/g, '') || 0;\n\n  return {\n    id: data.title.runs[0].navigationEndpoint.watchEndpoint.playlistId,\n    title: data.title.runs[0].text,\n    videoCount: parseInt(videosCount) || 0,\n    lastUpdate: lastUpdate,\n    views: parseInt(views) || 0,\n    videos: videos,\n    url: `https://www.youtube.com/playlist?list=${data.title.runs[0].navigationEndpoint.watchEndpoint.playlistId}`,\n    link: `https://www.youtube.com${data.title.runs[0].navigationEndpoint.commandMetadata.webCommandMetadata.url}`,\n    channel: author\n      ? {\n        name: author.videoOwnerRenderer.title.runs[0].text,\n        id: author.videoOwnerRenderer.title.runs[0].navigationEndpoint.browseEndpoint.browseId,\n        url: `https://www.youtube.com${author.videoOwnerRenderer.navigationEndpoint.commandMetadata.webCommandMetadata.url ||\n          author.videoOwnerRenderer.navigationEndpoint.browseEndpoint.canonicalBaseUrl\n          }`,\n        icons: author.videoOwnerRenderer.thumbnail.thumbnails ?? []\n      }\n      : {},\n    thumbnail: data.thumbnailRenderer.playlistVideoThumbnailRenderer?.thumbnail.thumbnails.length\n      ? data.thumbnailRenderer.playlistVideoThumbnailRenderer.thumbnail.thumbnails[\n      data.thumbnailRenderer.playlistVideoThumbnailRenderer.thumbnail.thumbnails.length - 1\n      ]\n      : null\n  };\n}\n\nfunction parseDuration(text) {\n  if (!text) return 0;\n  const split = text.split(':');\n\n  switch (split.length) {\n    case 2:\n      return parseInt(split[0]) * 60 + parseInt(split[1]);\n\n    case 3:\n      return parseInt(split[0]) * 60 * 60 + parseInt(split[1]) * 60 + parseInt(split[2]);\n\n    default:\n      return 0;\n  }\n}\n\nfunction getWatchPlaylistVideos(data, limit = Infinity) {\n  const videos = [];\n\n  for (let i = 0; i < data.length; i++) {\n    if (limit === videos.length) break;\n    const info = data[i].playlistPanelVideoRenderer;\n    if (!info || !info.shortBylineText) continue;\n    const channel_info = info.shortBylineText.runs[0];\n\n    videos.push({\n      id: info.videoId,\n      duration: parseDuration(info.lengthText?.simpleText) || 0,\n      duration_raw: info.lengthText?.simpleText ?? '0:00',\n      thumbnails: info.thumbnail.thumbnails,\n      title: info.title.simpleText,\n      upcoming:\n        info.thumbnailOverlays[0].thumbnailOverlayTimeStatusRenderer?.style === 'UPCOMING' || undefined,\n      channel: {\n        id: channel_info.navigationEndpoint.browseEndpoint.browseId || undefined,\n        name: channel_info.text || undefined,\n        url: `https://www.youtube.com${channel_info.navigationEndpoint.browseEndpoint.canonicalBaseUrl ||\n          channel_info.navigationEndpoint.commandMetadata.webCommandMetadata.url\n          }`,\n        icon: undefined\n      }\n    });\n  }\n\n  return videos;\n}\n\n\nreturn playlist_info($input.first().json.data, $('Update Context Intent').first().json.output.url);"
          },
          "retryOnFail": true,
          "typeVersion": 2,
          "alwaysOutputData": true,
          "waitBetweenTries": 500
        },
        {
          "id": "71b60b8e-06df-45a8-85a3-7b9e938fb6f0",
          "name": "Embeddings Google Gemini2",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            2640,
            1060
          ],
          "parameters": {
            "modelName": "models/text-embedding-004"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "58feccf5-1b97-4c88-b274-444e177f4515",
          "name": "Qdrant Vector Store3",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
          "position": [
            -100,
            160
          ],
          "parameters": {
            "options": {},
            "qdrantCollection": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Default Intent').first().json.output?.id }}"
            }
          },
          "credentials": {
            "qdrantApi": {
              "id": "mb8rw8tmUeP6aPJm",
              "name": "QdrantApi account"
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "6cff2236-3e78-4e8c-bb3d-5140f106c530",
          "name": "Answer questions with a vector store",
          "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
          "position": [
            180,
            -40
          ],
          "parameters": {
            "name": "chat_playlist_data",
            "topK": 10,
            "description": "=Retrive data about the Playlist or Video from the vector store.\nplaylistId or youtubeId: {{ $('Default Intent').item.json.output?.id }}\n\n**User Message:**\n{{ $('Chat').item.json.chatInput }}"
          },
          "typeVersion": 1
        },
        {
          "id": "312081d9-9279-4700-a432-e9f878d5361e",
          "name": "Qdrant Vector Store4",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
          "position": [
            2700,
            900
          ],
          "parameters": {
            "options": {},
            "qdrantCollection": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Default Intent').first().json.output?.id }}"
            }
          },
          "credentials": {
            "qdrantApi": {
              "id": "mb8rw8tmUeP6aPJm",
              "name": "QdrantApi account"
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "f5cba8b5-226d-4b0a-8cb6-a51728ac8247",
          "name": "Answer questions with a vector store1",
          "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
          "position": [
            2860,
            700
          ],
          "parameters": {
            "name": "chat_playlist_data",
            "topK": 6,
            "description": "=User Message:\n{{ $('Chat').item.json.chatInput }}"
          },
          "typeVersion": 1
        },
        {
          "id": "22f18788-b47f-4187-9146-28e6de5ec7a6",
          "name": "Google Gemini Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            3000,
            900
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-flash"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "2aa52dd2-169b-43dc-8202-1d60f5fd55c0",
          "name": "Google Gemini Chat Model3",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            220,
            160
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-flash"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "d96d3670-ab95-4afc-a275-33f03383a204",
          "name": "Qdrant Vector Store2",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
          "position": [
            -820,
            -880
          ],
          "parameters": {
            "mode": "load",
            "prompt": "Are there any documents in the store?",
            "options": {},
            "qdrantCollection": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Process Status').item.json.output?.id }}"
            }
          },
          "credentials": {
            "qdrantApi": {
              "id": "mb8rw8tmUeP6aPJm",
              "name": "QdrantApi account"
            }
          },
          "typeVersion": 1,
          "alwaysOutputData": true
        },
        {
          "id": "7c289d61-09b2-461e-b771-8781f60828c7",
          "name": "Embeddings Google Gemini4",
          "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
          "position": [
            -840,
            -640
          ],
          "parameters": {
            "modelName": "models/text-embedding-004"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "2zwuT5znDglBrUCO",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "59be01b0-3ff9-4cc2-b569-c0cb4dcae3ec",
          "name": "If",
          "type": "n8n-nodes-base.if",
          "position": [
            -260,
            -880
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "795da689-23c3-49d5-a312-ca18e2c9d5e3",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  },
                  "leftValue": "={{ $json.count_document }}",
                  "rightValue": 0
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "ab9bc74d-9659-44fe-aa08-4878609ef808",
          "name": "Count Content",
          "type": "n8n-nodes-base.summarize",
          "position": [
            -460,
            -880
          ],
          "parameters": {
            "options": {},
            "fieldsToSummarize": {
              "values": [
                {
                  "field": "document"
                }
              ]
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "5c953435-1052-4e1c-9d2f-2439ba944b28",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            20,
            -1020
          ],
          "parameters": {
            "color": 7,
            "width": 500,
            "height": 580,
            "content": "## Process or ask for more details\n- Decides next steps based on workflow conditions e.g. missing number of playlist videos to process.\n- Route to Playlist or Video processing."
          },
          "typeVersion": 1
        },
        {
          "id": "78760cd2-74db-482d-b660-bd53a3184b95",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -920,
            -1020
          ],
          "parameters": {
            "color": 7,
            "width": 880,
            "height": 580,
            "content": "## Already Processed? \n- Check if we already have embeddings in the vector store."
          },
          "typeVersion": 1
        },
        {
          "id": "a8dc1b1e-2ba9-4b85-9f2f-c3d07ec67c32",
          "name": "Update Context Intent1",
          "type": "n8n-nodes-base.redis",
          "position": [
            -460,
            -640
          ],
          "parameters": {
            "key": "=context_intent_{{ $('Chat').item.json.sessionId }}",
            "value": "=intent {{ $('Process Status').item.json.output?.intent || null }} url {{ $('Process Status').item.json.output?.url || \"\" }} id {{ $('Process Status').item.json.output?.id || \"\" }} limit {{ $('Process Status').item.json.output?.limit || 0 }} status DONE",
            "keyType": "hash",
            "operation": "set",
            "valueIsJSON": false
          },
          "credentials": {
            "redis": {
              "id": "mA0f9F1ROUThyrRW",
              "name": "Redis account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "36ea2e25-8d29-4ec6-bc6a-15c98153c390",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2540,
            20
          ],
          "parameters": {
            "width": 1080,
            "height": 1320,
            "content": "# AI-Powered YouTube Playlist & Video Summarization and Analysis Chat Bot\n\nThis N8N workflow transforms YouTube playlists or individual videos into interactive knowledge bases. Instead of watching videos, users can chat with the workflow to get summaries and answers based on the video transcripts.\n\n## How it Works:\n\n1.  **Chat Interaction & Intent Detection:**\n    * The workflow starts via a chat interface (`Chat Trigger`), prompting the user for a YouTube playlist or video URL.\n    * It retrieves any previous conversation context stored in Redis.\n    * A Google Gemini AI agent (`Message Intent`) analyzes the user's input to determine if it contains a valid YouTube playlist URL, a video URL, or neither (`NONE`). It extracts the URL, the corresponding ID (Playlist ID or Video ID), and checks if the user specified a limit for the number of playlist videos to process.\n    * The workflow maintains context (like the current URL, ID, and processing status) using Redis (`Update Context Intent`, `Get Previous Context Intent`).\n\n2.  **Routing & Pre-processing Checks:**\n    * Based on the detected intent and whether the content needs processing, a `Switch` node (`Route Message Intent`) directs the workflow.\n    * If a valid URL is provided and hasn't been processed yet (`status != 'DONE'`), it proceeds to the processing pipeline.\n    * It checks if embeddings for the given ID already exist in the Qdrant vector store (`Qdrant Vector Store2`, `If`). If they do, it skips processing and moves to the query handling stage.\n    * If the input is a playlist URL but no video limit is specified (`limit=0`), it prompts the user to provide one (`Numb of Videos` agent).\n\n3.  **Video/Playlist Processing Pipeline:**\n    * **Data Fetching:**\n        * For **Playlists**: Fetches the playlist page (`Playlist HTTP Request`), extracts video details using custom code (`Get Playlist Videos Data`), limits the videos if specified (`Limit`), and then fetches the transcript for each video (`YouTube Transcript`).\n        * For **Videos**: Fetches the video page (`Video HTTP Request`), extracts title/description (`Get Title and Desc`), and fetches the transcript (`YouTube Transcript1`).\n    * **Transcript Processing & Summarization:**\n        * Transcripts are retrieved using the `youtubeTranscripter` node.\n        * Transcripts are concatenated (`Concatenate`, `Concatenate1`).\n        * Data (like video ID, title, transcript text) is merged and structured (`Merge`, `Edit Fields`).\n        * Each video's transcript is summarized by a Google Gemini AI chain (`Summarize & Analyze Transcript`).\n    * **Embedding & Storage:**\n        * Any existing data for the playlist/video ID is cleared from the Qdrant vector store (`Delete Collection`).\n        * The processed transcripts (potentially alongside summaries/metadata) are loaded (`Default Data Loader`).\n        * Text is split into manageable chunks (`Recursive Character Text Splitter`).\n        * Google Gemini generates vector embeddings for the text chunks (`Embeddings Google Gemini`).\n        * These embeddings are stored in a Qdrant collection, indexed by the playlist or video ID (`Qdrant Vector Store`).\n    * **Status Update & Final Summary:**\n        * The context status in Redis is updated to 'DONE' (`Update Context Process Done1`).\n        * All individual video summaries are combined (`Full Summary`).\n        * An AI agent (`AI Agent`) may generate a final, comprehensive summary or response based on the processed data, using a tool to query the vector store (`Answer questions with a vector store1`).\n\n4.  **Query Handling (Chatting with Content):**\n    * If the user's input is identified as a query rather than a new URL to process (or if processing for a URL is complete), the workflow activates the main query handler.\n    * A conversational AI agent (`Handle Queries`), powered by Google Gemini and equipped with chat memory (`Chat Buffer Memory`), answers user questions.\n    * This agent uses a specialized tool (`Answer questions with a vector store`) that retrieves relevant information directly from the Qdrant vector store based on the user's query and the stored embeddings."
          },
          "typeVersion": 1
        }
      ],
      "active": true,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "7c1d0978-ccea-4618-bcbf-560b34f77023",
      "connections": {
        "If": {
          "main": [
            [
              {
                "node": "Update Context Intent1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Playlist Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Chat": {
          "main": [
            [
              {
                "node": "Get Previous Context Intent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit": {
          "main": [
            [
              {
                "node": "YouTube Transcript",
                "type": "main",
                "index": 0
              },
              {
                "node": "Video Titles",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Summarize & Analyze Transcript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Concatenate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Videos": {
          "main": [
            [
              {
                "node": "Qdrant Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out1": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out2": {
          "main": [
            [
              {
                "node": "Concatenate1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Concatenate": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Delete Collection",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Concatenate1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Full Summary": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Video Titles": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Count Content": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "Message Intent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Default Intent": {
          "main": [
            [
              {
                "node": "Route Message Intent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Message Intent": {
          "main": [
            [
              {
                "node": "Default Intent",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "Playlist Limit": {
          "main": [
            [
              {
                "node": "Numb of Videos",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Playlist or Video",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Process Status": {
          "main": [
            [
              {
                "node": "Update Context Intent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory3": {
          "ai_memory": [
            [
              {
                "node": "Numb of Videos",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Delete Collection": {
          "main": [
            [
              {
                "node": "Get Videos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Playlist or Video": {
          "main": [
            [
              {
                "node": "Video HTTP Request",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Playlist HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Chat Buffer Memory": {
          "ai_memory": [
            [
              {
                "node": "Handle Queries",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Get Title and Desc": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Video HTTP Request": {
          "main": [
            [
              {
                "node": "YouTube Transcript1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get Title and Desc",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "YouTube Transcript": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Chat Buffer Memory1": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Qdrant Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Qdrant Vector Store": {
          "main": [
            [
              {
                "node": "Update Context Process Done1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "YouTube Transcript1": {
          "main": [
            [
              {
                "node": "Split Out2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Qdrant Vector Store2": {
          "main": [
            [
              {
                "node": "Count Content",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Qdrant Vector Store3": {
          "ai_tool": [
            []
          ],
          "ai_vectorStore": [
            [
              {
                "node": "Answer questions with a vector store",
                "type": "ai_vectorStore",
                "index": 0
              }
            ]
          ]
        },
        "Qdrant Vector Store4": {
          "ai_vectorStore": [
            [
              {
                "node": "Answer questions with a vector store1",
                "type": "ai_vectorStore",
                "index": 0
              }
            ]
          ]
        },
        "Route Message Intent": {
          "main": [
            [
              {
                "node": "Process Status",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Handle Queries",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Handle Queries",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Playlist HTTP Request": {
          "main": [
            [
              {
                "node": "Get Playlist Videos Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Context Intent": {
          "main": [
            [
              {
                "node": "Qdrant Vector Store2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Fields for Summary": {
          "main": [
            [
              {
                "node": "Full Summary",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Context Intent1": {
          "main": [
            [
              {
                "node": "Handle Queries",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini": {
          "ai_embedding": [
            [
              {
                "node": "Qdrant Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Get Playlist Videos Data": {
          "main": [
            [
              {
                "node": "Split Out1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Answer questions with a vector store1",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini1": {
          "ai_embedding": [
            [
              {
                "node": "Qdrant Vector Store3",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini2": {
          "ai_embedding": [
            [
              {
                "node": "Qdrant Vector Store4",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings Google Gemini4": {
          "ai_embedding": [
            [
              {
                "node": "Qdrant Vector Store2",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Handle Queries",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "Summarize & Analyze Transcript",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model3": {
          "ai_languageModel": [
            [
              {
                "node": "Answer questions with a vector store",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model4": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model6": {
          "ai_languageModel": [
            [
              {
                "node": "Message Intent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model8": {
          "ai_languageModel": [
            [
              {
                "node": "Numb of Videos",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser1": {
          "ai_outputParser": [
            [
              {
                "node": "Message Intent",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Get Previous Context Intent": {
          "main": [
            [
              {
                "node": "Message Intent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Context Process Done1": {
          "main": [
            [
              {
                "node": "Get Fields for Summary",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Summarize & Analyze Transcript": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Recursive Character Text Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Answer questions with a vector store": {
          "ai_tool": [
            [
              {
                "node": "Handle Queries",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Answer questions with a vector store1": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "notion-clockify-sync",
    "title": "Notion â†’ Clockify Sync",
    "description": "Compares datasets, syncs tasks, and keeps Notion databases aligned with Clockify time tracking via webhooks.",
    "problem": "Ops teams struggle to reconcile project plans with actual time entries across tools.",
    "tags": [
      "notion",
      "clockify",
      "time-tracking",
      "webhook"
    ],
    "metadata": {
      "industries": [
        "operations"
      ],
      "domains": [
        "time-tracking"
      ],
      "channels": [
        "notion",
        "clockify"
      ],
      "trigger": "webhook",
      "complexity": "medium",
      "integrations": [
        "Notion",
        "Clockify"
      ]
    },
    "workflow": {
      "id": "HpjjgJm3Ulnl1cJQ",
      "meta": {
        "instanceId": "fb8bc2e315f7f03c97140b30aa454a27bc7883a19000fa1da6e6b571bf56ad6d",
        "templateCredsSetupCompleted": true
      },
      "name": "Notion to Clockify Sync Template",
      "tags": [
        {
          "id": "RKga6I6NviNI12bx",
          "name": "template",
          "createdAt": "2024-09-19T19:09:21.997Z",
          "updatedAt": "2024-09-19T19:09:21.997Z"
        }
      ],
      "nodes": [
        {
          "id": "e0e40960-a45f-44a2-91b8-d0f45c254679",
          "name": "Webhook",
          "type": "n8n-nodes-base.webhook",
          "position": [
            -400,
            -100
          ],
          "webhookId": "43028c1f-7331-4fbe-bf56-d6f47c92d9be",
          "parameters": {
            "path": "43028c1f-7331-4fbe-bf56-d6f47c92d9be",
            "options": {},
            "httpMethod": "POST"
          },
          "typeVersion": 2
        },
        {
          "id": "cda9abae-ede3-4ce1-8f2b-b2913eba887a",
          "name": "Globals",
          "type": "n8n-nodes-base.set",
          "position": [
            40,
            -200
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0955695f-888f-46bc-807d-979a0798114f",
                  "name": "workspace_id",
                  "type": "string",
                  "value": "={{ $json.id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "a3d588b2-f169-479e-801b-2534bffc47ed",
          "name": "Schedule Trigger",
          "type": "n8n-nodes-base.scheduleTrigger",
          "position": [
            -400,
            -300
          ],
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 4
                }
              ]
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "73bccaca-2c54-4c40-9181-831c3a713f8a",
          "name": "Get first workspace ID",
          "type": "n8n-nodes-base.clockify",
          "position": [
            -180,
            -200
          ],
          "parameters": {
            "limit": 1,
            "resource": "workspace"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "d6e6fa71-fd9a-40ed-a915-02fae1fa3d78",
          "name": "Compare Datasets",
          "type": "n8n-nodes-base.compareDatasets",
          "position": [
            920,
            -220
          ],
          "parameters": {
            "options": {},
            "resolve": "mix",
            "mergeByFields": {
              "values": [
                {
                  "field1": "clockify_client_id",
                  "field2": "clockify_client_id"
                }
              ]
            }
          },
          "typeVersion": 2.3
        },
        {
          "id": "00a30e3d-e966-4512-829f-5c7729027c04",
          "name": "Stop and Error",
          "type": "n8n-nodes-base.stopAndError",
          "position": [
            2020,
            -460
          ],
          "parameters": {
            "errorMessage": "Could not update client in Notion (deleted in Clockify again)"
          },
          "typeVersion": 1
        },
        {
          "id": "4dfe33a9-670c-400e-8ef9-090ca74b21f7",
          "name": "Structure output",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1140,
            -280
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "029e1297-3133-433f-a779-c3c1a6b5762c",
          "name": "Map values",
          "type": "n8n-nodes-base.set",
          "position": [
            700,
            -300
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "8e12edff-162e-49eb-84de-2b060c1050f3",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                },
                {
                  "id": "df7765a2-9452-4e67-a261-23ef5d2ad1f8",
                  "name": "archived",
                  "type": "boolean",
                  "value": "={{ $json.property_archive }}"
                },
                {
                  "id": "eb2692cb-e40f-45c8-a3e3-ca676a3b6df3",
                  "name": "clockify_client_id",
                  "type": "string",
                  "value": "={{ $json.property_clockify_client_id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "4c7d62d1-9987-4f47-983a-e5d7c11d9f8f",
          "name": "Map values1",
          "type": "n8n-nodes-base.set",
          "position": [
            700,
            -100
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "043540c8-8784-4445-93c5-b945de834696",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                },
                {
                  "id": "1cb47384-f444-484d-a1a1-41b4d7fe1d9a",
                  "name": "archived",
                  "type": "boolean",
                  "value": "={{ $json.archived }}"
                },
                {
                  "id": "04b62bab-0db7-4f03-8c2e-2c45b6d5d3b8",
                  "name": "clockify_client_id",
                  "type": "string",
                  "value": "={{ $json.id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "c608bfe4-07f4-45d8-a37b-3153a2e659a5",
          "name": "No Operation",
          "type": "n8n-nodes-base.noOp",
          "position": [
            260,
            -200
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "92b717ba-9620-4fdf-abbc-1b2c5f9c3bf9",
          "name": "Get active Clients from Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            480,
            -300
          ],
          "parameters": {
            "filters": {
              "conditions": [
                {
                  "key": "Archive|checkbox",
                  "condition": "equals"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "matchType": "allFilters",
            "operation": "getAll",
            "returnAll": true,
            "databaseId": {
              "__rl": true,
              "mode": "list",
              "value": "1a878e40-f803-80e4-bc79-e24747562817",
              "cachedResultUrl": "https://www.notion.so/1a878e40f80380e4bc79e24747562817",
              "cachedResultName": "Clients"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "af035e80-835d-4099-85dd-f7a24d6b9e47",
          "name": "Get active Clients from Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            480,
            -100
          ],
          "parameters": {
            "resource": "client",
            "operation": "getAll",
            "returnAll": true,
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}",
            "additionalFields": {
              "archived": false
            }
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "872e869a-0e44-409d-8c3f-e3b24f28fbd2",
          "name": "If unmapped in Notion",
          "type": "n8n-nodes-base.if",
          "position": [
            1140,
            -480
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "26af0d64-ef8d-492e-87ca-6a893e8f85a1",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.clockify_client_id }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "ca45be8c-7dc7-4c2e-a7a0-8f8f0621e488",
          "name": "Set new values",
          "type": "n8n-nodes-base.set",
          "position": [
            1360,
            -20
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "bfc2ff08-56a1-49c1-b1db-475063f88032",
                  "name": "archived",
                  "type": "boolean",
                  "value": true
                },
                {
                  "id": "2e8b2166-149b-4eed-8bf2-dd08e9b98210",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "b44b7ccd-316a-487c-841e-7a27a117285e",
          "name": "Update Client in Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            1580,
            -180
          ],
          "parameters": {
            "name": "={{ $json.name }}",
            "clientId": "={{ $('Compare Datasets').item.json.clockify_client_id }}",
            "resource": "client",
            "operation": "update",
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}",
            "updateFields": {
              "archived": "={{ $json.archived }}"
            }
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "6efa63a5-b242-4e25-87a9-9a6f90a923a7",
          "name": "Get archived Client from Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            1140,
            -20
          ],
          "parameters": {
            "limit": 1,
            "filters": {
              "conditions": [
                {
                  "key": "Clockify Client ID|rich_text",
                  "condition": "equals",
                  "richTextValue": "={{ $json.clockify_client_id }}"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "mode": "list",
              "value": "1a878e40-f803-80e4-bc79-e24747562817",
              "cachedResultUrl": "https://www.notion.so/1a878e40f80380e4bc79e24747562817",
              "cachedResultName": "Clients"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "alwaysOutputData": false,
          "waitBetweenTries": 5000
        },
        {
          "id": "93fd7fa7-07fd-4ba4-a9c4-8043897e654e",
          "name": "Create Client in Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            1360,
            -580
          ],
          "parameters": {
            "name": "={{ $json.name }}",
            "resource": "client",
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "ef51cbbf-2ea6-429b-a654-1510d28c4df3",
          "name": "Store Clockify ID in Notion",
          "type": "n8n-nodes-base.notion",
          "onError": "continueErrorOutput",
          "position": [
            1580,
            -580
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Get active Clients from Notion').item.json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Clockify Client ID|rich_text",
                  "textContent": "={{ $json.id}}"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "aff72e76-e59d-4402-a6e9-b21c07f1d3fc",
          "name": "Remove Client from Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            1800,
            -460
          ],
          "parameters": {
            "clientId": "={{ $('Create Client in Clockify').item.json.id }}",
            "resource": "client",
            "operation": "delete",
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "6d43bed2-af7c-450d-b4fd-42f84a9081a2",
          "name": "Merge",
          "type": "n8n-nodes-base.merge",
          "position": [
            2240,
            -280
          ],
          "parameters": {
            "numberInputs": 3
          },
          "typeVersion": 3
        },
        {
          "id": "a1046097-90ff-4447-a0d0-adb16ccc3c31",
          "name": "No Operation, do nothing",
          "type": "n8n-nodes-base.noOp",
          "position": [
            2020,
            -680
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "3b9e2bb5-cc78-4495-880f-3702b9edfead",
          "name": "Get active Projects from Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            480,
            620
          ],
          "parameters": {
            "filters": {
              "conditions": [
                {
                  "key": "Status|status",
                  "condition": "does_not_equal",
                  "statusValue": "Done"
                },
                {
                  "key": "Status|status",
                  "condition": "does_not_equal",
                  "statusValue": "Obsolete"
                },
                {
                  "key": "Clients|relation",
                  "condition": "is_not_empty"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "matchType": "allFilters",
            "operation": "getAll",
            "returnAll": true,
            "databaseId": {
              "__rl": true,
              "mode": "list",
              "value": "1a878e40-f803-80bf-a72a-d7373be374b2",
              "cachedResultUrl": "https://www.notion.so/1a878e40f80380bfa72ad7373be374b2",
              "cachedResultName": "Buckets"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "17cdb708-b5cf-44d3-872e-fb3d2528dc85",
          "name": "Get active Projects from Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            480,
            820
          ],
          "parameters": {
            "operation": "getAll",
            "returnAll": true,
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}",
            "additionalFields": {
              "archived": false
            }
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "0624cebc-7310-4559-ac35-4447212fb4b0",
          "name": "Update Project in Clockify",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1580,
            740
          ],
          "parameters": {
            "url": "=https://api.clockify.me/api/v1/workspaces/{{ $('Globals').item.json.workspace_id }}/projects/{{ $('Compare Datasets1').item.json.clockify_project_id }}",
            "method": "PUT",
            "options": {},
            "jsonBody": "={\n  \"archived\": {{ $json.archived }},\n  \"clientId\": \"{{ $('Compare Datasets1').item.json.clockify_client_id }}\",\n  \"name\": \"{{ $json.name }}\"\n}",
            "sendBody": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "clockifyApi"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "5edb9a80-5d3a-4c2d-80a7-6d545f02b053",
          "name": "Get completed Project from Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            1140,
            900
          ],
          "parameters": {
            "filters": {
              "conditions": [
                {
                  "key": "Clockify Project ID|rich_text",
                  "condition": "equals",
                  "richTextValue": "={{ $json.clockify_project_id }}"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "matchType": "allFilters",
            "operation": "getAll",
            "returnAll": true,
            "databaseId": {
              "__rl": true,
              "mode": "list",
              "value": "1a878e40-f803-80bf-a72a-d7373be374b2",
              "cachedResultUrl": "https://www.notion.so/1a878e40f80380bfa72ad7373be374b2",
              "cachedResultName": "Buckets"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "079795a3-51bc-4077-8fe1-84ed16e88125",
          "name": "Create Project in Clockify",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1360,
            340
          ],
          "parameters": {
            "url": "=https://api.clockify.me/api/v1/workspaces/{{ $('Globals').item.json.workspace_id }}/projects",
            "method": "POST",
            "options": {},
            "jsonBody": "={\n  \"archived\": {{ $json.archived }},\n  \"clientId\": \"{{ $json.clockify_client_id }}\",\n  \"name\": \"{{ $('Get active Projects from Notion').item.json.name }}\"\n}",
            "sendBody": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "clockifyApi"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 4.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "53ad9719-ba0b-4858-846e-a338eae1d48e",
          "name": "Remove Project from Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            1800,
            440
          ],
          "parameters": {
            "clientId": "={{ $('Compare Datasets1').item.json.clockify_project_id }}",
            "resource": "client",
            "operation": "delete",
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "b6224074-8712-4134-bc94-7b5f127f0971",
          "name": "Structure output1",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1140,
            640
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "247b31ae-7bdf-4813-aa60-08ddade1dd70",
          "name": "No Operation1",
          "type": "n8n-nodes-base.noOp",
          "position": [
            260,
            720
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "d92f6ced-133c-4881-98f1-f2dfd9b2c5d4",
          "name": "Map values2",
          "type": "n8n-nodes-base.set",
          "position": [
            700,
            620
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "63fe0f05-c1b4-41b8-99e9-74f5ef2d51b6",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                },
                {
                  "id": "44339109-9634-451b-965c-b2767aa3c628",
                  "name": "archived",
                  "type": "boolean",
                  "value": "={{ ['Done', 'Obsolete'].includes($json.property_status) }}"
                },
                {
                  "id": "12f7a5b6-e98f-4fa7-ad67-208c54ab2924",
                  "name": "clockify_project_id",
                  "type": "string",
                  "value": "={{ $json.property_clockify_project_id }}"
                },
                {
                  "id": "bddd1a9b-df7c-4d2f-891e-501639c786cc",
                  "name": "clockify_client_id",
                  "type": "string",
                  "value": "={{ $json.property_clockify_client_id[0] || \"\" }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "7644f331-e5ae-47d1-ac6c-bf026fde2e9c",
          "name": "Map values3",
          "type": "n8n-nodes-base.set",
          "position": [
            700,
            820
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "b2bea7bb-8b70-4268-84dd-a0463f8a30c1",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                },
                {
                  "id": "bbe039ac-a0ac-4570-b4f6-e6728b1d68ff",
                  "name": "archived",
                  "type": "boolean",
                  "value": "={{ $json.archived }}"
                },
                {
                  "id": "2547d142-507f-4f8b-bc65-1556e217c801",
                  "name": "clockify_project_id",
                  "type": "string",
                  "value": "={{ $json.id }}"
                },
                {
                  "id": "7342b5ea-7da7-4158-bdca-ca40d1cdb042",
                  "name": "clockify_client_id",
                  "type": "string",
                  "value": "={{ $json.clientId }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "9e7d0b28-dc9c-476b-9da7-36ec2354c45d",
          "name": "Compare Datasets1",
          "type": "n8n-nodes-base.compareDatasets",
          "position": [
            920,
            700
          ],
          "parameters": {
            "options": {},
            "resolve": "mix",
            "mergeByFields": {
              "values": [
                {
                  "field1": "clockify_project_id",
                  "field2": "clockify_project_id"
                }
              ]
            }
          },
          "typeVersion": 2.3
        },
        {
          "id": "2b7ae0ca-0bac-4875-b5e4-e809938004fa",
          "name": "If unmapped in Notion1",
          "type": "n8n-nodes-base.if",
          "position": [
            1140,
            440
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "26af0d64-ef8d-492e-87ca-6a893e8f85a1",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.clockify_project_id }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "b118db13-1ee1-41ce-9232-dfd8eec40104",
          "name": "Set new values1",
          "type": "n8n-nodes-base.set",
          "position": [
            1360,
            900
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "bfc2ff08-56a1-49c1-b1db-475063f88032",
                  "name": "archived",
                  "type": "boolean",
                  "value": true
                },
                {
                  "id": "2e8b2166-149b-4eed-8bf2-dd08e9b98210",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "49a65fbe-ba66-4127-a5af-f5fdf2cf8b37",
          "name": "Store Clockify ID in Notion1",
          "type": "n8n-nodes-base.notion",
          "onError": "continueErrorOutput",
          "position": [
            1580,
            340
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Get active Projects from Notion').item.json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Clockify Project ID|rich_text",
                  "textContent": "={{ $json.id }}"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "d995e6e4-588e-4e26-9531-d40b5ba3ab86",
          "name": "Stop and Error1",
          "type": "n8n-nodes-base.stopAndError",
          "position": [
            2020,
            440
          ],
          "parameters": {
            "errorMessage": "Could not update bucket in Notion (deleted in Clockify again)"
          },
          "typeVersion": 1
        },
        {
          "id": "434a1c89-a388-4069-adf4-0f2da4e8ca3e",
          "name": "Merge1",
          "type": "n8n-nodes-base.merge",
          "position": [
            2240,
            640
          ],
          "parameters": {
            "numberInputs": 3
          },
          "typeVersion": 3
        },
        {
          "id": "19ecbb3b-8007-4a78-bba2-f31e3afca794",
          "name": "No Operation, do nothing2",
          "type": "n8n-nodes-base.noOp",
          "position": [
            2020,
            240
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "30719262-f037-4d00-a7a4-2a85180c2a8c",
          "name": "Get active Tasks from Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            700,
            1440
          ],
          "parameters": {
            "options": {},
            "resource": "databasePage",
            "operation": "getAll",
            "returnAll": true,
            "databaseId": {
              "__rl": true,
              "mode": "list",
              "value": "1a878e40-f803-80e6-8df1-cf50776752da",
              "cachedResultUrl": "https://www.notion.so/1a878e40f80380e68df1cf50776752da",
              "cachedResultName": "Tasks"
            },
            "filterJson": "={\n  \"and\": [\n    {\n      \"property\": \"Status\",\n      \"status\": {\n        \"does_not_equal\": \"Done\"\n      }\n    },\n    {\n      \"property\": \"Status\",\n      \"status\": {\n        \"does_not_equal\": \"Obsolete\"\n      }\n    },\n    {\n      \"property\": \"Clients\",\n      \"rollup\": {\n        \"any\": {\n          \"select\": {\n            \"is_not_empty\": true\n          }\n        }\n      }\n    }\n  ]\n}",
            "filterType": "json"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "2cfb387a-f6fa-4ace-afdf-687680b1659d",
          "name": "Get active Tasks from Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            700,
            1640
          ],
          "parameters": {
            "filters": {
              "is-active": true
            },
            "resource": "task",
            "operation": "getAll",
            "projectId": "={{ $json.id }}",
            "returnAll": true,
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "alwaysOutputData": false,
          "waitBetweenTries": 5000
        },
        {
          "id": "938801f2-d5c6-4e95-970d-29fa3ba6ba4b",
          "name": "Update Task in Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            1800,
            1560
          ],
          "parameters": {
            "taskId": "={{ $('Compare Datasets2').item.json.clockify_task_id }}",
            "resource": "task",
            "operation": "update",
            "projectId": "={{ $('Compare Datasets2').item.json.clockify_project_id }}",
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}",
            "updateFields": {
              "name": "={{ $json.name }}",
              "status": "={{ $json.archived ? 'DONE' : 'ACTIVE' }}"
            }
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "f77a17b6-da10-4fb9-9e7f-83866132ec0e",
          "name": "Get completed Task from Notion",
          "type": "n8n-nodes-base.notion",
          "position": [
            1360,
            1720
          ],
          "parameters": {
            "filters": {
              "conditions": [
                {
                  "key": "Clockify Task ID|rich_text",
                  "condition": "equals",
                  "richTextValue": "={{ $json.clockify_task_id }}"
                }
              ]
            },
            "options": {},
            "resource": "databasePage",
            "matchType": "allFilters",
            "operation": "getAll",
            "returnAll": true,
            "databaseId": {
              "__rl": true,
              "mode": "list",
              "value": "1a878e40-f803-80e6-8df1-cf50776752da",
              "cachedResultUrl": "https://www.notion.so/1a878e40f80380e68df1cf50776752da",
              "cachedResultName": "Tasks"
            },
            "filterType": "manual"
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "da34def3-17ac-461e-bec3-5bcdbfdd3609",
          "name": "Create Task in Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            1580,
            1160
          ],
          "parameters": {
            "name": "={{ $json.name }}",
            "resource": "task",
            "projectId": "={{ $json.clockify_project_id }}",
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}",
            "additionalFields": {}
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "c8adb686-8667-466e-a7f9-32e8dd7c1721",
          "name": "Remove Task from Clockify",
          "type": "n8n-nodes-base.clockify",
          "position": [
            2020,
            1260
          ],
          "parameters": {
            "taskId": "={{ $('Compare Datasets2').item.json.clockify_task_id }}",
            "resource": "task",
            "operation": "delete",
            "projectId": "={{ $('Compare Datasets2').item.json.clockify_project_id }}",
            "workspaceId": "={{ $('Globals').item.json.workspace_id }}"
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "399e5ebc-65d6-4af2-94ba-b4016602df4f",
          "name": "Structure output2",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1360,
            1460
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "63f911a9-f75e-46ae-91b1-ebbab6548471",
          "name": "No Operation2",
          "type": "n8n-nodes-base.noOp",
          "position": [
            260,
            1540
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "7ca89d07-1e82-4bbf-8fa6-5becd996b0b9",
          "name": "Map values4",
          "type": "n8n-nodes-base.set",
          "position": [
            920,
            1440
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "63fe0f05-c1b4-41b8-99e9-74f5ef2d51b6",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                },
                {
                  "id": "44339109-9634-451b-965c-b2767aa3c628",
                  "name": "archived",
                  "type": "boolean",
                  "value": "={{ ['Done', 'Obsolete'].includes($json.property_status) }}"
                },
                {
                  "id": "bddd1a9b-df7c-4d2f-891e-501639c786cc",
                  "name": "clockify_task_id",
                  "type": "string",
                  "value": "={{ $json.property_clockify_task_id }}"
                },
                {
                  "id": "12f7a5b6-e98f-4fa7-ad67-208c54ab2924",
                  "name": "clockify_project_id",
                  "type": "string",
                  "value": "={{ $json.property_clockify_project_id[0] || \"\" }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "a9dcf9f2-8cb1-4dc4-9136-25d25ec5033e",
          "name": "Map values5",
          "type": "n8n-nodes-base.set",
          "position": [
            920,
            1640
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "b2bea7bb-8b70-4268-84dd-a0463f8a30c1",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                },
                {
                  "id": "bbe039ac-a0ac-4570-b4f6-e6728b1d68ff",
                  "name": "archived",
                  "type": "boolean",
                  "value": "={{ $json.status !== 'ACTIVE' }}"
                },
                {
                  "id": "7342b5ea-7da7-4158-bdca-ca40d1cdb042",
                  "name": "clockify_task_id",
                  "type": "string",
                  "value": "={{ $json.id }}"
                },
                {
                  "id": "2547d142-507f-4f8b-bc65-1556e217c801",
                  "name": "clockify_project_id",
                  "type": "string",
                  "value": "={{ $json.projectId }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "20b17136-fd8c-4e79-9d39-b31a149e9867",
          "name": "Get active Projects from Clockify1",
          "type": "n8n-nodes-base.clockify",
          "position": [
            480,
            1640
          ],
          "parameters": {
            "operation": "getAll",
            "returnAll": true,
            "workspaceId": "={{ $('Globals').first().json.workspace_id }}",
            "additionalFields": {
              "archived": false
            }
          },
          "credentials": {
            "clockifyApi": {
              "id": "CMJ0LAYOs143GAXw",
              "name": "Clockify (octionictest)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 1,
          "waitBetweenTries": 5000
        },
        {
          "id": "ec63d256-5abb-49c6-b6c8-67daf653f67e",
          "name": "Compare Datasets2",
          "type": "n8n-nodes-base.compareDatasets",
          "position": [
            1140,
            1520
          ],
          "parameters": {
            "options": {},
            "resolve": "mix",
            "mergeByFields": {
              "values": [
                {
                  "field1": "clockify_task_id",
                  "field2": "clockify_task_id"
                }
              ]
            }
          },
          "typeVersion": 2.3
        },
        {
          "id": "c759e651-5c28-4b72-8f5f-628396e054a7",
          "name": "If unmapped in Notion2",
          "type": "n8n-nodes-base.if",
          "position": [
            1360,
            1260
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "26af0d64-ef8d-492e-87ca-6a893e8f85a1",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.clockify_task_id }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "91d86b0f-8823-4eb6-9d62-c423134645ad",
          "name": "Set new values2",
          "type": "n8n-nodes-base.set",
          "position": [
            1580,
            1720
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "bfc2ff08-56a1-49c1-b1db-475063f88032",
                  "name": "archived",
                  "type": "boolean",
                  "value": true
                },
                {
                  "id": "2e8b2166-149b-4eed-8bf2-dd08e9b98210",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $json.name }}"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "ec95b97a-4bea-4726-8114-8cc352f11162",
          "name": "Store Clockify ID in Notion2",
          "type": "n8n-nodes-base.notion",
          "onError": "continueErrorOutput",
          "position": [
            1800,
            1160
          ],
          "parameters": {
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Get active Tasks from Notion').item.json.id }}"
            },
            "options": {},
            "resource": "databasePage",
            "operation": "update",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Clockify Task ID|rich_text",
                  "textContent": "={{ $json.id }}"
                }
              ]
            }
          },
          "credentials": {
            "notionApi": {
              "id": "ObmaBA0dJss3JJPv",
              "name": "Notion (Test)"
            }
          },
          "retryOnFail": true,
          "typeVersion": 2.2,
          "waitBetweenTries": 5000
        },
        {
          "id": "0baa8a13-7190-42c2-bfa6-e53771e48e65",
          "name": "Stop and Error2",
          "type": "n8n-nodes-base.stopAndError",
          "position": [
            2240,
            1260
          ],
          "parameters": {
            "errorMessage": "Could not update task in Notion (deleted in Clockify again)"
          },
          "typeVersion": 1
        },
        {
          "id": "ecebad5d-0462-4501-915c-9e15792a3e99",
          "name": "Limit",
          "type": "n8n-nodes-base.limit",
          "position": [
            2460,
            20
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "ff50b701-9bc3-4336-961c-fb2513cc401c",
          "name": "Limit1",
          "type": "n8n-nodes-base.limit",
          "position": [
            2460,
            940
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "4189d36a-72d2-47e2-b800-e9355f411717",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            220,
            -700
          ],
          "parameters": {
            "color": 5,
            "width": 2420,
            "height": 880,
            "content": "# Sync Clients"
          },
          "typeVersion": 1
        },
        {
          "id": "c9bafea6-74c6-4978-bd78-58312ab5e812",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            220,
            220
          ],
          "parameters": {
            "color": 5,
            "width": 2420,
            "height": 880,
            "content": "# Sync Projects"
          },
          "typeVersion": 1
        },
        {
          "id": "9537b98c-a70d-4d5a-902a-9809965e5ee2",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            220,
            1140
          ],
          "parameters": {
            "color": 5,
            "width": 2420,
            "height": 780,
            "content": "# Sync Tasks"
          },
          "typeVersion": 1
        },
        {
          "id": "a38ec76e-c8e8-46fe-95af-a04dda8d8c08",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -20,
            -360
          ],
          "parameters": {
            "width": 220,
            "height": 320,
            "content": "## Set Globals (optional)\nBy default the fist available workspace ID is set. This can be overridden here."
          },
          "typeVersion": 1
        },
        {
          "id": "a366f477-87b5-4fe8-aed8-761f2941f2d1",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -460,
            -460
          ],
          "parameters": {
            "width": 220,
            "height": 520,
            "content": "## Set triggers\nBy default this workflow runs once a day. Additionally a webhook allows for manual calls using a Notion button."
          },
          "typeVersion": 1
        },
        {
          "id": "2566cdd1-4fe2-4d61-b2a0-47ebdaf8c9a1",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1300,
            1620
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "## Select database\nChoose the tasks database."
          },
          "typeVersion": 1
        },
        {
          "id": "029ec90b-dacd-4d80-b78e-4983a646b3db",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            420,
            -400
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "## Select database\nChoose the clients database."
          },
          "typeVersion": 1
        },
        {
          "id": "1851f5ed-5c51-4545-a4f4-ef3fa268998c",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1080,
            -120
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "## Select database\nChoose the clients database."
          },
          "typeVersion": 1
        },
        {
          "id": "a1562c09-033c-43df-9456-a9fe4775133f",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1080,
            800
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "## Select database\nChoose the projects database."
          },
          "typeVersion": 1
        },
        {
          "id": "20a722ec-e89d-4801-903d-ab84635772e7",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            420,
            520
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "## Select database\nChoose the projects database."
          },
          "typeVersion": 1
        },
        {
          "id": "67d3f286-9025-43a0-978c-74b9e1aee176",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            640,
            1340
          ],
          "parameters": {
            "width": 220,
            "height": 280,
            "content": "## Select database\nChoose the tasks database."
          },
          "typeVersion": 1
        },
        {
          "id": "f90dc5a3-e824-4331-b68f-848dd3c11813",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -460,
            160
          ],
          "parameters": {
            "width": 660,
            "height": 1160,
            "content": "# Setup\n## Prerequisites\nThis workflow expects a database structure with at least having the structure mentioned below. Alternatively start with [this Notion Template](https://steadfast-banjo-d1f.notion.site/1ae82b476c84808e9409c08baf382c45)\n### Clients\n- Name (Text)\n- Archive (Checkbox)\n- Clockify Client ID (Text)\n### Projects\n- Name (Text)\n- Status (Status)\n  - required options: \"Done\", \"Obsolete\" and at least one more\n  - recommended options: \"Backlog\", \"In progress\", \"On hold\"\n- Clockify Client ID (Rollup: Clients -> Clockify Client ID)\n- Clockify Project ID (Text)\n### Tasks\n- Name (Text)\n- Status (Status)\n  - required options: \"Done\", \"Obsolete\" and at least one more\n  - recommended options: \"Backlog\", \"In progress\", \"On hold\"\n- Clockify Project ID (Rollup: Projects -> Clockify Project ID)\n- Clockify Task ID (Text)\n- Clients (Rollup: Projects -> Clients)\n## Update this workflow\n- Set the credentials accordingly\n- Check for all other yellow sticky notes\n\n## Add report button in Notion (optional)\nAdd a Formula field named \"Clockify Report\" or similar to the projects database and insert the following value:\n```if(prop(\"Clockify Project ID\").length() > 0, link(style(\"â±ï¸ View open time logs\", \"grey_background\"), \"https://app.clockify.me/reports/detailed?start=\" + formatDate(dateSubtract(today(), 1, \"years\"), \"YYYY-MM-DD\") + \"T00:00:00.000Z&end=\" + formatDate(today(), \"YYYY-MM-DD\") + \"T23:59:59.999Z&filterValuesData=%7B%22tags%22:%5B%2267c381166730bf39cdcce516%22%5D,%22projects%22:%5B%22\" + prop(\"Clockify Project ID\") + \"%22%5D%7D&filterOptions=%7B%22tags%22:%7B%22status%22:%22ACTIVE%22,%22contains%22:%22DOES_NOT_CONTAIN%22%7D,%22projects%22:%7B%22status%22:%22ACTIVE%22%7D%7D&page=1&pageSize=50\"), \"\")```\n\n## Add sync button to Notion (optional)\n_This requires a paid Notion plan_\n- Grab the production URL of the Webhook Node\n- Create a button in Notion next to a view of the Clients Database\n- Add a webhook call action and paste copied URL\n- Name the button \"Sync to Clockify\" or similar"
          },
          "typeVersion": 1
        }
      ],
      "active": false,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "c3e4f66b-5501-434d-a9aa-bc6c68780891",
      "connections": {
        "Limit": {
          "main": [
            [
              {
                "node": "No Operation1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Limit",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limit1": {
          "main": [
            [
              {
                "node": "No Operation2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "Limit1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Globals": {
          "main": [
            [
              {
                "node": "No Operation",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Get first workspace ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map values": {
          "main": [
            [
              {
                "node": "Compare Datasets",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map values1": {
          "main": [
            [
              {
                "node": "Compare Datasets",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Map values2": {
          "main": [
            [
              {
                "node": "Compare Datasets1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map values3": {
          "main": [
            [
              {
                "node": "Compare Datasets1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Map values4": {
          "main": [
            [
              {
                "node": "Compare Datasets2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map values5": {
          "main": [
            [
              {
                "node": "Compare Datasets2",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "No Operation": {
          "main": [
            [
              {
                "node": "Get active Clients from Notion",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get active Clients from Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation1": {
          "main": [
            [
              {
                "node": "Get active Projects from Notion",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get active Projects from Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation2": {
          "main": [
            [
              {
                "node": "Get active Projects from Clockify1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get active Tasks from Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set new values": {
          "main": [
            [
              {
                "node": "Update Client in Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set new values1": {
          "main": [
            [
              {
                "node": "Update Project in Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set new values2": {
          "main": [
            [
              {
                "node": "Update Task in Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Compare Datasets": {
          "main": [
            [
              {
                "node": "If unmapped in Notion",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Structure output",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update Client in Clockify",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get archived Client from Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Get first workspace ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structure output": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Compare Datasets1": {
          "main": [
            [
              {
                "node": "If unmapped in Notion1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Structure output1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update Project in Clockify",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get completed Project from Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Compare Datasets2": {
          "main": [
            [
              {
                "node": "If unmapped in Notion2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Structure output2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update Task in Clockify",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get completed Task from Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structure output1": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "If unmapped in Notion": {
          "main": [
            [
              {
                "node": "Create Client in Clockify",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update Client in Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get first workspace ID": {
          "main": [
            [
              {
                "node": "Globals",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If unmapped in Notion1": {
          "main": [
            [
              {
                "node": "Create Project in Clockify",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update Project in Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If unmapped in Notion2": {
          "main": [
            [
              {
                "node": "Create Task in Clockify",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Update Task in Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Task in Clockify": {
          "main": [
            [
              {
                "node": "Store Clockify ID in Notion2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation, do nothing": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Client in Clockify": {
          "main": [
            [
              {
                "node": "Store Clockify ID in Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation, do nothing2": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Remove Task from Clockify": {
          "main": [
            [
              {
                "node": "Stop and Error2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Client in Clockify": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Create Project in Clockify": {
          "main": [
            [
              {
                "node": "Store Clockify ID in Notion1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Project in Clockify": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Remove Client from Clockify": {
          "main": [
            [
              {
                "node": "Stop and Error",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Store Clockify ID in Notion": {
          "main": [
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Remove Client from Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get active Tasks from Notion": {
          "main": [
            [
              {
                "node": "Map values4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Remove Project from Clockify": {
          "main": [
            [
              {
                "node": "Stop and Error1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Store Clockify ID in Notion1": {
          "main": [
            [
              {
                "node": "No Operation, do nothing2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Remove Project from Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Store Clockify ID in Notion2": {
          "main": [
            [],
            [
              {
                "node": "Remove Task from Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get active Clients from Notion": {
          "main": [
            [
              {
                "node": "Map values",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get active Tasks from Clockify": {
          "main": [
            [
              {
                "node": "Map values5",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get completed Task from Notion": {
          "main": [
            [
              {
                "node": "Set new values2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get active Projects from Notion": {
          "main": [
            [
              {
                "node": "Map values2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get archived Client from Notion": {
          "main": [
            [
              {
                "node": "Set new values",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get active Clients from Clockify": {
          "main": [
            [
              {
                "node": "Map values1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get active Projects from Clockify": {
          "main": [
            [
              {
                "node": "Map values3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get completed Project from Notion": {
          "main": [
            [
              {
                "node": "Set new values1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get active Projects from Clockify1": {
          "main": [
            [
              {
                "node": "Get active Tasks from Clockify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "bamboohr-webhook-sandbox",
    "title": "Webhook Sandbox & BambooHR Alerts",
    "description": "Uses PostBin + Cal.com forms to capture HR events, enriches data with OpenAI, and pushes alerts to Slack.",
    "problem": "Testing webhook-driven HR flows is painful; this template lets you inspect payloads and automate BambooHR handling.",
    "tags": [
      "bamboohr",
      "webhook",
      "slack",
      "cal.com"
    ],
    "metadata": {
      "industries": [
        "hr"
      ],
      "domains": [
        "hr-automation"
      ],
      "channels": [
        "slack",
        "email"
      ],
      "trigger": "webhook",
      "complexity": "medium",
      "integrations": [
        "BambooHR",
        "Cal.com",
        "OpenAI",
        "Slack"
      ]
    },
    "workflow": {
      "id": "sB6dC0GZ7zZHuMGF",
      "meta": {
        "instanceId": "a9f3b18652ddc96459b459de4fa8fa33252fb820a9e5a1593074f3580352864a",
        "templateCredsSetupCompleted": true
      },
      "name": "Test Webhooks in n8n Without Changing WEBHOOK_URL (PostBin & BambooHR Example)",
      "tags": [
        {
          "id": "qtD3SYKEoYtiqguT",
          "name": "building_blocks",
          "createdAt": "2025-02-08T21:20:40.051Z",
          "updatedAt": "2025-02-08T21:20:40.051Z"
        },
        {
          "id": "mCgqKYNfNWwqIQG3",
          "name": "ai",
          "createdAt": "2025-02-08T21:20:49.438Z",
          "updatedAt": "2025-02-08T21:20:49.438Z"
        },
        {
          "id": "EjQkfx3v7nH79HWo",
          "name": "hr",
          "createdAt": "2025-02-08T21:20:57.598Z",
          "updatedAt": "2025-02-08T21:20:57.598Z"
        },
        {
          "id": "suSDrJxibUi10zsu",
          "name": "engineering",
          "createdAt": "2025-02-08T21:21:43.564Z",
          "updatedAt": "2025-02-08T21:21:43.564Z"
        }
      ],
      "nodes": [
        {
          "id": "2529ea94-8427-4fbb-bac0-79fec29fe943",
          "name": "When clicking â€˜Test workflowâ€™",
          "type": "n8n-nodes-base.manualTrigger",
          "position": [
            440,
            1220
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "067ce1b6-a511-448b-a268-7d0869ed2b36",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            600,
            980
          ],
          "parameters": {
            "color": 6,
            "width": 550.7128407259806,
            "height": 151.03568930452542,
            "content": "### Requirements:\n1. **BambooHR instance** ([free trial link](https://www.bamboohr.com/signup/))\n2. **BambooHR API key*** ([documentation](https://documentation.bamboohr.com/docs/getting-started#authentication))\n3. **Slack connection** ([n8n documentation](https://docs.n8n.io/integrations/builtin/credentials/slack/))\n* **Note about API key**: Set up in n8n as Generic Credential (Basic Auth) with the API key as the username and any string for the password.\n\n"
          },
          "typeVersion": 1
        },
        {
          "id": "62a65021-8bc5-4bd3-95e4-b0616c0cbbe6",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1620,
            1620
          ],
          "parameters": {
            "color": 7,
            "width": 804.2810233962304,
            "height": 154.2786603126325,
            "content": "## Other use cases for BambooHR webhook\n1. Fraud & Compliance Monitoring (Triggered by Pay Rate, Pay Type, Compensation Change Reason, Bonus Amount, Commission Amount)\n2. Offboarding & Security Access Revocation (Triggered by Employment Status, Job Title, Department, Location)\n3. Manager Change Alert for Team & Workflow Updates (Triggered by Reporting To, Job Title, Department)"
          },
          "typeVersion": 1
        },
        {
          "id": "63e5f28a-83ea-44be-ad91-ab2b635551a1",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            800,
            1140
          ],
          "parameters": {
            "color": 7,
            "width": 600.2141303561856,
            "height": 246.1007234368067,
            "content": "## Create a new Bin in PostBin (STEP #1 above)"
          },
          "typeVersion": 1
        },
        {
          "id": "1afbac45-116e-4c8b-886c-24a96ba286ab",
          "name": "Merge",
          "type": "n8n-nodes-base.merge",
          "position": [
            1680,
            1240
          ],
          "parameters": {
            "mode": "combine",
            "options": {},
            "combineBy": "combineByPosition"
          },
          "typeVersion": 3
        },
        {
          "id": "367315b0-eba5-4768-bdb0-8be23d965f6c",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1840,
            1180
          ],
          "parameters": {
            "color": 7,
            "width": 424.9937286279833,
            "height": 248.92215299422725,
            "content": "## Register webhook (STEP #2 above)"
          },
          "typeVersion": 1
        },
        {
          "id": "5b860a4e-66c9-4996-bd8f-ac642eca9021",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1400,
            300
          ],
          "parameters": {
            "color": 4,
            "width": 291.16380512688715,
            "height": 397.605174332017,
            "content": "## STEP #3: Confirm webhook functionality"
          },
          "typeVersion": 1
        },
        {
          "id": "c6d78f60-0e05-452c-b50d-4bee9b4e1220",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            600,
            300
          ],
          "parameters": {
            "color": 4,
            "width": 611.7032537942721,
            "height": 397.94343220191183,
            "content": "## STEP #1: Create a new Bin in PostBin\nNo authentication needed. Use API to create Bin and retrieve BinId to craft URL for subsequent usage."
          },
          "typeVersion": 1
        },
        {
          "id": "6bdd564e-daf7-4259-a283-547f8257dcce",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            580,
            140
          ],
          "parameters": {
            "color": 7,
            "width": 1140.1894415469083,
            "height": 593.490746966612,
            "content": "## How to Test a Short-Lived Webhook in n8n **WITHOUT** Changing WEBHOOK_URL\nTypically in n8n, in order to test a webhook, you first need to go through the process of changing the [**WEBHOOK_URL**](https://docs.n8n.io/hosting/configuration/configuration-examples/webhook-url/) environment variable to an address that is accessible to the service you want to test. Time permitting, that can be done with [ngrok](https://ngrok.com/docs/getting-started/) ([example](https://docs.n8n.io/hosting/installation/server-setups/)) or by self-hosting with one of [n8n's recommended deployment options](https://docs.n8n.io/hosting/installation/server-setups/).\n\nBut if you're new to n8n and in a rush to test a webhook's functionality, you can use [PostBin](https://www.postb.in/) as demonstrated in this workflow to test a proof of concept fast and avoid any unnecessary time on n8n setup and configuration."
          },
          "typeVersion": 1
        },
        {
          "id": "06b12932-bc46-46ff-a316-518cd1e24546",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1420,
            600
          ],
          "parameters": {
            "color": 2,
            "width": 255.54164387152053,
            "height": 80,
            "content": "**This may respond with a 404**\nIf no requests have been sent to the Bin, an error is raised."
          },
          "typeVersion": 1
        },
        {
          "id": "17eabcf5-9ae7-4e79-bdb5-3664fa286aeb",
          "name": "Create Bin",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            660,
            420
          ],
          "parameters": {
            "url": "https://www.postb.in/api/bin",
            "method": "POST",
            "options": {}
          },
          "typeVersion": 4.2
        },
        {
          "id": "5b233ff1-475a-48a7-a5d2-4ce82adb2213",
          "name": "GET Bin",
          "type": "n8n-nodes-base.postBin",
          "position": [
            860,
            420
          ],
          "parameters": {
            "binId": "={{ $json.binId }}",
            "operation": "get",
            "requestOptions": {}
          },
          "typeVersion": 1
        },
        {
          "id": "14e0b2fc-f1bb-4eae-be81-069641f27b53",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            620,
            600
          ],
          "parameters": {
            "color": 7,
            "width": 182.23771342026427,
            "height": 80,
            "content": "Uses API call to bypass broken PostBin create bin endpoint in n8n."
          },
          "typeVersion": 1
        },
        {
          "id": "2eb51697-744e-4bfc-ae3e-ad28bcdc21b1",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            840,
            600
          ],
          "parameters": {
            "color": 7,
            "width": 351.0986223154297,
            "height": 80,
            "content": "Retrieve the binId (can also be found in response of Create Bin node). Craft a url that uses `https://www.postb.in/:binId` structure"
          },
          "typeVersion": 1
        },
        {
          "id": "ae7367be-ca86-4cac-a763-3627a176d988",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            580,
            740
          ],
          "parameters": {
            "width": 631.0482952232512,
            "height": 113.5322633928848,
            "content": "**Per PostBin API Documentation:**\nYou can hit the https://www.postb.in/:binId endpoint to collect any kind of request data whether it is a GET, POST, PUT, PATCH, DELETE or whatever. This particular endpoint is not RESTful and is not part of this API. It isn't RESTful by definition. ie. it is meant to collect whatever you send to it."
          },
          "typeVersion": 1
        },
        {
          "id": "be327737-1e33-4107-9f98-66a6d66d2886",
          "name": "Format url for webhook",
          "type": "n8n-nodes-base.set",
          "position": [
            1060,
            420
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "5235b8f1-f284-472f-b6a5-25c16bc4a66e",
                  "name": "webhook_url",
                  "type": "string",
                  "value": "=https://www.postb.in/{{ $json.binId }}"
                },
                {
                  "id": "35d56f07-4f6b-422a-8a03-0c3e49f4d734",
                  "name": "binId",
                  "type": "string",
                  "value": "={{ $json.binId }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "463d247c-ac97-4d79-a0c9-8c0785240a73",
          "name": "GET most recent request",
          "type": "n8n-nodes-base.postBin",
          "position": [
            1500,
            420
          ],
          "parameters": {
            "binId": "={{ $('Format url for webhook').item.json.binId }}",
            "resource": "request",
            "operation": "removeFirst",
            "requestOptions": {}
          },
          "typeVersion": 1
        },
        {
          "id": "ef07fa4e-1411-474e-ba98-171abae9542d",
          "name": "MOCK request",
          "type": "n8n-nodes-base.postBin",
          "position": [
            1260,
            580
          ],
          "parameters": {
            "binId": "={{ $('Format url for webhook').item.json.binId }}",
            "resource": "request",
            "operation": "send",
            "binContent": "=",
            "requestOptions": {}
          },
          "typeVersion": 1
        },
        {
          "id": "6769b161-6dff-4732-b1cd-900b2e64ffc9",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            580,
            900
          ],
          "parameters": {
            "color": 4,
            "width": 4124.530158203355,
            "height": 962.561104644939,
            "content": "## Example: Register and test a webhook in BambooHR\n### Scenario: Send a notification to Slack when new employees join the company"
          },
          "typeVersion": 1
        },
        {
          "id": "a7f57c0a-3918-450b-b1a7-edd80e6edcf6",
          "name": "Create Bin1",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            860,
            1220
          ],
          "parameters": {
            "url": "https://www.postb.in/api/bin",
            "method": "POST",
            "options": {}
          },
          "typeVersion": 4.2
        },
        {
          "id": "8a9ef96b-eb99-4fe5-aa82-0b4453d90dff",
          "name": "GET Bin1",
          "type": "n8n-nodes-base.postBin",
          "position": [
            1060,
            1220
          ],
          "parameters": {
            "binId": "={{ $json.binId }}",
            "operation": "get",
            "requestOptions": {}
          },
          "typeVersion": 1
        },
        {
          "id": "c70ff70f-80c6-4516-b278-bad82655d78c",
          "name": "Format url for webhook1",
          "type": "n8n-nodes-base.set",
          "position": [
            1260,
            1220
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "5235b8f1-f284-472f-b6a5-25c16bc4a66e",
                  "name": "url",
                  "type": "string",
                  "value": "=https://www.postb.in/{{ $json.binId }}"
                },
                {
                  "id": "35d56f07-4f6b-422a-8a03-0c3e49f4d734",
                  "name": "binId",
                  "type": "string",
                  "value": "={{ $json.binId }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "793cd3ab-1459-4382-b9f7-5630869a871e",
          "name": "SET BambooHR subdomain",
          "type": "n8n-nodes-base.set",
          "position": [
            660,
            1480
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "89c9eb04-196b-4cb0-afec-dab071dcc471",
                  "name": "subdomain",
                  "type": "string",
                  "value": "example"
                }
              ]
            }
          },
          "executeOnce": true,
          "typeVersion": 3.4
        },
        {
          "id": "06703339-8e5b-4267-ae23-15540ea00692",
          "name": "Split out fields",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            1060,
            1480
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "fields"
          },
          "typeVersion": 1
        },
        {
          "id": "b8086b64-0e27-4294-a230-3d6f428a2ddb",
          "name": "Combine fields to monitor",
          "type": "n8n-nodes-base.aggregate",
          "position": [
            1460,
            1480
          ],
          "parameters": {
            "options": {},
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "renameField": true,
                  "outputFieldName": "monitorFields",
                  "fieldToAggregate": "alias"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "6c75204f-8527-467f-b982-bed268843fde",
          "name": "Format payload for BambooHR webhook",
          "type": "n8n-nodes-base.set",
          "position": [
            1900,
            1240
          ],
          "parameters": {
            "include": "except",
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "188d1a10-d32c-4e48-8bad-f8a5002c34a9",
                  "name": "name",
                  "type": "string",
                  "value": "Webhook Test"
                },
                {
                  "id": "cfcd6de9-c20f-4935-8b5f-548bd6c381bf",
                  "name": "format",
                  "type": "string",
                  "value": "json"
                },
                {
                  "id": "c0b22bc7-d873-4973-9e27-6931dde4b8b1",
                  "name": "limit.times",
                  "type": "number",
                  "value": 1
                },
                {
                  "id": "5e912e0a-d3fe-46e5-b85a-b22be0ae3eb1",
                  "name": "limit.seconds",
                  "type": "number",
                  "value": 60
                },
                {
                  "id": "0a197fcf-4d30-4112-a441-5ee4dbfaa350",
                  "name": "postFields",
                  "type": "object",
                  "value": "={{ {\"employeeNumber\": \"Employee #\",\n        \"firstName\": \"First name\",\n        \"lastName\": \"Last name\",\n        \"jobTitle\": \"Job title\"} }}"
                },
                {
                  "id": "aa292476-0ee2-49fc-afce-4788ff37475a",
                  "name": "frequency",
                  "type": "object",
                  "value": "={\n  \"hour\": null,\n  \"minute\": null,\n  \"day\": null,\n  \"month\": null\n}"
                },
                {
                  "id": "0e6c44e5-c918-4897-b865-5e1848ff8444",
                  "name": "subdomain",
                  "type": "string",
                  "value": "={{ $('SET BambooHR subdomain').first().json.subdomain }}"
                }
              ]
            },
            "excludeFields": "binId",
            "includeOtherFields": true
          },
          "typeVersion": 3.4
        },
        {
          "id": "b0191582-e8d3-4432-b8e8-38ff0fc782fb",
          "name": "Create webhook in BambooHR",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            2100,
            1240
          ],
          "parameters": {
            "url": "=https://api.bamboohr.com/api/gateway.php/{{ $json.subdomain }}/v1/webhooks/",
            "method": "POST",
            "options": {},
            "jsonBody": "={{ $json.removeField(\"subdomain\").toJsonString() }}",
            "sendBody": true,
            "specifyBody": "json",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth"
          },
          "credentials": {
            "httpBasicAuth": {
              "id": "XXXXXX",
              "name": "BambooHR Basic Auth"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "6f8d47f3-1a80-4317-a9eb-89188c70618c",
          "name": "Create dummy data for employees",
          "type": "n8n-nodes-base.debugHelper",
          "position": [
            2380,
            1240
          ],
          "parameters": {
            "category": "randomData",
            "randomDataCount": 3
          },
          "typeVersion": 1
        },
        {
          "id": "b3ba2315-f7d7-474b-9f06-3dbad510fb93",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            800,
            1407.2486467347771
          ],
          "parameters": {
            "color": 7,
            "width": 794.510445997778,
            "height": 368.01097806266364,
            "content": "## GET fields from BambooHR to monitor for changes [[src]](https://documentation.bamboohr.com/reference/get-monitor-fields)"
          },
          "typeVersion": 1
        },
        {
          "id": "34956bf7-ef81-425b-a348-bffa99f278bd",
          "name": "Sticky Note14",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2320,
            1180
          ],
          "parameters": {
            "color": 7,
            "width": 416.47592441009544,
            "height": 250.72353860519,
            "content": "## Test webhook"
          },
          "typeVersion": 1
        },
        {
          "id": "077934b0-21c5-49ef-9482-fa52ecbe917f",
          "name": "Keep only new employee fields",
          "type": "n8n-nodes-base.filter",
          "position": [
            1260,
            1480
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "e1daab1a-bee5-4308-82f9-6660e957722d",
                  "operator": {
                    "type": "array",
                    "operation": "contains",
                    "rightType": "any"
                  },
                  "leftValue": "={{ [\"employmentHistoryStatus\",\"employeeStatusDate\",\"hireDate\",\"originalHireDate\"] }}",
                  "rightValue": "={{ $json.alias }}"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "ecd27c9d-fe7a-45fa-b085-e68535c334af",
          "name": "Sticky Note15",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            820,
            1653.074026323302
          ],
          "parameters": {
            "width": 568.1578343498747,
            "height": 101.29440680672363,
            "content": "### Note about this section\nDepending on your familiarity with BambooHR and your intention with the webhook, you could hard code the fields to monitor with your webhook or use AI to filter based on topic. I chose a middle ground for this example.\n"
          },
          "typeVersion": 1
        },
        {
          "id": "2b0ee3a5-1b9f-4f8f-b024-2c576573d2d6",
          "name": "GET all possible fields to monitor in BambooHR",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            860,
            1480
          ],
          "parameters": {
            "url": "=https://api.bamboohr.com/api/gateway.php/{{ $json.subdomain }}/v1/webhooks/monitor_fields",
            "options": {},
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth"
          },
          "credentials": {
            "httpBasicAuth": {
              "id": "XXXXXX",
              "name": "BambooHR Basic Auth"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "97923d51-c895-4215-b808-4ade22ea6011",
          "name": "Register and test webhook",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1260,
            420
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "4e48efac-eec6-48cc-b940-b04bda667953",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1228.9696450873366,
            300
          ],
          "parameters": {
            "color": 4,
            "width": 157.46160832218783,
            "height": 397.57230173351894,
            "content": "## STEP #2\nUse the PostBin URL in place of your normal webhook"
          },
          "typeVersion": 1
        },
        {
          "id": "f7147f00-19d1-4c0f-a75b-a7fd18f16c31",
          "name": "Sticky Note16",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2940,
            1040
          ],
          "parameters": {
            "color": 7,
            "width": 296.68826711085643,
            "height": 497.77627578351644,
            "content": "## STEP #3: Confirm webhook functionality"
          },
          "typeVersion": 1
        },
        {
          "id": "ea428b8f-fb4c-44bd-bcf0-bb7f40f3ed98",
          "name": "Check BambooHR for calls to webhook",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueRegularOutput",
          "position": [
            3040,
            1140
          ],
          "parameters": {
            "url": "=https://api.bamboohr.com/api/gateway.php/{{ $('Format payload for BambooHR webhook').item.json.subdomain }}/v1/webhooks/{{ $('Create webhook in BambooHR').item.json.id }}/log",
            "options": {},
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth"
          },
          "credentials": {
            "httpBasicAuth": {
              "id": "XXXXXX",
              "name": "BambooHR Basic Auth"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "2aa4610d-48a8-4c15-be21-1adbb3bb8b1a",
          "name": "Create employee records with dummy data",
          "type": "n8n-nodes-base.bambooHr",
          "position": [
            2580,
            1240
          ],
          "parameters": {
            "lastName": "={{ $json.lastname }}",
            "firstName": "={{ $json.firstname }}",
            "additionalFields": {
              "hireDate": "={{ $now }}",
              "department": 18264
            }
          },
          "credentials": {
            "bambooHrApi": {
              "id": "XXXXXX",
              "name": "BambooHR account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "f912f38c-fb3b-4357-87fe-cca9aea7ebf4",
          "name": "Split out employees",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            3300,
            1340
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "body.employees"
          },
          "typeVersion": 1
        },
        {
          "id": "200f8afe-f872-4598-b376-6e5cd053aa7d",
          "name": "Format displayName",
          "type": "n8n-nodes-base.set",
          "position": [
            3500,
            1340
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "41e8a654-af0e-42db-a9f8-23bc951d34a9",
                  "name": "displayName",
                  "type": "string",
                  "value": "={{ $json.fields[\"First name\"].value + \" \" +  $json.fields[\"Last name\"].value}}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "5fdf5f56-42ea-4891-9b66-5d3d290d0862",
          "name": "OpenAI Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            4100,
            1480
          ],
          "parameters": {
            "options": {}
          },
          "credentials": {
            "openAiApi": {
              "id": "XXXXXX",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "c3b02b2a-2135-41da-a881-25cf2135ff71",
          "name": "Auto-fixing Output Parser",
          "type": "@n8n/n8n-nodes-langchain.outputParserAutofixing",
          "position": [
            4200,
            1480
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "e32e3977-1a4c-4b74-839e-278621ac59ec",
          "name": "OpenAI Chat Model1",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            4200,
            1640
          ],
          "parameters": {
            "options": {}
          },
          "credentials": {
            "openAiApi": {
              "id": "XXXXXX",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "aaf59e1e-4db6-416b-8602-d5dab0959783",
          "name": "Structured Output Parser",
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "position": [
            4420,
            1640
          ],
          "parameters": {
            "jsonSchemaExample": "{\n\t\"welcome_message\": \"We are excited to welcome employee_name to the company!\"\n}"
          },
          "typeVersion": 1.2
        },
        {
          "id": "cc6702aa-8e96-40ad-805e-306e94b0be13",
          "name": "Basic LLM Chain",
          "type": "@n8n/n8n-nodes-langchain.chainLlm",
          "position": [
            4100,
            1340
          ],
          "parameters": {
            "text": "=Write a message to be shared with other employees welcoming our new {{ $json.keys().first() + \": \" + $json.values().first().join(', ').replace(/ ([^,]*)$/, ' and $1') }} to the company.",
            "promptType": "define",
            "hasOutputParser": true
          },
          "typeVersion": 1.4
        },
        {
          "id": "7f2d7505-5554-4ea4-8bf9-1e05c56c2bc6",
          "name": "Combine employees into list",
          "type": "n8n-nodes-base.aggregate",
          "position": [
            3700,
            1340
          ],
          "parameters": {
            "options": {},
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "renameField": true,
                  "outputFieldName": "=employee",
                  "fieldToAggregate": "displayName"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "b897a173-254f-445f-a3af-db9398d0c904",
          "name": "Pluralize key",
          "type": "n8n-nodes-base.renameKeys",
          "position": [
            3900,
            1340
          ],
          "parameters": {
            "keys": {
              "key": [
                {
                  "newKey": "=employee{{ $if($json.employee.length > 1,\"s\",\"\") }}",
                  "currentKey": "employee"
                }
              ]
            },
            "additionalOptions": {}
          },
          "typeVersion": 1
        },
        {
          "id": "7e0474f1-3a9a-4b30-91eb-0b0d107d8bd1",
          "name": "Welcome employees on Slack",
          "type": "n8n-nodes-base.slack",
          "position": [
            4480,
            1340
          ],
          "webhookId": "700f2d63-f04a-4809-9602-75f3328b56f8",
          "parameters": {
            "text": "={{ $json.output.welcome_message }}",
            "select": "channel",
            "channelId": {
              "__rl": true,
              "mode": "list",
              "value": "C08BWLDFS48",
              "cachedResultName": "social"
            },
            "otherOptions": {}
          },
          "credentials": {
            "slackApi": {
              "id": "XXXXXX",
              "name": "Slack account"
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "99cd4b68-a789-4a78-9636-c26554d703ed",
          "name": "Sticky Note17",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3260,
            1240
          ],
          "parameters": {
            "color": 7,
            "width": 1380.619460919744,
            "height": 545.950640999295,
            "content": "## (For example purposes) Send message to Slack channel welcoming new employees"
          },
          "typeVersion": 1
        },
        {
          "id": "37839a6d-b616-4e24-b24f-659064752360",
          "name": "Sticky Note18",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            4340,
            920
          ],
          "parameters": {
            "color": 3,
            "width": 342.10949704718837,
            "height": 275.27825144542527,
            "content": "## FOR TESTING: DELETE WEBHOOK"
          },
          "typeVersion": 1
        },
        {
          "id": "0e03ab51-dace-4aed-9f4e-16fbbb7f7173",
          "name": "DELETE BambooHR webhook",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            4460,
            1020
          ],
          "parameters": {
            "url": "=https://api.bamboohr.com/api/gateway.php/{subdomain}/v1/webhooks/{webhook_id}",
            "method": "DELETE",
            "options": {},
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth"
          },
          "credentials": {
            "httpBasicAuth": {
              "id": "XXXXXX",
              "name": "BambooHR Basic Auth"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "81dc0021-3a7d-41f9-aef9-126143b51e9a",
          "name": "Sticky Note20",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1840,
            1440
          ],
          "parameters": {
            "width": 424.0067532215409,
            "height": 134.02025779064905,
            "content": "BambooHR's `/webhook` API endpoint expects arguments passed in the body of the request. You can see what arguments are required in their [documentation](https://documentation.bamboohr.com/reference/post-webhook) and [examples](https://documentation.bamboohr.com/docs/webhook-api-permissioned). In the arguments we pass through, we have set our webhook to fire at the same frequency as BambooHR's rate limit: 1 time every 60 seconds."
          },
          "typeVersion": 1
        },
        {
          "id": "b4a246ff-200a-40bc-a79c-4f51b24e0948",
          "name": "Sticky Note21",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2940,
            1557.4137607776859
          ],
          "parameters": {
            "width": 295.8585062958632,
            "height": 227.09133367749476,
            "content": "### What is this?\nIn the above two nodes, we performing two actions:\n\n1. Checking BambooHR for a record of calls made by it to the webhook URL we registered (provided by PostBin).\n2. Retrieving the most recent call made by BambooHR to the webhook URL from PostBin."
          },
          "typeVersion": 1
        },
        {
          "id": "b09041d0-42b7-4084-b336-5d9af288acf9",
          "name": "GET most recent request1",
          "type": "n8n-nodes-base.postBin",
          "onError": "continueRegularOutput",
          "position": [
            3040,
            1340
          ],
          "parameters": {
            "binId": "={{ $('Merge').item.json.binId }}",
            "resource": "request",
            "operation": "removeFirst",
            "requestOptions": {}
          },
          "typeVersion": 1
        },
        {
          "id": "ee2543e5-5fc6-48e1-a574-d351380df732",
          "name": "Wait 60 + 1 seconds for webhook to fire",
          "type": "n8n-nodes-base.wait",
          "position": [
            2780,
            1240
          ],
          "webhookId": "61bbec81-dcf5-441e-b6dd-ad96b429e80d",
          "parameters": {
            "amount": 61
          },
          "executeOnce": true,
          "typeVersion": 1.1
        },
        {
          "id": "6f6a95ee-ec01-429c-8710-edc52b6cc185",
          "name": "Sticky Note19",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1740,
            780
          ],
          "parameters": {
            "color": 5,
            "width": 256.0973815349037,
            "height": 87.34661077350344,
            "content": "## About the maker\n**[Find Ludwig Gerdes on LinkedIn](https://www.linkedin.com/in/ludwiggerdes)**"
          },
          "typeVersion": 1
        },
        {
          "id": "fc8344ab-f643-4bc2-af97-a2022834b3c8",
          "name": "Sticky Note22",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1740,
            520
          ],
          "parameters": {
            "color": 7,
            "width": 255.71137685448693,
            "height": 240.80136668021893,
            "content": "![image](https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExdjM4dWFjeW1lNGVxc2Vsd2Z0aXB4cWNzZmN6aG41Y296cXVnem10eCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/5cL9WAVQREF3TkfhXj/giphy.gif#full-width)"
          },
          "typeVersion": 1
        },
        {
          "id": "58c5c5a6-2210-4506-9470-d6a55fae421a",
          "name": "Sticky Note23",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3280,
            1517.2043765224669
          ],
          "parameters": {
            "width": 410.05041971203013,
            "height": 251.31245942384516,
            "content": "## What's happening here?\nIn this section, we do the following:\n1. Extract employee information from webhook call (from PostBin)\n2. Create a displayName from each employee's first and last name\n3. Combine the names into a list and format the key\n4. Ask OpenAI to compose a welcome message with the employee names\n5. Post that welcome message to Slack"
          },
          "typeVersion": 1
        }
      ],
      "active": false,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "c8562d68-8706-4fe0-9983-b9ae6de379a0",
      "connections": {
        "Merge": {
          "main": [
            [
              {
                "node": "Format payload for BambooHR webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GET Bin": {
          "main": [
            [
              {
                "node": "Format url for webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GET Bin1": {
          "main": [
            [
              {
                "node": "Format url for webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Bin": {
          "main": [
            [
              {
                "node": "GET Bin",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Bin1": {
          "main": [
            [
              {
                "node": "GET Bin1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pluralize key": {
          "main": [
            [
              {
                "node": "Basic LLM Chain",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Basic LLM Chain": {
          "main": [
            [
              {
                "node": "Welcome employees on Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split out fields": {
          "main": [
            [
              {
                "node": "Keep only new employee fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Basic LLM Chain",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Format displayName": {
          "main": [
            [
              {
                "node": "Combine employees into list",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Auto-fixing Output Parser",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Split out employees": {
          "main": [
            [
              {
                "node": "Format displayName",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Format url for webhook": {
          "main": [
            [
              {
                "node": "Register and test webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SET BambooHR subdomain": {
          "main": [
            [
              {
                "node": "GET all possible fields to monitor in BambooHR",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Format url for webhook1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GET most recent request1": {
          "main": [
            [
              {
                "node": "Split out employees",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser": {
          "ai_outputParser": [
            [
              {
                "node": "Auto-fixing Output Parser",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Auto-fixing Output Parser": {
          "ai_outputParser": [
            [
              {
                "node": "Basic LLM Chain",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Combine fields to monitor": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Register and test webhook": {
          "main": [
            [
              {
                "node": "GET most recent request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create webhook in BambooHR": {
          "main": [
            [
              {
                "node": "Create dummy data for employees",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Combine employees into list": {
          "main": [
            [
              {
                "node": "Pluralize key",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Keep only new employee fields": {
          "main": [
            [
              {
                "node": "Combine fields to monitor",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create dummy data for employees": {
          "main": [
            [
              {
                "node": "Create employee records with dummy data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When clicking â€˜Test workflowâ€™": {
          "main": [
            [
              {
                "node": "Create Bin1",
                "type": "main",
                "index": 0
              },
              {
                "node": "SET BambooHR subdomain",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Format payload for BambooHR webhook": {
          "main": [
            [
              {
                "node": "Create webhook in BambooHR",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create employee records with dummy data": {
          "main": [
            [
              {
                "node": "Wait 60 + 1 seconds for webhook to fire",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait 60 + 1 seconds for webhook to fire": {
          "main": [
            [
              {
                "node": "Check BambooHR for calls to webhook",
                "type": "main",
                "index": 0
              },
              {
                "node": "GET most recent request1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GET all possible fields to monitor in BambooHR": {
          "main": [
            [
              {
                "node": "Split out fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "social-publishing-factory",
    "title": "Omni-Channel Social Publishing Factory",
    "description": "Uploads assets, crafts prompts, and pushes content to Telegram, LinkedIn, Instagram, Facebook, and Twitter with approval flows.",
    "problem": "Marketing teams need one automation to fan out content across every network while keeping humans in the loop.",
    "tags": [
      "social",
      "telegram",
      "linkedin",
      "instagram",
      "facebook"
    ],
    "metadata": {
      "industries": [
        "marketing",
        "social"
      ],
      "domains": [
        "content-publishing"
      ],
      "channels": [
        "telegram",
        "linkedin",
        "instagram",
        "twitter",
        "facebook"
      ],
      "trigger": "manual",
      "complexity": "high",
      "integrations": [
        "Telegram",
        "LinkedIn",
        "Instagram",
        "Facebook",
        "Twitter/X"
      ]
    },
    "workflow": {
      "id": "0KZs18Ti2KXKoLIr",
      "meta": {
        "instanceId": "31e69f7f4a77bf465b805824e303232f0227212ae922d12133a0f96ffeab4fef",
        "templateCredsSetupCompleted": true
      },
      "name": "âœ¨ðŸ©·Automated Social Media Content Publishing Factory + System Prompt Composition",
      "tags": [],
      "nodes": [
        {
          "id": "74fb48a6-1acd-4693-9b8e-39b36c5649a9",
          "name": "When chat message received",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            -520,
            -2080
          ],
          "webhookId": "faddb40a-7048-4398-a0f9-d239a19c32ce",
          "parameters": {
            "options": {}
          },
          "typeVersion": 1.1
        },
        {
          "id": "09f4a998-2d69-4683-9251-2694a77efeba",
          "name": "Sticky Note20",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -600,
            -1720
          ],
          "parameters": {
            "color": 7,
            "height": 240,
            "content": "## LLM"
          },
          "typeVersion": 1
        },
        {
          "id": "03b93e0b-a917-41f6-b99e-5a27ad07cd3e",
          "name": "Sticky Note21",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -600,
            -1460
          ],
          "parameters": {
            "color": 7,
            "height": 240,
            "content": "## Chat Memory"
          },
          "typeVersion": 1
        },
        {
          "id": "b6c61fe5-a519-4bdb-8641-3149362fbb54",
          "name": "Sticky Note22",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -620,
            -2160
          ],
          "parameters": {
            "color": 4,
            "width": 300,
            "height": 280,
            "content": "## ðŸ‘Start Here"
          },
          "typeVersion": 1
        },
        {
          "id": "2cf0448a-76de-4b2c-a200-953d47e29a52",
          "name": "Sticky Note32",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1980,
            -2000
          ],
          "parameters": {
            "color": 2,
            "width": 340,
            "height": 420,
            "content": "## Social Media Publishing Router"
          },
          "typeVersion": 1
        },
        {
          "id": "dff757e6-8ef4-4479-a9f8-71cb814fb8ef",
          "name": "Sticky Note33",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -300,
            -1640
          ],
          "parameters": {
            "color": 6,
            "height": 240,
            "content": "## 1ï¸âƒ£ X - Twitter"
          },
          "typeVersion": 1
        },
        {
          "id": "fda64627-952a-4be9-b4c5-799d8c7801ad",
          "name": "X-Twiter",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            -220,
            -1540
          ],
          "parameters": {
            "name": "create_x_twitter_posts_tool",
            "fields": {
              "values": [
                {
                  "name": "route",
                  "stringValue": "=xtwitter"
                },
                {
                  "name": "user_prompt",
                  "stringValue": "={{ $('When chat message received').item.json.chatInput }}"
                }
              ]
            },
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "description": "Use this tool to create XTwitter posts",
            "jsonSchemaExample": ""
          },
          "typeVersion": 1.2
        },
        {
          "id": "5023b0b3-468b-4cbb-829c-e06aaf822b99",
          "name": "Sticky Note34",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -40,
            -1640
          ],
          "parameters": {
            "color": 6,
            "height": 240,
            "content": "## 2ï¸âƒ£ Instagram"
          },
          "typeVersion": 1
        },
        {
          "id": "781df8c5-0b06-42a4-bbe9-6948ae345599",
          "name": "Instagram",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            40,
            -1540
          ],
          "parameters": {
            "name": "create_instagram_posts_tool",
            "fields": {
              "values": [
                {
                  "name": "route",
                  "stringValue": "=instagram"
                },
                {
                  "name": "user_prompt",
                  "stringValue": "={{ $('When chat message received').item.json.chatInput }}"
                }
              ]
            },
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "description": "Use this tool to create Instagram posts",
            "jsonSchemaExample": ""
          },
          "typeVersion": 1.2
        },
        {
          "id": "8687d1ff-06ee-44c7-a26e-f08da72bbd15",
          "name": "Window Buffer Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            -520,
            -1360
          ],
          "parameters": {},
          "typeVersion": 1.3
        },
        {
          "id": "30cbcc50-e19b-43ea-8f0a-5e2021dc5e48",
          "name": "When Executed by Another Workflow",
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "position": [
            -700,
            -560
          ],
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "user_prompt"
                },
                {
                  "name": "route"
                }
              ]
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "0b9b7f07-d603-4890-96b0-f815feb38185",
          "name": "Sticky Note35",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            220,
            -1640
          ],
          "parameters": {
            "color": 6,
            "height": 240,
            "content": "## 3ï¸âƒ£ Facebook"
          },
          "typeVersion": 1
        },
        {
          "id": "12b17b82-8f98-4d80-9b49-aa9860827e01",
          "name": "Sticky Note36",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            480,
            -1640
          ],
          "parameters": {
            "color": 6,
            "height": 240,
            "content": "## 4ï¸âƒ£ LinkedIn"
          },
          "typeVersion": 1
        },
        {
          "id": "71dc9ccf-3691-4c0d-b53b-f3ff10f382a9",
          "name": "Facebook",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            300,
            -1540
          ],
          "parameters": {
            "name": "create_facebook_posts_tool",
            "fields": {
              "values": [
                {
                  "name": "route",
                  "stringValue": "=facebook"
                },
                {
                  "name": "user_prompt",
                  "stringValue": "={{ $('When chat message received').item.json.chatInput }}"
                }
              ]
            },
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "description": "Use this tool to create Facebook posts",
            "jsonSchemaExample": ""
          },
          "typeVersion": 1.2
        },
        {
          "id": "f953cd87-88a8-451f-841e-78227949b64d",
          "name": "LinkedIn",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            560,
            -1540
          ],
          "parameters": {
            "name": "create_linkedin_posts_tool",
            "fields": {
              "values": [
                {
                  "name": "route",
                  "stringValue": "=linkedin"
                },
                {
                  "name": "user_prompt",
                  "stringValue": "={{ $('When chat message received').item.json.chatInput }}"
                }
              ]
            },
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "description": "Use this tool to create LinkedIn posts",
            "jsonSchemaExample": ""
          },
          "typeVersion": 1.2
        },
        {
          "id": "97b6829d-6c9d-410a-8fa0-d89d884fd76e",
          "name": "Sticky Note37",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -40,
            -1380
          ],
          "parameters": {
            "color": 6,
            "height": 240,
            "content": "## 5ï¸âƒ£Threads"
          },
          "typeVersion": 1
        },
        {
          "id": "463259f7-71b4-492f-b05a-d1a958917d5c",
          "name": "Sticky Note38",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            220,
            -1380
          ],
          "parameters": {
            "color": 6,
            "height": 240,
            "content": "## 6ï¸âƒ£YouTube Shorts"
          },
          "typeVersion": 1
        },
        {
          "id": "0cd9003b-8eeb-4e4a-9f1f-5f6b611d5194",
          "name": "Short",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            40,
            -1280
          ],
          "parameters": {
            "name": "create_threads_posts_tool",
            "fields": {
              "values": [
                {
                  "name": "route",
                  "stringValue": "=threads"
                },
                {
                  "name": "user_prompt",
                  "stringValue": "={{ $('When chat message received').item.json.chatInput }}"
                }
              ]
            },
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "description": "Use this tool to create Threads posts",
            "jsonSchemaExample": ""
          },
          "typeVersion": 1.2
        },
        {
          "id": "54c2bf4b-8053-4e9d-beb4-570db66f9bd4",
          "name": "YouTube Short",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            300,
            -1280
          ],
          "parameters": {
            "name": "create_youtube_short_tool",
            "fields": {
              "values": [
                {
                  "name": "route",
                  "stringValue": "=youtube_short"
                },
                {
                  "name": "user_prompt",
                  "stringValue": "={{ $('When chat message received').item.json.chatInput }}"
                },
                {
                  "name": "llm",
                  "stringValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Value', ``, 'string') }}"
                }
              ]
            },
            "workflowId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $workflow.id }}"
            },
            "description": "Use this tool to create a YouTube short",
            "jsonSchemaExample": ""
          },
          "typeVersion": 1.2
        },
        {
          "id": "a72c3242-3a8b-444f-9623-fbcb0b47a817",
          "name": "Sticky Note18",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -340,
            -1720
          ],
          "parameters": {
            "color": 7,
            "width": 1100,
            "height": 620,
            "content": "## Social Media Agent Tools"
          },
          "typeVersion": 1
        },
        {
          "id": "586a33ae-3546-4b31-9235-9a8fcfd28598",
          "name": "Sticky Note25",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -500,
            -940
          ],
          "parameters": {
            "color": 6,
            "width": 3520,
            "height": 820,
            "content": "# ðŸ­Social Media Content Factory"
          },
          "typeVersion": 1
        },
        {
          "id": "153da903-fcd3-4694-aaa4-bef2b300d158",
          "name": "pollinations.ai1",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueErrorOutput",
          "maxTries": 5,
          "position": [
            1440,
            -560
          ],
          "parameters": {
            "url": "=https://image.pollinations.ai/prompt/{{ $json.output.common_schema.image_suggestion.replaceAll(' ','-').replaceAll(',','').replaceAll('.','').slice(0,100) }}",
            "options": {}
          },
          "retryOnFail": true,
          "typeVersion": 4.2
        },
        {
          "id": "6c114f0b-1395-4fe6-8de7-0b3d0d9fd6b2",
          "name": "Sticky Note26",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1340,
            -720
          ],
          "parameters": {
            "color": 7,
            "width": 300,
            "height": 340,
            "content": "## Create Post Image\nhttps://pollinations.ai/\nhttps://image.pollinations.ai/prompt/[your image description]\n\n"
          },
          "typeVersion": 1
        },
        {
          "id": "e196ea9b-f5d0-4fa6-a3d9-bea2f98fd872",
          "name": "Save Image to imgbb.com",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1760,
            -680
          ],
          "parameters": {
            "url": "https://api.imgbb.com/1/upload",
            "method": "POST",
            "options": {
              "redirect": {
                "redirect": {}
              }
            },
            "sendBody": true,
            "sendQuery": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "image",
                  "parameterType": "formBinaryData",
                  "inputDataFieldName": "data"
                }
              ]
            },
            "queryParameters": {
              "parameters": [
                {
                  "name": "expiration",
                  "value": "0"
                },
                {
                  "name": "key",
                  "value": "={{ $env.IMGBB_API_KEY}} "
                }
              ]
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "225e34be-26ee-40d7-88d6-e866420e083a",
          "name": "Sticky Note41",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1980,
            -2280
          ],
          "parameters": {
            "width": 340,
            "height": 180,
            "content": "ðŸ’¡Notes\n\nUpdate all Social Media Platform Credentials as required.\n\nAdjust parameters and content for each platform to suit your needs."
          },
          "typeVersion": 1
        },
        {
          "id": "2f48f19d-92c1-478a-b7fa-3fc3b1100993",
          "name": "Sticky Note42",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1240,
            -1760
          ],
          "parameters": {
            "color": 4,
            "width": 400,
            "height": 360,
            "content": "# ðŸ‘ Approve Content Before Proceeding"
          },
          "typeVersion": 1
        },
        {
          "id": "ce4e9f3c-801a-478e-8ffc-008c5e7d4e49",
          "name": "Gmail",
          "type": "n8n-nodes-base.gmail",
          "position": [
            2640,
            -780
          ],
          "webhookId": "cfc2a53d-14a7-47e1-8385-c0b0792d9843",
          "parameters": {
            "sendTo": "={{ $env.TELEGRAM_CHAT_ID }}",
            "message": "={{ $json.output }}",
            "options": {
              "appendAttribution": false
            },
            "subject": "=Social Media Content - {{ $('Social Content').item.json.output.title }}"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "1xpVDEQ1yx8gV022",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "31ee0735-c863-476c-9c4a-41b50ae9c61a",
          "name": "Social Media Schema",
          "type": "n8n-nodes-base.googleDocs",
          "position": [
            -320,
            -700
          ],
          "parameters": {
            "operation": "get",
            "documentURL": "=12345"
          },
          "credentials": {
            "googleDocsOAuth2Api": {
              "id": "YWEHuG28zOt532MQ",
              "name": "Google Docs account"
            }
          },
          "typeVersion": 2
        },
        {
          "id": "18cfde4e-2637-496c-acca-070bdb84c2ba",
          "name": "Social Media System Prompt",
          "type": "n8n-nodes-base.googleDocs",
          "position": [
            -320,
            -420
          ],
          "parameters": {
            "operation": "get",
            "documentURL": "=12345"
          },
          "credentials": {
            "googleDocsOAuth2Api": {
              "id": "YWEHuG28zOt532MQ",
              "name": "Google Docs account"
            }
          },
          "typeVersion": 2
        },
        {
          "id": "383ce472-ccf8-47fb-aa36-5b8aacbcd64f",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -440,
            -840
          ],
          "parameters": {
            "color": 7,
            "width": 1120,
            "height": 640,
            "content": "## Prompt & Schema Composition from External Sources"
          },
          "typeVersion": 1
        },
        {
          "id": "8d2a2a64-bbaa-4692-94ed-2f541d0d40ca",
          "name": "gpt-40-mini",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            2320,
            -600
          ],
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini",
              "cachedResultName": "gpt-4o-mini"
            },
            "options": {
              "responseFormat": "text"
            }
          },
          "credentials": {
            "openAiApi": {
              "id": "jEMSvKmtYfzAkhe6",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "6e5faa4d-25a1-4dbe-998e-3255ed181ac5",
          "name": "Instagram Image",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueRegularOutput",
          "position": [
            2440,
            -1940
          ],
          "parameters": {
            "url": "https://graph.facebook.com/v20.0/[your-unique-id]/media",
            "method": "POST",
            "options": {},
            "sendQuery": true,
            "authentication": "predefinedCredentialType",
            "queryParameters": {
              "parameters": [
                {
                  "name": "image_url",
                  "value": "={{ $json.output.social_image.medium.url }}"
                },
                {
                  "name": "caption",
                  "value": "={{ $json.output.caption }}"
                }
              ]
            },
            "nodeCredentialType": "facebookGraphApi"
          },
          "credentials": {
            "facebookGraphApi": {
              "id": "PzDfmiwB7GPtmSaP",
              "name": "Facebook Graph account"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "958793c8-7a74-498f-ac75-256232469fbc",
          "name": "X Post",
          "type": "n8n-nodes-base.twitter",
          "onError": "continueRegularOutput",
          "position": [
            2640,
            -2180
          ],
          "parameters": {
            "text": "={{ $json.data.social_content.schema.post }}",
            "additionalFields": {}
          },
          "credentials": {
            "twitterOAuth2Api": {
              "id": "wRDruLTCqjQ7C5jq",
              "name": "X account"
            }
          },
          "typeVersion": 2,
          "alwaysOutputData": true
        },
        {
          "id": "1f04a4b5-e97d-4574-abdb-270265da77fa",
          "name": "Instragram Post",
          "type": "n8n-nodes-base.facebookGraphApi",
          "onError": "continueRegularOutput",
          "position": [
            2640,
            -2000
          ],
          "parameters": {
            "edge": "media_publish",
            "node": "[your-unique-id]",
            "options": {
              "queryParameters": {
                "parameter": [
                  {
                    "name": "creation_id",
                    "value": "={{ $json.id }}"
                  },
                  {
                    "name": "caption",
                    "value": "={{ $('Social Media Publishing Router').item.json.output.caption }}"
                  }
                ]
              }
            },
            "graphApiVersion": "v20.0",
            "httpRequestMethod": "POST"
          },
          "credentials": {
            "facebookGraphApi": {
              "id": "PzDfmiwB7GPtmSaP",
              "name": "Facebook Graph account"
            }
          },
          "typeVersion": 1,
          "alwaysOutputData": true
        },
        {
          "id": "92a917ff-d20d-4bbc-be8f-00e17be83ea2",
          "name": "Facebook Post",
          "type": "n8n-nodes-base.facebookGraphApi",
          "onError": "continueRegularOutput",
          "position": [
            2640,
            -1820
          ],
          "parameters": {
            "edge": "photos",
            "node": "[your-unique-id]",
            "options": {
              "queryParameters": {
                "parameter": [
                  {
                    "name": "message",
                    "value": "={{ $json.output.post }}\n\n{{ $json.output.call_to_action }}\n"
                  }
                ]
              }
            },
            "sendBinaryData": true,
            "graphApiVersion": "v20.0",
            "httpRequestMethod": "POST",
            "binaryPropertyName": "data"
          },
          "credentials": {
            "facebookGraphApi": {
              "id": "PzDfmiwB7GPtmSaP",
              "name": "Facebook Graph account"
            }
          },
          "typeVersion": 1,
          "alwaysOutputData": true
        },
        {
          "id": "6c80332d-1aaf-4f3a-91fd-58c25f20ee0c",
          "name": "LinkedIn Post",
          "type": "n8n-nodes-base.linkedIn",
          "onError": "continueRegularOutput",
          "position": [
            2640,
            -1640
          ],
          "parameters": {
            "text": "={{ $json.data.social_content.schema.post }}\n{{ $json.data.social_content.schema.call_to_action }}\n{{ $json.data.social_content.common_schema.hashtags }}\n",
            "postAs": "organization",
            "organization": "12345678",
            "additionalFields": {},
            "binaryPropertyName": "=data",
            "shareMediaCategory": "IMAGE"
          },
          "credentials": {
            "linkedInOAuth2Api": {
              "id": "WMm6pzAEgNd4wJdO",
              "name": "LinkedIn account"
            }
          },
          "typeVersion": 1,
          "alwaysOutputData": true
        },
        {
          "id": "f9d80261-8543-4a12-969c-eecd58513ef2",
          "name": "Gmail User for Approval",
          "type": "n8n-nodes-base.gmail",
          "position": [
            1380,
            -1600
          ],
          "webhookId": "abfae12d-ddcf-4981-ad33-bb7a8cc115a2",
          "parameters": {
            "sendTo": "={{ $env.TELEGRAM_CHAT_ID }}",
            "message": "={{ $json.output }}",
            "options": {
              "limitWaitTime": {
                "values": {
                  "resumeUnit": "minutes",
                  "resumeAmount": 45
                }
              }
            },
            "subject": "=ðŸ”¥FOR APPROVALðŸ”¥ {{$('Extract as JSON').item.json.data.social_content.root_schema.name  }}",
            "operation": "sendAndWait",
            "approvalOptions": {
              "values": {
                "approvalType": "double"
              }
            }
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "1xpVDEQ1yx8gV022",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "97c2dec9-9e1e-4a42-9538-8a37392114e6",
          "name": "Get Social Post Image",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1640,
            -1340
          ],
          "parameters": {
            "url": "={{ $('Extract as JSON').item.json.data.social_image.medium.url }}",
            "options": {}
          },
          "retryOnFail": true,
          "typeVersion": 4.2
        },
        {
          "id": "b5b6b7b9-d275-4c1a-a3c5-195b13be1538",
          "name": "gpt-40-mini1",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            860,
            -1420
          ],
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini",
              "cachedResultName": "gpt-4o-mini"
            },
            "options": {
              "responseFormat": "text"
            }
          },
          "credentials": {
            "openAiApi": {
              "id": "jEMSvKmtYfzAkhe6",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "0b5b8237-9e34-44b7-82d9-372a12c67546",
          "name": "gpt-4o-mini",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            780,
            -360
          ],
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini",
              "cachedResultName": "gpt-4o-mini"
            },
            "options": {
              "responseFormat": "json_object"
            }
          },
          "credentials": {
            "openAiApi": {
              "id": "jEMSvKmtYfzAkhe6",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "df61bbeb-1432-434b-9993-18362dba097f",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1840,
            -1220
          ],
          "parameters": {
            "color": 5,
            "width": 760,
            "height": 1540,
            "content": "<system>\nYou are a specialized content creation AI for social media platforms.\nYour primary function is generating platform-optimized social media content across various platforms including LinkedIn, Instagram, Facebook, Twitter (X), Threads, and YouTube Shorts. Each piece of content must:\nMatch the specific platform's audience expectations and algorithm preferences\nShowcase relevant expertise in your field\nDeliver actionable insights for your target audience\nDrive meaningful engagement through value-driven content\nOBJECTIVES:\nCreate platform-specific content following each platform's best practices\nImplement strategic hashtag usage combining general and trending tags\nDesign content that encourages user interaction and community building\nMaintain consistent brand voice while adapting to platform requirements\nIncorporate data-driven insights to maximize content performance\nOUTPUT REQUIREMENTS:\nDeliver content in valid JSON format according to the platform-specific schema\nInclude all required fields as specified in the schema\nOmit any explanatory text or code fencing in your response\nTailor content specifically to the platform indicated in the user's request\nFor each content request, adapt your output based on the platform guidelines.  Never provide URLS for video or image suggestions and only describe the suggestion.\n</system>\n\n\n<rules>\nOnly provide final response in valid JSON for the appropriate social platform\nNever include any preamble or further explanation\nAlways remove any ``` ```json\n</rules>\n\n\n<linkedin>\n**Style**: Professional and insightful.\n**Tone**: Business-oriented; focus on automation use cases, industry insights, and community impact.\n**Content Length**: 3-4 sentences; concise but detailed.\n**Hashtags**: #Innovation #Automation #WorkflowSolutions #DigitalTransformation #Leadership\n**Call to Action (CTA)**: Encourage comments or visits to workflows.diy's website for more insights.\n</linkedin>\n\n<instagram>\n**Style**: Visual storytelling with creative captions.\n**Tone**: Inspirational and engaging; use emojis for relatability.\n**Content Length**: 2-3 sentences paired with eye-catching visuals (e.g., infographics or workflow demos).\n**Visuals**: Showcase milestones (e.g., new workflow launches), tutorials, or product highlights.\n**CTA**: Use phrases like \"Swipe to learn more,\" \"Tag your team,\" or \"Check out the link below!\"\n**Link Placement**: Add the provided link before hashtags; if no link is provided, use \"Visit our website: https://example.com\"\n**Hashtags**: #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering\n</instagram>\n\n<facebook>\n**Style**: Friendly and community-focused.\n**Tone**: Relatable; highlight user success stories or company achievements in automation.\n**Content Length**: 2-3 sentences; conversational yet professional.\n**Hashtags**: #SmallBusinessAutomation #Entrepreneurship #Leadership #WorkflowInnovation\n**CTA**: Encourage likes, shares, comments (e.g., \"What's your favorite automation tip?\").\n</facebook>\n\n<xtwitter>\n**Style**: Concise and impactful.\n**Tone**: Crisp and engaging; spark curiosity in 150 characters or less.\n**Hashtags**: #WorkflowTrends #AIWorkflows #AutomationTips #NoCodeSolutions\n**CTA**: Drive quick engagement through retweets or replies (e.g., \"What's your go-to n8n workflow?\").\n</xtwitter>\n\n<threads>\n**Style**: Conversational and community-driven posts.\n**Tone**: Casual yet informative; encourage discussions around automation trends or innovations.\n**Content Length**: 1-2 short paragraphs with a question or thought-provoking statement at the end.\n**Hashtags**: Similar to Instagram but tailored for trending Threads topics related to automation.\n</threads>\n\n<youtube_short>\n**Style**: Short-form video content showcasing quick workflow tutorials or use cases.\n**Tone**: Authoritative yet approachable; establish workflows.diy as a leader in n8n automation solutions.\n**Content Length**:\n  Tutorials/Reviews (long-form): 5-10 minutes\n  Shorts/Highlights (short-form): Under 1 minute\n**CTA**: Encourage subscriptions, likes, comments (e.g., \"Subscribe for more workflow tips!\").\n</youtube_short>\n\n\n\n\n"
          },
          "typeVersion": 1
        },
        {
          "id": "ddf3d7d3-0218-4ba0-b990-34a6220a53fa",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1060,
            -1220
          ],
          "parameters": {
            "color": 3,
            "height": 1540,
            "content": "<common>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"hashtags\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"string\"\n            }\n        },\n        \"image_suggestion\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</common>\n\n<root>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"type\": \"string\"\n        },\n        \"description\": {\n            \"type\": \"string\"\n        },\n        \"additional_notes\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</root>\n\n<linkedin>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"post\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</linkedin>\n\n<instagram>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"caption\": {\n            \"type\": \"string\"\n        },\n        \"emojis\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"string\"\n            }\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</instagram>\n\n<facebook>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"post\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</facebook>\n\n<xtwitter>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"video_suggestion\": {\n            \"type\": \"string\"\n        },\n        \"post\": {\n            \"type\": \"string\"\n        },\n        \"character_limit\": {\n            \"type\": \"integer\"\n        }\n    }\n}\n</xtwitter>\n\n<threads>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"text_post\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</threads>\n\n<youtube_short>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"video_suggestion\": {\n            \"type\": \"string\"\n        },\n        \"title\": {\n            \"type\": \"string\"\n        },\n        \"description\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</youtube_short>\n\n\n\n"
          },
          "typeVersion": 1
        },
        {
          "id": "72b378bd-6035-45da-8c76-ddd897d107c7",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -400,
            -480
          ],
          "parameters": {
            "color": 5,
            "width": 260,
            "height": 240,
            "content": "### ðŸ‘ˆSystem Prompt"
          },
          "typeVersion": 1
        },
        {
          "id": "ba60e52d-722a-4f07-86b4-f4ea64cb2bab",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -400,
            -760
          ],
          "parameters": {
            "color": 3,
            "width": 260,
            "height": 240,
            "content": "### ðŸ‘ˆSocial Media Schema"
          },
          "typeVersion": 1
        },
        {
          "id": "bc1ff038-26ad-44d6-94d1-2c1f72a9bf87",
          "name": "Schema",
          "type": "n8n-nodes-base.set",
          "position": [
            -60,
            -700
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "9d6d41f2-7216-4659-af34-7215298494d9",
                  "name": "schema",
                  "type": "string",
                  "value": "={{ $json.content }}"
                },
                {
                  "id": "7d8c85f5-3f4a-4d72-bef0-0957c6ce82a4",
                  "name": "platform",
                  "type": "string",
                  "value": "={{ $('When Executed by Another Workflow').item.json.route }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "777d231c-f69c-4b48-bec5-6674175703bc",
          "name": "System Prompt",
          "type": "n8n-nodes-base.set",
          "position": [
            -60,
            -420
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "5f789b37-b021-4cd4-b359-fdfbb9b71c2b",
                  "name": "system_prompt_doc_id",
                  "type": "string",
                  "value": "={{ $json.documentId }}"
                },
                {
                  "id": "daac5758-38ad-4afe-966b-a9b4b89691b2",
                  "name": "system_prompt",
                  "type": "string",
                  "value": "={{ $json.content }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "3813a552-cf99-49ca-9617-7eaac56f6819",
          "name": "Parse Schema",
          "type": "n8n-nodes-base.code",
          "position": [
            140,
            -700
          ],
          "parameters": {
            "jsCode": "// Get the input data from previous node\nconst inputData = $input.first().json;\nconst xmlString = inputData.schema;\n\nconsole.log(inputData)\n\n// Function to extract content between XML tags with better regex handling\nfunction extractFromXmlTags(xmlString, tagName) {\n  const regex = new RegExp(`<${tagName}>(.*?)<\\/${tagName}>`, 'gs');\n  const match = regex.exec(xmlString);\n  return match ? match[1].trim() : null;\n}\n\n// Get the platform from the input or use a default\nconst platform = inputData.platform;\n\n// Extract the content from the specified tag\nconst extractedContent = extractFromXmlTags(xmlString, platform);\nconst rootContent = extractFromXmlTags(xmlString, 'root');\nconst commonContent = extractFromXmlTags(xmlString, 'common');\n\njsonData = JSON.parse(extractedContent);\nrootSchema = JSON.parse(rootContent);\ncommonSchema = JSON.parse(commonContent);\n\n// Return the result\nreturn {\n  json: {\n    schema: jsonData,\n    root_schema: rootSchema,\n    common_schema: commonSchema\n  }\n};\n"
          },
          "typeVersion": 2
        },
        {
          "id": "c55da4a1-91f8-4d17-ad73-730013a99231",
          "name": "Parse System Prompt",
          "type": "n8n-nodes-base.code",
          "position": [
            140,
            -420
          ],
          "parameters": {
            "jsCode": "// Get the input data from previous node\nconst inputData = $input.first().json;\nconst xmlString = inputData.system_prompt;\n\n// Function to extract all content between XML tags\nfunction extractAllXmlTags(xmlString) {\n  // Create a result object to store tag contents\n  const result = {};\n  \n  // Regular expression to find all XML tags and their content\n  // This regex matches opening tag, content, and closing tag\n  const tagRegex = /<([^>\\/]+)>([\\s\\S]*?)<\\/\\1>/g;\n  \n  // Find all matches\n  let match;\n  while ((match = tagRegex.exec(xmlString)) !== null) {\n    const tagName = match[1].trim();\n    const content = match[2].trim();\n    \n    // Store the content with the tag name as the key\n    result[tagName] = content;\n  }\n  \n  return result;\n}\n\n// Extract all XML tags and their content\nconst extractedTags = extractAllXmlTags(xmlString);\n\n// Return the result as a JSON object\nreturn {\n  json: {\n    system_config: extractedTags\n  }\n};\n"
          },
          "typeVersion": 2
        },
        {
          "id": "1767c787-943b-43d6-86cb-3fb60eaf878e",
          "name": "Compose Prompt & Schema",
          "type": "n8n-nodes-base.set",
          "position": [
            520,
            -560
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "9216ad1c-a281-4c94-835d-e20507ef0cb5",
                  "name": "route",
                  "type": "string",
                  "value": "={{ $json.route }}"
                },
                {
                  "id": "e6ca5cdf-5139-4db7-b065-ee52028216c5",
                  "name": "user_prompt",
                  "type": "string",
                  "value": "={{ $json.user_prompt }}"
                },
                {
                  "id": "2927cd6f-c351-49df-954b-9f87b0338c58",
                  "name": "system_config.system",
                  "type": "string",
                  "value": "={{ $json.system_config.system }}"
                },
                {
                  "id": "829b1519-9ffa-44d7-8caa-455e15b30614",
                  "name": "system_config.rules",
                  "type": "string",
                  "value": "={{ $json.system_config.rules }}"
                },
                {
                  "id": "b44472ba-6e98-448b-bad6-e02da8b32b0a",
                  "name": "={{ $json.route }}",
                  "type": "string",
                  "value": "={{ $json.system_config[$json.route.toLowerCase()] }}"
                },
                {
                  "id": "a96e8c30-1d44-4e23-9ef4-95d7303ea41e",
                  "name": "root_schema",
                  "type": "object",
                  "value": "={{ $json.root_schema }}"
                },
                {
                  "id": "6cb68192-10f3-496d-88ca-289ee0c19940",
                  "name": "common_schema",
                  "type": "object",
                  "value": "={{ $json.common_schema }}"
                },
                {
                  "id": "8f9b85f0-abaa-46c2-ba98-897f6a677105",
                  "name": "schema",
                  "type": "object",
                  "value": "={{ $json.schema }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "b7d78f57-ee83-4e03-ada6-fd6e2048c272",
          "name": "Social Media Content Creator",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            800,
            -560
          ],
          "parameters": {
            "text": "=Social Media Platform: {{ $json.route }}\nUser Prompt: {{ $json.user_prompt }}\n",
            "options": {
              "systemMessage": "={{ $json.system_config.system }}\n\n<tools>\nYou have been provided with an internet search tool.  Use this tool to find relavent information about the users request before responding.  Todays date is: {{ $now }}\n</tools>\n\n<rules>\n{{ $json.system_config.rules }}\n- Output must conform to provided JSON schema\n</rules>\n\nFollow this Output JSON Schema:\n{\n  root_schema: {{ $json.root_schema.toJsonString() }},\n  common_schema: {{ $json.common_schema.toJsonString()}},\n  schema: {{  $json.schema.toJsonString() }}\n}"
            },
            "promptType": "define"
          },
          "typeVersion": 1.7
        },
        {
          "id": "35469698-0eb5-4238-85d1-c67ccbacf2cb",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1880,
            -1400
          ],
          "parameters": {
            "color": 7,
            "width": 1100,
            "height": 1760,
            "content": "# External System Prompt and Schema"
          },
          "typeVersion": 1
        },
        {
          "id": "12b55edd-ff51-423b-a153-96a8a2a09678",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2380,
            -2280
          ],
          "parameters": {
            "color": 6,
            "width": 700,
            "height": 1240,
            "content": "# ðŸ“„ Publish to Social Media "
          },
          "typeVersion": 1
        },
        {
          "id": "78cd8af0-c10c-4bf5-8420-63061e7687bc",
          "name": "Merge Prompts and Schema",
          "type": "n8n-nodes-base.merge",
          "position": [
            340,
            -560
          ],
          "parameters": {
            "mode": "combine",
            "options": {},
            "combineBy": "combineByPosition",
            "numberInputs": 3
          },
          "typeVersion": 3
        },
        {
          "id": "e7a62296-729b-45df-bd15-002ccaae2fa0",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            720,
            -680
          ],
          "parameters": {
            "width": 400,
            "height": 480,
            "content": "## Social Media Content Creator"
          },
          "typeVersion": 1
        },
        {
          "id": "f6cb5a95-4047-4e41-a635-a73681fe6d8b",
          "name": "Social Content",
          "type": "n8n-nodes-base.set",
          "position": [
            1180,
            -560
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "8c318996-aa79-4970-b8d7-33ae1931c8c6",
                  "name": "output",
                  "type": "object",
                  "value": "={{ $json.output }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "148df311-24db-4243-bc62-1a51579720d7",
          "name": "Save Image to Google Drive",
          "type": "n8n-nodes-base.googleDrive",
          "position": [
            1760,
            -480
          ],
          "parameters": {
            "name": "={{ $json.output.root_schema.name.replaceAll(' ','-').replaceAll(',','').replaceAll('.','') }}",
            "driveId": {
              "__rl": true,
              "mode": "id",
              "value": "=My Drive"
            },
            "options": {},
            "folderId": {
              "__rl": true,
              "mode": "id",
              "value": "=12345"
            }
          },
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "UhdXGYLTAJbsa0xX",
              "name": "Google Drive account"
            }
          },
          "typeVersion": 3
        },
        {
          "id": "f84ab889-d193-4d9a-8e8b-4f35805edaa4",
          "name": "Merge",
          "type": "n8n-nodes-base.merge",
          "position": [
            1980,
            -560
          ],
          "parameters": {
            "mode": "combine",
            "options": {
              "includeUnpaired": true
            },
            "combineBy": "combineByPosition",
            "numberInputs": 3
          },
          "typeVersion": 3
        },
        {
          "id": "ca43646b-ca79-4ff6-ac02-da4f668e7aeb",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2200,
            -880
          ],
          "parameters": {
            "color": 7,
            "width": 660,
            "height": 420,
            "content": "## Send Social Media Image and Post Contents to Gmail\n(optional)"
          },
          "typeVersion": 1
        },
        {
          "id": "cf7bda38-260f-42c0-b60a-6a93181712de",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2120,
            -420
          ],
          "parameters": {
            "color": 7,
            "width": 840,
            "height": 260,
            "content": "## Prepare Social Media Post and Save to Google Drive"
          },
          "typeVersion": 1
        },
        {
          "id": "13cafb9c-5f04-4193-8f0e-0384f68d5e45",
          "name": "Save Social Post to Google Drive",
          "type": "n8n-nodes-base.googleDrive",
          "position": [
            2560,
            -340
          ],
          "parameters": {
            "name": "={{ $json.response.google_drive_image.id }}",
            "content": "={{ $json.response.toJsonString() }}",
            "driveId": {
              "__rl": true,
              "mode": "list",
              "value": "My Drive"
            },
            "options": {},
            "folderId": {
              "__rl": true,
              "mode": "id",
              "value": "= 12345"
            },
            "operation": "createFromText"
          },
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "UhdXGYLTAJbsa0xX",
              "name": "Google Drive account"
            }
          },
          "typeVersion": 3
        },
        {
          "id": "2bdecf8d-e180-4795-92c2-6158adf71daf",
          "name": "Google Drive Image Meta",
          "type": "n8n-nodes-base.set",
          "position": [
            2200,
            -340
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "769d86e6-3764-4023-8932-f25f7d4fe34a",
                  "name": "id",
                  "type": "string",
                  "value": "={{ $json.id }}"
                },
                {
                  "id": "4ccae0cc-d246-477c-9e94-3be461134d01",
                  "name": "webContentLink",
                  "type": "string",
                  "value": "={{ $json.webContentLink }}"
                },
                {
                  "id": "74e22694-c7e6-4598-8e87-8ea6ae00144e",
                  "name": "webViewLink",
                  "type": "string",
                  "value": "={{ $json.webViewLink }}"
                },
                {
                  "id": "e8eedbbf-7d42-475b-a748-0afbe8b730da",
                  "name": "thumbnailLink",
                  "type": "string",
                  "value": "={{ $json.thumbnailLink }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "d6e4902a-af19-45a4-8253-432135e17998",
          "name": "Social Post JSON",
          "type": "n8n-nodes-base.set",
          "position": [
            2380,
            -340
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "b705af39-d286-4461-956c-d963ea151734",
                  "name": "response",
                  "type": "object",
                  "value": "={ \n  \"route\": \"{{ $('When Executed by Another Workflow').item.json.route }}\",\n \"social_image\": {{ $('Merge').item.json.data.toJsonString()  }},\n  \"social_content\": {{ $('Social Content').item.json.output.toJsonString() }},\n  \"google_drive_image\": {{ $json.toJsonString() }}\n}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "b35623e6-9ddc-4091-905f-7b485efc5d60",
          "name": "Respond with Google Drive Id",
          "type": "n8n-nodes-base.set",
          "position": [
            2740,
            -340
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "ad353ca7-059a-4108-88b9-fb92720a34fe",
                  "name": "response",
                  "type": "string",
                  "value": "={{ $json.id }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "410c3924-1011-480d-874c-a395c243f4c6",
          "name": "Telegram Success Message (Optional)",
          "type": "n8n-nodes-base.telegram",
          "position": [
            1760,
            -880
          ],
          "webhookId": "93342863-02c0-42ee-98c3-a2ec72b3bf12",
          "parameters": {
            "text": "Image created successfully",
            "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "credentials": {
            "telegramApi": {
              "id": "pAIFhguJlkO3c7aQ",
              "name": "Telegram account"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "eba8445d-55da-43e2-b2aa-4822168a70ea",
          "name": "Telegram Error Message (Optional)",
          "type": "n8n-nodes-base.telegram",
          "position": [
            1760,
            -300
          ],
          "webhookId": "93342863-02c0-42ee-98c3-a2ec72b3bf12",
          "parameters": {
            "text": "Error creating image (Debugging)",
            "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
            "additionalFields": {
              "appendAttribution": false
            }
          },
          "credentials": {
            "telegramApi": {
              "id": "pAIFhguJlkO3c7aQ",
              "name": "Telegram account"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "af2c4945-0dac-4398-b8ad-329066eefedd",
          "name": "Social Media Publishing Router",
          "type": "n8n-nodes-base.switch",
          "position": [
            2080,
            -1900
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "1ï¸âƒ£X-Twitter",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.data.route }}",
                        "rightValue": "xtwitter"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": " 2ï¸âƒ£Instagram",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "86d44336-bab7-422f-9266-fcb513252d19",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.data.route }}",
                        "rightValue": "instagram"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": " 3ï¸âƒ£Facebook",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "29f37628-6381-46af-babb-74bf00b4a849",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.data.route }}",
                        "rightValue": "facebook"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "4ï¸âƒ£Linkedin",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "fdb7c8aa-4108-43f6-8f6b-71cd8f383d2a",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.data.route }}",
                        "rightValue": "=linkedin"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "5ï¸âƒ£Threads",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "956baedd-4a0b-4e41-b85c-ef2c84332bdc",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.data.route }}",
                        "rightValue": "threads"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "6ï¸âƒ£YouTube Short",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "4d690442-197c-4ff9-b176-b55dfabaecc9",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.data.route }}",
                        "rightValue": "youtube_short"
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 3.2
        },
        {
          "id": "682ee752-8e7f-4ee5-b617-88d7c1f7d4e7",
          "name": "Prepare Email Contents",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            880,
            -1600
          ],
          "parameters": {
            "text": "=Use the HTML template and populate [fields] as required from this: {{ $json.data.social_content.toJsonString() }}\n-----\nOnly output HTML without code block tags, preamble or further explanation in the format provided.\n\n## HTML Template\n<table style=\"max-width:640px;min-width:320px;width:100%;border-collapse:collapse;font-family:Arial,sans-serif;margin:20px auto\">\n    <tbody>\n        <tr>\n            <td colspan=\"2\" style=\"background-color:#ffffff;padding:15px;text-align:left\">\n                <img src=\"{{ $json.data.google_drive_image.thumbnailLink }}\" alt=\"{{ $json.data.social_content.root_schema.name }}\" style=\"max-width:100%;height:auto;\">\n            </td>\n        </tr>\n        <tr>\n            <td colspan=\"2\" style=\"background-color:#efefef;padding:15px;font-size:20px;text-align:left;font-weight:bold\">\n                {{ $json.data.social_content.root_schema.name }}\n            </td>\n        </tr>\n        <tr>\n            <td style=\"background-color:#f9f9f9;padding:15px;width:30%;text-align:left\"><strong>[label_1]:</strong></td>\n            <td style=\"background-color:#f9f9f9;padding:15px;text-align:left\">[content_1]</td>\n        </tr>\n        <tr>\n            <td style=\"background-color:#f1f1f1;padding:15px;text-align:left\"><strong>[label_2]:</strong></td>\n            <td style=\"background-color:#f1f1f1;padding:15px;text-align:left\">[content_2]</td>\n        </tr>\n\n        [continue the pattern ...]\n\n        <tr>\n            <td colspan=\"2\" style=\"background-color:#efefef;padding:15px;text-align:left\">\n                <strong>[footer_label]:</strong> [footer_content]\n            </td>\n        </tr>\n    </tbody>\n</table>\n\n",
            "options": {},
            "promptType": "define"
          },
          "typeVersion": 1.7
        },
        {
          "id": "eeab0159-cb24-4653-ba14-461740c8753c",
          "name": "Is Approved?",
          "type": "n8n-nodes-base.if",
          "position": [
            1380,
            -1340
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "313cec9b-aad5-4f9c-a209-afe83af53df0",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.data.approved }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "dbe7cd63-9ec0-46cd-9255-8c1dc738847d",
          "name": "File Id",
          "type": "n8n-nodes-base.set",
          "position": [
            1200,
            -2080
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "efb1c03b-8465-443d-a442-b76b8cd86a73",
                  "name": "output",
                  "type": "object",
                  "value": "={{ $json.output }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "cdb01e90-c54c-4ae4-87e2-75a3baec2295",
          "name": "Get Social Post from Google Drive",
          "type": "n8n-nodes-base.googleDrive",
          "position": [
            1380,
            -2080
          ],
          "parameters": {
            "fileId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.output.response }}"
            },
            "options": {},
            "operation": "download"
          },
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "UhdXGYLTAJbsa0xX",
              "name": "Google Drive account"
            }
          },
          "typeVersion": 3
        },
        {
          "id": "aea6ec59-fcf4-4b5a-9fbc-86d9eb834388",
          "name": "Extract as JSON",
          "type": "n8n-nodes-base.extractFromFile",
          "position": [
            1560,
            -2080
          ],
          "parameters": {
            "options": {},
            "operation": "fromJson"
          },
          "typeVersion": 1
        },
        {
          "id": "70ccf82d-3871-40cd-8dc0-961e36acd070",
          "name": "Merge Image and Post Contents",
          "type": "n8n-nodes-base.merge",
          "position": [
            1820,
            -1840
          ],
          "parameters": {
            "mode": "combine",
            "options": {},
            "combineBy": "combineByPosition"
          },
          "typeVersion": 3
        },
        {
          "id": "077f7110-215f-4ccf-8546-41d21c1105ad",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2540,
            -1460
          ],
          "parameters": {
            "width": 320,
            "height": 380,
            "content": ""
          },
          "typeVersion": 1
        },
        {
          "id": "650a4191-6ed6-4868-b433-f44a0ddf959b",
          "name": "Implement Threads Here",
          "type": "n8n-nodes-base.noOp",
          "position": [
            2640,
            -1420
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "59651d51-92ce-42e5-a9c7-4faa18526ef2",
          "name": "Implement YouTube Shorts Here",
          "type": "n8n-nodes-base.noOp",
          "position": [
            2640,
            -1260
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "7cb931d5-d890-4ea6-9fca-84b934dd911c",
          "name": "X Response",
          "type": "n8n-nodes-base.set",
          "position": [
            2840,
            -2180
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "4015bb20-da3b-4781-ab8c-46f4d826138e",
                  "name": "output",
                  "type": "string",
                  "value": "={{ $('Social Media Publishing Router').item.json.data.route }}\n\n{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}\n\n{{ $('Social Media Publishing Router').item.json.data.social_content.schema.post }}\n\n![{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}]({{ $('Social Media Publishing Router').item.json.data.social_image.thumb.url }})"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "90c4faa3-3376-41d1-83e7-0c4c2bc03de5",
          "name": "Instagram Response",
          "type": "n8n-nodes-base.set",
          "position": [
            2840,
            -2000
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "da8fe7e3-e74d-46b6-91eb-1bf4432b73b0",
                  "name": "output",
                  "type": "string",
                  "value": "={{ $('Social Media Publishing Router').item.json.data.route }}  \n{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}\n{{ $('Social Media Publishing Router').item.json.data.social_content.schema.caption }}\n![{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}]({{ $('Social Media Publishing Router').item.json.data.social_image.thumb.url }})"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "de57e2c7-acac-4268-a535-e90f00548956",
          "name": "Facebook Response",
          "type": "n8n-nodes-base.set",
          "position": [
            2840,
            -1820
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "e349e314-2967-456f-856a-85727bdf94f3",
                  "name": "output",
                  "type": "string",
                  "value": "={{ $('Social Media Publishing Router').item.json.data.route }}\n\n{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}\n\n{{ $('Social Media Publishing Router').item.json.data.social_content.schema.post }}\n\n![{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}]({{ $('Social Media Publishing Router').item.json.data.social_image.thumb.url }})"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "030e8933-0eae-4e6c-956d-dce0e702b163",
          "name": "LinkedIn Response",
          "type": "n8n-nodes-base.set",
          "position": [
            2840,
            -1640
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "88404fde-a41b-4da5-bbdb-0e41b879a52c",
                  "name": "output",
                  "type": "string",
                  "value": "={{ $('Social Media Publishing Router').item.json.data.route }}\n\n{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}\n\n{{ $('Social Media Publishing Router').item.json.data.social_content.schema.post }}\n\n![{{ $('Social Media Publishing Router').item.json.data.social_content.root_schema.name }}]({{ $('Social Media Publishing Router').item.json.data.social_image.thumb.url }})\n"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "d48b6b3a-9410-4012-85bf-f70b4e91eccb",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1060,
            -1300
          ],
          "parameters": {
            "color": 3,
            "height": 80,
            "content": "## Social Media Schema"
          },
          "typeVersion": 1
        },
        {
          "id": "e3ef0a13-42ca-4021-aeb5-2230f4ac7eac",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1840,
            -1300
          ],
          "parameters": {
            "color": 5,
            "width": 760,
            "height": 80,
            "content": "## System Prompt"
          },
          "typeVersion": 1
        },
        {
          "id": "11457221-fa5e-41f4-93a5-bb3eea3f02a9",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -120,
            -2200
          ],
          "parameters": {
            "width": 620,
            "height": 320,
            "content": "# Social Media Router Agent"
          },
          "typeVersion": 1
        },
        {
          "id": "f40e9cde-1810-4471-9751-6da724a06f6c",
          "name": "ðŸ¤–Social Media Router Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            60,
            -2080
          ],
          "parameters": {
            "text": "=You are a helpful assistant that uses the provided tools.  Respond with a valid JSON object.\n\nUser prompt:  {{ $json.chatInput }}",
            "options": {
              "systemMessage": "## RULES\n- You do not answer the users questions directly and your sole purpose is to call the appropriate tool to and provide the verbatim response.\n\n## TOOLS\n- create_x_twitter_posts_tool: Use this tool to create X-Twitter posts\n- create_instagram_posts_tool: Use this tool to create Instagram posts\n- create_facebook_posts_tool: Use this tool to create Facebook posts\n- create_linkedin_posts_tool: Use this tool to create LinkedIn posts\n- create_threads_posts_tool: Use this tool to create Threads posts\n- create_youtube_short_tool: Use this tool to create a YouTube short\n\n\n"
            },
            "promptType": "define"
          },
          "typeVersion": 1.7
        },
        {
          "id": "e6715ea6-f70d-427b-bf3d-499ed8040140",
          "name": "Sticky Note14",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            800,
            -1720
          ],
          "parameters": {
            "width": 400,
            "height": 440,
            "content": "## Prepare Email Approval Contents as HTML"
          },
          "typeVersion": 1
        },
        {
          "id": "cbb2a190-8aad-4e09-9d5c-a43dbcb32184",
          "name": "SerpAPI",
          "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
          "position": [
            980,
            -360
          ],
          "parameters": {
            "options": {}
          },
          "credentials": {
            "serpApi": {
              "id": "DfdkTTaZtPp0iHYv",
              "name": "SerpAPI account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "58da1f9e-caa4-4ea2-8b02-3e734758af80",
          "name": "Sticky Note15",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -500,
            -120
          ],
          "parameters": {
            "color": 7,
            "width": 3520,
            "height": 680,
            "content": "# ðŸ’«Features & Benefits"
          },
          "typeVersion": 1
        },
        {
          "id": "e65c6e37-0523-4e7d-b634-d3499aef5516",
          "name": "Sticky Note16",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -440,
            -40
          ],
          "parameters": {
            "color": 7,
            "width": 680,
            "height": 280,
            "content": "## 1ï¸âƒ£System Prompt Composition from External Source\nCentralized prompt management: Store and update system prompts in Google Docs for easy team collaboration\n\n- Consistent brand voice: Ensure all generated content maintains consistent tone and style across platforms\n\n- Flexible customization: Quickly modify prompts without changing workflow code\n\n- Version control: Track changes to prompts over time with Google Docs revision history\n\n- Role-specific access: Control who can edit core prompts while allowing broader viewing access\n"
          },
          "typeVersion": 1
        },
        {
          "id": "b7ccbaa4-3c33-4f32-a72d-fb693b9c63d6",
          "name": "Sticky Note17",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -440,
            260
          ],
          "parameters": {
            "color": 7,
            "width": 680,
            "height": 260,
            "content": "## 2ï¸âƒ£Output Schema Composition from External Source\n- Structured content generation: Enforce consistent JSON output formats for each platform\n\n- Platform-specific optimization: Tailor content structure to each social network's requirements\n\n- Reduced errors: Validate content against schemas before publishing\n\n- Easy updates: Modify schemas as platform requirements change without workflow modifications\n\n- Standardized metadata: Ensure all required fields are included for each platform"
          },
          "typeVersion": 1
        },
        {
          "id": "b36e874a-a893-439d-bd29-524ea567b695",
          "name": "Sticky Note19",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            720,
            -40
          ],
          "parameters": {
            "color": 7,
            "width": 400,
            "height": 520,
            "content": "## 4ï¸âƒ£ Dynamic Social Media Content Creator Agent with Web Search Tool to Match Social Post and Platform Schema\n\n- Real-time research: Incorporate current events and trending topics into content\n\n- Fact-checking: Verify information before publishing to maintain credibility\n\n- Competitive analysis: Reference industry trends and competitor content\n\n- Contextual relevance: Create content that responds to current market conditions\n\n- Enhanced engagement: Generate content that aligns with trending conversations"
          },
          "typeVersion": 1
        },
        {
          "id": "d57e47d1-e95e-45b6-95cf-a8952320da35",
          "name": "Sticky Note23",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1160,
            -40
          ],
          "parameters": {
            "color": 7,
            "width": 340,
            "height": 520,
            "content": "## 5ï¸âƒ£ Dynamic Image Creation to Match Social Post & Platform Schema\n\n- Visual consistency: Generate platform-optimized images that match content themes\n\n- Automated alt text: Create accessibility-compliant image descriptions\n\n- Multi-format output: Generate images in various dimensions for different platforms\n\n- Brand compliance: Ensure all visuals align with brand guidelines\n\n- Reduced design bottlenecks: Eliminate waiting for custom graphics for each post"
          },
          "typeVersion": 1
        },
        {
          "id": "4323fd33-f2ff-434a-bd44-0ecb59fc4962",
          "name": "Sticky Note24",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1520,
            -40
          ],
          "parameters": {
            "color": 7,
            "width": 300,
            "height": 520,
            "content": "## 6ï¸âƒ£ Image Archiving to Multiple Cloud Services for Future Use\n\n- Redundant storage: Prevent content loss with multi-location backups\n\n-Searchable repository: Build a library of past content for reference and reuse\n\n- Asset tracking: Maintain records of which images were used for which campaigns\n\n- Compliance documentation: Keep records of published content for regulatory purposes\n\n- Resource optimization: Reuse successful visual assets for future campaigns"
          },
          "typeVersion": 1
        },
        {
          "id": "e0dc7e2a-275f-4389-973a-e0d92af6de6c",
          "name": "Sticky Note27",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1840,
            -40
          ],
          "parameters": {
            "color": 7,
            "width": 260,
            "height": 520,
            "content": "## 7ï¸âƒ£ Telegram Messaging for Workflow Status \n\n- Real-time notifications: Get immediate alerts about workflow execution\n\n- Error tracking: Quickly identify and address failures in the content pipeline\n\n- Team coordination: Keep stakeholders informed of content progress\n\n- Audit trail: Maintain records of when content was created and published\n\n- Remote monitoring: Track workflow execution from mobile devices"
          },
          "typeVersion": 1
        },
        {
          "id": "0d9940df-faad-4adc-a79f-4b89f2f2d16e",
          "name": "Sticky Note28",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2120,
            -40
          ],
          "parameters": {
            "color": 7,
            "width": 840,
            "height": 280,
            "content": "## 8ï¸âƒ£ Optional Workflow Reporting to Gmail in with Structured HTML Content\n- Executive summaries: Provide management with clean, formatted reports\n\n- Content approval: Enable stakeholders to review content before publishing\n\n- Performance tracking: Document content metrics in standardized formats\n\n- Schedule adherence: Monitor if content is being published according to plan\n\n- Resource allocation: Track time and effort spent on different content types"
          },
          "typeVersion": 1
        },
        {
          "id": "febb3aa7-d0ed-422a-b115-33863889a152",
          "name": "Sticky Note29",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2120,
            260
          ],
          "parameters": {
            "color": 7,
            "width": 840,
            "height": 260,
            "content": "## 9ï¸âƒ£ Social Post Archiving to Google Drive for Future Use\n- Content library: Build a searchable repository of all published content\n\n- Performance correlation: Connect content with its performance metrics\n\n- Compliance records: Maintain documentation of published materials\n\n- Content repurposing: Easily find and adapt past successful content\n\n- Campaign documentation: Group related content for campaign analysis"
          },
          "typeVersion": 1
        },
        {
          "id": "697fab77-d1bb-41d8-8683-193230471721",
          "name": "Sticky Note30",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            260,
            -40
          ],
          "parameters": {
            "width": 420,
            "height": 960,
            "content": "## 3ï¸âƒ£Dynamic System Prompt and Platform Schema Composition based on User Prompt using External Sources\n- Centralized prompt management: Store all system prompts in a single external source for easier maintenance and updates\n\n- Platform-specific optimization: Automatically tailor content to each platform's unique requirements and audience expectations\n\n- Consistent brand voice: Ensure all generated content maintains your brand's tone and messaging guidelines across platforms\n\n- Reduced technical debt: Modify prompts and schemas without changing workflow code or redeploying applications\n\n- Collaborative improvement: Enable marketing teams to refine prompts without developer intervention\n\n- Version control: Track changes to prompts and schemas over time with document revision history\n\n- A/B testing capability: Easily test different prompt variations to optimize content performance\n\n- Scalable content strategy: Add support for new platforms by simply creating new prompt and schema documents\n\n- Dynamic adaptation: Respond to platform algorithm changes by quickly updating external prompt documents\n\n- Knowledge preservation: Maintain institutional knowledge about effective platform-specific content strategies\n\n- Reduced onboarding time: New team members can understand content requirements by reviewing documented prompts\n\n- Compliance management: Ensure all generated content follows legal and brand guidelines by centralizing rules"
          },
          "typeVersion": 1
        },
        {
          "id": "11ba3bef-7036-416b-a63d-a82cf7cbe30f",
          "name": "Prepare Social Media Email Contents",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            2300,
            -780
          ],
          "parameters": {
            "text": "=Use the HTML template and populate [fields] as required from this: {{ $('pollinations.ai1').item.json.output.toJsonString() }}\n-----\nOnly output HTML without code block tags, preamble or further explanation in the format provided.\n\n## HTML Template\n<table style=\"max-width:640px;min-width:320px;width:100%;border-collapse:collapse;font-family:Arial,sans-serif;margin:20px auto\">\n    <tbody>\n        <tr>\n            <td colspan=\"2\" style=\"background-color:#ffffff;padding:15px;text-align:left\">\n                <img src=\"{{ $json.thumbnailLink }}\" alt=\"{{ $json.output.root_schema.name }}\" style=\"max-width:100%;height:auto;\">\n            </td>\n        </tr>\n        <tr>\n            <td colspan=\"2\" style=\"background-color:#efefef;padding:15px;font-size:20px;text-align:left;font-weight:bold\">\n                {{ $json.output.root_schema.name  }}\n            </td>\n        </tr>\n        <tr>\n            <td style=\"background-color:#f9f9f9;padding:15px;width:30%;text-align:left\"><strong>Platform:</strong></td>\n            <td style=\"background-color:#f9f9f9;padding:15px;text-align:left\">{{ $('Compose Prompt & Schema').item.json.route }}</td>\n        </tr>\n        <tr>\n            <td style=\"background-color:#f9f9f9;padding:15px;width:30%;text-align:left\"><strong>[label_1]:</strong></td>\n            <td style=\"background-color:#f9f9f9;padding:15px;text-align:left\">[content_1]</td>\n        </tr>\n        <tr>\n            <td style=\"background-color:#f1f1f1;padding:15px;text-align:left\"><strong>[label_2]:</strong></td>\n            <td style=\"background-color:#f1f1f1;padding:15px;text-align:left\">[content_2]</td>\n        </tr>\n\n        [continue the pattern ...]\n\n        <tr>\n            <td colspan=\"2\" style=\"background-color:#efefef;padding:15px;text-align:left\">\n                <strong>[footer_label]:</strong> [footer_content]\n            </td>\n        </tr>\n    </tbody>\n</table>\n\n",
            "options": {},
            "promptType": "define"
          },
          "typeVersion": 1.7
        },
        {
          "id": "1dc19a25-ff27-4582-a574-279831f7bc28",
          "name": "Sticky Note43",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -760,
            -340
          ],
          "parameters": {
            "height": 500,
            "content": "ðŸ’¡Notes\n\n- Create Google Doc for the Social Media Schema and copy the provided schema.\n\n- Update the Google Doc ID in the Social Media Schema node.\n\n- Create Google Doc for the Social Media System Prompt and copy the provided System Prompt.\n\n- Update the Google Doc ID in the Social Media System Prompt node.\n\n\n\nAdjust system prompt and platform specific prompts to suit your needs."
          },
          "typeVersion": 1
        },
        {
          "id": "6b1d2ad9-9ad8-4a33-ab7d-430f96dc317c",
          "name": "Sticky Note44",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1340,
            -360
          ],
          "parameters": {
            "width": 300,
            "content": "ðŸ’¡Notes\n\nReplace pollinations.ai with any online image generation service that produces an image file you can download."
          },
          "typeVersion": 1
        },
        {
          "id": "e7c2d9ba-6b9a-404f-a84d-8e90e4c5f4bb",
          "name": "Sticky Note45",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            720,
            -840
          ],
          "parameters": {
            "width": 400,
            "height": 140,
            "content": "ðŸ’¡Notes\n\nReplace Chat model with other LLMs and test out the results.  Add more tools or try other web search tools to suit your use case."
          },
          "typeVersion": 1
        },
        {
          "id": "00204106-dd0f-46d5-89c8-60fd92f1388e",
          "name": "gpt-4o",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            -520,
            -1620
          ],
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o",
              "cachedResultName": "gpt-4o"
            },
            "options": {
              "responseFormat": "json_object"
            }
          },
          "credentials": {
            "openAiApi": {
              "id": "jEMSvKmtYfzAkhe6",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1.2
        }
      ],
      "active": false,
      "pinData": {
        "Social Media Schema": [
          {
            "json": {
              "content": "<common>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"hashtags\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"string\"\n            }\n        },\n        \"image_suggestion\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</common>\n\n<root>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"name\": {\n            \"type\": \"string\"\n        },\n        \"description\": {\n            \"type\": \"string\"\n        },\n        \"additional_notes\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</root>\n\n<linkedin>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"post\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</linkedin>\n\n<instagram>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"caption\": {\n            \"type\": \"string\"\n        },\n        \"emojis\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"string\"\n            }\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</instagram>\n\n<facebook>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"post\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</facebook>\n\n<xtwitter>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"video_suggestion\": {\n            \"type\": \"string\"\n        },\n        \"post\": {\n            \"type\": \"string\"\n        },\n        \"character_limit\": {\n            \"type\": \"integer\"\n        }\n    }\n}\n</xtwitter>\n\n<threads>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"text_post\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</threads>\n\n<youtube_short>\n{\n    \"type\": \"object\",\n    \"properties\": {\n        \"video_suggestion\": {\n            \"type\": \"string\"\n        },\n        \"title\": {\n            \"type\": \"string\"\n        },\n        \"description\": {\n            \"type\": \"string\"\n        },\n        \"call_to_action\": {\n            \"type\": \"string\"\n        }\n    }\n}\n</youtube_short>\n\n\n\n",
              "documentId": "[your-doc-id-here]"
            }
          }
        ],
        "Social Media System Prompt": [
          {
            "json": {
              "content": "<system>\nYou are a specialized content creation AI for social media platforms.\nYour primary function is generating platform-optimized social media content across various platforms including LinkedIn, Instagram, Facebook, Twitter (X), Threads, and YouTube Shorts. Each piece of content must:\nMatch the specific platform's audience expectations and algorithm preferences\nShowcase relevant expertise in your field\nDeliver actionable insights for your target audience\nDrive meaningful engagement through value-driven content\nOBJECTIVES:\nCreate platform-specific content following each platform's best practices\nImplement strategic hashtag usage combining general and trending tags\nDesign content that encourages user interaction and community building\nMaintain consistent brand voice while adapting to platform requirements\nIncorporate data-driven insights to maximize content performance\nOUTPUT REQUIREMENTS:\nDeliver content in valid JSON format according to the platform-specific schema\nInclude all required fields as specified in the schema\nOmit any explanatory text or code fencing in your response\nTailor content specifically to the platform indicated in the user's request\nFor each content request, adapt your output based on the platform guidelines and ensure it aligns with your organization's mission and values.  Never provide URLS for video or image suggestions and only describe the suggestion.\n</system>\n\n\n<rules>\n- Only provide final response in valid JSON for the appropriate social platform\n- Never include any preamble or further explanation\n- Always remove any ``` ```json\n</rules>\n\n\n<linkedin>\n**Style**: Professional and insightful.\n**Tone**: Business-oriented; focus on automation use cases, industry insights, and community impact.\n**Content Length**: 3-4 sentences; concise but detailed.\n**Hashtags**: #Innovation #Automation #WorkflowSolutions #DigitalTransformation #Leadership\n**Call to Action (CTA)**: Encourage comments or visits to workflows.diy's website for more insights.\n</linkedin>\n\n<instagram>\n**Style**: Visual storytelling with creative captions.\n**Tone**: Inspirational and engaging; use emojis for relatability.\n**Content Length**: 2-3 sentences paired with eye-catching visuals (e.g., infographics or workflow demos).\n**Visuals**: Showcase milestones (e.g., new workflow launches), tutorials, or product highlights.\n**CTA**: Use phrases like \"Swipe to learn more,\" \"Tag your team,\" or \"Check out the link below!\"\n**Link Placement**: Add the provided link before hashtags; if no link is provided, use \"Visit our website: https://workflows.diy.\"\n**Hashtags**: #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering\n</instagram>\n\n<facebook>\n**Style**: Friendly and community-focused.\n**Tone**: Relatable; highlight user success stories or company achievements in automation.\n**Content Length**: 2-3 sentences; conversational yet professional.\n**Hashtags**: #SmallBusinessAutomation #Entrepreneurship #Leadership #WorkflowInnovation\n**CTA**: Encourage likes, shares, comments (e.g., \"What's your favorite automation tip?\").\n</facebook>\n\n<xtwitter>\n**Style**: Concise and impactful.\n**Tone**: Crisp and engaging; spark curiosity in 150 characters or less.\n**Hashtags**: #WorkflowTrends #AIWorkflows #AutomationTips #NoCodeSolutions\n**CTA**: Drive quick engagement through retweets or replies (e.g., \"What's your go-to n8n workflow?\").\n</xtwitter>\n\n<threads>\n**Style**: Conversational and community-driven posts.\n**Tone**: Casual yet informative; encourage discussions around automation trends or innovations.\n**Content Length**: 1-2 short paragraphs with a question or thought-provoking statement at the end.\n**Hashtags**: Similar to Instagram but tailored for trending Threads topics related to automation.\n</threads>\n\n<youtube_short>\n**Style**: Short-form video content showcasing quick workflow tutorials or use cases.\n**Tone**: Authoritative yet approachable; establish workflows.diy as a leader in n8n automation solutions.\n**Content Length**:\n  - Tutorials/Reviews (long-form): 5-10 minutes\n  - Shorts/Highlights (short-form): Under 1 minute\n**CTA**: Encourage subscriptions, likes, comments (e.g., \"Subscribe for more workflow tips!\").\n</youtube_short>\n\n\n\n",
              "documentId": "[your-doc-id-here]"
            }
          }
        ],
        "When Executed by Another Workflow": [
          {
            "json": {
              "route": "instagram",
              "user_prompt": "i need an instagram post about using n8n to transform business automation with reference to a related historical fact and example"
            }
          }
        ]
      },
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "110ac387-48e7-4ed2-98d6-0e3ddbb34063",
      "connections": {
        "Gmail": {
          "main": [
            []
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Prepare Social Media Email Contents",
                "type": "main",
                "index": 0
              },
              {
                "node": "Google Drive Image Meta",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Short": {
          "ai_tool": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Schema": {
          "main": [
            [
              {
                "node": "Parse Schema",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "X Post": {
          "main": [
            [
              {
                "node": "X Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "gpt-4o": {
          "ai_languageModel": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "File Id": {
          "main": [
            [
              {
                "node": "Get Social Post from Google Drive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SerpAPI": {
          "ai_tool": [
            [
              {
                "node": "Social Media Content Creator",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Facebook": {
          "ai_tool": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "LinkedIn": {
          "ai_tool": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "X-Twiter": {
          "ai_tool": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Instagram": {
          "ai_tool": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "gpt-40-mini": {
          "ai_languageModel": [
            [
              {
                "node": "Prepare Social Media Email Contents",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "gpt-4o-mini": {
          "ai_languageModel": [
            [
              {
                "node": "Social Media Content Creator",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Is Approved?": {
          "main": [
            [
              {
                "node": "Get Social Post Image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse Schema": {
          "main": [
            [
              {
                "node": "Merge Prompts and Schema",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "gpt-40-mini1": {
          "ai_languageModel": [
            [
              {
                "node": "Prepare Email Contents",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Facebook Post": {
          "main": [
            [
              {
                "node": "Facebook Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "LinkedIn Post": {
          "main": [
            [
              {
                "node": "LinkedIn Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "System Prompt": {
          "main": [
            [
              {
                "node": "Parse System Prompt",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "YouTube Short": {
          "ai_tool": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Social Content": {
          "main": [
            [
              {
                "node": "pollinations.ai1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract as JSON": {
          "main": [
            [
              {
                "node": "Merge Image and Post Contents",
                "type": "main",
                "index": 0
              },
              {
                "node": "Prepare Email Contents",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Instagram Image": {
          "main": [
            [
              {
                "node": "Instragram Post",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Instragram Post": {
          "main": [
            [
              {
                "node": "Instagram Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Social Post JSON": {
          "main": [
            [
              {
                "node": "Save Social Post to Google Drive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "pollinations.ai1": {
          "main": [
            [
              {
                "node": "Telegram Success Message (Optional)",
                "type": "main",
                "index": 0
              },
              {
                "node": "Save Image to imgbb.com",
                "type": "main",
                "index": 0
              },
              {
                "node": "Save Image to Google Drive",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ],
            [
              {
                "node": "Telegram Error Message (Optional)",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse System Prompt": {
          "main": [
            [
              {
                "node": "Merge Prompts and Schema",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Social Media Schema": {
          "main": [
            [
              {
                "node": "Schema",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Window Buffer Memory": {
          "ai_memory": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Get Social Post Image": {
          "main": [
            [
              {
                "node": "Merge Image and Post Contents",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Prepare Email Contents": {
          "main": [
            [
              {
                "node": "Gmail User for Approval",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Compose Prompt & Schema": {
          "main": [
            [
              {
                "node": "Social Media Content Creator",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gmail User for Approval": {
          "main": [
            [
              {
                "node": "Is Approved?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Drive Image Meta": {
          "main": [
            [
              {
                "node": "Social Post JSON",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Save Image to imgbb.com": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Prompts and Schema": {
          "main": [
            [
              {
                "node": "Compose Prompt & Schema",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Save Image to Google Drive": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Social Media System Prompt": {
          "main": [
            [
              {
                "node": "System Prompt",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "ðŸ¤–Social Media Router Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Social Media Content Creator": {
          "main": [
            [
              {
                "node": "Social Content",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Image and Post Contents": {
          "main": [
            [
              {
                "node": "Social Media Publishing Router",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ðŸ¤–Social Media Router Agent": {
          "main": [
            [
              {
                "node": "File Id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Social Media Publishing Router": {
          "main": [
            [
              {
                "node": "X Post",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Instagram Image",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Facebook Post",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "LinkedIn Post",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Implement Threads Here",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Implement YouTube Shorts Here",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Save Social Post to Google Drive": {
          "main": [
            [
              {
                "node": "Respond with Google Drive Id",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Social Post from Google Drive": {
          "main": [
            [
              {
                "node": "Extract as JSON",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Social Media System Prompt",
                "type": "main",
                "index": 0
              },
              {
                "node": "Social Media Schema",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge Prompts and Schema",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Prepare Social Media Email Contents": {
          "main": [
            [
              {
                "node": "Gmail",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "shopify-to-d365",
    "title": "Shopify â†’ D365 Sales Doc Sync",
    "description": "Transforms Shopify orders into D365 Business Central sales orders/invoices using SplitOut/Batch patterns and HTTP connectors.",
    "problem": "Ecommerce ops struggle to mirror Shopify transactions inside ERP without manual re-entry.",
    "tags": [
      "shopify",
      "d365",
      "ecommerce",
      "erp"
    ],
    "metadata": {
      "industries": [
        "ecommerce",
        "finance"
      ],
      "domains": [
        "erp-sync",
        "order-management"
      ],
      "channels": [
        "d365"
      ],
      "trigger": "webhook",
      "complexity": "high",
      "integrations": [
        "Shopify",
        "Dynamics 365",
        "HTTP"
      ]
    },
    "workflow": {
      "id": "NGwD3pIHXBU0w5hC",
      "meta": {
        "instanceId": "ae2372ebbc56db2b55a9a46ac3affa802af144b84fd97c2796c22342aba529bd"
      },
      "name": "[n8n] - Shopify Orders to D365 Business Central Sales Orders / Sales Invoices",
      "tags": [
        {
          "id": "2RJGhx5RHCJdXr52",
          "name": "d365 business central",
          "createdAt": "2023-08-08T23:10:56.527Z",
          "updatedAt": "2023-08-08T23:10:56.527Z"
        },
        {
          "id": "OPc1YLQyTimMr498",
          "name": "shopify",
          "createdAt": "2023-07-22T15:30:38.620Z",
          "updatedAt": "2023-07-22T15:30:38.620Z"
        }
      ],
      "nodes": [
        {
          "id": "92db12db-d96d-4076-a9cd-441c4bdfe212",
          "name": "GetFufillmentOrders",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            840,
            300
          ],
          "parameters": {
            "url": "=https://integrocloud.myshopify.com/admin/api/2024-01/orders/{{ $json.id }}/fulfillment_orders.json",
            "options": {},
            "sendHeaders": true,
            "authentication": "predefinedCredentialType",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "nodeCredentialType": "shopifyAccessTokenApi"
          },
          "credentials": {
            "httpHeaderAuth": {
              "id": "BkNv57yQW9PSPr6p",
              "name": "Shopify HTTP Token Auth"
            },
            "shopifyAccessTokenApi": {
              "id": "9P9B0Hcwyj2CpqeA",
              "name": "Shopify Access Token account"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "60e0bd37-a2d1-48c5-8b47-830094d5e2ae",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            780,
            140
          ],
          "parameters": {
            "width": 730.3433300216063,
            "height": 394.8862809393426,
            "content": "## Shopify Line Locations\nFor multi-location Shopify accounts, these group of nodes get the active location id for each order line."
          },
          "typeVersion": 1
        },
        {
          "id": "1e91817c-26bf-46f8-8185-696f07daa28c",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            400,
            140
          ],
          "parameters": {
            "width": 354.40926061252037,
            "height": 398.9698970525732,
            "content": "## Get Shopify Orders\n1.- Get Shopify Orders created/updated since one day prior. The Flow will get every order created or updated on the last 24 hours.\n\n2.- Filter to get paid orders."
          },
          "typeVersion": 1
        },
        {
          "id": "89f633a1-ac8f-4480-934b-e429717cb09f",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1557,
            140
          ],
          "parameters": {
            "width": 974.6786178827637,
            "height": 520.8878646073657,
            "content": "## Existing Customer Lookup (Business Central)\nLookup for existing customer in Business Central based on the logic defined in the URI, if a customer exist then that id is used, otherwhise a new customer will be created\n"
          },
          "typeVersion": 1
        },
        {
          "id": "c973b647-c1c6-43dc-9b80-46e34d051fc4",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -640,
            140
          ],
          "parameters": {
            "color": 3,
            "width": 509.9611651710956,
            "height": 705.3721586313337,
            "content": "## Workflow Information ðŸ“Œ\n\n### Purpose ðŸŽ¯\nThe intention of this workflow is to integrate New Shopify Orders into MS Dynamics Business Central:\n\n- **Point-of-Sale (POS):** POS orders will be created in Business Central as Sales Invoices given no fulfillment is expected.\n- **Web Orders:** This type of orders will be created as Business Central Sales Orders.\n\n### How to use it ðŸš€\n1. Edit the \"D365 BC Environment Settings\" node with your own account values (Company Id, Tenanant Id, Tax & Discount Items).\n2. Go to the \"Shopify\" node and edit the connection with your environment. More help [here](https://docs.n8n.io/integrations/builtin/credentials/shopify/).\n3. Go to the \"Lookup Customers\" node to edit the Business Central connection details with your environment settings.\n4. Set the required filters on the \"Shopify Order Filter\" node.\n5. Edit the \"Schedule Trigger\" node with the required frequency.\n\n### Useful Workflow Links ðŸ“š\n1. [Step-by-step Guide/ Integro Cloud Solutions](https://z0v4z2m6gixudcjglfbe.guidejar.xyz/categories/business-central)\n2. [Business Central REST API Documentation](https://learn.microsoft.com/en-us/dynamics365/business-central/dev-itpro/api-reference/v2.0/)\n3. [Video Demo](https://www.loom.com/share/9e218cd53cf14a93bcb55d7b3d47ec45?sid=5fdfb8ab-8205-468a-b514-67193abac455)\n\n\n### Need Help?\nContact me at:\nâœ‰ï¸greg.lopez@integrocloudsolutions.com\nðŸ“¥ https://www.linkedin.com/in/greg-lopez-08b5071b/\n\n\n\n"
          },
          "typeVersion": 1
        },
        {
          "id": "e7c4bf60-e040-4f41-9c8a-7729ffed88fd",
          "name": "Shopify",
          "type": "n8n-nodes-base.shopify",
          "position": [
            440,
            300
          ],
          "parameters": {
            "options": {
              "status": "any",
              "updatedAtMin": "={{$now.minus({days: 1})}}"
            },
            "operation": "getAll",
            "returnAll": true,
            "authentication": "accessToken"
          },
          "credentials": {
            "shopifyAccessTokenApi": {
              "id": "9P9B0Hcwyj2CpqeA",
              "name": "Shopify Access Token account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "274b710d-e642-4bc6-bf8d-5852a721f037",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1560,
            730.5378173588417
          ],
          "parameters": {
            "width": 978.7262207141349,
            "height": 502.3149881728773,
            "content": "## Existing Order Lookup (Business Central)\n\n1.- This logic will avoid duplication of Business Central Sales Orders/Sales Invoices validating if an order with the same external Id exist already.\n\n2.- If a match is found then the order is ignored\n\n3.- The source of the order is evaluated, if the order was placed on the Point-of-Sale a Sales Invoice is created else a Sales Order will be created."
          },
          "typeVersion": 1
        },
        {
          "id": "ccf15ee2-b805-4fa7-88ab-12bf3c864415",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2600,
            700
          ],
          "parameters": {
            "width": 1330.0330040471722,
            "height": 434.94851154152406,
            "content": "## Sales Order Creation\n\n1.- Map on the \"Sales Order Mapping\" node any requiered fields to be integrated into Business Central.\n\n2- The HTTP Node will perform a POST call to Business Central REST API to create the Sales Order.\n\n3. After the Sales Order gets created, all line items will be added into the Order. \n\n4. If there are any while creating line items, the Sales Order will be deleted.\n"
          },
          "typeVersion": 1
        },
        {
          "id": "5a78d974-d950-4e26-87cf-a42e4633a5d8",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -68.32736133691077,
            140
          ],
          "parameters": {
            "width": 442.73662194943114,
            "height": 398.9698970525732,
            "content": "## Configure Business Central Environment Variables\n1.- Enter your BC tenantId,companyId, name.\n2.- Set the SKU number for the Items to be used for Taxes and Discounts."
          },
          "typeVersion": 1
        },
        {
          "id": "95f15005-6c9b-46ae-9cb3-a89887189aed",
          "name": "Schedule Trigger",
          "type": "n8n-nodes-base.scheduleTrigger",
          "position": [
            -20,
            340
          ],
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "minutes"
                }
              ]
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "0c2ee7ac-3b27-4e6f-9e65-f1bba3ee494b",
          "name": "Loop Over Items",
          "type": "n8n-nodes-base.splitInBatches",
          "position": [
            1620,
            260
          ],
          "parameters": {
            "options": {}
          },
          "typeVersion": 3
        },
        {
          "id": "58a528fe-f9f3-4522-bc4d-0fc91fbbf656",
          "name": "New Customer?",
          "type": "n8n-nodes-base.if",
          "position": [
            2020,
            260
          ],
          "parameters": {
            "conditions": {
              "number": [
                {
                  "value1": "={{ $json.value.length }}",
                  "value2": 1
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "e5222a97-002c-4433-aa7a-dbc6426b2a25",
          "name": "Lookup Customers",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1840,
            260
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json[\"tenantId\"] }}/{{ $('D365 BC Environment Settings').item.json[\"environmentName\"] }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json[\"companyId\"] }})/customers?$filter=email eq '{{ $json.customer.email }}' and contains(email,'@')&$select=id,number,email",
            "options": {},
            "authentication": "genericCredentialType",
            "genericAuthType": "oAuth2Api"
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "typeVersion": 4.1,
          "continueOnFail": true
        },
        {
          "id": "8d5ba820-04a7-413e-bb9e-8385dee5e78b",
          "name": "SelectFields",
          "type": "n8n-nodes-base.set",
          "position": [
            1080,
            300
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "id",
                  "value": "={{ $('Filter').item.json.id }}"
                },
                {
                  "name": "name",
                  "value": "={{ $('Filter').item.json.name }}"
                },
                {
                  "name": "source_name",
                  "value": "={{ $('Filter').item.json.source_name }}"
                },
                {
                  "name": "shipping_address",
                  "value": "={{ $('Filter').item.json.shipping_address }}"
                },
                {
                  "name": "billing_address",
                  "value": "={{ $('Filter').item.json.billing_address }}"
                },
                {
                  "name": "customer",
                  "value": "={{ $('Filter').item.json.customer }}"
                },
                {
                  "name": "discount_codes",
                  "value": "={{ $('Filter').item.json.discount_codes}}"
                },
                {
                  "name": "shippingcost",
                  "value": "={{ $('Filter').item.json.total_shipping_price_set.shop_money.amount }}"
                },
                {
                  "name": "line_items",
                  "value": "={{ $('Filter').item.json.line_items }}"
                },
                {
                  "name": "fulfillment_orders",
                  "value": "={{ $json.fulfillment_orders }}"
                },
                {
                  "name": "currency",
                  "value": "={{ $('Filter').item.json.currency }}"
                },
                {
                  "name": "=created_at",
                  "value": "={{ $('Filter').item.json.created_at }}"
                },
                {
                  "name": "gateway",
                  "value": "={{ $('Filter').item.json.payment_gateway_names[0] }}"
                },
                {
                  "name": "total_tax",
                  "value": "={{ $('Filter').item.json.total_tax }}"
                },
                {
                  "name": "total_discounts",
                  "value": "={{ $('Filter').item.json.total_discounts*-1 }}"
                }
              ]
            },
            "options": {},
            "keepOnlySet": true
          },
          "typeVersion": 2
        },
        {
          "id": "d5120009-2efe-4ef1-9450-eedd475f95c7",
          "name": "orderPreprocessing",
          "type": "n8n-nodes-base.code",
          "position": [
            1340,
            300
          ],
          "parameters": {
            "mode": "runOnceForEachItem",
            "jsCode": "const orderJson = $input.item.json;\n\n// Create a map of line_item_id to assigned_location_id\nconst lineItemToLocationMap = {};\norderJson.fulfillment_orders.forEach(fulfillmentOrder => {\n  fulfillmentOrder.line_items.forEach(lineItem => {\n    lineItemToLocationMap[lineItem.line_item_id] = fulfillmentOrder.assigned_location_id;\n  });\n});\n\n// Update the line_items array with assigned_location_id\norderJson.line_items.forEach(lineItem => {\n  const assignedLocationId = lineItemToLocationMap[lineItem.id];\n  if (assignedLocationId !== undefined) {\n    lineItem.assigned_location_id = assignedLocationId;\n  }\n});\n\n// Add a new property 'pairedItem' to orderJson with the value of $itemIndex\norderJson.pairedItem = $itemIndex;\n\n// Add a new line item with specified fields for taxes if taxesAsLineItem is true\nif ($('D365 BC Environment Settings').item.json.taxesAsLineItem) {\n  const newLineItem = {\n    \"sku\": $('D365 BC Environment Settings').item.json.taxItemSku,\n    \"price\": orderJson.total_tax,\n    \"quantity\": 1\n  };\n  orderJson.line_items.push(newLineItem);\n}\n\n// Add a new line item with specified fields for discount\nif ($('D365 BC Environment Settings').item.json.discountsAsLineItem) {\nconst newDiscountLineItem = {\n  \"sku\": $('D365 BC Environment Settings').item.json.discountItemSku,\n  \"price\": orderJson.total_discounts,\n  \"quantity\": 1\n};\norderJson.line_items.push(newDiscountLineItem);\n}\n\n// Return the modified orderJson\nreturn orderJson;\n"
          },
          "typeVersion": 2
        },
        {
          "id": "28f0b15a-e1a6-4055-90ed-f3051f043792",
          "name": "Create Customer",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            2240,
            320
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json[\"tenantId\"] }}/{{ $('D365 BC Environment Settings').item.json[\"environmentName\"] }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json[\"companyId\"] }})/customers",
            "method": "POST",
            "options": {
              "response": {
                "response": {}
              }
            },
            "sendBody": true,
            "sendHeaders": true,
            "authentication": "genericCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "displayName",
                  "value": "={{ $('orderPreprocessing').item.json.customer.first_name }} {{ $('orderPreprocessing').item.json.customer.last_name }}"
                },
                {
                  "name": "type",
                  "value": "Person"
                },
                {
                  "name": "email",
                  "value": "={{ $('Loop Over Items').item.json.customer.email }}"
                },
                {
                  "name": "taxLiable",
                  "value": "true"
                },
                {
                  "name": "currencyCode",
                  "value": "={{ $('Loop Over Items').item.json.currency }}"
                },
                {
                  "name": "addressLine1",
                  "value": "={{ $('Loop Over Items').item.json.shipping_address.address1 }}"
                },
                {
                  "name": "addressLine2",
                  "value": "={{ $('Loop Over Items').item.json.shipping_address.address2 }}"
                },
                {
                  "name": "city",
                  "value": "={{ $('Loop Over Items').item.json.shipping_address.city }}"
                },
                {
                  "name": "state",
                  "value": "={{ $('Loop Over Items').item.json.shipping_address.province }}"
                },
                {
                  "name": "country",
                  "value": "={{ $('Loop Over Items').item.json.shipping_address.country_code }}"
                },
                {
                  "name": "postalCode",
                  "value": "={{ $('Loop Over Items').item.json.shipping_address.zip }}"
                },
                {
                  "name": "phoneNumber",
                  "value": "={{ $('Loop Over Items').item.json.shipping_address.phone }}"
                }
              ]
            },
            "genericAuthType": "oAuth2Api",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "notesInFlow": true,
          "typeVersion": 4.1,
          "continueOnFail": true,
          "alwaysOutputData": false
        },
        {
          "id": "990fec80-30e3-44f8-a95d-f9afb2e495c5",
          "name": "Set Business Central Customer Id",
          "type": "n8n-nodes-base.set",
          "position": [
            1780,
            500
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "order",
                  "value": "={{ $('orderPreprocessing').item.json }}"
                },
                {
                  "name": "bc_customer.id",
                  "value": "={{ $json.value.isEmpty() ? $json.id : $json.value[0].id}}"
                }
              ]
            },
            "options": {},
            "keepOnlySet": true
          },
          "typeVersion": 2
        },
        {
          "id": "313ac019-aedb-4d64-833d-c3582153e2c0",
          "name": "Create Order Lines",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueErrorOutput",
          "position": [
            3440,
            900
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json.tenantId }}/{{ $('D365 BC Environment Settings').item.json.environmentName }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json.companyId }})/salesOrders({{ $json.so_id }})/salesOrderLines",
            "method": "POST",
            "options": {
              "batching": {
                "batch": {
                  "batchSize": 0
                }
              },
              "response": {
                "response": {}
              }
            },
            "sendBody": true,
            "sendHeaders": true,
            "authentication": "genericCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "lineObjectNumber",
                  "value": "={{ $json.line_items.sku }}"
                },
                {
                  "name": "quantity",
                  "value": "={{ $json.line_items.quantity }}"
                },
                {
                  "name": "description",
                  "value": "={{ $json.line_items.title }}"
                },
                {
                  "name": "lineType",
                  "value": "Item"
                },
                {
                  "name": "unitPrice",
                  "value": "={{ $json.line_items.price*1 }}"
                }
              ]
            },
            "genericAuthType": "oAuth2Api",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "e0d63859-a480-4f69-bb30-77c9615777b6",
          "name": "End",
          "type": "n8n-nodes-base.noOp",
          "position": [
            3720,
            840
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "8c756b31-0b7f-4f9a-a7a3-5fccdcfcf8b8",
          "name": "Split Out",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            3260,
            900
          ],
          "parameters": {
            "include": "allOtherFields",
            "options": {},
            "fieldToSplitOut": "=line_items"
          },
          "typeVersion": 1
        },
        {
          "id": "e2ddcd9a-7502-49ae-9d5c-50f6c3084570",
          "name": "DELETE Sales Order",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueRegularOutput",
          "position": [
            3720,
            980
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json.tenantId }}/Production/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json.companyId }})/salesOrders({{ $json.so_id }})",
            "method": "DELETE",
            "options": {
              "batching": {
                "batch": {
                  "batchSize": 1
                }
              },
              "response": {
                "response": {}
              }
            },
            "sendBody": true,
            "sendHeaders": true,
            "authentication": "genericCredentialType",
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "genericAuthType": "oAuth2Api",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "b5303dc5-bf56-4b1c-a231-15a322f26ac8",
          "name": "D365 BC Environment Settings",
          "type": "n8n-nodes-base.set",
          "position": [
            180,
            340
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "tenantId",
                  "value": "{tenandId}"
                },
                {
                  "name": "environmentName",
                  "value": "Production"
                },
                {
                  "name": "companyId",
                  "value": "{CompanyId}"
                },
                {
                  "name": "discountItemSku",
                  "value": "N8N_DISCOUNT"
                },
                {
                  "name": "taxItemSku",
                  "value": "N8N_TAX_AMOUNT"
                }
              ],
              "boolean": [
                {
                  "name": "taxesAsLineItem",
                  "value": true
                },
                {
                  "name": "discountsAsLineItem",
                  "value": true
                }
              ]
            },
            "options": {},
            "keepOnlySet": true
          },
          "typeVersion": 2
        },
        {
          "id": "e7925d36-5b30-4822-8eb1-a5a076a77669",
          "name": "Create Sales Order",
          "type": "n8n-nodes-base.httpRequest",
          "notes": "Create Sales Order Header",
          "onError": "continueErrorOutput",
          "position": [
            2880,
            920
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json.tenantId }}/{{ $('D365 BC Environment Settings').item.json.environmentName }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json.companyId }})/salesOrders",
            "method": "POST",
            "options": {
              "batching": {
                "batch": {
                  "batchSize": 5,
                  "batchInterval": 5000
                }
              },
              "response": {
                "response": {}
              }
            },
            "jsonBody": "={{$json}}",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "genericCredentialType",
            "genericAuthType": "oAuth2Api",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "notesInFlow": true,
          "typeVersion": 4.1
        },
        {
          "id": "fce6d383-c372-4f65-83b5-d681dfa16323",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2600,
            140
          ],
          "parameters": {
            "width": 1330.0330040471722,
            "height": 434.94851154152406,
            "content": "## Sales Order Creation\n\n1. Map on the \"Sales Invoice Mapping\" node any requiered fields to be integrated into Business Central.\n\n2. The HTTP Node will perform a POST call to Business Central REST API to create the Sales Invoice.\n\n3. After the Sales Invoice gets created, all line items will be added into the Invoice. \n\n4. If there are any while creating line items, the Sales Invoice will be deleted.\n"
          },
          "typeVersion": 1
        },
        {
          "id": "29d43335-713f-4bfc-a416-be41f7cc1311",
          "name": "Set Lines Invoice",
          "type": "n8n-nodes-base.set",
          "position": [
            3100,
            360
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "so_id",
                  "value": "={{ $json.id }}"
                },
                {
                  "name": "line_items",
                  "value": "={{ $('Set Business Central Customer Id').item.json.order.line_items }}"
                }
              ]
            },
            "options": {
              "dotNotation": true
            },
            "keepOnlySet": true
          },
          "typeVersion": 2
        },
        {
          "id": "7d05a3d7-5bac-4099-8561-61b520c75e91",
          "name": "Set Lines SO",
          "type": "n8n-nodes-base.set",
          "position": [
            3100,
            900
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "so_id",
                  "value": "={{ $json.id }}"
                },
                {
                  "name": "line_items",
                  "value": "={{ $('Set Business Central Customer Id').item.json.order.line_items }}"
                }
              ]
            },
            "options": {
              "dotNotation": true
            },
            "keepOnlySet": true
          },
          "typeVersion": 2
        },
        {
          "id": "e39a775a-4c89-47f0-8da9-e5cb33d03228",
          "name": "Split Out Invoice",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            3260,
            360
          ],
          "parameters": {
            "include": "allOtherFields",
            "options": {},
            "fieldToSplitOut": "=line_items"
          },
          "typeVersion": 1
        },
        {
          "id": "ff21ea27-091c-4ba7-bedb-1e26561ff042",
          "name": "Create Invoice Lines",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueErrorOutput",
          "position": [
            3440,
            360
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json.tenantId }}/{{ $('D365 BC Environment Settings').item.json.environmentName }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json.companyId }})/salesInvoices({{ $json.so_id }})/salesInvoiceLines",
            "method": "POST",
            "options": {
              "batching": {
                "batch": {
                  "batchSize": 0
                }
              },
              "response": {
                "response": {}
              }
            },
            "sendBody": true,
            "sendHeaders": true,
            "authentication": "genericCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "lineObjectNumber",
                  "value": "={{ $json.line_items.sku }}"
                },
                {
                  "name": "quantity",
                  "value": "={{ $json.line_items.quantity }}"
                },
                {
                  "name": "description",
                  "value": "={{ $json.line_items.title }}"
                },
                {
                  "name": "lineType",
                  "value": "Item"
                },
                {
                  "name": "unitPrice",
                  "value": "={{ $json.line_items.price*1 }}"
                }
              ]
            },
            "genericAuthType": "oAuth2Api",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "becfe8a8-9655-4386-b891-977271b26c7e",
          "name": "Filter",
          "type": "n8n-nodes-base.filter",
          "position": [
            620,
            300
          ],
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{ $json.financial_status }}",
                  "value2": "paid"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "48edfcb3-5864-4794-8876-40bb7bec31f6",
          "name": "Create Sales Invoice",
          "type": "n8n-nodes-base.httpRequest",
          "notes": "Create Sales Order Header",
          "onError": "continueErrorOutput",
          "position": [
            2900,
            380
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json.tenantId }}/{{ $('D365 BC Environment Settings').item.json.environmentName }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json.companyId }})/salesInvoices",
            "method": "POST",
            "options": {
              "batching": {
                "batch": {
                  "batchSize": 5,
                  "batchInterval": 5000
                }
              },
              "response": {
                "response": {}
              }
            },
            "jsonBody": "={{$json}}",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "genericCredentialType",
            "genericAuthType": "oAuth2Api",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "notesInFlow": true,
          "typeVersion": 4.1
        },
        {
          "id": "a2879c0f-55d2-442a-be5e-cb249af88561",
          "name": "End1",
          "type": "n8n-nodes-base.noOp",
          "position": [
            3720,
            300
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "4c979801-ab23-41a7-bc14-179d128c2bf7",
          "name": "Sales Invoice",
          "type": "n8n-nodes-base.set",
          "position": [
            2700,
            380
          ],
          "parameters": {
            "fields": {
              "values": [
                {
                  "name": "customerId",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.bc_customer.id }}"
                },
                {
                  "name": "invoiceDate",
                  "stringValue": "={{ DateTime.fromISO($('Set Business Central Customer Id').item.json.order.created_at).toFormat('yyyy-MM-dd').toString() }}"
                },
                {
                  "name": "externalDocumentNumber",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.id.toString() }}"
                },
                {
                  "name": "currencyCode",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.currency }}"
                },
                {
                  "name": "sellToAddressLine1",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.address1 }}"
                },
                {
                  "name": "sellToAddressLine2",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.address2 }}"
                },
                {
                  "name": "sellToCity",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.city }}"
                },
                {
                  "name": "sellToCountry",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.country_code }}"
                },
                {
                  "name": "sellToState",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.province }}"
                },
                {
                  "name": "sellToPostCode",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.zip }}"
                }
              ]
            },
            "include": "none",
            "options": {}
          },
          "typeVersion": 3.2
        },
        {
          "id": "022de50a-0030-434d-95b8-edef8eacb481",
          "name": "Lookup Sales Order",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            2120,
            1080
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json[\"tenantId\"] }}/{{ $('D365 BC Environment Settings').item.json[\"environmentName\"] }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json[\"companyId\"] }})/salesOrders?$filter=externalDocumentNumber eq '{{ $json.order.id.toString() }}'&$select=id,number,externalDocumentNumber",
            "options": {},
            "authentication": "genericCredentialType",
            "genericAuthType": "oAuth2Api"
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "typeVersion": 4.1,
          "continueOnFail": true
        },
        {
          "id": "8e646fe3-5a28-4bf4-8cc1-d31a13294218",
          "name": "Sales Order Mapping",
          "type": "n8n-nodes-base.set",
          "position": [
            2660,
            920
          ],
          "parameters": {
            "fields": {
              "values": [
                {
                  "name": "customerId",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.bc_customer.id }}"
                },
                {
                  "name": "OrderDate",
                  "stringValue": "={{ DateTime.fromISO($('Set Business Central Customer Id').item.json.order.created_at).toFormat('yyyy-MM-dd').toString() }}"
                },
                {
                  "name": "externalDocumentNumber",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.id.toString() }}"
                },
                {
                  "name": "currencyCode",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.currency }}"
                },
                {
                  "name": "sellToAddressLine1",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.address1 }}"
                },
                {
                  "name": "sellToAddressLine2",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.address2 }}"
                },
                {
                  "name": "sellToCity",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.city }}"
                },
                {
                  "name": "sellToCountry",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.country_code }}"
                },
                {
                  "name": "sellToState",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.province }}"
                },
                {
                  "name": "sellToPostCode",
                  "stringValue": "={{ $('Set Business Central Customer Id').item.json.order.shipping_address.zip }}"
                }
              ]
            },
            "include": "none",
            "options": {}
          },
          "typeVersion": 3.2
        },
        {
          "id": "3839e2f2-54a2-4bbb-b0af-e10d5da0da82",
          "name": "New SO?",
          "type": "n8n-nodes-base.if",
          "position": [
            2300,
            1080
          ],
          "parameters": {
            "conditions": {
              "number": [
                {
                  "value1": "={{ $json.value.length }}",
                  "operation": "smallerEqual"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "54292ca1-8d99-4ef8-8f46-a17633bd8a9d",
          "name": "Lookup Sales Invoice",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            2120,
            920
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json[\"tenantId\"] }}/{{ $('D365 BC Environment Settings').item.json[\"environmentName\"] }}/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json[\"companyId\"] }})/salesInvoices?$filter=externalDocumentNumber eq '{{ $json.order.id.toString() }}'&$select=id,number,externalDocumentNumber",
            "options": {},
            "authentication": "genericCredentialType",
            "genericAuthType": "oAuth2Api"
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "typeVersion": 4.1,
          "continueOnFail": true
        },
        {
          "id": "6c531d1b-a605-4212-88c9-292b818ca5d4",
          "name": "New Invoice?",
          "type": "n8n-nodes-base.if",
          "position": [
            2300,
            920
          ],
          "parameters": {
            "conditions": {
              "number": [
                {
                  "value1": "={{ $json.value.length }}",
                  "operation": "smallerEqual"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "6d7517eb-b32d-471d-93e3-4bbee0b7f06a",
          "name": "POS?",
          "type": "n8n-nodes-base.if",
          "position": [
            1920,
            1000
          ],
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{ $json.order.source_name }}",
                  "value2": "pos"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "b17c61c4-ce32-4b0f-88ac-aad47e5d785d",
          "name": "DELETE Sales Invoice",
          "type": "n8n-nodes-base.httpRequest",
          "onError": "continueRegularOutput",
          "position": [
            3720,
            440
          ],
          "parameters": {
            "url": "=https://api.businesscentral.dynamics.com/v2.0/{{ $('D365 BC Environment Settings').item.json.tenantId }}/Production/api/v2.0/companies({{ $('D365 BC Environment Settings').item.json.companyId }})/salesOrders({{ $json.so_id }})",
            "method": "DELETE",
            "options": {
              "batching": {
                "batch": {
                  "batchSize": 1
                }
              },
              "response": {
                "response": {}
              }
            },
            "sendBody": true,
            "sendHeaders": true,
            "authentication": "genericCredentialType",
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "genericAuthType": "oAuth2Api",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "oAuth2Api": {
              "id": "s8gGHYzOwlhE9yot",
              "name": "PROD_businessCentral_integro"
            }
          },
          "typeVersion": 4.1
        }
      ],
      "active": false,
      "pinData": {},
      "settings": {
        "callerPolicy": "workflowsFromSameOwner",
        "executionOrder": "v1",
        "executionTimeout": 300,
        "saveManualExecutions": false,
        "saveExecutionProgress": true,
        "saveDataSuccessExecution": "none"
      },
      "versionId": "82aaad0b-396d-4d9a-9550-731340124a18",
      "connections": {
        "POS?": {
          "main": [
            [
              {
                "node": "Lookup Sales Invoice",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Lookup Sales Order",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "GetFufillmentOrders",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New SO?": {
          "main": [
            [
              {
                "node": "Sales Order Mapping",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Shopify": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Create Order Lines",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New Invoice?": {
          "main": [
            [
              {
                "node": "Sales Invoice",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "SelectFields": {
          "main": [
            [
              {
                "node": "orderPreprocessing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set Lines SO": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New Customer?": {
          "main": [
            [
              {
                "node": "Create Customer",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Sales Invoice": {
          "main": [
            [
              {
                "node": "Create Sales Invoice",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Customer": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [
              {
                "node": "Set Business Central Customer Id",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Lookup Customers",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Lookup Customers": {
          "main": [
            [
              {
                "node": "New Customer?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "D365 BC Environment Settings",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set Lines Invoice": {
          "main": [
            [
              {
                "node": "Split Out Invoice",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out Invoice": {
          "main": [
            [
              {
                "node": "Create Invoice Lines",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Order Lines": {
          "main": [
            [
              {
                "node": "End",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "DELETE Sales Order",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Sales Order": {
          "main": [
            [
              {
                "node": "Set Lines SO",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Lookup Sales Order": {
          "main": [
            [
              {
                "node": "New SO?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "orderPreprocessing": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GetFufillmentOrders": {
          "main": [
            [
              {
                "node": "SelectFields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Sales Order Mapping": {
          "main": [
            [
              {
                "node": "Create Sales Order",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Invoice Lines": {
          "main": [
            [
              {
                "node": "End1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "DELETE Sales Invoice",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Sales Invoice": {
          "main": [
            [
              {
                "node": "Set Lines Invoice",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Lookup Sales Invoice": {
          "main": [
            [
              {
                "node": "New Invoice?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "D365 BC Environment Settings": {
          "main": [
            [
              {
                "node": "Shopify",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Set Business Central Customer Id": {
          "main": [
            [
              {
                "node": "POS?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "whatsapp-erp-router",
    "title": "WhatsApp ERP Support Router",
    "description": "Ingests WhatsApp webhooks, enriches messages via Gemini, and routes cases into ERPNext + Outlook workflows.",
    "problem": "Support teams need to convert customer WhatsApp threads into structured ERP tickets automatically.",
    "tags": [
      "whatsapp",
      "erpnext",
      "support"
    ],
    "metadata": {
      "industries": [
        "support",
        "operations"
      ],
      "domains": [
        "ticket-routing"
      ],
      "channels": [
        "whatsapp",
        "outlook"
      ],
      "trigger": "webhook",
      "complexity": "high",
      "integrations": [
        "WhatsApp",
        "ERPNext",
        "Outlook",
        "Gemini"
      ]
    },
    "workflow": {
      "meta": {
        "instanceId": "e4f78845dfed9ddcfba1945ae00d12e9a7d76eab052afd19299228ce02349d86"
      },
      "nodes": [
        {
          "id": "a8b14ffd-4a8b-4a3d-ba54-5997197e5457",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2880,
            340
          ],
          "parameters": {
            "color": 6,
            "width": 429.96763122593137,
            "height": 322,
            "content": "### Get Apprropraite Data\nThese Nodes are to extract only the Required Data from the Webhook Node"
          },
          "typeVersion": 1
        },
        {
          "id": "c8ae8766-3942-4b8d-8815-9e96ab9dc1de",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -840,
            340
          ],
          "parameters": {
            "color": 5,
            "width": 677,
            "height": 660,
            "content": "### N8N has the Node to convert PDF to Text, but PDF should be converted from Text. Scanned Image PDF will not be converted. \n\nYou can use ohter nodes here to convert word file to text or JPG to Text, possiblities are limitless."
          },
          "typeVersion": 1
        },
        {
          "id": "529f5756-c1a2-4c41-8245-38164543eb8e",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1334.2232779572741,
            340
          ],
          "parameters": {
            "color": 7,
            "width": 477.2230145794152,
            "height": 648.5051458745238,
            "content": "### Download the File.\nIf you are using S3 to Upload attachments you can use S3 node here to download the attachment\n"
          },
          "typeVersion": 1
        },
        {
          "id": "101c6544-d319-495d-a14f-e180f51be1f0",
          "name": "Code",
          "type": "n8n-nodes-base.code",
          "position": [
            -2840,
            480
          ],
          "parameters": {
            "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n item.json.myNewField = 1;\n}\n\nreturn $input.all();"
          },
          "typeVersion": 2
        },
        {
          "id": "5d0a1090-9be9-41e1-9a15-26bd6498fd95",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -3300,
            340
          ],
          "parameters": {
            "color": 5,
            "width": 398,
            "height": 642,
            "content": "### Applicant Applied for Job in ERPNext\n\nYou need to go to Webhooks in ERPNext and Create a Webhook on Job Applicant Doc Type and trigger should be on insert.\n\nFirst do the Test Wehbook and Pin the Webhook.\n\nFollow the Tutorial"
          },
          "typeVersion": 1
        },
        {
          "id": "4ed5dfbf-9b16-4f62-83e2-abb63421809b",
          "name": "ApplicantData",
          "type": "n8n-nodes-base.set",
          "position": [
            -2640,
            480
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "8d600a4f-14d3-4840-aea0-665d26e7771b",
                  "name": "body",
                  "type": "object",
                  "value": "={{ $json.body }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "4f141057-8dd6-429a-b48f-fd80b2666882",
          "name": "ERPNext - Reject if Resume not Attached",
          "type": "n8n-nodes-base.erpNext",
          "position": [
            -2380,
            800
          ],
          "parameters": {
            "docType": "Job%20Applicant",
            "operation": "update",
            "properties": {
              "customProperty": [
                {
                  "field": "status",
                  "value": "Rejected"
                }
              ]
            },
            "documentName": "={{ $('ApplicantData').item.json.body.name }}"
          },
          "credentials": {
            "erpNextApi": {
              "id": "PInpnsxvPkvaiW0z",
              "name": "ERPNext account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "de0a9900-4109-4092-ad3b-f36f02517fdf",
          "name": "Applied Against Job",
          "type": "n8n-nodes-base.if",
          "position": [
            -2140,
            460
          ],
          "parameters": {
            "options": {
              "ignoreCase": true
            },
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": false,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "abbbd6f3-838e-43fb-a809-6bfffb153244",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $json.body.Job_opening }}",
                  "rightValue": "None"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "1c8e889b-dcd9-4807-8528-a7f0300bf558",
          "name": "ERPNext - Hold Applicant",
          "type": "n8n-nodes-base.erpNext",
          "position": [
            -2180,
            800
          ],
          "parameters": {
            "docType": "Job%20Applicant",
            "operation": "update",
            "properties": {
              "customProperty": [
                {
                  "field": "status",
                  "value": "Hold"
                }
              ]
            },
            "documentName": "={{ $('ApplicantData').item.json.body.name }}"
          },
          "credentials": {
            "erpNextApi": {
              "id": "PInpnsxvPkvaiW0z",
              "name": "ERPNext account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "548c61dd-bcc3-4a7f-970e-5ff734926499",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -140,
            343.6198532285906
          ],
          "parameters": {
            "color": 6,
            "width": 258,
            "height": 638.3801467714094,
            "content": "### Get Job Opening Data\nFrom ERPNext\n\nAs Job is applied against a specific Job, you can now get the Job Opening Data which must be having the Job Description."
          },
          "typeVersion": 1
        },
        {
          "id": "6266e3e0-9bd7-4ab6-a488-55f1b524000f",
          "name": "Get Job Opening",
          "type": "n8n-nodes-base.erpNext",
          "position": [
            -80,
            620
          ],
          "parameters": {
            "docType": "Job%20Opening",
            "operation": "get",
            "documentName": "={{ $('ApplicantData').item.json.body.Job_opening }}"
          },
          "credentials": {
            "erpNextApi": {
              "id": "PInpnsxvPkvaiW0z",
              "name": "ERPNext account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "536755cf-19d6-44a4-8449-635f4562b61f",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            140,
            320
          ],
          "parameters": {
            "color": 4,
            "width": 406.7864870360547,
            "height": 662,
            "content": "### AI Agent to do its Job\nOpenAI\n\nSee full prompt which tells this AI Agent that you are a recruitment sepcialist and all the roles are defined in this node.\n\nIt will shortlist the candidate and will give the descriptive output with candidate fitlevel, score, rating and justification."
          },
          "typeVersion": 1
        },
        {
          "id": "0072826c-0e24-4c1f-89f9-388dc6e59ae5",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            980,
            320
          ],
          "parameters": {
            "color": 6,
            "width": 438,
            "height": 662,
            "content": "### Update data in ERPNext\nHere First node will do the formatting of the data and will convert output from AI Agent to Appropriate Fields which are defined in ERPNext and then will Send to Next Node\n\n### ERPNext (HTTP Node)\nThis node will take the Data from Previouis Node and will update the Applicant Data in ERPNext"
          },
          "typeVersion": 1
        },
        {
          "id": "28f23589-0608-4ed0-9e70-b6cbd31aa387",
          "name": "Google Gemini Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            220,
            800
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.0-flash-exp"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "pKFvSpPWSRFpnBoB",
              "name": "Google Gemini(PaLM) Api account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "8bdd8f1c-e546-4ffb-a058-a3271fcad156",
          "name": "Convert to Fields",
          "type": "n8n-nodes-base.code",
          "position": [
            660,
            620
          ],
          "parameters": {
            "jsCode": "// Input text from the `output` field\nconst textOutput = $json.output || '';\n\n// Function to extract values from the text\nfunction extractFields(text) {\n const fields = {};\n\n // Regular expressions to extract each field\n const fitLevelMatch = text.match(/FitLevel:\\s*(.+)\\n/);\n const scoreMatch = text.match(/Score:\\s*(\\d+)\\n/);\n const ratingMatch = text.match(/Rating:\\s*(\\d+)\\n/);\n const justificationMatch = text.match(/Justification:\\s*([\\s\\S]+)/);\n\n // Assign extracted values to the fields\n fields.fit_level = fitLevelMatch ? fitLevelMatch[1].trim() : null;\n fields.score = scoreMatch ? scoreMatch[1].trim() : null;\n fields.applicant_rating = ratingMatch ? ratingMatch[1].trim() : null;\n fields.justification_by_ai = justificationMatch ? justificationMatch[1].trim() : null;\n\n return fields;\n}\n\n// Extract fields from the output\nconst extractedFields = extractFields(textOutput);\n\n// Return the fields as JSON\nreturn {\n json: extractedFields\n};\n"
          },
          "typeVersion": 2
        },
        {
          "id": "ae1dc677-9ad7-4138-969f-2ee73b8537f9",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1460,
            320
          ],
          "parameters": {
            "color": 5,
            "width": 226.43884349833064,
            "height": 682,
            "content": "### Selected or Rejected\n\nThe criteia for score is that if Score is 80 or above Candidate will be selected Else Rejected."
          },
          "typeVersion": 1
        },
        {
          "id": "090f4f22-639a-4fc7-8351-04dafcc09638",
          "name": "If score less than 80",
          "type": "n8n-nodes-base.if",
          "position": [
            1520,
            620
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "5f845292-f4aa-44fb-a644-06c0736c3503",
                  "operator": {
                    "type": "number",
                    "operation": "lt"
                  },
                  "leftValue": "={{ $('Convert to Fields').item.json.score }}",
                  "rightValue": 80
                }
              ]
            },
            "looseTypeValidation": true
          },
          "typeVersion": 2.2
        },
        {
          "id": "0d7a84c2-0b1d-4e61-a3df-b81dd7981f1a",
          "name": "Reject Applicant",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1880,
            460
          ],
          "parameters": {
            "url": "=https://erpnext.syncbricks.com/api/resource/Job Applicant/{{ $('ApplicantData').item.json.body.name }}",
            "method": "PUT",
            "options": {},
            "jsonBody": "={\n \"status\": \"Rejected\"\n}",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "headerParameters": {
              "parameters": [
                {}
              ]
            },
            "nodeCredentialType": "erpNextApi"
          },
          "credentials": {
            "erpNextApi": {
              "id": "PInpnsxvPkvaiW0z",
              "name": "ERPNext account"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "a55e70d1-7070-407d-9107-41cb33d2f0ae",
          "name": "Update Applicant Data",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1140,
            620
          ],
          "parameters": {
            "url": "=https://erpnext.syncbricks.com/api/resource/Job Applicant/{{ $('ApplicantData').item.json.body.name }}",
            "method": "PUT",
            "options": {},
            "jsonBody": "={\n \"applicant_rating\": \"{{ $json.applicant_rating }}\",\n \"custom_justification_by_ai\": \"{{ $json.justification_by_ai }}\",\n \"custom_fit_level\": \"{{ $json.fit_level }}\",\n \"custom_score\":\"{{ $json.score }}\"\n}\n\n\n\n\n",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "headerParameters": {
              "parameters": [
                {}
              ]
            },
            "nodeCredentialType": "erpNextApi"
          },
          "credentials": {
            "erpNextApi": {
              "id": "PInpnsxvPkvaiW0z",
              "name": "ERPNext account"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "044d26cb-2b34-4613-8d1d-20f40b47da29",
          "name": "Reume Attachment Link",
          "type": "n8n-nodes-base.set",
          "position": [
            -1820,
            560
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "7d0b8b98-0976-4c19-bc7c-738fabd60d28",
                  "name": "body.resume_attachment",
                  "type": "string",
                  "value": "={{ $json.body.resume_link }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "a17e9c94-0ec7-430f-adf3-109bcccf3bcb",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2874.102923130834,
            680
          ],
          "parameters": {
            "color": 3,
            "width": 875.658619343735,
            "height": 302,
            "content": "## Resume Available?\nFirst Node : If Resume is not attached or Then Job Applicant will be Rejected\nSecond Node : If job is not applied against opening then the Applicant will be kept on hold."
          },
          "typeVersion": 1
        },
        {
          "id": "e2508130-4ecd-4d19-b41c-293006d17507",
          "name": "Resume Link Provided",
          "type": "n8n-nodes-base.if",
          "position": [
            -2400,
            480
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "3cd3da7d-d0fb-43fd-be10-3c1e627846b9",
                  "operator": {
                    "type": "string",
                    "operation": "startsWith"
                  },
                  "leftValue": "={{ $json.body.resume_link }}",
                  "rightValue": "http"
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "e6770961-05b2-4488-99b1-7d1a219f8372",
          "name": "Accept Applicant",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1860,
            760
          ],
          "parameters": {
            "url": "=https://erpnext.syncbricks.com/api/resource/Job Applicant/{{ $('ApplicantData').item.json.body.name }}",
            "method": "PUT",
            "options": {},
            "jsonBody": "={\n \"status\": \"Accepted\"\n}",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "headerParameters": {
              "parameters": [
                {}
              ]
            },
            "nodeCredentialType": "erpNextApi"
          },
          "credentials": {
            "erpNextApi": {
              "id": "PInpnsxvPkvaiW0z",
              "name": "ERPNext account"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "6b7ad5c5-2a6f-4bb8-8296-3defb40f9605",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -3800,
            340
          ],
          "parameters": {
            "color": 4,
            "width": 475.27306699862953,
            "height": 636.1483291619771,
            "content": "## Developed by Amjid Ali\n\nThank you for using this workflow template. It has taken me countless hours of hard work, research, and dedication to develop, and I sincerely hope it adds value to your work.\n\nIf you find this template helpful, I kindly ask you to consider supporting my efforts. Your support will help me continue improving and creating more valuable resources.\n\nYou can contribute via PayPal here:\n\nhttp://paypal.me/pmptraining\n\nFor Full Course about ERPNext or Automation using AI follow below link\n\nhttp://lms.syncbricks.com\n\nAdditionally, when sharing this template, I would greatly appreciate it if you include my original information to ensure proper credit is given.\n\nThank you for your generosity and support!\nEmail : amjid@amjidali.com\nhttps://linkedin.com/in/amjidali\nhttps://syncbricks.com\nhttps://youtube.com/@syncbricks"
          },
          "typeVersion": 1
        },
        {
          "id": "173c6341-2ab7-4ee5-a6bd-0770ae19c013",
          "name": "Webhook",
          "type": "n8n-nodes-base.webhook",
          "position": [
            -3180,
            620
          ],
          "webhookId": "f003f8ea-1f24-457c-8f28-762bd7942023",
          "parameters": {
            "path": "syncbricks-com-tutorial-candidate-shortlist",
            "options": {},
            "httpMethod": "POST"
          },
          "typeVersion": 2
        },
        {
          "id": "cb0a8dd4-6673-4043-af76-0bf4537a8173",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1980,
            340
          ],
          "parameters": {
            "color": 6,
            "width": 613.5767730410602,
            "height": 654.6630436071407,
            "content": "### Get file of Resume Detail from ERPNext Applicant\nExtract the Resume Download Link and Decide which Attachment type it is as every attachment will be treated differently.\nCurrently I provided only for PDF Version but you can add seperate flow for other versions"
          },
          "typeVersion": 1
        },
        {
          "id": "101938bd-75cd-4557-a44f-ba64c4181f70",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -2420,
            340
          ],
          "parameters": {
            "color": 6,
            "width": 429.96763122593137,
            "height": 310.20584626167124,
            "content": "### Validate if the Resume is Available and It is against a specific Job\nThese Nodes are to extract only the Required Data from the Webhook Node"
          },
          "typeVersion": 1
        },
        {
          "id": "596bcbd5-b94a-4a06-aa83-f7d9dc6264be",
          "name": "File Type",
          "type": "n8n-nodes-base.switch",
          "position": [
            -1600,
            560
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "pdf",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "operator": {
                          "type": "string",
                          "operation": "endsWith"
                        },
                        "leftValue": "={{ $json.body.resume_attachment }}",
                        "rightValue": ".pdf"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "doc",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "dabe1bd2-9aba-4a61-b0b3-08c22856b213",
                        "operator": {
                          "type": "string",
                          "operation": "contains"
                        },
                        "leftValue": "={{ $json.body.resume_attachment }}",
                        "rightValue": ".doc"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": ".jpg",
                  "conditions": {
                    "options": {
                      "version": 2,
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "1101fc2e-4220-4795-9342-58d88ea146ce",
                        "operator": {
                          "type": "string",
                          "operation": "endsWith"
                        },
                        "leftValue": "={{ $json.body.resume_attachment }}",
                        "rightValue": ".jpg"
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 3.2
        },
        {
          "id": "cc7f4ca0-8e9b-49de-a7f1-f1f7913d6dcc",
          "name": "Download PDF Resume",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            -1160,
            460
          ],
          "parameters": {
            "url": "={{ $json.body.resume_attachment }}",
            "options": {}
          },
          "typeVersion": 4.2
        },
        {
          "id": "1209643a-7133-45cf-98a3-e242e2e1766b",
          "name": "PDF to Text",
          "type": "n8n-nodes-base.extractFromFile",
          "position": [
            -720,
            440
          ],
          "parameters": {
            "options": {},
            "operation": "pdf"
          },
          "typeVersion": 1
        },
        {
          "id": "17430d0d-7bca-4ed9-b80e-d1f81dad5d58",
          "name": "Txt File to Text (Example)",
          "type": "n8n-nodes-base.extractFromFile",
          "position": [
            -740,
            680
          ],
          "parameters": {
            "options": {},
            "operation": "text"
          },
          "typeVersion": 1
        },
        {
          "id": "2ab3f083-66d7-4a28-9b00-b9dabcd84282",
          "name": "Merge1",
          "type": "n8n-nodes-base.merge",
          "position": [
            -420,
            620
          ],
          "parameters": {},
          "typeVersion": 3
        },
        {
          "id": "e45d5828-1e7b-454e-9a79-7ab0f60e3cd9",
          "name": "Recruitment AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            200,
            620
          ],
          "parameters": {
            "text": "=System Prompt : \nYou are a highly skilled AI agent trained to compare and analyze text from resumes against job descriptions. Your primary goal is to assess whether the candidate is a good fit for the role based on the given inputs. You will receive two inputs:\n\n1. **Job Description**: A detailed description of the responsibilities, qualifications, and skills required for a specific job role.\n2. **Resume Text**: A summary of a candidate's qualifications, skills, experience, and education.\n\nYour task is to:\n1. **Analyze Match**: Compare the candidate's resume text against the job description and assess the alignment of:\n - Required skills\n - Relevant experience\n - Educational background\n - Certifications\n - Keywords mentioned in both texts (e.g., specific tools, methodologies, or terminologies).\n\n2. **Assess Fit**: Determine if the candidate is a strong, moderate, or weak fit for the role. Assign a score from 0 to 100 based on relevance:\n - **Strong Fit**: 80â€“100 (Candidate meets or exceeds the majority of the job requirements).\n - **Moderate Fit**: 50â€“79 (Candidate meets some key requirements but lacks in others).\n - **Weak Fit**: Below 50 (Candidate does not align with the role requirements).\n\n3. **Provide Justification**: Include a brief explanation of why the candidate is or isnâ€™t a good fit, highlighting strengths, gaps, or missing criteria.\n\nOutput Format:\n- **Fit Level**: [Strong Fit / Moderate Fit / Weak Fit]\n- **Score**: [0â€“100]\n- **Rating**: [0â€“5]\n- **Justification**: A concise summary of the reasoning behind the fit level.\n\nRemember to maintain a neutral and objective tone in your analysis and ensure that your assessment is solely based on the information provided in the inputs.\"\n\n\nProvide me the output in the following format:\n\nFitLevel\n<fitLevel>\n\nScore:\n<score>\n\nRating:\n<rating>\n\nJustification:\n<justification>\n\nBelow are the inputs \n\nJob Title : {{ $json.job_title }}\nJob Desription : {{ $json.description }}\n\n\nHere here Job Applican't text from Resume : \n{{ $('PDF to Text').item.json.text }}\n",
            "agent": "reActAgent",
            "options": {},
            "promptType": "define"
          },
          "typeVersion": 1.7
        },
        {
          "id": "02d40fbc-3b2a-4350-bd01-2dcca11cf23b",
          "name": "Sticky Note14",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            560,
            320
          ],
          "parameters": {
            "color": 6,
            "width": 374.6910896370089,
            "height": 662,
            "content": "### Create Fields\n\nThis Java Script will convert the extracted fieldws from AI Agent and will create fields which are already created in ERPNext.\n\nEnsure to create below fields in ERPNext : \n\njustification_by_ai\nfit_level\nscore\n\napplicant_rating field is already there, which will be updated with 1 to 5 star"
          },
          "typeVersion": 1
        },
        {
          "id": "fdc011c2-e734-44fe-8a83-975247445d16",
          "name": "Sticky Note15",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1720,
            320
          ],
          "parameters": {
            "color": 3,
            "width": 394.2810709723076,
            "height": 308.0357387860514,
            "content": "### Update data in ERPNext\nAPI Call\nCandidate Rejected"
          },
          "typeVersion": 1
        },
        {
          "id": "3c4174cc-b947-4461-87a6-a7dbd0e3c78d",
          "name": "Sticky Note16",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1720,
            660
          ],
          "parameters": {
            "color": 4,
            "width": 385.4472695263088,
            "height": 308.0357387860514,
            "content": "### Update data in ERPNext\nAPI Call\nCandidate Rejected"
          },
          "typeVersion": 1
        },
        {
          "id": "0116aa6d-2783-487b-b457-47a6b7d69f02",
          "name": "Microsoft Outlook",
          "type": "n8n-nodes-base.microsoftOutlook",
          "position": [
            2240,
            460
          ],
          "parameters": {
            "additionalFields": {}
          },
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "9gy3uvf3pmBdpEsq",
              "name": "Microsoft Outlook Al Ansari"
            }
          },
          "typeVersion": 2
        },
        {
          "id": "f2eac576-3a17-46e8-8800-1ba250e53047",
          "name": "Sticky Note17",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2140,
            331.1661985540012
          ],
          "parameters": {
            "color": 6,
            "width": 338.3336618143153,
            "height": 623.107990360008,
            "content": "### Notifiy Applicant either by Email or Whatsapp or SMS, Options are Limitless"
          },
          "typeVersion": 1
        },
        {
          "id": "d4a6e756-923c-47c8-9c12-b1e8dcc873ca",
          "name": "WhatsApp Business Cloud",
          "type": "n8n-nodes-base.whatsApp",
          "position": [
            2280,
            760
          ],
          "parameters": {
            "operation": "send",
            "requestOptions": {},
            "additionalFields": {}
          },
          "credentials": {
            "whatsAppApi": {
              "id": "E8IjegSMj5LTd8lA",
              "name": "WhatsApp Syncbricks Access Token Never Expires"
            }
          },
          "typeVersion": 1
        }
      ],
      "pinData": {},
      "connections": {
        "Code": {
          "main": [
            [
              {
                "node": "ApplicantData",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge1": {
          "main": [
            [
              {
                "node": "Get Job Opening",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "File Type": {
          "main": [
            [
              {
                "node": "Download PDF Resume",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PDF to Text": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ApplicantData": {
          "main": [
            [
              {
                "node": "Resume Link Provided",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Job Opening": {
          "main": [
            [
              {
                "node": "Recruitment AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Accept Applicant": {
          "main": [
            [
              {
                "node": "WhatsApp Business Cloud",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Reject Applicant": {
          "main": [
            [
              {
                "node": "Microsoft Outlook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Convert to Fields": {
          "main": [
            [
              {
                "node": "Update Applicant Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Applied Against Job": {
          "main": [
            [
              {
                "node": "Reume Attachment Link",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ERPNext - Hold Applicant",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Download PDF Resume": {
          "main": [
            [
              {
                "node": "PDF to Text",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Recruitment AI Agent": {
          "main": [
            [
              {
                "node": "Convert to Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Resume Link Provided": {
          "main": [
            [
              {
                "node": "Applied Against Job",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ERPNext - Reject if Resume not Attached",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If score less than 80": {
          "main": [
            [
              {
                "node": "Reject Applicant",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Accept Applicant",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Reume Attachment Link": {
          "main": [
            [
              {
                "node": "File Type",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Applicant Data": {
          "main": [
            [
              {
                "node": "If score less than 80",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Recruitment AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Txt File to Text (Example)": {
          "main": [
            [
              {
                "node": "Merge1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "slack-incident-webhook",
    "title": "Slack Incident Intake Hub",
    "description": "Uses form triggers, Hive alerting, and Slack responses to capture incidents, enrich them, and push follow-ups.",
    "problem": "Security teams need a consistent intake for incidents from forms/webhooks with Slack-based collaboration.",
    "tags": [
      "slack",
      "incident",
      "forms",
      "security"
    ],
    "metadata": {
      "industries": [
        "security"
      ],
      "domains": [
        "incident-response"
      ],
      "channels": [
        "slack"
      ],
      "trigger": "webhook",
      "complexity": "medium",
      "integrations": [
        "Slack",
        "TheHive",
        "Form Trigger"
      ]
    },
    "workflow": {
      "meta": {
        "instanceId": "03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8"
      },
      "nodes": [
        {
          "id": "71dd0b5e-7bb0-4d06-9769-753156d1acf3",
          "name": "TheHive Trigger",
          "type": "n8n-nodes-base.theHiveProjectTrigger",
          "position": [
            20,
            300
          ],
          "webhookId": "23c014ae-1191-4775-9c00-69e5e014b11d",
          "parameters": {
            "events": [
              "case_create"
            ],
            "options": {}
          },
          "typeVersion": 1
        },
        {
          "id": "659339a5-3b3e-4f57-8aec-4c368b01890c",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            280,
            520
          ],
          "parameters": {
            "color": 7,
            "width": 455.1635858314854,
            "height": 538.2816200839441,
            "content": "![slack](https://uploads.n8n.io/templates/slack.png)\n## Events Webhook Trigger\nThe first node receives all messages from Slack API via Subscription Events API. You can find more information about setting up the subscription events API by [clicking here](https://api.slack.com/apis/connections/events-api). The second node extracts the payload from slack into an object that n8n can understand.  "
          },
          "typeVersion": 1
        },
        {
          "id": "c3ec7525-41f5-426c-a1c9-63b4596c8632",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -160,
            -60
          ],
          "parameters": {
            "color": 7,
            "width": 543.689530484159,
            "height": 516.5011820330969,
            "content": "![theHive](https://uploads.n8n.io/templates/thehive.png)\n## TheHive Trigger\nTo setup TheHive 5's triggers, visit the Settings in TheHive and add a webhook using the url found TheHive node."
          },
          "typeVersion": 1
        },
        {
          "id": "d754ebe1-8a9e-4ae2-9a51-b6d359866ec3",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            400,
            -60
          ],
          "parameters": {
            "color": 7,
            "width": 686.8181233897246,
            "height": 516.5011820330969,
            "content": "![Slack](https://uploads.n8n.io/templates/slack.png)\n## Post TheHive Case to Slack\nThe Case data is then mapped to Slack Block Kit and pushed to Slack. In Slack, it lives as a database object, mapping the Case Id to the block kit values themselves, so they can be updated in TheHive. "
          },
          "typeVersion": 1
        },
        {
          "id": "6ac8fc89-6640-4799-93cb-eb1afa0e35c9",
          "name": "Edit Fields",
          "type": "n8n-nodes-base.set",
          "position": [
            580,
            880
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "e63f9299-a19d-4ba1-93b0-59f458769fb2",
                  "name": "response",
                  "type": "object",
                  "value": "={{ $json.body.payload }}"
                },
                {
                  "id": "d95dda30-0a5c-4c63-8b4a-6b4e0a2bcb59",
                  "name": "dictionary",
                  "type": "object",
                  "value": "{\"PAP\":{\"WHITE\":\"ðŸ•Šï¸\",\"GREEN\":\"ðŸŸ¢\",\"AMBER\":\"ðŸŸ \",\"RED\":\"ðŸ”´\"},\"Severity\":{\"LOW\":\"ðŸŸ¢\",\"MEDIUM\":\"ðŸŸ¡\",\"HIGH\":\"ðŸŸ \",\"CRITICAL\":\"ðŸ”´\"},\"Severityid\":{\"1\":\"LOW\",\"2\":\"MEDIUM\",\"3\":\"HIGH\",\"4\":\"CRITICAL\"},\"TLP\":{\"WHITE\":\"âšª\",\"GREEN\":\"ðŸŸ¢\",\"AMBER\":\"ðŸŸ \",\"RED\":\"ðŸ”´\"},\"STATUS\":{\"1\":\"New\",\"2\":\"InProgress\",\"3\":\"Duplicated\",\"4\":\"FalsePositive\",\"5\":\"Indeterminate\",\"6\":\"Other\",\"7\":\"TruePositive\"},\"STATUSEMOJI\":{\"1\":\"ðŸ†•\",\"2\":\"ðŸ”„\",\"3\":\"ðŸ“‘\",\"4\":\"âŽ\",\"5\":\"â“\",\"6\":\"ðŸŸ£\",\"7\":\"ðŸ”´\"}}"
                },
                {
                  "id": "2303d403-1329-47b4-9b74-4f679a2cc192",
                  "name": "theHiveUrl",
                  "type": "string",
                  "value": "http://37.27.1.230:9000"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "86f90f83-c115-4561-8c0f-432c2ebb18b5",
          "name": "Task Modal",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1800,
            3040
          ],
          "parameters": {
            "url": "https://slack.com/api/views.open",
            "method": "POST",
            "options": {},
            "jsonBody": "=  {\n    \"trigger_id\": \"{{ $('Edit Fields').item.json['response']['trigger_id'] }}\",\n    \"external_id\": \"TheHive Task Adder\",\n    \"view\": {\n\t\"type\": \"modal\",\n\t\"callback_id\": \"add_task_modal\",\n\t\"title\": {\n\t\t\"type\": \"plain_text\",\n\t\t\"text\": \"Add a Task to Case\",\n\t\t\"emoji\": true\n\t},\n\t\"submit\": {\n\t\t\"type\": \"plain_text\",\n\t\t\"text\": \"Submit\",\n\t\t\"emoji\": true\n\t},\n\t\"close\": {\n\t\t\"type\": \"plain_text\",\n\t\t\"text\": \"Cancel\",\n\t\t\"emoji\": true\n\t},\n\t\"blocks\": [\n\t\t{\n\t\t\t\"type\": \"context\",\n\t\t\t\"block_id\": \"case_number_context\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $('Edit Fields').item.json[\"response\"][\"message\"][\"blocks\"][1][\"text\"][\"text\"] }}\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\"text\": \"{{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}\",\n\t\t\t\t\t\"emoji\": true\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"input\",\n\t\t\t\"block_id\": \"title_block\",\n\t\t\t\"element\": {\n\t\t\t\t\"type\": \"plain_text_input\",\n\t\t\t\t\"action_id\": \"title_input\",\n\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\"text\": \"Enter the task title\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"label\": {\n\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\"text\": \"Title\",\n\t\t\t\t\"emoji\": true\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"input\",\n\t\t\t\"block_id\": \"description_block\",\n\t\t\t\"element\": {\n\t\t\t\t\"type\": \"plain_text_input\",\n\t\t\t\t\"action_id\": \"description_input\",\n\t\t\t\t\"multiline\": true,\n\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\"text\": \"Enter a description for the task\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"label\": {\n\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\"text\": \"Description\",\n\t\t\t\t\"emoji\": true\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"input\",\n\t\t\t\"block_id\": \"group_block\",\n\t\t\t\"element\": {\n\t\t\t\t\"type\": \"plain_text_input\",\n\t\t\t\t\"action_id\": \"group_input\",\n\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\"text\": \"Enter the group name\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"label\": {\n\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\"text\": \"Group\",\n\t\t\t\t\"emoji\": true\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"actions\",\n\t\t\t\"block_id\": \"case-options\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"checkboxes\",\n\t\t\t\t\t\"options\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\t\t\t\"text\": \":exclamation: *Mandatory*\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"description\": {\n\t\t\t\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\t\t\t\"text\": \"Make this case Mandatory\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"mandatory\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\t\t\t\"text\": \":triangular_flag_on_post: *Flagged*\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"description\": {\n\t\t\t\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\t\t\t\"text\": \"Flag this case\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"flagged\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"action_id\": \"submit-task-option\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"input\",\n\t\t\t\"block_id\": \"due_date_block\",\n\t\t\t\"element\": {\n\t\t\t\t\"type\": \"datepicker\",\n\t\t\t\t\"action_id\": \"due_date_input\",\n\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\"text\": \"Select a due date and time\"\n\t\t\t\t},\n\t\t\t\t\"initial_date\": \"{{$today.format('yyyy-MM-dd')}}\"\n\t\t\t},\n\t\t\t\"label\": {\n\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\"text\": \"Due Date\",\n\t\t\t\t\"emoji\": true\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"input\",\n\t\t\t\"block_id\": \"assignee_block\",\n\t\t\t\"element\": {\n\t\t\t\t\"type\": \"users_select\",\n\t\t\t\t\"action_id\": \"assignee_input\",\n\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\"text\": \"Select an assignee\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"label\": {\n\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\"text\": \"Assignee\",\n\t\t\t\t\"emoji\": true\n\t\t\t}\n\t\t}\n\t]\n}\n}",
            "sendBody": true,
            "jsonQuery": "{\n  \"Content-type\": \"application/json\"\n}",
            "sendQuery": true,
            "specifyBody": "json",
            "specifyQuery": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "slackApi"
          },
          "credentials": {
            "slackApi": {
              "id": "hOkN2lZmH8XimxKh",
              "name": "TheHive Slack App"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "e2874195-4b4e-4288-937f-201e4a361438",
          "name": "HTTP Request",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            460,
            300
          ],
          "parameters": {
            "url": "https://slack.com/api/users.lookupByEmail",
            "options": {},
            "sendQuery": true,
            "authentication": "predefinedCredentialType",
            "queryParameters": {
              "parameters": [
                {
                  "name": "email",
                  "value": "={{ $('TheHive Trigger').item.json[\"body\"][\"object\"][\"assignee\"] }}"
                }
              ]
            },
            "nodeCredentialType": "slackApi"
          },
          "credentials": {
            "slackApi": {
              "id": "hOkN2lZmH8XimxKh",
              "name": "TheHive Slack App"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "9fbf2b59-e6c3-45b5-aceb-5e98ebad9814",
          "name": "Formatting Dictionaries",
          "type": "n8n-nodes-base.set",
          "position": [
            240,
            300
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "4a0f7bf9-f346-4ccf-8026-79c984cdedb5",
                  "name": "dictionary",
                  "type": "object",
                  "value": "{\"PAP\":{\"CLEAR\":\"ðŸ•Šï¸\",\"GREEN\":\"ðŸŸ¢\",\"AMBER\":\"ðŸŸ \",\"RED\":\"ðŸ”´\"},\"Severity\":{\"LOW\":\"ðŸŸ¢\",\"MEDIUM\":\"ðŸŸ¡\",\"HIGH\":\"ðŸŸ \",\"CRITICAL\":\"ðŸ”´\"},\"TLP\":{\"CLEAR\":\"âšª\",\"GREEN\":\"ðŸŸ¢\",\"AMBER\":\"ðŸŸ \",\"RED\":\"ðŸ”´\"},\"STATUS\":{\"NEW\":\"ðŸ†•\",\"inprogress\":\"ðŸ”„\",\"Duplicated\":\"ðŸ“‘\",\"Falsepositive\":\"âŽ\",\"Indeterminate\":\"â“\",\"Other\":\"ðŸŸ£\",\"Truepositive\":\"ðŸ”´\"}}"
                },
                {
                  "id": "32a165d5-cd94-454e-bcf9-9254decb63cb",
                  "name": "theHiveUrl",
                  "type": "string",
                  "value": "=http://37.27.1.230:9000"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "f5ab276e-809b-41df-ba86-020c1b3681e1",
          "name": "Prep Fields For Slack",
          "type": "n8n-nodes-base.set",
          "position": [
            680,
            300
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0001aed3-a3fb-4229-8fa1-1941f0ee8a12",
                  "name": "title",
                  "type": "string",
                  "value": "=:computer: *Case Title:*\\n {{ $('TheHive Trigger').item.json.body.details.title }}"
                },
                {
                  "id": "6f40871c-ea6f-4c61-9272-9342c99637e8",
                  "name": "datecreated",
                  "type": "string",
                  "value": "=*:date: Date Created:*\\n{{DateTime.fromMillis($('TheHive Trigger').item.json[\"body\"][\"context\"][\"_createdAt\"]).toLocaleString({month: 'long', day: 'numeric', year: 'numeric'})}}"
                },
                {
                  "id": "2ea20d66-380f-4a0f-a1ea-c4740293f48b",
                  "name": "number",
                  "type": "string",
                  "value": "=:hash: Case #{{ $('TheHive Trigger').item.json.body.details.number }} created on TheHive "
                },
                {
                  "id": "a22dd686-ac38-4e73-a0ec-051dce57f9fa",
                  "name": "severity",
                  "type": "string",
                  "value": "=*Severity:* {{ $('TheHive Trigger').item.json[\"body\"][\"context\"][\"severityLabel\"] }}"
                },
                {
                  "id": "1c210cfb-2a03-4e81-a8c5-2db739d98226",
                  "name": "tlp",
                  "type": "string",
                  "value": "=*Traffic Light Protocol(TLP):* {{ $('TheHive Trigger').item.json[\"body\"][\"context\"][\"tlpLabel\"] }}"
                },
                {
                  "id": "53e1d1a9-055a-48c2-80de-b694871c6620",
                  "name": "pap",
                  "type": "string",
                  "value": "=*Permissible Actions Protocol(PAP):* {{ $('TheHive Trigger').item.json[\"body\"][\"context\"][\"papLabel\"] }}"
                },
                {
                  "id": "ee630583-a6ad-4bab-ad78-7846df3ac093",
                  "name": "description",
                  "type": "string",
                  "value": "=:spiral_note_pad: *Case Description:*\\n{{ $('TheHive Trigger').item.json[\"body\"][\"context\"][\"description\"] }}"
                },
                {
                  "id": "48ac7d92-5177-46be-b01e-83493f18ee09",
                  "name": "assignee",
                  "type": "string",
                  "value": "={{ $json.user.profile.real_name }}"
                },
                {
                  "id": "f9c06ecf-d3d5-490c-a848-02c88fbd3ab4",
                  "name": "profilepic",
                  "type": "string",
                  "value": "={{ $json.user.profile.image_32 }}"
                },
                {
                  "id": "bb4ec29d-fac2-4eb9-a177-fca9d2798514",
                  "name": "caseid",
                  "type": "string",
                  "value": "={{ $('TheHive Trigger').item.json[\"body\"][\"objectId\"] }}"
                },
                {
                  "id": "7a485f44-b855-4633-ba51-82e7490d7166",
                  "name": "tags",
                  "type": "string",
                  "value": "=:label:  *Tags:*\\n{{ $('TheHive Trigger').item.json[\"body\"][\"context\"][\"tags\"].join(', ') }}"
                },
                {
                  "id": "a99d49b4-af10-4e04-a9c6-2b17a14643ff",
                  "name": "status_emoji",
                  "type": "string",
                  "value": "={{ $(`Formatting Dictionaries`).item.json.dictionary.STATUS[$('TheHive Trigger').item.json[\"body\"][\"context\"][\"status\"].toUpperCase()] }}"
                },
                {
                  "id": "a4884fc5-2d92-4c34-af9c-61240bc564d5",
                  "name": "status",
                  "type": "string",
                  "value": "={{ $('TheHive Trigger').item.json[\"body\"][\"context\"][\"status\"] }}"
                },
                {
                  "id": "7efb073b-1f1a-4d11-97a2-d61a9baeb52f",
                  "name": "tlp_emoji",
                  "type": "string",
                  "value": "={{ $(`Formatting Dictionaries`).item.json.dictionary.TLP[$('TheHive Trigger').item.json[\"body\"][\"context\"][\"tlpLabel\"].toUpperCase()] }}"
                },
                {
                  "id": "19f5bc67-97c3-47bc-8210-738057f30c1f",
                  "name": "pap_emoji",
                  "type": "string",
                  "value": "={{ $(`Formatting Dictionaries`).item.json.dictionary.PAP[$('TheHive Trigger').item.json[\"body\"][\"context\"][\"papLabel\"].toUpperCase()] }}"
                },
                {
                  "id": "d31504be-e4ef-4704-8b1b-cb1a8072298d",
                  "name": "severity_emoji",
                  "type": "string",
                  "value": "={{ $(`Formatting Dictionaries`).item.json.dictionary.Severity[$('TheHive Trigger').item.json[\"body\"][\"context\"][\"severityLabel\"].toUpperCase()] }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "b7747c0c-52ec-415b-aa55-ce399b53054b",
          "name": "Update Message with new Assignee",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            3200,
            1160
          ],
          "parameters": {
            "url": "https://slack.com/api/chat.update",
            "method": "POST",
            "options": {},
            "sendBody": true,
            "sendQuery": true,
            "authentication": "predefinedCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "channel",
                  "value": "={{ $('Edit Fields').item.json.response.channel.id }}"
                },
                {
                  "name": "ts",
                  "value": "={{ $('Edit Fields').item.json.response.container.message_ts }}"
                },
                {
                  "name": "blocks",
                  "value": "={{ JSON.stringify($json.blocks) }}"
                }
              ]
            },
            "queryParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            },
            "nodeCredentialType": "slackApi"
          },
          "credentials": {
            "slackApi": {
              "id": "hOkN2lZmH8XimxKh",
              "name": "TheHive Slack App"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "b548c331-1612-40a9-806c-8136c1eb6dbe",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            385.7161688656365
          ],
          "parameters": {
            "color": 7,
            "width": 706.9954015609856,
            "height": 467.56934570944634,
            "content": "![Slack](https://uploads.n8n.io/templates/slack.png)\n## Assign Case to Others\nSince slack does not send the slack user email, we must take the extra step \nof passing the user ID back to slack, and getting back the email address of \nthe person selecting the buttons. For this to work correctly, TheHive users \nemails and Slack user emails must be the same. "
          },
          "typeVersion": 1
        },
        {
          "id": "34dc3eb9-e19a-46c1-947d-65c9c5be9993",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            860
          ],
          "parameters": {
            "color": 7,
            "width": 1400.2199299541444,
            "height": 1720.4067726820667,
            "content": "![theHive](https://uploads.n8n.io/templates/thehive.png)\n# Streamlined Case Updates via Slack for SOC Analysts\n\n## This workflow segment is crucial for enhancing the responsiveness and efficiency of SOC operations by allowing analysts to update TheHive case attributes directly from Slack. By using form inputs and buttons embedded within Slack messages, analysts can quickly modify case details without switching to TheHive. This integration significantly speeds up case handling and improves the management of security incidents.\n\n\n**Key Operations:**\n- **Dynamic Slack Blocks**: Utilizes custom-built Slack block elements to present actionable items directly within the communication platform.\n- **Immediate Actions**: Enables actions like closing a case as a false positive, updating case severity, TLP (Traffic Light Protocol), PAP (Permissible Action Protocol), and more with simple clicks.\n- **Automated Updates**: Upon interaction, the workflow automatically updates the respective fields in TheHive, ensuring that all case information is current and accurately reflected.\n- **Feedback Loop**: After updating, a confirmation is sent back to Slack, confirming the action taken, which helps in maintaining clear communication and audit trails.\n\n\n**Benefits for SOC Analysts:**\n- **Efficiency**: Reduces the time spent switching between tools and streamlines the case update process.\n- **Accuracy**: Minimizes human error by automating data entry from Slack to TheHive.\n- **Visibility**: Keeps the entire team informed about case status updates in real-time, enhancing collaborative efforts.\n\n\n**Setup Note:**\n- Ensure that your TheHive and Slack integration permissions are configured to allow updates and that users are familiar with the operational workflow.\n- The last set of \"Set\" nodes on the far right of the workflow are designed to split the Slack block kit action into two parts. This split facilitates easier customization of the action options at the bottom of the Slack message. While customization is possible, a good understanding of JSON is desirable to modify these settings effectively.\n\n\nThis integration not only speeds up response times but also leverages the collaborative environment of Slack to keep the SOC team agile and well-informed."
          },
          "typeVersion": 1
        },
        {
          "id": "233924c6-eceb-4618-90fa-2633f0e3cf84",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1135,
            3242
          ],
          "parameters": {
            "color": 7,
            "width": 988.1220012094333,
            "height": 613.5055433060886,
            "content": "![slack](https://uploads.n8n.io/templates/slack.png)\n## Add a task to a Case - Process the task details\nOnce the modal window is submitted, this sections then processes the data sent in. Certain fields send data back to the server so the no operation check simply ignores certain types of inputs in the modal until the whole modal is filled out. "
          },
          "typeVersion": 1
        },
        {
          "id": "c32929b9-9f57-4f70-86da-e038c786d360",
          "name": "Check if Case Options",
          "type": "n8n-nodes-base.if",
          "position": [
            1175,
            3560
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "de563083-5735-42d3-8765-5b072b10ff9c",
                  "operator": {
                    "type": "string",
                    "operation": "notEquals"
                  },
                  "leftValue": "={{ $json.response.actions[0].action_id }}",
                  "rightValue": "submit-task-option"
                }
              ]
            }
          },
          "typeVersion": 2
        },
        {
          "id": "5887da0e-36eb-4bd3-8dba-6422dc8fa70a",
          "name": "Case Slack Block Rebuild",
          "type": "n8n-nodes-base.set",
          "position": [
            2340,
            680
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c1fccf83-8223-42a2-837e-11eafe5d23fd",
                  "name": "slackblocks",
                  "type": "string",
                  "value": "={\"type\":\"image\",\"block_id\":\"image_block\",\"image_url\":\"https://i.imgur.com/y2Yw1ZP.png\",\"alt_text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"caseid\"]}}\"},{\"type\":\"header\",\"block_id\":\"header_case_created\",\"text\":{\"type\":\"plain_text\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"number\"]}}\",\"emoji\":true}},{\"type\":\"divider\",\"block_id\":\"divider_1\"},{\"type\":\"section\",\"block_id\":\"section_case_details\",\"fields\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"title\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"datecreated\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"tags\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"description\"].replace(\"\\n\",\"\\\\n\")}}\"}]},{\"type\":\"actions\",\"block_id\":\"actions_case_options\",\"elements\":[{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Close Case as False Positive\",\"emoji\":true},\"style\":\"danger\",\"value\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"caseid\"]}}\",\"action_id\":\"close_case\"},{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Add a Task\",\"emoji\":true},\"value\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"caseid\"]}}\",\"action_id\":\"add_task\"}]},{\"type\":\"divider\",\"block_id\":\"divider_2\"},{\"type\":\"header\",\"block_id\":\"header_current_assignment\",\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ” Case Details:\",\"emoji\":true}},{\"type\":\"context\",\"block_id\":\"context_status\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"status\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_severity\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"severity\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_tlp\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"tlp\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_pap\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Assign').item.json[\"pap\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_assignee\",\"elements\":[{\"type\":\"image\",\"image_url\":\"{{ $('Get Slack User\\'s Email From Slack').item.json.profile.image_32 }}\",\"alt_text\":\"Profile Pic\"},{\"type\":\"mrkdwn\",\"text\":\"Assignee: {{ $('Get Slack User\\'s Email From Slack').item.json.profile.real_name }}\"}]}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "0dc10f84-c087-45ab-8b1d-f770725f400b",
          "name": "Close Case Block Rebuild",
          "type": "n8n-nodes-base.set",
          "position": [
            2400,
            1700
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c1fccf83-8223-42a2-837e-11eafe5d23fd",
                  "name": "slackblocks",
                  "type": "string",
                  "value": "={\"type\":\"image\",\"block_id\":\"image_block\",\"image_url\":\"https://i.imgur.com/y2Yw1ZP.png\",\"alt_text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"caseid\"]}}\"},{\"type\":\"header\",\"block_id\":\"header_case_created\",\"text\":{\"type\":\"plain_text\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"number\"]}}\",\"emoji\":true}},{\"type\":\"divider\",\"block_id\":\"divider_1\"},{\"type\":\"section\",\"block_id\":\"section_case_details\",\"fields\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"title\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"datecreated\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"tags\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"description\"].replace(\"\\n\",\"\\\\n\")}}\"}]},{\"type\":\"actions\",\"block_id\":\"actions_case_options\",\"elements\":[{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Close Case as False Positive\",\"emoji\":true},\"style\":\"danger\",\"value\":\"{{ $('Prep Fields For Slack - Close').item.json[\"caseid\"]}}\",\"action_id\":\"close_case\"},{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Add a Task\",\"emoji\":true},\"value\":\"{{ $('Prep Fields For Slack - Close').item.json[\"caseid\"]}}\",\"action_id\":\"add_task\"}]},{\"type\":\"divider\",\"block_id\":\"divider_2\"},{\"type\":\"header\",\"block_id\":\"header_current_assignment\",\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ” Case Details:\",\"emoji\":true}},{\"type\":\"context\",\"block_id\":\"context_status\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"status\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_severity\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"severity\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_tlp\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"tlp\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_pap\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"pap\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_assignee\",\"elements\":[{\"type\":\"image\",\"image_url\":\"{{ $('Prep Fields For Slack - Close').item.json[\"profilepic\"]}}\",\"alt_text\":\"Profile Pic\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Close').item.json[\"assignee\"] }}\"}]}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "3b95146f-d842-4c69-b537-bad5603ba0d0",
          "name": "Severity Case Block Rebuild1",
          "type": "n8n-nodes-base.set",
          "position": [
            2400,
            1880
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c1fccf83-8223-42a2-837e-11eafe5d23fd",
                  "name": "slackblocks",
                  "type": "string",
                  "value": "={\"type\":\"image\",\"block_id\":\"image_block\",\"image_url\":\"https://i.imgur.com/y2Yw1ZP.png\",\"alt_text\":\"{{ $('Prep Fields For Slack - Severity').item.json['caseid']}}\"},{\"type\":\"header\",\"block_id\":\"header_case_created\",\"text\":{\"type\":\"plain_text\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['number']}}\",\"emoji\":true}},{\"type\":\"divider\",\"block_id\":\"divider_1\"},{\"type\":\"section\",\"block_id\":\"section_case_details\",\"fields\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['title'].replace('\\n','\\\\n')}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['datecreated'].replace('\\n','\\\\n')}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['tags'].replace('\\n','\\\\n')}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['description'].replace('\\n','\\\\n')}}\"}]},{\"type\":\"actions\",\"block_id\":\"actions_case_options\",\"elements\":[{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Close Case as False Positive\",\"emoji\":true},\"style\":\"danger\",\"value\":\"{{ $('Prep Fields For Slack - Severity').item.json['caseid']}}\",\"action_id\":\"close_case\"},{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Add a Task\",\"emoji\":true},\"value\":\"{{ $('Prep Fields For Slack - Severity').item.json['caseid']}}\",\"action_id\":\"add_task\"}]},{\"type\":\"divider\",\"block_id\":\"divider_2\"},{\"type\":\"header\",\"block_id\":\"header_current_assignment\",\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ” Case Details:\",\"emoji\":true}},{\"type\":\"context\",\"block_id\":\"context_status\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['status']}}\"}]},{\"type\":\"context\",\"block_id\":\"context_severity\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['severity']}}\"}]},{\"type\":\"context\",\"block_id\":\"context_tlp\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['tlp']}}\"}]},{\"type\":\"context\",\"block_id\":\"context_pap\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['pap']}}\"}]},{\"type\":\"context\",\"block_id\":\"context_assignee\",\"elements\":[{\"type\":\"image\",\"image_url\":\"{{ $('Prep Fields For Slack - Severity').item.json['profilepic']}}\",\"alt_text\":\"Profile Pic\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Slack - Severity').item.json['assignee']}}\"}]}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "be1fe770-aaa2-4ed2-9ff1-5baa00423d76",
          "name": "PAP Case Block Rebuild",
          "type": "n8n-nodes-base.set",
          "position": [
            2400,
            2060
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c1fccf83-8223-42a2-837e-11eafe5d23fd",
                  "name": "slackblocks",
                  "type": "string",
                  "value": "={\"type\":\"image\",\"block_id\":\"image_block\",\"image_url\":\"https://i.imgur.com/y2Yw1ZP.png\",\"alt_text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"caseid\"]}}\"},{\"type\":\"header\",\"block_id\":\"header_case_created\",\"text\":{\"type\":\"plain_text\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"number\"]}}\",\"emoji\":true}},{\"type\":\"divider\",\"block_id\":\"divider_1\"},{\"type\":\"section\",\"block_id\":\"section_case_details\",\"fields\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"title\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"datecreated\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"tags\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"description\"].replace(\"\\n\",\"\\\\n\")}}\"}]},{\"type\":\"actions\",\"block_id\":\"actions_case_options\",\"elements\":[{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Close Case as False Positive\",\"emoji\":true},\"style\":\"danger\",\"value\":\"{{ $('Prep Fields For PAP Slack').item.json[\"caseid\"]}}\",\"action_id\":\"close_case\"},{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Add a Task\",\"emoji\":true},\"value\":\"{{ $('Prep Fields For PAP Slack').item.json[\"caseid\"]}}\",\"action_id\":\"add_task\"}]},{\"type\":\"divider\",\"block_id\":\"divider_2\"},{\"type\":\"header\",\"block_id\":\"header_current_assignment\",\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ” Case Details:\",\"emoji\":true}},{\"type\":\"context\",\"block_id\":\"context_status\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"status\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_severity\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"severity\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_tlp\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"tlp\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_pap\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"pap\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_assignee\",\"elements\":[{\"type\":\"image\",\"image_url\":\"{{ $('Prep Fields For PAP Slack').item.json[\"profilepic\"]}}\",\"alt_text\":\"Profile Pic\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For PAP Slack').item.json[\"assignee\"] }}\"}]}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "0d9a2036-6a4c-4ffd-95a8-34b6861894b9",
          "name": "Prep Fields For PAP Slack",
          "type": "n8n-nodes-base.set",
          "position": [
            1600,
            2060
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0001aed3-a3fb-4229-8fa1-1941f0ee8a12",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[0].text }}"
                },
                {
                  "id": "6f40871c-ea6f-4c61-9272-9342c99637e8",
                  "name": "datecreated",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[1].text }}"
                },
                {
                  "id": "2ea20d66-380f-4a0f-a1ea-c4740293f48b",
                  "name": "number",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[1].text.text }}"
                },
                {
                  "id": "a22dd686-ac38-4e73-a0ec-051dce57f9fa",
                  "name": "severity",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"response\"][\"message\"][\"blocks\"][8][\"elements\"][0][\"text\"] }}"
                },
                {
                  "id": "1c210cfb-2a03-4e81-a8c5-2db739d98226",
                  "name": "tlp",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[9].elements[0].text }}"
                },
                {
                  "id": "53e1d1a9-055a-48c2-80de-b694871c6620",
                  "name": "pap",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"dictionary\"][\"PAP\"][$('Edit Fields').item.json[\"response\"][\"state\"][\"values\"][\"actions_assignment_options\"][\"update_pap\"][\"selected_option\"][\"text\"][\"text\"].toUpperCase()] }} *Permissible Actions Protocol(PAP):* {{ $('Edit Fields').item.json[\"response\"][\"state\"][\"values\"][\"actions_assignment_options\"][\"update_pap\"][\"selected_option\"][\"text\"][\"text\"].toUpperCase() }}"
                },
                {
                  "id": "ee630583-a6ad-4bab-ad78-7846df3ac093",
                  "name": "description",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[3].text }}"
                },
                {
                  "id": "48ac7d92-5177-46be-b01e-83493f18ee09",
                  "name": "assignee",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[1].text }}"
                },
                {
                  "id": "f9c06ecf-d3d5-490c-a848-02c88fbd3ab4",
                  "name": "profilepic",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[0].image_url }}"
                },
                {
                  "id": "bb4ec29d-fac2-4eb9-a177-fca9d2798514",
                  "name": "caseid",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}"
                },
                {
                  "id": "7a485f44-b855-4633-ba51-82e7490d7166",
                  "name": "tags",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[2].text.replaceAll(\"\\n\",\"\\\\n\").replaceAll(\"**\",\"*\") }}"
                },
                {
                  "id": "a4884fc5-2d92-4c34-af9c-61240bc564d5",
                  "name": "status",
                  "type": "string",
                  "value": "={{ $json.response.message.blocks[7].elements[0].text }}"
                },
                {
                  "id": "449c052a-05b4-4c03-99a4-b5fe7ec0e102",
                  "name": "newassignee",
                  "type": "string",
                  "value": "={{ $json.response.state.values.actions_assignment_options['change-assignee'].selected_user }}"
                },
                {
                  "id": "8278ead1-85c0-4921-ac36-9abfd44f99c8",
                  "name": "papId",
                  "type": "number",
                  "value": "={{ $json.response.state.values.actions_assignment_options.update_pap.selected_option.value }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "574caf88-eef7-4b06-9f04-7a468ef56325",
          "name": "Map Actions",
          "type": "n8n-nodes-base.set",
          "position": [
            2700,
            1160
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "7d88f9ff-3046-491f-a31c-642839fba7b4",
                  "name": "actions",
                  "type": "string",
                  "value": "={{ $json.slackblocks }}"
                },
                {
                  "id": "5cde079d-1b30-41b0-948d-f3b8bacb88bf",
                  "name": "buttons",
                  "type": "string",
                  "value": "={\"type\":\"actions\",\"block_id\":\"actions_assignment_options\",\"elements\":[{\"type\":\"users_select\",\"placeholder\":{\"type\":\"plain_text\",\"text\":\"Change Assignee\",\"emoji\":true},\"action_id\":\"change-assignee\"},{\"type\":\"static_select\",\"placeholder\":{\"type\":\"plain_text\",\"text\":\"Change Status\",\"emoji\":true},\"action_id\":\"update-status\",\"options\":[{\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ†• New\",\"emoji\":true},\"value\":\"1\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ”„ In progress\",\"emoji\":true},\"value\":\"2\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ“‘ Duplicated\",\"emoji\":true},\"value\":\"3\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"âŽ False positive\",\"emoji\":true},\"value\":\"4\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"â“ Indeterminate\",\"emoji\":true},\"value\":\"5\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ”µ Other\",\"emoji\":true},\"value\":\"6\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"âœ… True positive\",\"emoji\":true},\"value\":\"7\"}]},{\"type\":\"static_select\",\"placeholder\":{\"type\":\"plain_text\",\"text\":\"Change severity\",\"emoji\":true},\"action_id\":\"update_severity\",\"options\":[{\"text\":{\"type\":\"plain_text\",\"text\":\"Low\",\"emoji\":true},\"value\":\"1\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Medium\",\"emoji\":true},\"value\":\"2\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"High\",\"emoji\":true},\"value\":\"3\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Critical\",\"emoji\":true},\"value\":\"4\"}]},{\"type\":\"static_select\",\"placeholder\":{\"type\":\"plain_text\",\"text\":\"Change TLP\",\"emoji\":true},\"action_id\":\"update_tlp\",\"options\":[{\"text\":{\"type\":\"plain_text\",\"text\":\"White\",\"emoji\":true},\"value\":\"0\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Green\",\"emoji\":true},\"value\":\"1\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Amber\",\"emoji\":true},\"value\":\"2\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Red\",\"emoji\":true},\"value\":\"3\"}]},{\"type\":\"static_select\",\"placeholder\":{\"type\":\"plain_text\",\"text\":\"Change PAP\",\"emoji\":true},\"action_id\":\"update_pap\",\"options\":[{\"text\":{\"type\":\"plain_text\",\"text\":\"White\",\"emoji\":true},\"value\":\"0\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Green\",\"emoji\":true},\"value\":\"1\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Amber\",\"emoji\":true},\"value\":\"2\"},{\"text\":{\"type\":\"plain_text\",\"text\":\"Red\",\"emoji\":true},\"value\":\"3\"}]}]},{\"type\":\"section\",\"text\":{\"type\":\"mrkdwn\",\"text\":\":bee: View the case in TheHive\"},\"accessory\":{\"type\":\"button\",\"style\":\"primary\",\"text\":{\"type\":\"plain_text\",\"text\":\"View Case\",\"emoji\":true},\"value\":\"click_me_123\",\"url\":\"{{ $('Edit Fields').item.json.theHiveUrl }}/cases/{{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}/details\",\"action_id\":\"viewlink\"}}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "d0e2d26f-9ab1-4f4f-a700-d686dda8dbef",
          "name": "Build Final Block",
          "type": "n8n-nodes-base.set",
          "position": [
            2920,
            1160
          ],
          "parameters": {
            "mode": "raw",
            "options": {},
            "jsonOutput": "={\"blocks\": [{{ $json.actions }},{{ $json.buttons }}]}"
          },
          "typeVersion": 3.3
        },
        {
          "id": "e189e865-664a-47c1-b877-59788967c852",
          "name": "Prep Fields For TLP Slack",
          "type": "n8n-nodes-base.set",
          "position": [
            1600,
            2240
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0001aed3-a3fb-4229-8fa1-1941f0ee8a12",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[0].text }}"
                },
                {
                  "id": "6f40871c-ea6f-4c61-9272-9342c99637e8",
                  "name": "datecreated",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[1].text }}"
                },
                {
                  "id": "2ea20d66-380f-4a0f-a1ea-c4740293f48b",
                  "name": "number",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[1].text.text }}"
                },
                {
                  "id": "a22dd686-ac38-4e73-a0ec-051dce57f9fa",
                  "name": "severity",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"response\"][\"message\"][\"blocks\"][8][\"elements\"][0][\"text\"] }}"
                },
                {
                  "id": "1c210cfb-2a03-4e81-a8c5-2db739d98226",
                  "name": "tlp",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"dictionary\"][\"TLP\"][$('Edit Fields').item.json[\"response\"][\"state\"][\"values\"][\"actions_assignment_options\"][\"update_tlp\"][\"selected_option\"][\"text\"][\"text\"].toUpperCase()] }} *Traffic Light Protocol(TLP):* {{ $('Edit Fields').item.json[\"response\"][\"state\"][\"values\"][\"actions_assignment_options\"][\"update_tlp\"][\"selected_option\"][\"text\"][\"text\"].toUpperCase() }}"
                },
                {
                  "id": "53e1d1a9-055a-48c2-80de-b694871c6620",
                  "name": "pap",
                  "type": "string",
                  "value": "={{ $json.response.message.blocks[10].elements[0].text }}"
                },
                {
                  "id": "ee630583-a6ad-4bab-ad78-7846df3ac093",
                  "name": "description",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[3].text }}"
                },
                {
                  "id": "48ac7d92-5177-46be-b01e-83493f18ee09",
                  "name": "assignee",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[1].text }}"
                },
                {
                  "id": "f9c06ecf-d3d5-490c-a848-02c88fbd3ab4",
                  "name": "profilepic",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[0].image_url }}"
                },
                {
                  "id": "bb4ec29d-fac2-4eb9-a177-fca9d2798514",
                  "name": "caseid",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}"
                },
                {
                  "id": "7a485f44-b855-4633-ba51-82e7490d7166",
                  "name": "tags",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[2].text.replaceAll(\"\\n\",\"\\\\n\").replaceAll(\"**\",\"*\") }}"
                },
                {
                  "id": "a4884fc5-2d92-4c34-af9c-61240bc564d5",
                  "name": "status",
                  "type": "string",
                  "value": "={{ $json.response.message.blocks[7].elements[0].text }}"
                },
                {
                  "id": "449c052a-05b4-4c03-99a4-b5fe7ec0e102",
                  "name": "newassignee",
                  "type": "string",
                  "value": "={{ $json.response.state.values.actions_assignment_options['change-assignee'].selected_user }}"
                },
                {
                  "id": "8278ead1-85c0-4921-ac36-9abfd44f99c8",
                  "name": "tlpId",
                  "type": "number",
                  "value": "={{ $('Edit Fields').item.json.response.state.values.actions_assignment_options.update_tlp.selected_option.value }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "286a5624-a546-4a7f-a416-0b4ef66a99d7",
          "name": "Prep Fields For Status Slack",
          "type": "n8n-nodes-base.set",
          "position": [
            1600,
            2420
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0001aed3-a3fb-4229-8fa1-1941f0ee8a12",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[0].text }}"
                },
                {
                  "id": "6f40871c-ea6f-4c61-9272-9342c99637e8",
                  "name": "datecreated",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[1].text }}"
                },
                {
                  "id": "2ea20d66-380f-4a0f-a1ea-c4740293f48b",
                  "name": "number",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[1].text.text }}"
                },
                {
                  "id": "a22dd686-ac38-4e73-a0ec-051dce57f9fa",
                  "name": "severity",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"response\"][\"message\"][\"blocks\"][8][\"elements\"][0][\"text\"] }}"
                },
                {
                  "id": "1c210cfb-2a03-4e81-a8c5-2db739d98226",
                  "name": "tlp",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[9].elements[0].text }}"
                },
                {
                  "id": "53e1d1a9-055a-48c2-80de-b694871c6620",
                  "name": "pap",
                  "type": "string",
                  "value": "={{ $json.response.message.blocks[10].elements[0].text }}"
                },
                {
                  "id": "ee630583-a6ad-4bab-ad78-7846df3ac093",
                  "name": "description",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[3].text }}"
                },
                {
                  "id": "48ac7d92-5177-46be-b01e-83493f18ee09",
                  "name": "assignee",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[1].text }}"
                },
                {
                  "id": "f9c06ecf-d3d5-490c-a848-02c88fbd3ab4",
                  "name": "profilepic",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[0].image_url }}"
                },
                {
                  "id": "bb4ec29d-fac2-4eb9-a177-fca9d2798514",
                  "name": "caseid",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}"
                },
                {
                  "id": "7a485f44-b855-4633-ba51-82e7490d7166",
                  "name": "tags",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[2].text.replaceAll(\"\\n\",\"\\\\n\").replaceAll(\"**\",\"*\") }}"
                },
                {
                  "id": "a4884fc5-2d92-4c34-af9c-61240bc564d5",
                  "name": "status",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"dictionary\"][\"STATUSEMOJI\"][$('Edit Fields').item.json[\"response\"][\"state\"][\"values\"][\"actions_assignment_options\"][\"update-status\"][\"selected_option\"][\"value\"].toUpperCase()] }} *Status:* {{ $('Edit Fields').item.json[\"dictionary\"][\"STATUS\"][$('Edit Fields').item.json[\"response\"][\"state\"][\"values\"][\"actions_assignment_options\"][\"update-status\"][\"selected_option\"][\"value\"].toUpperCase()] }}"
                },
                {
                  "id": "8278ead1-85c0-4921-ac36-9abfd44f99c8",
                  "name": "statusvalue",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"dictionary\"][\"STATUS\"][$('Edit Fields').item.json[\"response\"][\"state\"][\"values\"][\"actions_assignment_options\"][\"update-status\"][\"selected_option\"][\"value\"].toUpperCase()] }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "bdaa7347-dd4f-4183-9f21-979557320603",
          "name": "Update Status in TheHive",
          "type": "n8n-nodes-base.theHiveProject",
          "position": [
            2060,
            2420
          ],
          "parameters": {
            "resource": "case",
            "operation": "update",
            "caseUpdateFields": {
              "value": {
                "id": "={{ $json.caseid }}",
                "flag": false,
                "status": "={{ $json.statusvalue }}"
              },
              "schema": [
                {
                  "id": "id",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "ID",
                  "defaultMatch": true,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "title",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Title",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "description",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Description",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "severity",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Low",
                      "value": 1
                    },
                    {
                      "name": "Medium",
                      "value": 2
                    },
                    {
                      "name": "High",
                      "value": 3
                    },
                    {
                      "name": "Critical",
                      "value": 4
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Severity (Severity of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "startDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Start Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "endDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "End Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "flag",
                  "type": "boolean",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Flag",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tlp",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "TLP (Confidentiality of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "pap",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "PAP (Level of exposure of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "summary",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Summary",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Duplicated",
                      "value": "Duplicated",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "FalsePositive",
                      "value": "FalsePositive",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "Indeterminate",
                      "value": "Indeterminate",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "InProgress",
                      "value": "InProgress",
                      "description": "Stage: InProgress"
                    },
                    {
                      "name": "New",
                      "value": "New",
                      "description": "Stage: New"
                    },
                    {
                      "name": "Other",
                      "value": "Other",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "TruePositive",
                      "value": "TruePositive",
                      "description": "Stage: Closed"
                    }
                  ],
                  "removed": false,
                  "required": false,
                  "displayName": "Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "assignee",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Angel",
                      "value": "angel@n8n.io"
                    },
                    {
                      "name": "John Smith",
                      "value": "john@n8n.io"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Assignee",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "impactStatus",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Impact Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "taskRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Task Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "observableRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Observable Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "addTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Add Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "removeTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Remove Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [
                "id"
              ]
            }
          },
          "credentials": {
            "theHiveProjectApi": {
              "id": "6O5aPdkMaQmc8I9B",
              "name": "The Hive 5 account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "06320f47-c22d-4285-9885-0f3148702dd9",
          "name": "Close Case as False Positive",
          "type": "n8n-nodes-base.theHiveProject",
          "position": [
            2060,
            1700
          ],
          "parameters": {
            "resource": "case",
            "operation": "update",
            "caseUpdateFields": {
              "value": {
                "id": "={{ $json.caseid }}",
                "flag": false,
                "status": "FalsePositive"
              },
              "schema": [
                {
                  "id": "id",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "ID",
                  "defaultMatch": true,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "title",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Title",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "description",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Description",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "severity",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Low",
                      "value": 1
                    },
                    {
                      "name": "Medium",
                      "value": 2
                    },
                    {
                      "name": "High",
                      "value": 3
                    },
                    {
                      "name": "Critical",
                      "value": 4
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Severity (Severity of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "startDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Start Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "endDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "End Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "flag",
                  "type": "boolean",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Flag",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tlp",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "TLP (Confidentiality of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "pap",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "PAP (Level of exposure of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "summary",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Summary",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Duplicated",
                      "value": "Duplicated",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "FalsePositive",
                      "value": "FalsePositive",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "Indeterminate",
                      "value": "Indeterminate",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "InProgress",
                      "value": "InProgress",
                      "description": "Stage: InProgress"
                    },
                    {
                      "name": "New",
                      "value": "New",
                      "description": "Stage: New"
                    },
                    {
                      "name": "Other",
                      "value": "Other",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "TruePositive",
                      "value": "TruePositive",
                      "description": "Stage: Closed"
                    }
                  ],
                  "removed": false,
                  "required": false,
                  "displayName": "Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "assignee",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Angel",
                      "value": "angel@n8n.io"
                    },
                    {
                      "name": "John Smith",
                      "value": "john@n8n.io"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Assignee",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "impactStatus",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Impact Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "taskRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Task Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "observableRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Observable Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "addTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Add Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "removeTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Remove Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [
                "id"
              ]
            }
          },
          "credentials": {
            "theHiveProjectApi": {
              "id": "6O5aPdkMaQmc8I9B",
              "name": "The Hive 5 account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "14d2eebc-17f7-4004-b4d2-17f38e1c6aaa",
          "name": "Status Case Block Rebuild",
          "type": "n8n-nodes-base.set",
          "position": [
            2400,
            2420
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c1fccf83-8223-42a2-837e-11eafe5d23fd",
                  "name": "slackblocks",
                  "type": "string",
                  "value": "={\"type\":\"image\",\"block_id\":\"image_block\",\"image_url\":\"https://i.imgur.com/y2Yw1ZP.png\",\"alt_text\":\"{{ $('Prep Fields For Status Slack').item.json[\"caseid\"]}}\"},{\"type\":\"header\",\"block_id\":\"header_case_created\",\"text\":{\"type\":\"plain_text\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"number\"]}}\",\"emoji\":true}},{\"type\":\"divider\",\"block_id\":\"divider_1\"},{\"type\":\"section\",\"block_id\":\"section_case_details\",\"fields\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"title\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"datecreated\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"tags\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"description\"].replace(\"\\n\",\"\\\\n\")}}\"}]},{\"type\":\"actions\",\"block_id\":\"actions_case_options\",\"elements\":[{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Close Case as False Positive\",\"emoji\":true},\"style\":\"danger\",\"value\":\"{{ $('Prep Fields For Status Slack').item.json[\"caseid\"]}}\",\"action_id\":\"close_case\"},{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Add a Task\",\"emoji\":true},\"value\":\"{{ $('Prep Fields For Status Slack').item.json[\"caseid\"]}}\",\"action_id\":\"add_task\"}]},{\"type\":\"divider\",\"block_id\":\"divider_2\"},{\"type\":\"header\",\"block_id\":\"header_current_assignment\",\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ” Case Details:\",\"emoji\":true}},{\"type\":\"context\",\"block_id\":\"context_status\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"status\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_severity\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"severity\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_tlp\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"tlp\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_pap\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"pap\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_assignee\",\"elements\":[{\"type\":\"image\",\"image_url\":\"{{ $('Prep Fields For Status Slack').item.json[\"profilepic\"]}}\",\"alt_text\":\"Profile Pic\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For Status Slack').item.json[\"assignee\"] }}\"}]}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "eff9d872-a2e0-42ff-ba18-645d044a95b7",
          "name": "TLP Case Block Rebuild",
          "type": "n8n-nodes-base.set",
          "position": [
            2400,
            2240
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c1fccf83-8223-42a2-837e-11eafe5d23fd",
                  "name": "slackblocks",
                  "type": "string",
                  "value": "={\"type\":\"image\",\"block_id\":\"image_block\",\"image_url\":\"https://i.imgur.com/y2Yw1ZP.png\",\"alt_text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"caseid\"]}}\"},{\"type\":\"header\",\"block_id\":\"header_case_created\",\"text\":{\"type\":\"plain_text\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"number\"]}}\",\"emoji\":true}},{\"type\":\"divider\",\"block_id\":\"divider_1\"},{\"type\":\"section\",\"block_id\":\"section_case_details\",\"fields\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"title\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"datecreated\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"tags\"].replace(\"\\n\",\"\\\\n\")}}\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"description\"].replace(\"\\n\",\"\\\\n\")}}\"}]},{\"type\":\"actions\",\"block_id\":\"actions_case_options\",\"elements\":[{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Close Case as False Positive\",\"emoji\":true},\"style\":\"danger\",\"value\":\"{{ $('Prep Fields For TLP Slack').item.json[\"caseid\"]}}\",\"action_id\":\"close_case\"},{\"type\":\"button\",\"text\":{\"type\":\"plain_text\",\"text\":\"Add a Task\",\"emoji\":true},\"value\":\"{{ $('Prep Fields For TLP Slack').item.json[\"caseid\"]}}\",\"action_id\":\"add_task\"}]},{\"type\":\"divider\",\"block_id\":\"divider_2\"},{\"type\":\"header\",\"block_id\":\"header_current_assignment\",\"text\":{\"type\":\"plain_text\",\"text\":\"ðŸ” Case Details:\",\"emoji\":true}},{\"type\":\"context\",\"block_id\":\"context_status\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"status\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_severity\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"severity\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_tlp\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"tlp\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_pap\",\"elements\":[{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"pap\"]}}\"}]},{\"type\":\"context\",\"block_id\":\"context_assignee\",\"elements\":[{\"type\":\"image\",\"image_url\":\"{{ $('Prep Fields For TLP Slack').item.json[\"profilepic\"]}}\",\"alt_text\":\"Profile Pic\"},{\"type\":\"mrkdwn\",\"text\":\"{{ $('Prep Fields For TLP Slack').item.json[\"assignee\"] }}\"}]}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "ddf72a31-3655-423d-bf47-c405563ebf46",
          "name": "No Action Needed",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1520,
            4140
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "7e3155d1-69d0-4773-97f7-61cdc55d04ad",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            2600
          ],
          "parameters": {
            "color": 7,
            "width": 792.317043267064,
            "height": 631.3919967555308,
            "content": "![slack](https://uploads.n8n.io/templates/slack.png)\n## Add a task to a Case - Display Modal Popup\nThis section of the workflow focuses on enhancing task management directly within Slack, allowing users to interactively add tasks to cases through a modal popup. \n\nThe workflow acknowledges the modal request using a specialized node that prepares the system for a dynamic interaction, then leverages an HTTP request node to open a modal in Slack via the `https://slack.com/api/views.open` API endpoint. \n\nThis modal is populated with various fields such as task title, description, due date, assignee, and options like marking the task as mandatory or flagged, which are meticulously structured in JSON format to facilitate user input. \n\nEach element in the modal, from text inputs and date pickers to user-select dropdowns, is designed for ease of use, ensuring that task details are comprehensive and contextually relevant. "
          },
          "typeVersion": 1
        },
        {
          "id": "90fc2f6d-8e22-477e-ab6e-3282d1d1e6f0",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1856.0596905369107,
            385.2537459507854
          ],
          "parameters": {
            "color": 7,
            "width": 691.0596729578308,
            "height": 465.39159795232865,
            "content": "![theHive](https://uploads.n8n.io/templates/thehive.png)\n## Assign Case to Others\nLastly the assignee data is passed into TheHive in \nthe correct format. We then use the Set node to \nbegin the process of building our updated Slack \nmessage. "
          },
          "typeVersion": 1
        },
        {
          "id": "50435336-d159-4477-aeb4-228bdfcb1003",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2640,
            449.39422080427823
          ],
          "parameters": {
            "color": 7,
            "width": 952.9348524840666,
            "height": 895.6351014818621,
            "content": "![slack](https://uploads.n8n.io/templates/slack.png)\n# Dynamic Slack Message Updates in Workflow\n\nThis section of the workflow focuses on dynamically updating Slack messages to reflect changes in TheHive case attributes directly from Slack. The process begins by mapping user actions to Slack interactive elements, which are then composed into a final message block. This updated block is sent back to Slack to modify the original message, ensuring all changes are visible in real-time.\n\n**Key Components:**\n- **Map Actions Node**: This node maps user actions from Slack, like changing assignees or case status, into JSON format. It sets the foundation for creating interactive message blocks that users can interact with.\n- **Build Final Block Node**: Combines all interactive elements into a single JSON object, preparing it for posting back to Slack.\n- **Update Message with new Assignee Node**: Utilizes an HTTP request to post the updated message blocks back to Slack using the chat.update API endpoint. This action modifies the original Slack message to display the new, interactive elements.\n\n**Workflow Efficiency:**\n- By automating the update of Slack messages, this process eliminates the need for manual updates and ensures that all stakeholders are viewing the most current case details directly within Slack.\n- Isolating action elements in separate nodes allows for easier modifications and ensures that any changes in the workflow logic are consistently applied.\n\n**Setup Considerations:**\n- Ensure that the Slack API credentials are correctly configured to allow message updates.\n- Familiarize yourself with JSON structure if you need to customize the interactive elements further, as modifications require a good understanding of JSON formatting.\n\nThis method not only enhances the interactivity of Slack communications but also ensures that updates are seamlessly integrated into the workflow, promoting efficiency and ensuring data consistency."
          },
          "typeVersion": 1
        },
        {
          "id": "97b8bae8-1711-4c11-81f0-d2e0c50d10e6",
          "name": "Sticky Note14",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2135,
            3243
          ],
          "parameters": {
            "color": 7,
            "width": 409.70915573152797,
            "height": 570.3745712311052,
            "content": "![Imgur](https://uploads.n8n.io/templates/thehive.png)\n## Add a task to a Case - Process the task details\nThe data is then processed in TheHive using the native n8n node. "
          },
          "typeVersion": 1
        },
        {
          "id": "1c7c5f11-d8f0-4623-b303-1ebf4adb3b79",
          "name": "Sticky Note15",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            751.1129156240361,
            520
          ],
          "parameters": {
            "color": 7,
            "width": 374.56596023868,
            "height": 628.1281535316614,
            "content": "![n8n](https://uploads.n8n.io/templates/n8n.png)\n## n8n Switch Node\nThis node checks the messages from Slack and routes them down the appropriate route in the workflow. \n\nIt is an invaluable tool that simplifies our logic immensely. "
          },
          "typeVersion": 1
        },
        {
          "id": "4fd498e7-31cf-4d9f-b888-ede79e42e79f",
          "name": "Post New Case To Slack",
          "type": "n8n-nodes-base.slack",
          "position": [
            880,
            300
          ],
          "parameters": {
            "select": "channel",
            "blocksUi": "={\n\t\"blocks\": [\n\t\t{\n\t\t\t\"type\": \"image\",\n\t\t\t\"block_id\": \"image_block\",\n\t\t\t\"image_url\": \"https://i.imgur.com/y2Yw1ZP.png\",\n\t\t\t\"alt_text\": \"{{ $json['caseid'] }}\"\n\t\t},\n\t\t{\n\t\t\t\"type\": \"header\",\n\t\t\t\"block_id\": \"header_case_created\",\n\t\t\t\"text\": {\n\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\"text\": \"{{ $json['number'] }}\",\n\t\t\t\t\"emoji\": true\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"divider\",\n\t\t\t\"block_id\": \"divider_1\"\n\t\t},\n\t\t{\n\t\t\t\"type\": \"section\",\n\t\t\t\"block_id\": \"section_case_details\",\n\t\t\t\"fields\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['title'] }}\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['datecreated'] }}\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['description'].replaceAll(\"\\n\",\"\\\\n\").replaceAll(\"**\",\"*\")}}\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['tags'] }}\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"actions\",\n\t\t\t\"block_id\": \"actions_case_options\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"button\",\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Close Case as False Positive\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"style\": \"danger\",\n\t\t\t\t\t\"value\": \"{{ $json['caseid'] }}\",\n\t\t\t\t\t\"action_id\": \"close_case\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"button\",\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Add a Task\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"value\": \"{{ $json['caseid'] }}\",\n\t\t\t\t\t\"action_id\": \"add_task\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"divider\",\n\t\t\t\"block_id\": \"divider_2\"\n\t\t},\n\t\t{\n\t\t\t\"type\": \"header\",\n\t\t\t\"block_id\": \"header_current_assignment\",\n\t\t\t\"text\": {\n\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\"text\": \"ðŸ” Case Details:\",\n\t\t\t\t\"emoji\": true\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"context\",\n\t\t\t\"block_id\": \"context_status\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['status_emoji'] }} *Status:* {{ $json['status'] }}\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"context\",\n\t\t\t\"block_id\": \"context_severity\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['severity_emoji'] }} {{ $json['severity'] }}\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"context\",\n\t\t\t\"block_id\": \"context_tlp\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['tlp_emoji'] }} {{ $json['tlp'] }}\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"context\",\n\t\t\t\"block_id\": \"context_pap\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"{{ $json['pap_emoji'] }} {{ $json['pap'] }}\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"context\",\n\t\t\t\"block_id\": \"context_assignee\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"image\",\n\t\t\t\t\t\"image_url\": \"{{ $json['profilepic'] }}\",\n\t\t\t\t\t\"alt_text\": \"Profile Pic\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \"Assignee: {{ $json['assignee'] }}\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"actions\",\n\t\t\t\"block_id\": \"actions_assignment_options\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"users_select\",\n\t\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Change Assignee\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"action_id\": \"change-assignee\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"static_select\",\n\t\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Change Status\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"action_id\": \"update-status\",\n\t\t\t\t\t\"options\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"ðŸ†• New\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"ðŸ”„ In progress\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"ðŸ“‘ Duplicated\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"3\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"âŽ False positive\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"4\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"â“ Indeterminate\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"5\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"ðŸ”µ Other\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"6\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"âœ… True positive\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"7\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"static_select\",\n\t\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Change severity\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"action_id\": \"update_severity\",\n\t\t\t\t\t\"options\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Low\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Medium\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"High\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"3\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Critical\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"4\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"static_select\",\n\t\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Change TLP\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"action_id\": \"update_tlp\",\n\t\t\t\t\t\"options\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"White\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"0\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Amber\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Green\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Red\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"3\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"static_select\",\n\t\t\t\t\t\"placeholder\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Change PAP\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"action_id\": \"update_pap\",\n\t\t\t\t\t\"options\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"White\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"0\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Green\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"1\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Amber\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"2\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\t\t\"text\": \"Red\",\n\t\t\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"value\": \"3\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"section\",\n\t\t\t\"text\": {\n\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\"text\": \":bee: View the case in TheHive\"\n\t\t\t},\n\t\t\t\"accessory\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"style\": \"primary\",\n\t\t\t\t\"text\": {\n\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\"text\": \"View Case\",\n\t\t\t\t\t\"emoji\": true\n\t\t\t\t},\n\t\t\t\t\"value\": \"click_me_123\",\n\t\t\t\t\"url\": \"{{ $('Formatting Dictionaries').item.json.theHiveUrl }}/cases/{{ $json['caseid'] }}/details\",\n\t\t\t\t\"action_id\": \"viewlink\"\n\t\t\t}\n\t\t}\n\t]\n}",
            "channelId": {
              "__rl": true,
              "mode": "list",
              "value": "C05LAN72WJK",
              "cachedResultName": "alerts-cyber"
            },
            "messageType": "block",
            "otherOptions": {}
          },
          "credentials": {
            "slackApi": {
              "id": "hOkN2lZmH8XimxKh",
              "name": "TheHive Slack App"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "94f38341-660a-451b-a02a-7dc2d327e323",
          "name": "Prep Fields For Slack - Close",
          "type": "n8n-nodes-base.set",
          "position": [
            1600,
            1700
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0001aed3-a3fb-4229-8fa1-1941f0ee8a12",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[0].text }}"
                },
                {
                  "id": "6f40871c-ea6f-4c61-9272-9342c99637e8",
                  "name": "datecreated",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[1].text }}"
                },
                {
                  "id": "2ea20d66-380f-4a0f-a1ea-c4740293f48b",
                  "name": "number",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[1].text.text }}"
                },
                {
                  "id": "a22dd686-ac38-4e73-a0ec-051dce57f9fa",
                  "name": "severity",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[8].elements[0].text }}"
                },
                {
                  "id": "1c210cfb-2a03-4e81-a8c5-2db739d98226",
                  "name": "tlp",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[9].elements[0].text }}"
                },
                {
                  "id": "53e1d1a9-055a-48c2-80de-b694871c6620",
                  "name": "pap",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[10].elements[0].text }}"
                },
                {
                  "id": "ee630583-a6ad-4bab-ad78-7846df3ac093",
                  "name": "description",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[3].text }}"
                },
                {
                  "id": "48ac7d92-5177-46be-b01e-83493f18ee09",
                  "name": "assignee",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[1].text }}"
                },
                {
                  "id": "f9c06ecf-d3d5-490c-a848-02c88fbd3ab4",
                  "name": "profilepic",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[0].image_url }}"
                },
                {
                  "id": "bb4ec29d-fac2-4eb9-a177-fca9d2798514",
                  "name": "caseid",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}"
                },
                {
                  "id": "7a485f44-b855-4633-ba51-82e7490d7166",
                  "name": "tags",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[2].text }}"
                },
                {
                  "id": "a4884fc5-2d92-4c34-af9c-61240bc564d5",
                  "name": "status",
                  "type": "string",
                  "value": "=:negative_squared_cross_mark: *Status* Closed - False Positive"
                },
                {
                  "id": "449c052a-05b4-4c03-99a4-b5fe7ec0e102",
                  "name": "newassignee",
                  "type": "string",
                  "value": "={{ $json.response.state.values.actions_assignment_options['change-assignee'].selected_user }}"
                },
                {
                  "id": "827c585d-ae23-48d5-b905-81f8260db61e",
                  "name": "severitylabel",
                  "type": "string",
                  "value": ""
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "6a6644ec-0391-40e3-88aa-0d2c4c9a4a41",
          "name": "Prep Fields For Slack - Assign",
          "type": "n8n-nodes-base.set",
          "position": [
            1460,
            680
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0001aed3-a3fb-4229-8fa1-1941f0ee8a12",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[0].text }}"
                },
                {
                  "id": "6f40871c-ea6f-4c61-9272-9342c99637e8",
                  "name": "datecreated",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[1].text }}"
                },
                {
                  "id": "2ea20d66-380f-4a0f-a1ea-c4740293f48b",
                  "name": "number",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[1].text.text }}"
                },
                {
                  "id": "a22dd686-ac38-4e73-a0ec-051dce57f9fa",
                  "name": "severity",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[8].elements[0].text }}"
                },
                {
                  "id": "1c210cfb-2a03-4e81-a8c5-2db739d98226",
                  "name": "tlp",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[9].elements[0].text }}"
                },
                {
                  "id": "53e1d1a9-055a-48c2-80de-b694871c6620",
                  "name": "pap",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[10].elements[0].text }}"
                },
                {
                  "id": "ee630583-a6ad-4bab-ad78-7846df3ac093",
                  "name": "description",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[3].text }}"
                },
                {
                  "id": "48ac7d92-5177-46be-b01e-83493f18ee09",
                  "name": "assignee",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[1].text }}"
                },
                {
                  "id": "f9c06ecf-d3d5-490c-a848-02c88fbd3ab4",
                  "name": "profilepic",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[0].image_url }}"
                },
                {
                  "id": "bb4ec29d-fac2-4eb9-a177-fca9d2798514",
                  "name": "caseid",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}"
                },
                {
                  "id": "7a485f44-b855-4633-ba51-82e7490d7166",
                  "name": "tags",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[2].text }}"
                },
                {
                  "id": "a4884fc5-2d92-4c34-af9c-61240bc564d5",
                  "name": "status",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[7].elements[0].text }}"
                },
                {
                  "id": "449c052a-05b4-4c03-99a4-b5fe7ec0e102",
                  "name": "newassignee",
                  "type": "string",
                  "value": "={{ $json.response.state.values.actions_assignment_options['change-assignee'].selected_user }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "f3d194d1-9548-43ce-a7b6-a1d6b4c1c5cd",
          "name": "Prep Fields For Slack - Severity",
          "type": "n8n-nodes-base.set",
          "position": [
            1600,
            1880
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "0001aed3-a3fb-4229-8fa1-1941f0ee8a12",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[0].text }}"
                },
                {
                  "id": "6f40871c-ea6f-4c61-9272-9342c99637e8",
                  "name": "datecreated",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[1].text }}"
                },
                {
                  "id": "2ea20d66-380f-4a0f-a1ea-c4740293f48b",
                  "name": "number",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[1].text.text }}"
                },
                {
                  "id": "a22dd686-ac38-4e73-a0ec-051dce57f9fa",
                  "name": "severity",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json[\"dictionary\"][\"Severity\"][$('Edit Fields').item.json.response.state.values.actions_assignment_options.update_severity.selected_option.text.text.toUpperCase()] }} *Severity:* {{ $('Edit Fields').item.json.response.state.values.actions_assignment_options.update_severity.selected_option.text.text.toUpperCase() }}"
                },
                {
                  "id": "1c210cfb-2a03-4e81-a8c5-2db739d98226",
                  "name": "tlp",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[9].elements[0].text }}"
                },
                {
                  "id": "53e1d1a9-055a-48c2-80de-b694871c6620",
                  "name": "pap",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[10].elements[0].text }}"
                },
                {
                  "id": "ee630583-a6ad-4bab-ad78-7846df3ac093",
                  "name": "description",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[3].text }}"
                },
                {
                  "id": "48ac7d92-5177-46be-b01e-83493f18ee09",
                  "name": "assignee",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[1].text }}"
                },
                {
                  "id": "f9c06ecf-d3d5-490c-a848-02c88fbd3ab4",
                  "name": "profilepic",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[11].elements[0].image_url }}"
                },
                {
                  "id": "bb4ec29d-fac2-4eb9-a177-fca9d2798514",
                  "name": "caseid",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[0].alt_text }}"
                },
                {
                  "id": "7a485f44-b855-4633-ba51-82e7490d7166",
                  "name": "tags",
                  "type": "string",
                  "value": "={{ $('Edit Fields').item.json.response.message.blocks[3].fields[2].text.replaceAll(\"\\n\",\"\\\\n\").replaceAll(\"**\",\"*\") }}"
                },
                {
                  "id": "a4884fc5-2d92-4c34-af9c-61240bc564d5",
                  "name": "status",
                  "type": "string",
                  "value": "={{ $json.response.message.blocks[7].elements[0].text }}"
                },
                {
                  "id": "449c052a-05b4-4c03-99a4-b5fe7ec0e102",
                  "name": "newassignee",
                  "type": "string",
                  "value": "={{ $json.response.state.values.actions_assignment_options['change-assignee'].selected_user }}"
                },
                {
                  "id": "8278ead1-85c0-4921-ac36-9abfd44f99c8",
                  "name": "severityId",
                  "type": "number",
                  "value": "={{ $('Edit Fields').item.json.response.state.values.actions_assignment_options.update_severity.selected_option.value }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "bc66064d-dc16-485a-8e95-19bead7e5ec7",
          "name": "Update Case Severity",
          "type": "n8n-nodes-base.theHiveProject",
          "position": [
            2060,
            1880
          ],
          "parameters": {
            "resource": "case",
            "operation": "update",
            "caseUpdateFields": {
              "value": {
                "id": "={{ $json.caseid }}",
                "flag": false,
                "severity": "={{ $json.severityId }}"
              },
              "schema": [
                {
                  "id": "id",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "ID",
                  "defaultMatch": true,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "title",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Title",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "description",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Description",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "severity",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Low",
                      "value": 1
                    },
                    {
                      "name": "Medium",
                      "value": 2
                    },
                    {
                      "name": "High",
                      "value": 3
                    },
                    {
                      "name": "Critical",
                      "value": 4
                    }
                  ],
                  "removed": false,
                  "required": false,
                  "displayName": "Severity (Severity of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "startDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Start Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "endDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "End Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "flag",
                  "type": "boolean",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Flag",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tlp",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "TLP (Confidentiality of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "pap",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "PAP (Level of exposure of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "summary",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Summary",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Duplicated",
                      "value": "Duplicated",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "FalsePositive",
                      "value": "FalsePositive",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "Indeterminate",
                      "value": "Indeterminate",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "InProgress",
                      "value": "InProgress",
                      "description": "Stage: InProgress"
                    },
                    {
                      "name": "New",
                      "value": "New",
                      "description": "Stage: New"
                    },
                    {
                      "name": "Other",
                      "value": "Other",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "TruePositive",
                      "value": "TruePositive",
                      "description": "Stage: Closed"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "assignee",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Angel",
                      "value": "angel@n8n.io"
                    },
                    {
                      "name": "John Smith",
                      "value": "john@n8n.io"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Assignee",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "impactStatus",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Impact Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "taskRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Task Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "observableRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Observable Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "addTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Add Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "removeTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Remove Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [
                "id"
              ]
            }
          },
          "credentials": {
            "theHiveProjectApi": {
              "id": "6O5aPdkMaQmc8I9B",
              "name": "The Hive 5 account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "5f4eae8d-16e2-4a3a-b8dd-7af9f7f0bb4b",
          "name": "Update Case PAP",
          "type": "n8n-nodes-base.theHiveProject",
          "position": [
            2060,
            2060
          ],
          "parameters": {
            "resource": "case",
            "operation": "update",
            "caseUpdateFields": {
              "value": {
                "id": "={{ $json.caseid }}",
                "pap": "={{ $json.papId }}",
                "flag": false
              },
              "schema": [
                {
                  "id": "id",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "ID",
                  "defaultMatch": true,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "title",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Title",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "description",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Description",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "severity",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Low",
                      "value": 1
                    },
                    {
                      "name": "Medium",
                      "value": 2
                    },
                    {
                      "name": "High",
                      "value": 3
                    },
                    {
                      "name": "Critical",
                      "value": 4
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Severity (Severity of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "startDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Start Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "endDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "End Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "flag",
                  "type": "boolean",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Flag",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tlp",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "TLP (Confidentiality of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "pap",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": false,
                  "required": false,
                  "displayName": "PAP (Level of exposure of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "summary",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Summary",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Duplicated",
                      "value": "Duplicated",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "FalsePositive",
                      "value": "FalsePositive",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "Indeterminate",
                      "value": "Indeterminate",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "InProgress",
                      "value": "InProgress",
                      "description": "Stage: InProgress"
                    },
                    {
                      "name": "New",
                      "value": "New",
                      "description": "Stage: New"
                    },
                    {
                      "name": "Other",
                      "value": "Other",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "TruePositive",
                      "value": "TruePositive",
                      "description": "Stage: Closed"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "assignee",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Angel",
                      "value": "angel@n8n.io"
                    },
                    {
                      "name": "John Smith",
                      "value": "john@n8n.io"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Assignee",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "impactStatus",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Impact Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "taskRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Task Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "observableRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Observable Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "addTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Add Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "removeTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Remove Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [
                "id"
              ]
            }
          },
          "credentials": {
            "theHiveProjectApi": {
              "id": "6O5aPdkMaQmc8I9B",
              "name": "The Hive 5 account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "c95539f5-e365-4404-897b-65af116c89cb",
          "name": "Update Case TLP",
          "type": "n8n-nodes-base.theHiveProject",
          "position": [
            2060,
            2240
          ],
          "parameters": {
            "resource": "case",
            "operation": "update",
            "caseUpdateFields": {
              "value": {
                "id": "={{ $json.caseid }}",
                "tlp": "={{ $json.tlpId }}",
                "flag": false
              },
              "schema": [
                {
                  "id": "id",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "ID",
                  "defaultMatch": true,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "title",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Title",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "description",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Description",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "severity",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Low",
                      "value": 1
                    },
                    {
                      "name": "Medium",
                      "value": 2
                    },
                    {
                      "name": "High",
                      "value": 3
                    },
                    {
                      "name": "Critical",
                      "value": 4
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Severity (Severity of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "startDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Start Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "endDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "End Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "flag",
                  "type": "boolean",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Flag",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tlp",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": false,
                  "required": false,
                  "displayName": "TLP (Confidentiality of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "pap",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "PAP (Level of exposure of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "summary",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Summary",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Duplicated",
                      "value": "Duplicated",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "FalsePositive",
                      "value": "FalsePositive",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "Indeterminate",
                      "value": "Indeterminate",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "InProgress",
                      "value": "InProgress",
                      "description": "Stage: InProgress"
                    },
                    {
                      "name": "New",
                      "value": "New",
                      "description": "Stage: New"
                    },
                    {
                      "name": "Other",
                      "value": "Other",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "TruePositive",
                      "value": "TruePositive",
                      "description": "Stage: Closed"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "assignee",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Angel",
                      "value": "angel@n8n.io"
                    },
                    {
                      "name": "John Smith",
                      "value": "john@n8n.io"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Assignee",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "impactStatus",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Impact Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "taskRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Task Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "observableRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Observable Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "addTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Add Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "removeTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Remove Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [
                "id"
              ]
            }
          },
          "credentials": {
            "theHiveProjectApi": {
              "id": "6O5aPdkMaQmc8I9B",
              "name": "The Hive 5 account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "edfedf66-df2a-421e-a53d-11ee32623be0",
          "name": "Acknowledge Close Case to Slack",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1180,
            1700
          ],
          "parameters": {
            "options": {
              "responseCode": 200
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "791fea8b-67b3-4dd8-943f-29f750485a10",
          "name": "Acknowledge Severity Update to Slack",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1180,
            1880
          ],
          "parameters": {
            "options": {
              "responseCode": 200
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "14f59582-7a18-44ab-bb1e-19d5141dace5",
          "name": "Acknowledge PAP Update to Slack",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1180,
            2060
          ],
          "parameters": {
            "options": {
              "responseCode": 200
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "55b3ecfa-2be6-41f5-818c-5980f896832f",
          "name": "Acknowledge TLP Update to Slack",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1180,
            2240
          ],
          "parameters": {
            "options": {
              "responseCode": 200
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "4a4ef31e-de26-4e4e-b0f5-bef77c8c2801",
          "name": "Acknowledge Status Update to Slack",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1180,
            2420
          ],
          "parameters": {
            "options": {
              "responseCode": 200
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "cb7647b0-199c-4aa8-84d3-748bb52f1e7e",
          "name": "Acknowledge Modal Request to Slack",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1180,
            3040
          ],
          "parameters": {
            "options": {
              "responseCode": 200
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "20f028c6-1e15-4d3c-a4ad-5ae716fdc1db",
          "name": "Sticky Note16",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1940,
            2680
          ],
          "parameters": {
            "color": 5,
            "width": 431.4429614751546,
            "height": 532.2137131625435,
            "content": "![Imgur](https://uploads.n8n.io/templates/hivemodal.png)"
          },
          "typeVersion": 1
        },
        {
          "id": "661e067b-c11c-44e1-9767-a7b5776a2c4c",
          "name": "Sticky Note17",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1100,
            -83.7829059126309
          ],
          "parameters": {
            "color": 5,
            "width": 431.4429614751546,
            "height": 453.21603562878454,
            "content": "![Imgur](https://uploads.n8n.io/templates/thehivereport.png)\n### New cases will appear in slack in this format with the ability to quickly change variables in TheHive with quick actions baked in. "
          },
          "typeVersion": 1
        },
        {
          "id": "08c174f4-b486-4a18-b627-2d64229d9148",
          "name": "Parse Message Type",
          "type": "n8n-nodes-base.switch",
          "position": [
            860,
            900
          ],
          "parameters": {
            "rules": {
              "values": [
                {
                  "outputKey": "Assign to User",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "change-assignee"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "Close Case",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "d5e3230c-d60a-41a5-815c-117f9e8d7598",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "close_case"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "Update Severity",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "d0f5a4b9-c03c-4dc4-a6bc-41de387b0059",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "update_severity"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "Add Task",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "8cd2f467-0683-46af-98b4-1476c9fded2b",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "add_task"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "Task Modal Details",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "374c13a4-2590-4ae4-b7fb-e01116ba714c",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.view.type }}",
                        "rightValue": "modal"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "Update Pap",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "5bda6be6-cd63-448d-9f2f-c6ac47fdc024",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "update_pap"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "Update Status",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "7789be18-aba0-4fa8-a4d8-792e1b53fcc5",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "update-status"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "Update TLP",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "aff9e422-c8e6-416c-9c80-e2757ed97da1",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "update_tlp"
                      }
                    ]
                  },
                  "renameOutput": true
                },
                {
                  "outputKey": "View Link",
                  "conditions": {
                    "options": {
                      "leftValue": "",
                      "caseSensitive": true,
                      "typeValidation": "strict"
                    },
                    "combinator": "and",
                    "conditions": [
                      {
                        "id": "d35e11f3-0e5f-48a9-98f7-66d0ed676b53",
                        "operator": {
                          "name": "filter.operator.equals",
                          "type": "string",
                          "operation": "equals"
                        },
                        "leftValue": "={{ $json.response.actions[0].action_id }}",
                        "rightValue": "viewlink"
                      }
                    ]
                  },
                  "renameOutput": true
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 3
        },
        {
          "id": "1f489dfa-d1d4-450c-853d-6d006581018a",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            3860
          ],
          "parameters": {
            "color": 7,
            "width": 839.546315272846,
            "height": 472.04545691749547,
            "content": "![slack](https://uploads.n8n.io/templates/slack.png)\n## ðŸ¤Responding to Slack when someone clicks a link \nThis section of the workflow ensures that when a user interacts with a Slack message that invokes an n8n webhook, the server promptly acknowledges this with a \"200\" or \"204\" HTTP status response. This sticky note underscores the importance of a quick and positive response to maintain seamless interactions and ensure Slack receives the necessary feedback to conclude the user's action successfully."
          },
          "typeVersion": 1
        },
        {
          "id": "ad83c6b0-cde4-48b6-b505-8f9e1ded2066",
          "name": "Respond positive to Slack when someone clicks a link",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1180,
            4140
          ],
          "parameters": {
            "options": {
              "responseCode": 204
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "f2668b62-cd3c-41d6-ada3-37e6ba331b90",
          "name": "Respond 204 to Slack",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1380,
            3720
          ],
          "parameters": {
            "options": {
              "responseCode": 204
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "a46648ce-f125-4de6-95cf-9c61c466e43c",
          "name": "Close Modal with 204 response",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1420,
            3540
          ],
          "parameters": {
            "options": {
              "responseCode": 204
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "aa35e086-ace4-413a-9cd8-bed51dad94e7",
          "name": "Get Slack User's Email From Slack",
          "type": "n8n-nodes-base.slack",
          "position": [
            1700,
            680
          ],
          "parameters": {
            "user": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.newassignee }}"
            },
            "resource": "user"
          },
          "credentials": {
            "slackApi": {
              "id": "hOkN2lZmH8XimxKh",
              "name": "TheHive Slack App"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "717a650d-250f-4538-92cb-fa2f7368a9cd",
          "name": "Update TheHive Case with new Assignee",
          "type": "n8n-nodes-base.theHiveProject",
          "position": [
            2020,
            680
          ],
          "parameters": {
            "resource": "case",
            "operation": "update",
            "caseUpdateFields": {
              "value": {
                "id": "={{ $('Prep Fields For Slack - Assign').item.json.caseid }}",
                "flag": false,
                "assignee": "={{ $json.profile.email }}"
              },
              "schema": [
                {
                  "id": "id",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "ID",
                  "defaultMatch": true,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "title",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Title",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "description",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Description",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "severity",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Low",
                      "value": 1
                    },
                    {
                      "name": "Medium",
                      "value": 2
                    },
                    {
                      "name": "High",
                      "value": 3
                    },
                    {
                      "name": "Critical",
                      "value": 4
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Severity (Severity of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "startDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Start Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "endDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "End Date",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "flag",
                  "type": "boolean",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Flag",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "tlp",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "TLP (Confidentiality of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "pap",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "White",
                      "value": 0
                    },
                    {
                      "name": "Green",
                      "value": 1
                    },
                    {
                      "name": "Amber",
                      "value": 2
                    },
                    {
                      "name": "Red",
                      "value": 3
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "PAP (Level of exposure of information)",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "summary",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Summary",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "status",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Duplicated",
                      "value": "Duplicated",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "FalsePositive",
                      "value": "FalsePositive",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "Indeterminate",
                      "value": "Indeterminate",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "InProgress",
                      "value": "InProgress",
                      "description": "Stage: InProgress"
                    },
                    {
                      "name": "New",
                      "value": "New",
                      "description": "Stage: New"
                    },
                    {
                      "name": "Other",
                      "value": "Other",
                      "description": "Stage: Closed"
                    },
                    {
                      "name": "TruePositive",
                      "value": "TruePositive",
                      "description": "Stage: Closed"
                    }
                  ],
                  "removed": true,
                  "required": false,
                  "displayName": "Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "assignee",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Angel",
                      "value": "angel@n8n.io"
                    },
                    {
                      "name": "John Smith",
                      "value": "john@n8n.io"
                    }
                  ],
                  "removed": false,
                  "required": false,
                  "displayName": "Assignee",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "impactStatus",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Impact Status",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "taskRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Task Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "observableRule",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Observable Rule",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "addTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Add Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                },
                {
                  "id": "removeTags",
                  "type": "string",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Remove Tags",
                  "defaultMatch": false,
                  "canBeUsedToMatch": false
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [
                "id"
              ]
            }
          },
          "credentials": {
            "theHiveProjectApi": {
              "id": "6O5aPdkMaQmc8I9B",
              "name": "The Hive 5 account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "1915c609-edf2-4bfe-95db-88ab31ae4fa6",
          "name": "Respond to Slack with 200 response",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            1220,
            680
          ],
          "parameters": {
            "options": {
              "responseCode": 200
            },
            "respondWith": "noData"
          },
          "typeVersion": 1
        },
        {
          "id": "2b9b03cd-2f70-429a-b27f-9eb26663101a",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1660,
            460
          ],
          "parameters": {
            "color": 5,
            "width": 171.29382736351008,
            "height": 165.28509020280688,
            "content": "### ðŸ“§ GDPR Warning\nThis workflow requires additional permissions from your Slack app that may not be available in your region."
          },
          "typeVersion": 1
        },
        {
          "id": "eb76195a-42ef-4716-9b94-ba52f3746e3c",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2220,
            420
          ],
          "parameters": {
            "color": 5,
            "width": 306.95426010827737,
            "height": 207.67897543554668,
            "content": "### ðŸ“§ Ensure the Slack users emails match those in TheHive\nThis assumes that your TheHive user's emails are the same as the same user's email in Slack. Please note that there is no error handling for case's assigned user, so if you assign someone that has an email in Slack that does not match the user in TheHive, it will fail. "
          },
          "typeVersion": 1
        },
        {
          "id": "1da14415-e66a-41bc-8f6e-f57c1180924c",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -420,
            500
          ],
          "parameters": {
            "width": 670.2591130283372,
            "height": 1196.0687210874733,
            "content": "![theHive](https://uploads.n8n.io/templates/thehive.png)\n# Streamline Case Management in TheHive via Slack!\n\n## Our **TheHive Slack Integration** empowers SOC analysts by allowing them to efficiently manage and update case attributes directly within Slack, reducing the need to switch contexts and enhancing response time.\n\n\n**Key Features:**\n- **Direct Case Management**: Modify case details such as assignee, severity, status, and more through intuitive form inputs embedded within Slack messages.\n- **Seamless Integration**: Assumes matching email addresses between TheHive and Slack users for straightforward assignee updates. Note: Ensure email consistency to avoid assignment errors.\n- **Instant Case Actions**: Quickly close cases as false positives or adjust threat levels with minimal clicks, directly impacting case status in TheHive and reflecting updates immediately in Slack.\n- **Task Management**: Add tasks to cases through a user-friendly modal popup, fostering better task tracking and delegation within your team.\n\n\n**Operational Benefits:**\n- **Efficiency**: Enables analysts to perform multiple case actions without leaving Slack, streamlining workflows and saving valuable time.\n- **Accuracy**: Reduces the chances of human error by providing a controlled interface for case updates.\n- **Agility**: Enhances the SOC team's agility by providing tools for rapid response and case management, crucial for effective security operations.\n\n\n**Setup Tips:**\n- Verify that all SOC team members have matching email IDs in TheHive and Slack.\n- Familiarize your team with the Slack form inputs and ensure they understand the importance of accurate data entry.\n- Regularly review and update the integration settings to accommodate any changes in your security operations protocols.\n\n\n**Need Help?**\n- For detailed setup instructions or troubleshooting, refer to our [Integration Guide](https://docs.thehive-project.org) or reach out on our [Support Forum](https://community.thehive-project.org).\n\n\nLeverage this integration to maximize your SOC team's efficiency and responsiveness, ensuring that case management is as streamlined and effective as possible.\n"
          },
          "typeVersion": 1
        },
        {
          "id": "3c56a4a9-36ac-41d3-a4ff-425b93a26341",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1600,
            3720
          ],
          "parameters": {
            "color": 5,
            "width": 342.34463660857455,
            "height": 106.35161810996954,
            "content": "### ðŸ“§ GDPR Warning\nThis workflow requires additional permissions from your Slack app that may not be available in your region or organization."
          },
          "typeVersion": 1
        },
        {
          "id": "c87cdbc8-9f86-46a1-9789-7ad992b6f01d",
          "name": "Get Email From Slack to assign the task to in TheHive",
          "type": "n8n-nodes-base.slack",
          "position": [
            1700,
            3540
          ],
          "parameters": {
            "user": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.response.user.id }}"
            },
            "resource": "user"
          },
          "credentials": {
            "slackApi": {
              "id": "hOkN2lZmH8XimxKh",
              "name": "TheHive Slack App"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "f6e6512f-60d8-4733-833a-b88edf6c978c",
          "name": "Add a task to TheHive",
          "type": "n8n-nodes-base.theHiveProject",
          "position": [
            2280,
            3540
          ],
          "parameters": {
            "caseId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('Edit Fields').item.json.response.view.blocks[0].elements[1].text }}"
            },
            "resource": "task",
            "taskFields": {
              "value": {
                "flag": "={{ $('Edit Fields').item.json[\"response\"][\"view\"][\"state\"][\"values\"][\"case-options\"][\"submit-task-option\"]['selected_options'].some(option => option.value === 'flagged') }}",
                "group": "={{ $('Edit Fields').item.json.response.view.state.values.group_block.group_input.value }}",
                "title": "={{ $('Edit Fields').item.json.response.view.state.values.title_block.title_input.value }}",
                "dueDate": "={{ $('Edit Fields').item.json.response.view.state.values.due_date_block.due_date_input.selected_date }}",
                "assignee": "={{ $json.profile.email }}",
                "mandatory": "={{ $('Edit Fields').item.json[\"response\"][\"view\"][\"state\"][\"values\"][\"case-options\"][\"submit-task-option\"]['selected_options'].some(option => option.value === 'mandatory') }}",
                "description": "={{ $('Edit Fields').item.json.response.view.state.values.description_block.description_input.value }}"
              },
              "schema": [
                {
                  "id": "title",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": true,
                  "displayName": "Title",
                  "defaultMatch": false
                },
                {
                  "id": "description",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "Description",
                  "defaultMatch": false
                },
                {
                  "id": "group",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "Group",
                  "defaultMatch": false
                },
                {
                  "id": "status",
                  "type": "stirng",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Status",
                  "defaultMatch": false
                },
                {
                  "id": "flag",
                  "type": "boolean",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "Flag",
                  "defaultMatch": false
                },
                {
                  "id": "startDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Start Date",
                  "defaultMatch": false
                },
                {
                  "id": "dueDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "Due Date",
                  "defaultMatch": false
                },
                {
                  "id": "endDate",
                  "type": "dateTime",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "End Date",
                  "defaultMatch": false
                },
                {
                  "id": "assignee",
                  "type": "options",
                  "display": true,
                  "options": [
                    {
                      "name": "Angel",
                      "value": "angel@n8n.io"
                    },
                    {
                      "name": "John Smith",
                      "value": "john@n8n.io"
                    }
                  ],
                  "removed": false,
                  "required": false,
                  "displayName": "Assignee",
                  "defaultMatch": false
                },
                {
                  "id": "mandatory",
                  "type": "boolean",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "Mandatory",
                  "defaultMatch": false
                },
                {
                  "id": "order",
                  "type": "number",
                  "display": true,
                  "removed": true,
                  "required": false,
                  "displayName": "Order",
                  "defaultMatch": false
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": []
            }
          },
          "credentials": {
            "theHiveProjectApi": {
              "id": "6O5aPdkMaQmc8I9B",
              "name": "The Hive 5 account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "ebcd8020-b157-4c0f-a726-80dd4864cbcf",
          "name": "Receive Button Press",
          "type": "n8n-nodes-base.webhook",
          "position": [
            360,
            880
          ],
          "webhookId": "99db3e73-57d8-4107-ab02-5b7e713894ad",
          "parameters": {
            "path": "slackthehivewebhook",
            "options": {},
            "httpMethod": "POST",
            "responseMode": "responseNode"
          },
          "typeVersion": 2
        }
      ],
      "pinData": {},
      "connections": {
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Parse Message Type",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Map Actions": {
          "main": [
            [
              {
                "node": "Build Final Block",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Prep Fields For Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TheHive Trigger": {
          "main": [
            [
              {
                "node": "Formatting Dictionaries",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Case PAP": {
          "main": [
            [
              {
                "node": "PAP Case Block Rebuild",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Case TLP": {
          "main": [
            [
              {
                "node": "TLP Case Block Rebuild",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Build Final Block": {
          "main": [
            [
              {
                "node": "Update Message with new Assignee",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse Message Type": {
          "main": [
            [
              {
                "node": "Respond to Slack with 200 response",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Acknowledge Close Case to Slack",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Acknowledge Severity Update to Slack",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Acknowledge Modal Request to Slack",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Check if Case Options",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Acknowledge PAP Update to Slack",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Acknowledge Status Update to Slack",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Acknowledge TLP Update to Slack",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respond positive to Slack when someone clicks a link",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Receive Button Press": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Case Severity": {
          "main": [
            [
              {
                "node": "Severity Case Block Rebuild1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check if Case Options": {
          "main": [
            [
              {
                "node": "Close Modal with 204 response",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respond 204 to Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Fields For Slack": {
          "main": [
            [
              {
                "node": "Post New Case To Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "PAP Case Block Rebuild": {
          "main": [
            [
              {
                "node": "Map Actions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "TLP Case Block Rebuild": {
          "main": [
            [
              {
                "node": "Map Actions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Formatting Dictionaries": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Case Slack Block Rebuild": {
          "main": [
            [
              {
                "node": "Map Actions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Close Case Block Rebuild": {
          "main": [
            [
              {
                "node": "Map Actions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update Status in TheHive": {
          "main": [
            [
              {
                "node": "Status Case Block Rebuild",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Fields For PAP Slack": {
          "main": [
            [
              {
                "node": "Update Case PAP",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Fields For TLP Slack": {
          "main": [
            [
              {
                "node": "Update Case TLP",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Status Case Block Rebuild": {
          "main": [
            [
              {
                "node": "Map Actions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Close Case as False Positive": {
          "main": [
            [
              {
                "node": "Close Case Block Rebuild",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Fields For Status Slack": {
          "main": [
            [
              {
                "node": "Update Status in TheHive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Severity Case Block Rebuild1": {
          "main": [
            [
              {
                "node": "Map Actions",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Close Modal with 204 response": {
          "main": [
            [
              {
                "node": "Get Email From Slack to assign the task to in TheHive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Fields For Slack - Close": {
          "main": [
            [
              {
                "node": "Close Case as False Positive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Fields For Slack - Assign": {
          "main": [
            [
              {
                "node": "Get Slack User's Email From Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acknowledge Close Case to Slack": {
          "main": [
            [
              {
                "node": "Prep Fields For Slack - Close",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acknowledge PAP Update to Slack": {
          "main": [
            [
              {
                "node": "Prep Fields For PAP Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acknowledge TLP Update to Slack": {
          "main": [
            [
              {
                "node": "Prep Fields For TLP Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prep Fields For Slack - Severity": {
          "main": [
            [
              {
                "node": "Update Case Severity",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Slack User's Email From Slack": {
          "main": [
            [
              {
                "node": "Update TheHive Case with new Assignee",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acknowledge Modal Request to Slack": {
          "main": [
            [
              {
                "node": "Task Modal",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acknowledge Status Update to Slack": {
          "main": [
            [
              {
                "node": "Prep Fields For Status Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Respond to Slack with 200 response": {
          "main": [
            [
              {
                "node": "Prep Fields For Slack - Assign",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Acknowledge Severity Update to Slack": {
          "main": [
            [
              {
                "node": "Prep Fields For Slack - Severity",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update TheHive Case with new Assignee": {
          "main": [
            [
              {
                "node": "Case Slack Block Rebuild",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Respond positive to Slack when someone clicks a link": {
          "main": [
            [
              {
                "node": "No Action Needed",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get Email From Slack to assign the task to in TheHive": {
          "main": [
            [
              {
                "node": "Add a task to TheHive",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "suspicious-login-watch",
    "title": "Suspicious Login Detection",
    "description": "Monitors Postgres auth events, applies custom HTML/email checks, and notifies Slack when thresholds are met.",
    "problem": "Ops teams need early warning when risky logins occur across multiple properties.",
    "tags": [
      "security",
      "postgres",
      "slack",
      "monitoring"
    ],
    "metadata": {
      "industries": [
        "security"
      ],
      "domains": [
        "monitoring"
      ],
      "channels": [
        "slack"
      ],
      "trigger": "scheduled",
      "complexity": "medium",
      "integrations": [
        "PostgreSQL",
        "Slack",
        "HTML"
      ]
    },
    "workflow": {
      "id": "xQHiKDTkezDY5lFu",
      "meta": {
        "instanceId": "03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8"
      },
      "name": "Suspicious_login_detection",
      "tags": [
        {
          "id": "GCHVocImoXoEVnzP",
          "name": "ðŸ› ï¸ In progress",
          "createdAt": "2023-10-31T02:17:21.618Z",
          "updatedAt": "2023-10-31T02:17:21.618Z"
        },
        {
          "id": "QPJKatvLSxxtrE8U",
          "name": "Secops",
          "createdAt": "2023-10-31T02:15:11.396Z",
          "updatedAt": "2023-10-31T02:15:11.396Z"
        },
        {
          "id": "hF4M6DtfFqOn2HK2",
          "name": "createdBy:Milorad",
          "createdAt": "2023-10-31T02:20:20.366Z",
          "updatedAt": "2023-10-31T02:20:20.366Z"
        }
      ],
      "nodes": [
        {
          "id": "a95e464a-7451-4737-9db8-993a6568595b",
          "name": "Extract relevant data",
          "type": "n8n-nodes-base.set",
          "position": [
            -260,
            700
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "ip",
                  "value": "={{ $json.body.context.ip }}"
                },
                {
                  "name": "userAgent",
                  "value": "={{ $json.body.context.userAgent }}"
                },
                {
                  "name": "timestamp",
                  "value": "={{ $json.body.originalTimestamp }}"
                },
                {
                  "name": "url",
                  "value": "={{ $json.body.context.page.url }}"
                },
                {
                  "name": "userId",
                  "value": "={{ $json.body.userId }}"
                }
              ]
            },
            "options": {},
            "keepOnlySet": true
          },
          "typeVersion": 2
        },
        {
          "id": "d7dea680-14f3-4ffd-bfaf-f928b69d801d",
          "name": "New /login event",
          "type": "n8n-nodes-base.webhook",
          "disabled": true,
          "position": [
            -740,
            700
          ],
          "webhookId": "705ca4c4-0a38-4ef8-9de9-abc8b3686dc6",
          "parameters": {
            "path": "705ca4c4-0a38-4ef8-9de9-abc8b3686dc6",
            "options": {},
            "httpMethod": "POST"
          },
          "typeVersion": 1
        },
        {
          "id": "bd75aad9-2d24-4083-823d-bc789fb7ef07",
          "name": "Unknown threat?",
          "type": "n8n-nodes-base.if",
          "position": [
            720,
            1240
          ],
          "parameters": {
            "conditions": {
              "boolean": [
                {
                  "value1": "={{ $json.noise }}"
                },
                {
                  "value1": "={{ $json.riot }}"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "d0845980-3b8c-4659-95a1-82e925867f28",
          "name": "Get last 10 logins from the same user",
          "type": "n8n-nodes-base.postgres",
          "disabled": true,
          "position": [
            960,
            1220
          ],
          "parameters": {
            "query": "SELECT * FROM staging_n8n_cloud_frontend.user_signed_in WHERE user_id='{{ $('Extract relevant data').item.json.userId }}' ORDER BY received_at DESC LIMIT 10;",
            "options": {},
            "operation": "executeQuery"
          },
          "credentials": {
            "postgres": {
              "id": "aP9LLonHicGm2A7j",
              "name": "n8n product data"
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "90e859b2-aa64-48e7-a8fe-696e3b7216f1",
          "name": "Query IP API1",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1240,
            1340
          ],
          "parameters": {
            "url": "=http://ip-api.com/json/{{ $json.context_ip }}",
            "options": {}
          },
          "typeVersion": 4.1
        },
        {
          "id": "3a944973-132a-4272-97e3-42528eb4c0fc",
          "name": "New location?",
          "type": "n8n-nodes-base.if",
          "position": [
            1440,
            1340
          ],
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{ $json.city }}",
                  "value2": "={{ $('Merge').item.json.city }}",
                  "operation": "notEqual"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "fb4d5d07-58ae-4b17-a389-29e7fbe2caa2",
          "name": "Parse User Agent",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1260,
            1640
          ],
          "parameters": {
            "url": "https://api.userparser.com/1.1/detect",
            "options": {},
            "sendQuery": true,
            "authentication": "genericCredentialType",
            "genericAuthType": "httpQueryAuth",
            "queryParameters": {
              "parameters": [
                {
                  "name": "ua",
                  "value": "={{ $json.context_user_agent }}"
                }
              ]
            }
          },
          "credentials": {
            "httpQueryAuth": {
              "id": "33f1NrH1bLdXCGyw",
              "name": "n8n Userparser API Key"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "56442924-914c-461d-b4d7-f08192e1b53b",
          "name": "Merge",
          "type": "n8n-nodes-base.merge",
          "position": [
            295,
            1502
          ],
          "parameters": {
            "mode": "combine",
            "options": {},
            "combinationMode": "multiplex"
          },
          "typeVersion": 2.1
        },
        {
          "id": "2b36f782-029d-41de-8823-6c083f3c305a",
          "name": "New Device/Browser?",
          "type": "n8n-nodes-base.if",
          "position": [
            1460,
            1640
          ],
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{ $json.browser.name }}",
                  "value2": "={{ $('Complete login info').first().json.browser.name }}",
                  "operation": "notEqual"
                },
                {
                  "value1": "={{ $json.operatingSystem.name }}",
                  "value2": "={{ $('Complete login info').first().json.operatingSystem.name }}",
                  "operation": "notEqual"
                },
                {
                  "value1": "={{ $json.device.type }}",
                  "value2": "={{ $('Complete login info').first().json.device.type }}",
                  "operation": "notEqual"
                }
              ]
            },
            "combineOperation": "any"
          },
          "typeVersion": 1
        },
        {
          "id": "612c3704-6ea1-4978-ae84-17326f459c25",
          "name": "Complete login info",
          "type": "n8n-nodes-base.merge",
          "position": [
            540,
            1240
          ],
          "parameters": {
            "mode": "combine",
            "options": {},
            "combinationMode": "multiplex"
          },
          "typeVersion": 2.1
        },
        {
          "id": "9c097c31-a86d-45fe-92c7-14a58eae87b4",
          "name": "Query user by ID",
          "type": "n8n-nodes-base.postgres",
          "disabled": true,
          "position": [
            2020,
            1340
          ],
          "parameters": {
            "query": "SELECT * FROM staging_n8n_cloud_frontend.users WHERE id='{{ $('Extract relevant data').item.json.userId }}'",
            "options": {},
            "operation": "executeQuery"
          },
          "credentials": {
            "postgres": {
              "id": "aP9LLonHicGm2A7j",
              "name": "n8n product data"
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "cd6fb55b-b8f6-4778-a62a-34be42e2660d",
          "name": "New Location",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1660,
            1280
          ],
          "parameters": {},
          "executeOnce": true,
          "typeVersion": 1
        },
        {
          "id": "7070a43a-d588-4bbb-b8d0-50e8eff171df",
          "name": "New Device/Browser",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1674,
            1625
          ],
          "parameters": {},
          "executeOnce": true,
          "typeVersion": 1
        },
        {
          "id": "dca6d5ed-d92f-49a6-9910-c9194e696e70",
          "name": "User has email?",
          "type": "n8n-nodes-base.if",
          "position": [
            2360,
            1360
          ],
          "parameters": {
            "conditions": {
              "string": [
                {
                  "value1": "={{ $json.email }}",
                  "operation": "isNotEmpty"
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "14cd3d37-5c00-4750-8ad2-f78fce66019c",
          "name": "HTML",
          "type": "n8n-nodes-base.html",
          "position": [
            2580,
            1313
          ],
          "parameters": {
            "html": "<p>\n  Hello {{ $json.first_name || $json.username }},\n</p>\n<p>\n  We've detected a recent login to your n8n account from a new device or location. Here are the details:\n</p>\n<p>\n  <ul>\n    <li><b>Username:</b> {{ $json.username }}</li>\n    <li><b>Date & Time:</b> {{ $('Extract relevant data').item.json.timestamp }}</li>\n    <li><b>Location:</b> {{ $('Complete login info').item.json.city }}, {{ $('Complete login info').item.json.country }}</li>\n    <li><b>Device:</b> {{ $('Complete login info').item.json.operatingSystem.name }} ({{ $('Complete login info').item.json.device.type }})</li>\n  </ul>\n</p>\n<p>\n  If this was you, you can disregard this email. We just wanted to make sure it was you who logged in from a new device or location.\n</p>\n  If this wasn't you, we recommend resetting your password right away.\n</p>\n\n<style>\n  p {\n    font-family: sans-serif;\n  }\n</style>"
          },
          "typeVersion": 1
        },
        {
          "id": "e99f7779-9b84-4f8c-80a0-b34c3c9df5b4",
          "name": "Inform user",
          "type": "n8n-nodes-base.gmail",
          "disabled": true,
          "position": [
            2740,
            1313
          ],
          "parameters": {
            "sendTo": "={{ $('User has email?').item.json.email }}",
            "message": "={{ $json.html }}",
            "options": {},
            "subject": "Important: Usual Login Attempt Detected"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "162",
              "name": "Gmail - milorad@n8n.io"
            }
          },
          "typeVersion": 2
        },
        {
          "id": "b280b287-7b20-4dcb-9c0a-a3e5c3a60771",
          "name": "noise?",
          "type": "n8n-nodes-base.if",
          "position": [
            340,
            220
          ],
          "parameters": {
            "conditions": {
              "boolean": [
                {
                  "value1": "={{ $json.noise }}",
                  "value2": true
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "5be949da-f04a-44f9-9cf0-5e221f9d27e8",
          "name": "Slack",
          "type": "n8n-nodes-base.slack",
          "disabled": true,
          "position": [
            1560,
            500
          ],
          "parameters": {
            "text": "=Suspicious login attempt detected:\n  - Priority: {{ $json.priority }}\n  - User: {{ $('Extract relevant data').item.json[\"userId\"] }}\n  - IP: {{ $('Extract relevant data').item.json[\"ip\"] }}\n  - Timestamp: {{ $('Extract relevant data').item.json[\"timestamp\"] }}\n  - User Agent: {{ $('Extract relevant data').item.json[\"userAgent\"] }}\nGreyNoise report: https://viz.greynoise.io/ip/{{ $('Extract relevant data').item.json[\"ip\"] }}",
            "select": "channel",
            "channelId": {
              "__rl": true,
              "mode": "name",
              "value": "#slack-message-test"
            },
            "otherOptions": {}
          },
          "credentials": {
            "slackApi": {
              "id": "114",
              "name": "n8n Slack"
            }
          },
          "typeVersion": 2
        },
        {
          "id": "241e492c-fb9a-4b93-bd76-4167cb67f212",
          "name": "Check trust level",
          "type": "n8n-nodes-base.switch",
          "position": [
            780,
            360
          ],
          "parameters": {
            "rules": {
              "rules": [
                {
                  "output": 3,
                  "value2": 1,
                  "operation": "equal"
                },
                {
                  "output": 2,
                  "value2": 2,
                  "operation": "equal"
                }
              ]
            },
            "value1": "={{ $json.trust_level }}",
            "fallbackOutput": 1
          },
          "typeVersion": 1
        },
        {
          "id": "f99741d0-161e-49c6-8e41-d61b080e977d",
          "name": "Check classification",
          "type": "n8n-nodes-base.switch",
          "position": [
            780,
            200
          ],
          "parameters": {
            "rules": {
              "rules": [
                {
                  "value2": "malicious"
                },
                {
                  "output": 2,
                  "value2": "benign"
                },
                {
                  "output": 1,
                  "value2": "unknown"
                }
              ]
            },
            "value1": "={{ $json.classification }}",
            "dataType": "string"
          },
          "typeVersion": 1
        },
        {
          "id": "594857f6-713f-496e-8257-b74acf5d1282",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            0.10300782209924364,
            -502.1236093865191
          ],
          "parameters": {
            "width": 1443.8164871528645,
            "height": 1185.151137495839,
            "content": "![greynoise](https://i.imgur.com/4vSwTkY.png)\n## ðŸš¦ Advanced Threat Prioritization with GreyNoise Data\n\nIn this section of the workflow, the integration of GreyNoise data, particularly in the `GreyNoise` node, plays a pivotal role in refining the threat prioritization process. This node's interaction with GreyNoise ensures that each alert is given an appropriate level of attention, based on the nature of the IP address involved.\n\n-   **GreyNoise Analysis for Inbound Threats:** When the `GreyNoise` node identifies an IP address, it queries GreyNoise, considering both NOISE and RIOT datasets ([More here](https://docs.greynoise.io/docs/riot-data)). The response from this node guides the subsequent steps:\n    -   **High Priority for Unknown IPs:** The `Check trust level` and `Check classification` nodes act here. If GreyNoise has no data on the IP (noise:false, riot:false), the priority is set high in the `ðŸ”´ Priority: HIGH` node. This indicates a potential targeted attack, requiring immediate analyst review.\n    -   **Low to Medium Priority for Common Business Services:** IPs identified as part of common business services (riot:true), depending on their trust level and operation status, are assigned low to medium priority by the `ðŸŸ¡ Priority: MEDIUM` and `ðŸŸ¢ Priority: LOW` nodes. This reflects a lower risk of malicious activity.\n-   **Classification-Based Prioritization:** The workflow also considers the GreyNoise classification of the IP (malicious, benign, unknown) in the `Check classification` node:\n    -   **Malicious IPs:** Medium-high priority, suggesting opportunistic but potentially harmful activity, set in the `ðŸ”´ Priority: HIGH` node.\n    -   **Benign IPs:** Low priority, as these are usually harmless scans by known actors, designated in the `ðŸŸ¢ Priority: LOW` node.\n    -   **Unknown IPs:** Low-medium priority, indicating possibly innocuous but unverified activity, managed by the `ðŸŸ¡ Priority: MEDIUM` node.\n-   **Additional Context for Outbound Threats:** For outbound connections, the workflow prioritizes alerts based on whether the IP is a known service provider or a known device scanning the internet, as interpreted by the `GreyNoise` node. High priority is assigned to outbound connections to scanning devices in the `ðŸ”´ Priority: HIGH` node, indicating potentially unwanted behavior.\n\n\nThis approach, leveraging GreyNoise's advanced data analytics, showcases n8n's capability to deliver sophisticated cybersecurity solutions. By integrating this intelligent prioritization mechanism, the workflow ensures that your security team focuses on the most pressing threats first, enhancing overall security posture.\n\n### Authentication - No Free Tier Available\n\nTo set your API key for GreyNoise, open the `GreyNoise` node, and add a new authentication credential. Choose `Generic Credential Type` then `Header Auth`. Lastly, under `Credential for Header Auth` set the name to `key` and value to your `api key`."
          },
          "typeVersion": 1
        },
        {
          "id": "ee90c638-882d-4a2e-8164-adaf4ec386be",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1450.4432083435722,
            -139
          ],
          "parameters": {
            "width": 560.0194854548777,
            "height": 818.6128004838087,
            "content": "![Slack](https://i.imgur.com/iKyMV0N.png)\n## ðŸ“¢ Slack Notification for Alert Dissemination\n\nThe `Slack` node plays a crucial role in alert communication. It ensures that once a threat is identified and prioritized, the relevant information is quickly disseminated to your security team via Slack.\n\n-   **Timely Alert Notifications:** The `Slack` node is configured to send detailed alerts to a specified Slack channel. These alerts include critical information such as the priority level, user ID, IP address, timestamp, and user agent of the suspicious login attempt. It ensures that your team is promptly informed about potential threats, allowing for quick action to mitigate risks.\n-   **Integration of Data from Previous Nodes:** This node adeptly utilizes data extracted and processed by earlier nodes like `Extract relevant data`. It enriches the Slack message with this detailed information, providing a comprehensive overview of the threat.\n-   **Direct Link to GreyNoise Analysis:** Additionally, the Slack message includes a direct link to the GreyNoise visualization for the IP in question. This link, crafted using data from the `Extract relevant data` node, allows team members to quickly access in-depth information about the IP, facilitating a faster and more informed response.\n\n\nThis approach demonstrates n8n's ability to integrate seamlessly with communication tools like Slack, ensuring that cybersecurity teams are always informed and ready to respond to threats efficiently."
          },
          "typeVersion": 1
        },
        {
          "id": "b617da5f-f7e0-4c6d-8080-c1d4b2e2ed53",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            477,
            690
          ],
          "parameters": {
            "width": 696.8700988949365,
            "height": 894.3487921624444,
            "content": "![postgre](https://i.imgur.com/OEqO3MQ.png)\n## ðŸ”„  Synthesizing Data for Comprehensive Analysis\nThe `Complete login info` node serves as a crucial juncture, integrating data from multiple sources for a detailed analysis of each login attempt.\n\n-   **Combining Multiple Data Streams:** The `Complete login info` node merges information from the `GreyNoise`, `IP API`, and `UserParser` nodes. This process creates a comprehensive dataset by combining threat intelligence from GreyNoise, geolocation details from IP-API, and user agent information from UserParser.\n-   **Enhanced Context for Security Analysis:** By amalgamating data from these varied sources, the workflow gains a multi-faceted view of each login attempt. This enriched context is essential for identifying potential security threats with higher precision.\n-   **Efficient Workflow Structure:** The integration of these diverse data points exemplifies n8n's efficiency in managing complex workflows. By funneling various streams of information into a single node, the workflow ensures that all relevant data is considered in unison during the analysis phase.\n-   **Informing Subsequent Workflow Steps:** The dataset prepared by the `Complete login info` node lays the groundwork for further steps in the workflow. It provides the necessary context for nodes that follow, such as the `Unknown threat?` and `Get last 10 logins from the same user` nodes, to make informed decisions based on a holistic view of the login event."
          },
          "typeVersion": 1
        },
        {
          "id": "1e106297-b7db-4b2d-b08c-a35880782c8c",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1185,
            691
          ],
          "parameters": {
            "width": 663.6738255654103,
            "height": 892.4220900613532,
            "content": "![ipapi](https://i.imgur.com/OMhn14b.png)\n## ðŸ“ Assessing Login Location Anomalies\n\nThe nodes following `Get last 10 logins from the same user` are dedicated to analyzing login location patterns to identify any anomalies.\n\n-   **Fetching Historical Login Data:** The `Get last 10 logins from the same user` node queries a Postgres database to retrieve the last 10 login records for a user. This data forms the baseline for identifying unusual login locations.\n\n-   **Comparing Current and Historical Geolocation Data:** The `Query IP API1` node fetches the geolocation data for the current login attempt. This data is then compared with historical login locations in the `New location?` node.\n\n-   **Identifying Location Anomalies:** The `New location?` node checks if the city from the current login is different from the cities in the user's login history. This comparison is crucial to detect any unusual login patterns, such as logins from new, potentially suspicious locations.\n\n-   **Routing Based on Location Consistency:** Depending on whether the current login location matches historical patterns, the workflow branches to either the `New Location` or `Known Location` nodes. The `New Location` node triggers when a login from a new city is detected, indicating a potential security risk. Conversely, the `Known Location` node is activated when the login location is consistent with historical data, suggesting a regular login pattern."
          },
          "typeVersion": 1
        },
        {
          "id": "3e091a54-2fdc-491c-a168-0fb4fb704fd8",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2310.5877845770297,
            691.4637444823477
          ],
          "parameters": {
            "width": 629.1148167417672,
            "height": 841.097003209987,
            "content": "![gmail](https://i.imgur.com/f6f6my0.png)\n## ðŸ“§ Notifying Users About Unusual Login Attempts\n\nIn the final section of the \"Suspicious Login Detection\" workflow, the nodes `User has email?`, `HTML`, and `Inform user` work together to notify users about unusual login attempts, enhancing the security and responsiveness of the system.\n\n-   **Verifying Email Availability:** After fetching user details with `Query user by ID`, the `User has email?` node checks if the user has an email address on record. This verification is crucial to ensure that the notification process proceeds only for users with valid email addresses.\n\n-   **Crafting the Notification Message:** The `HTML` node is responsible for creating the email content. It generates a well-formatted HTML message informing the user of a recent login from a new device or location. The message includes details like username, timestamp, location, and device information, providing the user with specific insights into the login activity.\n\n-   **Sending the Email Alert:** Finally, the `Inform user` node sends out the email notification. This node uses Gmail to dispatch the message crafted by the `HTML` node to the user's email address obtained in the previous steps.\n\n-   **Enhancing User Awareness and Security:** By notifying users of unusual login activities, the workflow not only enhances security but also empowers users to take immediate action if the login was not authorized. This could include steps like changing their password or contacting the security team."
          },
          "typeVersion": 1
        },
        {
          "id": "f9c6f726-ce2f-448b-a392-b86e0507ce13",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1858,
            691.3527917931716
          ],
          "parameters": {
            "width": 442.82773054232473,
            "height": 839.4355618292594,
            "content": "![postgre](https://i.imgur.com/OEqO3MQ.png)\n## ðŸ§© Querying User Details for Enhanced Context\n\nThe `Query user by ID` node plays a key role in gathering additional user-specific information to provide enhanced context for the security analysis.\n\n-   **User Information Retrieval:** The `Query user by ID` node interacts with a Postgres database to fetch detailed information about the user whose ID is associated with the current login attempt. This information is crucial for understanding the user's profile and access patterns.\n\n-   **Integrating with Location and Device Analysis:** This node is triggered following alerts from either the `New Location` or `New Device/Browser` nodes. These alerts indicate that the current login attempt is potentially suspicious due to a new location or device/browser being used.\n\n-   **Enriching Security Insight:** By querying detailed user data, the workflow gains a deeper understanding of the user's normal access patterns and profiles. This information can be instrumental in differentiating between legitimate user behavior and potential unauthorized access."
          },
          "typeVersion": 1
        },
        {
          "id": "6fd1a35c-5abc-4655-b5b5-836b49129d24",
          "name": "riot?",
          "type": "n8n-nodes-base.if",
          "position": [
            520,
            380
          ],
          "parameters": {
            "conditions": {
              "boolean": [
                {
                  "value1": "={{ $('GreyNoise').item.json.riot }}",
                  "value2": true
                }
              ]
            }
          },
          "typeVersion": 1
        },
        {
          "id": "123fa821-4eb0-42b9-99c9-a0157f7ffac8",
          "name": "ðŸ”´ Priority: HIGH",
          "type": "n8n-nodes-base.set",
          "position": [
            1180,
            220
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "priority",
                  "value": "ðŸ”´ High"
                }
              ]
            },
            "options": {},
            "keepOnlySet": true
          },
          "typeVersion": 2
        },
        {
          "id": "459d0152-8184-4031-8f70-6c100f2bc6c3",
          "name": "ðŸŸ¡ Priority: MEDIUM",
          "type": "n8n-nodes-base.set",
          "position": [
            1180,
            360
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "priority",
                  "value": "ðŸŸ¡ Medium"
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 2
        },
        {
          "id": "58427db9-8ef7-4916-8564-727bd587401d",
          "name": "ðŸŸ¢ Priority: LOW",
          "type": "n8n-nodes-base.set",
          "position": [
            1180,
            500
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "priority",
                  "value": "ðŸŸ¢ Low"
                }
              ]
            },
            "options": {}
          },
          "typeVersion": 2
        },
        {
          "id": "fd1e93a2-267e-4d5e-9724-6a4bb46b94b2",
          "name": "GreyNoise",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            280,
            440
          ],
          "parameters": {
            "url": "=https://api.greynoise.io/v3/community/{{ $json.ip }}",
            "options": {
              "response": {
                "response": {
                  "neverError": true
                }
              }
            },
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth"
          },
          "credentials": {
            "httpHeaderAuth": {
              "id": "wwwfQfxzoBK7NH2a",
              "name": "n8n greynoise api key"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "032b9558-a19b-4790-8593-8949ab2606d4",
          "name": "IP API",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            40,
            1280
          ],
          "parameters": {
            "url": "=http://ip-api.com/json/{{ $json.ip }}",
            "options": {}
          },
          "typeVersion": 4.1
        },
        {
          "id": "6cff0db9-27c3-4c4b-9af0-e8a8d55ad107",
          "name": "UserParser",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            80,
            1522
          ],
          "parameters": {
            "url": "https://api.userparser.com/1.1/detect",
            "options": {},
            "sendQuery": true,
            "authentication": "genericCredentialType",
            "genericAuthType": "httpQueryAuth",
            "queryParameters": {
              "parameters": [
                {
                  "name": "ua",
                  "value": "={{ $json.userAgent }}"
                }
              ]
            }
          },
          "credentials": {
            "httpQueryAuth": {
              "id": "33f1NrH1bLdXCGyw",
              "name": "n8n Userparser API Key"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "65c7a039-5257-495d-86c2-18a44627ebe1",
          "name": "When clicking \"Execute Workflow\"",
          "type": "n8n-nodes-base.manualTrigger",
          "position": [
            -740,
            880
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "a038a10a-baaf-4649-9d38-4fa661dfc4ce",
          "name": "Example event",
          "type": "n8n-nodes-base.code",
          "position": [
            -480,
            880
          ],
          "parameters": {
            "jsCode": "return {\n  json:\n  {\n    \"headers\": {\n      \"host\": \"internal.users.n8n.cloud\",\n      \"user-agent\": \"PostmanRuntime/7.32.3\",\n      \"content-length\": \"857\",\n      \"accept\": \"*/*\",\n      \"accept-encoding\": \"gzip, deflate, br\",\n      \"content-type\": \"application/json\",\n      \"postman-token\": \"e10e747f-0668-4238-9a3d-148b2c8591da\",\n      \"x-forwarded-for\": \"10.255.0.2\",\n      \"x-forwarded-host\": \"internal.users.n8n.cloud\",\n      \"x-forwarded-port\": \"443\",\n      \"x-forwarded-proto\": \"https\",\n      \"x-forwarded-server\": \"e591fa1c2d01\",\n      \"x-real-ip\": \"10.255.0.2\"\n    },\n    \"params\": {},\n    \"query\": {},\n    \"body\": {\n      \"anonymousId\": \"b4191c58-7d64-4c93-8bb4-479c3c95d283\",\n      \"context\": {\n        \"ip\": \"2.204.248.108\",\n        \"library\": {\n          \"name\": \"analytics.js\",\n          \"version\": \"next-1.53.0\"\n        },\n        \"locale\": \"en-US\",\n        \"page\": {\n          \"path\": \"/login\",\n          \"referrer\": \"https://github.com/\",\n          \"search\": \"\",\n          \"title\": \"n8n.cloud\",\n          \"url\": \"https://stage-app.n8n.cloud/login\"\n        },\n        \"userAgent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/114.0\"\n      },\n      \"event\": \"User signed in\",\n      \"integrations\": {},\n      \"messageId\": \"ajs-next-a14f5b6e9860c7318a27f1ac05b3182d\",\n      \"originalTimestamp\": \"2023-06-28T11:26:46.302Z\",\n      \"properties\": {},\n      \"receivedAt\": \"2023-06-28T11:26:46.550Z\",\n      \"sentAt\": \"2023-06-28T11:26:46.313Z\",\n      \"timestamp\": \"2023-06-28T11:26:46.539Z\",\n      \"type\": \"track\",\n      \"userId\": \"staging-2055\"\n    }\n  }\n}"
          },
          "typeVersion": 2
        },
        {
          "id": "700a08d8-09ce-486c-bcfb-07d15f268d08",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -803,
            -83
          ],
          "parameters": {
            "width": 794.5711626683587,
            "height": 1175.5321499586535,
            "content": "![webhook](https://i.imgur.com/D6SP9P0.png)\n## Workflow Overview\n\nExperience enhanced cybersecurity with the `Suspicious Login Detection` workflow in n8n, your go-to solution for real-time monitoring and rapid response to suspicious login activities. This workflow is versatile, with both manual and automated webhook triggers to suit your testing and operational needs.\n\nThis [this GreyNoise guide](https://docs.greynoise.io/docs/applying-greynoise-data-to-your-analysis) was used to design the architecture of this workflow and can serve as a guide for making your own version of this workflow.\n\nKey features include:\n\n- Data Extraction: Seamlessly extracts crucial data like IP addresses and user IDs from login events.\n- Triple-Threat Analysis: Splits into three paths for thorough scrutiny, using `GreyNoise` for IP trust assessment, `IP-API` for geolocation insights, and `UserParser` for user agent details.\n- Prioritized Alerts: Assigns alert priorities and swiftly notifies via `Slack`, ensuring immediate attention to high-risk activities.\n- In-depth Investigation: Cross-references login history for anomalies and flags potential threats, keeping your security team a step ahead.\n\n\nEasy to set up and adaptable, this n8n workflow is a powerhouse tool for safeguarding your digital environment. \n\n## â–¶ï¸Initial Trigger: Detecting Suspicious Logins\n\nThe initial trigger of this workflow is the detection of new login events. This is achieved through a combination of a webhook (`New /login event` node), set to trigger upon a new /login event, and a manual trigger (`When clicking \"Execute Workflow\"` node) for testing purposes. The webhook is configured to receive data from login events, capturing vital information such as IP addresses and user details.\n\nThis setup is crucial for real-time monitoring of login activities. As soon as a login event occurs, the workflow springs into action, extracting and processing the relevant data using the `Extract relevant data` node. "
          },
          "typeVersion": 1
        },
        {
          "id": "ff6bbb3c-1c14-4e94-bfae-58e8cbb098c4",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            0.113308604309168,
            690
          ],
          "parameters": {
            "width": 469.4801859287644,
            "height": 736.6018800373852,
            "content": "![ipapi](https://i.imgur.com/OMhn14b.png)\n## ðŸŒ IP Geolocation with IP-API\nThe `IP API` node in the \"Suspicious Login Detection\" workflow adds crucial geolocation context to login events. It queries IP-API for geographical data on the IP address extracted earlier.\n\n-   **Geographical Insight:** This node provides geographical details like country, region, and city, helping to identify unusual login locations that might signal a security risk.\n-   **Enhanced Security Analysis:** The geographical data aids in assessing the legitimacy of login attempts, adding a valuable layer to the security analysis.\n\n### Authentication - Free Tier Available (45 requests/min)\nThis endpoint is limited to `45 requests per minute from an IP address`.\n\nIf you go over the limit your requests will be throttled `(HTTP 429)` until your rate limit window is reset. If you constantly go over the limit your IP address will be banned for 1 hour.\n\nNo authentication needed, [Click here to view documentation.](https://ip-api.com/docs)"
          },
          "typeVersion": 1
        },
        {
          "id": "57adbcf5-f927-4bdb-b863-bcff97be0ace",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            0,
            1435
          ],
          "parameters": {
            "width": 470.4372486447854,
            "height": 1044.866146557656,
            "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n![userparser](https://i.imgur.com/IxvDyZB.png)\n## ðŸ”„ Merging Geolocation and User Agent Data\n\nIn the \"Suspicious Login Detection\" workflow, the `Merge` node plays a pivotal role in synthesizing information from the `IP API` and `UserParser` nodes.\n\n-   **Data Integration:** The `Merge` node combines data from two key sources: geolocation details from the `IP API` node and user agent information from the `UserParser` node. This integration offers a comprehensive view of each login event.\n\n-   **Comprehensive Analysis:** By merging geolocation and user agent data, the workflow gains a fuller understanding of the context behind each login attempt, crucial for accurately assessing security risks.\n\n-   **Efficient Workflow Design:** The use of the `Merge` node demonstrates n8n's efficient handling of diverse data streams, ensuring that all relevant information is brought together for a cohesive analysis.\n\n\n### Authentication - Free Tier Available (10000 calls / month)\nThis endpoint is limited to `500 calls / day`.\n\nTo set your API key for UserParser, open the `UserParser HTTP Request` node, and add a new authentication credential. Choose `Generic Credential Type` then `Query Auth`. Lastly, under `Credential for Query Auth` set the name to `api_key` and value to your `api key`.\n\n[Click here to view documentation.](https://www.userparser.com/docs/user-agent-and-geoip-lookup-api-v1.1)"
          },
          "typeVersion": 1
        },
        {
          "id": "44830be0-428a-492e-97f7-66289fac6231",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1184,
            1590
          ],
          "parameters": {
            "width": 659.8254746666762,
            "height": 845.1421530016269,
            "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n![userparser](https://i.imgur.com/IxvDyZB.png)\n## ðŸ“± Identifying Device and Browser Anomalies\nthe `Parse User Agent` and `New Device/Browser?` nodes focus on detecting anomalies in device and browser usage for login events.\n\n-   **Parsing User Agent Data:** The `Parse User Agent` node uses the UserParser API to analyze the user agent string from the current login attempt. This node extracts detailed information about the browser, operating system, and device type used for the login, offering crucial insights into the login environment.\n\n-   **Comparing with Historical Data:** After parsing the user agent data, the workflow proceeds to the `New Device/Browser?` node. This node compares the current login's device and browser details against the user's historical data (retrieved by the `Get last 10 logins from the same user` node) to check for any discrepancies.\n\n-   **Detecting New Device or Browser Use:** The `New Device/Browser?` node checks if there's a change in the browser name, operating system, or device type. A change might indicate that the current login is being attempted from a new device or browser, which could be a sign of unauthorized access.\n\n-   **Routing Based on Device and Browser Consistency:** The workflow bifurcates based on this analysis. If a new device or browser is detected, the flow moves to the `New Device/Browser` node, suggesting potential security risks. Conversely, if the device and browser match historical patterns, the `Old Device/Browser` node is activated, indicating a routine login."
          },
          "typeVersion": 1
        },
        {
          "id": "e0bcc621-ff1f-47ca-a63a-f1af5c521c9a",
          "name": "Known, Do Nothing",
          "type": "n8n-nodes-base.noOp",
          "position": [
            960,
            1440
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "92c08a63-6961-40f6-993e-052a311f4bb6",
          "name": "Known Location",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1660,
            1420
          ],
          "parameters": {},
          "executeOnce": true,
          "typeVersion": 1
        },
        {
          "id": "bb1621e0-8297-4e6c-bcdf-eae683a4b830",
          "name": "Old Device/Browser",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1674,
            1765
          ],
          "parameters": {},
          "executeOnce": true,
          "typeVersion": 1
        },
        {
          "id": "9c987dd1-8d27-4067-9956-712eae4a228c",
          "name": "Not Riot",
          "type": "n8n-nodes-base.noOp",
          "position": [
            780,
            520
          ],
          "parameters": {},
          "typeVersion": 1
        }
      ],
      "active": false,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "cd2fd77a-2903-44b8-826a-6797efb5f871",
      "connections": {
        "HTML": {
          "main": [
            [
              {
                "node": "Inform user",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Complete login info",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "riot?": {
          "main": [
            [
              {
                "node": "Check trust level",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Not Riot",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "IP API": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "noise?": {
          "main": [
            [
              {
                "node": "Check classification",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "riot?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GreyNoise": {
          "main": [
            [
              {
                "node": "Complete login info",
                "type": "main",
                "index": 0
              },
              {
                "node": "noise?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "UserParser": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "New Location": {
          "main": [
            [
              {
                "node": "Query user by ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Example event": {
          "main": [
            [
              {
                "node": "Extract relevant data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New location?": {
          "main": [
            [
              {
                "node": "New Location",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Known Location",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Query IP API1": {
          "main": [
            [
              {
                "node": "New location?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Unknown threat?": {
          "main": [
            [
              {
                "node": "Get last 10 logins from the same user",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Known, Do Nothing",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "User has email?": {
          "main": [
            [
              {
                "node": "HTML",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New /login event": {
          "main": [
            [
              {
                "node": "Extract relevant data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Parse User Agent": {
          "main": [
            [
              {
                "node": "New Device/Browser?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Query user by ID": {
          "main": [
            [
              {
                "node": "User has email?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check trust level": {
          "main": [
            [],
            [
              {
                "node": "ðŸ”´ Priority: HIGH",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ðŸŸ¡ Priority: MEDIUM",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ðŸŸ¢ Priority: LOW",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New Device/Browser": {
          "main": [
            [
              {
                "node": "Query user by ID",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ðŸŸ¢ Priority: LOW": {
          "main": [
            [
              {
                "node": "Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Complete login info": {
          "main": [
            [
              {
                "node": "Unknown threat?",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "New Device/Browser?": {
          "main": [
            [
              {
                "node": "New Device/Browser",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Old Device/Browser",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ðŸ”´ Priority: HIGH": {
          "main": [
            [
              {
                "node": "Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Check classification": {
          "main": [
            [
              {
                "node": "ðŸ”´ Priority: HIGH",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ðŸŸ¡ Priority: MEDIUM",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "ðŸŸ¢ Priority: LOW",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract relevant data": {
          "main": [
            [
              {
                "node": "GreyNoise",
                "type": "main",
                "index": 0
              },
              {
                "node": "UserParser",
                "type": "main",
                "index": 0
              },
              {
                "node": "IP API",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "ðŸŸ¡ Priority: MEDIUM": {
          "main": [
            [
              {
                "node": "Slack",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When clicking \"Execute Workflow\"": {
          "main": [
            [
              {
                "node": "Example event",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get last 10 logins from the same user": {
          "main": [
            [
              {
                "node": "Query IP API1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Parse User Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "woocommerce-shipping-dhl",
    "title": "WooCommerce + DHL Fulfillment Console",
    "description": "Captures WooCommerce orders via forms, calls DHL APIs, and drives execution workflows to fulfill shipments.",
    "problem": "Store owners want automatic shipping label orchestration between WooCommerce and DHL without manual exports.",
    "tags": [
      "woocommerce",
      "dhl",
      "shipping",
      "forms"
    ],
    "metadata": {
      "industries": [
        "ecommerce",
        "logistics"
      ],
      "domains": [
        "fulfillment"
      ],
      "channels": [
        "woocommerce",
        "dhl"
      ],
      "trigger": "webhook",
      "complexity": "high",
      "integrations": [
        "WooCommerce",
        "DHL",
        "OpenAI"
      ]
    },
    "workflow": {
      "meta": {
        "instanceId": "cb484ba7b742928a2048bf8829668bed5b5ad9787579adea888f05980292a4a7"
      },
      "nodes": [
        {
          "id": "be49d136-6392-481d-8544-d4f4d4fd0357",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            90,
            260
          ],
          "parameters": {
            "color": 7,
            "width": 1000.427054367056,
            "height": 572.2734520891689,
            "content": "## Find WooCommerce User-ID\nUser-ID is required to query past orders"
          },
          "typeVersion": 1
        },
        {
          "id": "5932f77b-63e2-4991-aa16-2b8587b2b560",
          "name": "No email provided",
          "type": "n8n-nodes-base.set",
          "position": [
            400,
            640
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "9a06428b-4115-4eee-97f4-8e828c5a7e5a",
                  "name": "response",
                  "type": "string",
                  "value": "No email address got provided."
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "909a9a47-8683-4a1f-a359-8f6a878f8cd7",
          "name": "If email provided",
          "type": "n8n-nodes-base.if",
          "position": [
            140,
            460
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "13f7bd32-5760-4ac3-8292-c8beb131a4a5",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.email }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2
        },
        {
          "id": "f5bd2098-090b-4537-8e61-90afb4c85ad8",
          "name": "If user found",
          "type": "n8n-nodes-base.if",
          "position": [
            620,
            440
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "0e434771-6a63-420b-89fe-cf4d5b1d8127",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  },
                  "leftValue": "={{ Object.keys($json).length }}",
                  "rightValue": 0
                }
              ]
            }
          },
          "typeVersion": 2
        },
        {
          "id": "cd2e8f95-363d-47fc-a18b-42eb93f89d0d",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -480,
            -346
          ],
          "parameters": {
            "color": 6,
            "width": 1060.5591882039919,
            "height": 506.94921487705585,
            "content": "# Agent"
          },
          "typeVersion": 1
        },
        {
          "id": "411d5656-ace2-43a1-8672-0ffc9929f99b",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2040,
            265
          ],
          "parameters": {
            "width": 2404.755367647059,
            "height": 559.608748371423,
            "content": "## Add DHL tracking information\nQueries the status of shipped orders from DHL.\n\nCan be skipped if order tracking should not be available or replaced with other services like UPS."
          },
          "typeVersion": 1
        },
        {
          "id": "2787a47f-d685-49b2-b4f9-15ed59525d63",
          "name": "No customer found",
          "type": "n8n-nodes-base.set",
          "position": [
            880,
            640
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "9a06428b-4115-4eee-97f4-8e828c5a7e5a",
                  "name": "response",
                  "type": "string",
                  "value": "No customer with that email address could be found."
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "9ff271fb-5013-41a3-bc3c-84af3f36d079",
          "name": "If contains DHL data",
          "type": "n8n-nodes-base.if",
          "position": [
            2400,
            400
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "674eff87-834b-4436-8666-66ccd11016d6",
                  "operator": {
                    "type": "array",
                    "operation": "notEmpty",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.tracking }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2
        },
        {
          "id": "736adbe9-1141-47b1-9d17-b2a86e0285a3",
          "name": "Extract Tracking Data",
          "type": "n8n-nodes-base.set",
          "position": [
            2140,
            400
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c378e8d4-3fdf-49f5-a766-6cfc1d7e898f",
                  "name": "tracking",
                  "type": "array",
                  "value": "={{ $json.meta_data.filter(data => data.key === '_wc_shipment_tracking_items').flatMap(data => data.value) }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "603584d5-85c7-4995-a7a4-1ecb07c9ce2b",
          "name": "Merge Orders",
          "type": "n8n-nodes-base.merge",
          "position": [
            3980,
            500
          ],
          "parameters": {},
          "typeVersion": 2.1
        },
        {
          "id": "a5f61962-99bd-4e6d-9c4f-4e0fa3685780",
          "name": "Merge Order and Tracking Data",
          "type": "n8n-nodes-base.merge",
          "position": [
            4300,
            640
          ],
          "parameters": {
            "mode": "combine",
            "options": {},
            "combinationMode": "mergeByPosition"
          },
          "typeVersion": 2.1
        },
        {
          "id": "9aff6c2b-90f5-4cf6-8637-634c1d7f439d",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -480,
            -1280
          ],
          "parameters": {
            "color": 3,
            "width": 478.2162464985994,
            "height": 558.6043670960834,
            "content": "# Setup\n## Generally\n- The environment variable `NODE_FUNCTION_ALLOW_BUILTIN` has to equal or include the value `crypto` (FYI: is default on n8n cloud) as it is required to run this workflow\n\n\n## To test the workflow\n1. Set a valid email address of a user that exists in WooCommerce in the Mock Node \"Mock Data\"\n2. Enable the node \"Mock Data\"\n3. Disable the node \"Decrypt email address\"\n4. Use the built-in chat by pressing the \"Chat\" button\n\n\n## For production use:\n1. Update the \"System Message\" in the node \"AI Agent\" for specific use case. At least the name of the shop should be changed\n2. Integrate the chat into the website. An example can be found in the box \"Example Website Implementation\"\n3. Disable or delete the node \"Mock Data\"\n4. Enable the node \"Decrypt email address\"\n5. Enable Workflow"
          },
          "typeVersion": 1
        },
        {
          "id": "901be36e-f68a-4052-ad40-2a3a6a596b56",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1140,
            260
          ],
          "parameters": {
            "width": 277.6742597550393,
            "height": 568.9672169306307,
            "content": "## Get Orders"
          },
          "typeVersion": 1
        },
        {
          "id": "7501d8f8-d91e-4cb3-835d-bf3cd0cac69c",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -492,
            260
          ],
          "parameters": {
            "color": 2,
            "width": 527.8197815634092,
            "height": 572.2734520891689,
            "content": "# WooCommerce Order Tool"
          },
          "typeVersion": 1
        },
        {
          "id": "0f2dc782-63c1-43bc-9347-33ebfe00af69",
          "name": "Split Out",
          "type": "n8n-nodes-base.splitOut",
          "position": [
            2680,
            380
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "tracking"
          },
          "typeVersion": 1
        },
        {
          "id": "d9b180bc-b4d2-4b94-ac65-b73344a47ad8",
          "name": "Aggregate",
          "type": "n8n-nodes-base.aggregate",
          "position": [
            3600,
            380
          ],
          "parameters": {
            "options": {},
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "tracking"
          },
          "typeVersion": 1
        },
        {
          "id": "6d2a044e-4164-4f0f-a6ef-a1a7a347a0c3",
          "name": "Merge Tracking Data",
          "type": "n8n-nodes-base.merge",
          "position": [
            3360,
            380
          ],
          "parameters": {},
          "typeVersion": 2.1
        },
        {
          "id": "bca16467-9c24-4f36-b41f-d471d27ae465",
          "name": "Window Buffer Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            260,
            0
          ],
          "parameters": {
            "sessionKey": "={{ $('Mock Data').item.json.sessionId }}",
            "sessionIdType": "customKey",
            "contextWindowLength": 10
          },
          "typeVersion": 1.2
        },
        {
          "id": "ff432439-2421-4769-bfc8-b58e56742275",
          "name": "Execute Workflow Trigger",
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "position": [
            -340,
            460
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "b8a156a0-bec2-43a5-b2c1-3474701c353b",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1480,
            260
          ],
          "parameters": {
            "color": 7,
            "width": 492.0420811160542,
            "height": 564.8840203332783,
            "content": "## Check orders found"
          },
          "typeVersion": 1
        },
        {
          "id": "22f86e67-710f-49ae-a967-6e5f9345eab6",
          "name": "WooCommerce - Get User",
          "type": "n8n-nodes-base.wooCommerce",
          "position": [
            400,
            440
          ],
          "parameters": {
            "limit": 1,
            "filters": {
              "email": "={{ $json.email }}"
            },
            "resource": "customer",
            "operation": "getAll"
          },
          "credentials": {
            "wooCommerceApi": {
              "id": "Rm7eydPl5IQwnlhw",
              "name": "WooCommerce account"
            }
          },
          "typeVersion": 1,
          "alwaysOutputData": true
        },
        {
          "id": "0c23aaa1-b1a4-4890-8df8-4440d32c2308",
          "name": "If order found",
          "type": "n8n-nodes-base.if",
          "position": [
            1520,
            420
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "0e434771-6a63-420b-89fe-cf4d5b1d8127",
                  "operator": {
                    "type": "number",
                    "operation": "gt"
                  },
                  "leftValue": "={{ Object.keys($json).length }}",
                  "rightValue": 0
                }
              ]
            }
          },
          "typeVersion": 2
        },
        {
          "id": "63b155ef-6336-4938-890a-28050ffe5deb",
          "name": "WooCommerce Get Orders",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1220,
            420
          ],
          "parameters": {
            "url": "https://woo-pleasantly-swag-werewolf3.wpcomstaging.com/wp-json/wc/v3/orders",
            "options": {},
            "sendBody": true,
            "authentication": "predefinedCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "customer",
                  "value": "={{ $json.id }}"
                },
                {
                  "name": "include",
                  "value": "={{ $('If email provided').item.json.query.split(',').filter(data => !data.includes('@')).join(',') }}"
                }
              ]
            },
            "nodeCredentialType": "wooCommerceApi"
          },
          "credentials": {
            "wooCommerceApi": {
              "id": "Rm7eydPl5IQwnlhw",
              "name": "WooCommerce account"
            }
          },
          "typeVersion": 4.1,
          "alwaysOutputData": true
        },
        {
          "id": "6cd01eed-7b28-4fe1-b3a2-33293a978843",
          "name": "No order found",
          "type": "n8n-nodes-base.set",
          "position": [
            1800,
            620
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "9a06428b-4115-4eee-97f4-8e828c5a7e5a",
                  "name": "response",
                  "type": "string",
                  "value": "No order could be found."
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "bd45f21a-f30e-4dc2-be8b-527323016fae",
          "name": "Add Error Information",
          "type": "n8n-nodes-base.set",
          "position": [
            3120,
            480
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "5fdb3524-6263-4e0b-a052-742cec8ceac1",
                  "name": "Error",
                  "type": "string",
                  "value": "=No data about the parcel with the tracking ID \"{{ $('Split Out').item.json.tracking_id }}\" could be found."
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "73596711-8b8b-47d9-88b6-84fe1c35fd42",
          "name": "DHL",
          "type": "n8n-nodes-base.dhl",
          "onError": "continueErrorOutput",
          "position": [
            2880,
            380
          ],
          "parameters": {
            "options": {},
            "trackingNumber": "={{ $json.tracking_number }}"
          },
          "credentials": {
            "dhlApi": {
              "id": "AYAwLZA02lSGlGTd",
              "name": "DHL account Jan"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "ea1a7ab3-d7b7-4651-9232-4724a1adc14f",
          "name": "Send Response",
          "type": "n8n-nodes-base.set",
          "position": [
            4600,
            640
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "a2bb4a8a-40b0-4233-99a8-3b494fb84230",
                  "name": "response",
                  "type": "array",
                  "value": "={{ $input.all().map(item => item.json) }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "606f4731-00cc-4af0-a708-1d0d3d348dfa",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            640,
            -1280
          ],
          "parameters": {
            "color": 4,
            "width": 676.2425958534976,
            "height": 886.4179654829891,
            "content": "## How to supply user email\nAs we want to ensure that customers can only query information about their own orders, the email address gets encrypted in the backend, and then decrypt again in this workflow. If the email was allowed to be set unencrypted, anyone could query information from other customers.\n\n### The email address get supplied in the chat script at the following location:\n```\ncreateChat({\n\twebhookUrl: '...',\n\tmetadata: {\n          email: 'ENCRYPTED_EMAIL_ADDRESS'\n    },\n});\n```\n\n\n## Example Scripts:\n\n### Encrypt email on the backend\nRun the following code in the backend of your website, send the data to the frontend, and then set it dynamically at the above defined location as email.\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Decrypt email in workflow\nThis script is already used in this workflow and is only provided here again as an example.\n"
          },
          "typeVersion": 1
        },
        {
          "id": "adbd1b20-0b4e-44ee-9ecc-3fc746691a03",
          "name": "OpenAI Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            60,
            0
          ],
          "parameters": {
            "model": "gpt-4",
            "options": {}
          },
          "credentials": {
            "openAiApi": {
              "id": "h7YcjvQLK5VrUYLz",
              "name": "OpenAi Jan"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "b9076a7c-39b6-4205-9b05-90ed1f07115e",
          "name": "WooCommerce_Tool",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            440,
            0
          ],
          "parameters": {
            "name": "WooCommerce_Tool",
            "fields": {
              "values": [
                {
                  "name": "email",
                  "stringValue": "={{ $json.metadata.email }}"
                }
              ]
            },
            "workflowId": "={{ $workflow.id }}",
            "description": "Call this tool to retrieve the orders in JSON format (compatible with the WooCommerce API). The input should be a list of comma-separated order IDs or nothing at all for all orders. Supply nothing else than the order IDs!"
          },
          "typeVersion": 1
        },
        {
          "id": "c1f06bc7-04d3-4ad5-b46a-6baa509ee23d",
          "name": "Chat Trigger",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            -440,
            -220
          ],
          "webhookId": "3b63a62a-bfb7-4fb4-a6ec-4c40dcb4d9f6",
          "parameters": {
            "public": true,
            "options": {}
          },
          "typeVersion": 1
        },
        {
          "id": "1dcb818f-48d1-4314-8737-509c2484c8af",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            60,
            -1280
          ],
          "parameters": {
            "color": 4,
            "width": 517.004057164405,
            "height": 555.1564335638465,
            "content": "## Example Website Implementation\nExample Code for a website can be found in node \"Respond to Webhook\".\n\nMore information about the embeddable chat can be found [here](https://github.com/n8n-io/n8n/tree/master/packages/%40n8n/chat#installation).\n\nRequired changes:\n- Change \"webhookUrl\" to the displayed in \"Chat Trigger\" node\n- Set the encrypted email address dynamically. The value has to be calculated in the backend to make it truly secure\n- Use a unique password for email en-/decryption and use it in the backend and this workflow (can be set in node \"Decrypt email address\")\n\n\nThe example page can be opened by calling the production Webhook-URL of the node \"Webhook Example Page\". It only works if the \"For production use\" steps on the left have been followed."
          },
          "typeVersion": 1
        },
        {
          "id": "e3a405a1-077d-4b72-bafa-26fd470f0f1c",
          "name": "Respond to Webhook",
          "type": "n8n-nodes-base.respondToWebhook",
          "position": [
            360,
            -920
          ],
          "parameters": {
            "options": {
              "responseHeaders": {
                "entries": [
                  {
                    "name": "content-type",
                    "value": "text/html; charset=utf-8"
                  }
                ]
              }
            },
            "respondWith": "text",
            "responseBody": "<doctype html>\n\t<html lang=\"en\">\n\t\t<head>\n\t\t\t<meta charset=\"utf-8\" />\n\t\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n\t\t\t<title>Chat</title>\n\t\t\t<link\n\t\t\t\thref=\"https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css\"\n\t\t\t\trel=\"stylesheet\"\n\t\t\t/>\n\t\t\t<link href=\"https://cdn.jsdelivr.net/npm/@n8n/chat/style.css\" rel=\"stylesheet\" />\n\t\t</head>\n\t\t<body>\n\t\t\t<script type=\"module\">\n\t\t\t\timport { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat@latest/chat.bundle.es.js';\n\n\t\t\t\t(async function () {\n\t\t\t\t\tcreateChat({\n\t\t\t\t\t\tmode: 'window',\n\t\t\t\t\t\twebhookUrl: 'https://xxx.n8n.cloud/webhook/ea429912-869c-490b-9e04-4401ac9943b6/chat',\n\t\t\t\t\t\tloadPreviousSession: false,\n\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\temail: '352b16c74f73265441c55c37c9c22b04:4a8e614143c9cd31cc7e2389380943f3', // james@brown.com encrypted\n\t\t\t\t\t\t},\n\t\t\t\t\t\twebhookConfig: {\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t})();\n\t\t\t</script>\n\n\t\t\t<h1>WooCommerce Agent Example page</h1>\n\t\t\tClick on the bubble in the lower right corner to open the chat.\n\n\t\t</body>\n\t</html>\n</doctype>"
          },
          "typeVersion": 1
        },
        {
          "id": "3ee13508-9400-415f-b435-514131ab8c53",
          "name": "Webhook Example Page",
          "type": "n8n-nodes-base.webhook",
          "position": [
            140,
            -920
          ],
          "webhookId": "18474f2d-9472-4a8d-8e63-8128fd2cbefc",
          "parameters": {
            "path": "website-chat-example",
            "options": {},
            "responseMode": "responseNode"
          },
          "typeVersion": 1.1
        },
        {
          "id": "76bfe2b1-2c4a-45b9-a066-1287e735fafd",
          "name": "Decrypt email",
          "type": "n8n-nodes-base.code",
          "position": [
            860,
            -580
          ],
          "parameters": {
            "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\n\nconst crypto = require('crypto');\n\nconst password = 'a random password';\n\nconst encryptedData = $input.first().json.email;\n\n\nfunction decrypt(encrypted, password) {\n  // Extract the IV and the encrypted text\n  const parts = encrypted.split(':');\n  const iv = Buffer.from(parts.shift(), 'hex');\n\n  // Create a key from the password\n  const key = crypto.scryptSync(password, 'salt', 32);\n\n  // Create a decipher\n  const decipher = crypto.createDecipheriv('aes-256-cbc', key, iv);\n\n  // Decrypt the text\n  let decrypted = decipher.update(parts.join(':'), 'hex', 'utf8');\n  decrypted += decipher.final('utf8');\n\n  // Return the decrypted text\n  return decrypted;\n}\n\nreturn [\n  {\n    json: {\n      email: decrypt(encryptedData, password),\n    }\n  }\n];"
          },
          "typeVersion": 2
        },
        {
          "id": "561cb422-955b-445b-9690-aa439dcd2455",
          "name": "Encrypt email",
          "type": "n8n-nodes-base.code",
          "position": [
            680,
            -840
          ],
          "parameters": {
            "jsCode": "const crypto = require('crypto');\n\nconst password = 'a random password';\nconst email = 'james@brown.com';\n\n\nfunction encrypt(text, password) {\n  // Generate a secure random initialization vector\n  const iv = crypto.randomBytes(16);\n\n  // Create a key from the password\n  const key = crypto.scryptSync(password, 'salt', 32);\n\n  // Create a cipher\n  const cipher = crypto.createCipheriv('aes-256-cbc', key, iv);\n\n  // Encrypt the text\n  let encrypted = cipher.update(text, 'utf8', 'hex');\n  encrypted += cipher.final('hex');\n\n  // Return the IV and the encrypted text\n  return `${iv.toString('hex')}:${encrypted}`;\n}\n\nreturn [\n  {\n    json: {\n      email: encrypt(email, password),\n    }\n  }\n];"
          },
          "typeVersion": 2
        },
        {
          "id": "eba004cb-4a40-432b-8fe2-d8526913c585",
          "name": "Example encrypted email",
          "type": "n8n-nodes-base.set",
          "position": [
            680,
            -580
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "fa8d71d3-8e60-44b0-8ef0-e0bfc6feaf0e",
                  "name": "email",
                  "type": "string",
                  "value": "352b16c74f73265441c55c37c9c22b04:4a8e614143c9cd31cc7e2389380943f3"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "d2fe7948-2ce5-4faa-91da-ea76f02aaf84",
          "name": "Decrypt email address",
          "type": "n8n-nodes-base.code",
          "disabled": true,
          "position": [
            -240,
            -220
          ],
          "parameters": {
            "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\n\nconst crypto = require('crypto');\n\nconst password = 'a random password';\nconst incomingData = $input.first().json;\n\n\nfunction decrypt(encrypted, password) {\n  // Extract the IV and the encrypted text\n  const parts = encrypted.split(':');\n  const iv = Buffer.from(parts.shift(), 'hex');\n\n  // Create a key from the password\n  const key = crypto.scryptSync(password, 'salt', 32);\n\n  // Create a decipher\n  const decipher = crypto.createDecipheriv('aes-256-cbc', key, iv);\n\n  // Decrypt the text\n  let decrypted = decipher.update(parts.join(':'), 'hex', 'utf8');\n  decrypted += decipher.final('utf8');\n\n  // Return the decrypted text\n  return decrypted;\n}\n\nreturn [\n  {\n    json: {\n      ...incomingData,\n      metadata: {\n        email: decrypt(incomingData.metadata.email, password),        \n      },\n    }\n  }\n];"
          },
          "typeVersion": 2
        },
        {
          "id": "26cb468c-5edf-4674-bec2-39270262fc00",
          "name": "AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            140,
            -220
          ],
          "parameters": {
            "options": {
              "systemMessage": "=The Assistant is tailored to support customers of Best Shirts Ltd. with inquiries related to their orders. It adheres to the following principles for optimal customer service:\n\n1. **Customer-Focused Communication**: The Assistant maintains a friendly and helpful tone throughout the interaction. It remains focused on the topic at hand, ensuring all responses are relevant to the customer's inquiries about their orders.\n\n2. **Objective and Factual**: In cases where specific information is unavailable, the Assistant clearly communicates the lack of information and refrains from speculating or providing unverified details.\n\n3. **Efficient Interaction**: Recognizing the importance of the customer's time, the Assistant is designed to remember previous interactions within the same session. This minimizes the need for customers to repeat information, streamlining the support process.\n\n4. **Strict Privacy Adherence**: The Assistant automatically has access to the customer's email address as \"{{ $json.email }}\", using it to assist with order-related inquiries. Customers are informed that it is not possible to use or inquire about a different email address. If a customer attempts to provide an alternate email, they are gently reminded of this limitation.\n\n5. **Transparency in Order Status**: The Assistant provides accurate information about order processing and delivery timelines. Orders are typically dispatched 1-2 days post-purchase, with an expected delivery period of 1-2 days following dispatch. If an order hasn't been sent out within 2 days, the Assistant acknowledges an unplanned delay and offers assistance accordingly.\n\n6. **Non-assumptive Approach to Delivery Confirmation**: The Assistant never presumes an order has been delivered based solely on its dispatch. It relies on explicit delivery confirmations or tracking information to inform customers about their order status.\n\n7. **Responsive to Specific Inquiries**: If a customer requests the email address used for their inquiry, the Assistant provides it directly, ensuring privacy and accuracy in communications.\n\nThis approach ensures that customers receive comprehensive, respectful, and efficient support for their order-related queries."
            }
          },
          "typeVersion": 1.4
        },
        {
          "id": "1088d613-4321-40ec-baba-deb0f3aa1078",
          "name": "Mock Data",
          "type": "n8n-nodes-base.set",
          "position": [
            -40,
            -220
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "c591fa49-31b3-46e7-8108-2d3ad1fc895b",
                  "name": "metadata.email",
                  "type": "string",
                  "value": "james@brown.com"
                }
              ]
            },
            "includeOtherFields": true
          },
          "typeVersion": 3.3
        }
      ],
      "pinData": {},
      "connections": {
        "DHL": {
          "main": [
            [
              {
                "node": "Merge Tracking Data",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Add Error Information",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Merge Orders",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Mock Data": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "DHL",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Chat Trigger": {
          "main": [
            [
              {
                "node": "Decrypt email address",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Orders": {
          "main": [
            [
              {
                "node": "Merge Order and Tracking Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If user found": {
          "main": [
            [
              {
                "node": "WooCommerce Get Orders",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "No customer found",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If order found": {
          "main": [
            [
              {
                "node": "Extract Tracking Data",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge Order and Tracking Data",
                "type": "main",
                "index": 1
              }
            ],
            [
              {
                "node": "No order found",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "WooCommerce_Tool": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "If email provided": {
          "main": [
            [
              {
                "node": "WooCommerce - Get User",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "No email provided",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Merge Tracking Data": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If contains DHL data": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Merge Orders",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Webhook Example Page": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Window Buffer Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Add Error Information": {
          "main": [
            [
              {
                "node": "Merge Tracking Data",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Decrypt email address": {
          "main": [
            [
              {
                "node": "Mock Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract Tracking Data": {
          "main": [
            [
              {
                "node": "If contains DHL data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "WooCommerce - Get User": {
          "main": [
            [
              {
                "node": "If user found",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "WooCommerce Get Orders": {
          "main": [
            [
              {
                "node": "If order found",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Example encrypted email": {
          "main": [
            [
              {
                "node": "Decrypt email",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execute Workflow Trigger": {
          "main": [
            [
              {
                "node": "If email provided",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Order and Tracking Data": {
          "main": [
            [
              {
                "node": "Send Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "woocommerce-ai-chatbot",
    "title": "WooCommerce Post-Sales AI Chatbot",
    "description": "Combines Telegram bots, Cal.com, RAG over docs, and WooCommerce tools to answer order questions and create tickets.",
    "problem": "Support teams need an AI assistant that understands WooCommerce orders and can provide follow-up steps automatically.",
    "tags": [
      "woocommerce",
      "telegram",
      "support",
      "rag"
    ],
    "metadata": {
      "industries": [
        "ecommerce",
        "support"
      ],
      "domains": [
        "support-chatbot"
      ],
      "channels": [
        "telegram"
      ],
      "trigger": "webhook",
      "complexity": "high",
      "integrations": [
        "WooCommerce",
        "Telegram",
        "Cal.com",
        "Qdrant",
        "OpenAI"
      ]
    },
    "workflow": {
      "id": "ODZpSQqCxkISEqv8",
      "meta": {
        "instanceId": "a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462",
        "templateCredsSetupCompleted": true
      },
      "name": "WooCommerce AI Chatbot Workflow for Post-Sales Support",
      "tags": [
        {
          "id": "NFwUyKypVupFwAM4",
          "name": "WooCommerce",
          "createdAt": "2024-12-13T15:34:20.174Z",
          "updatedAt": "2024-12-13T15:34:20.174Z"
        },
        {
          "id": "paTcf5QZDJsC2vKY",
          "name": "OpenAI",
          "createdAt": "2024-12-04T16:52:10.768Z",
          "updatedAt": "2024-12-04T16:52:10.768Z"
        }
      ],
      "nodes": [
        {
          "id": "25024dde-431b-4dad-b5ed-9be77cdf3db2",
          "name": "When chat message received",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            -860,
            420
          ],
          "webhookId": "bb9b597a-25ed-43de-9ebb-14f166af789b",
          "parameters": {
            "mode": "webhook",
            "public": true,
            "options": {
              "responseMode": "responseNode"
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "96139b63-75aa-4d16-91b1-2fe0ca624137",
          "name": "Simple Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            -520,
            720
          ],
          "parameters": {},
          "typeVersion": 1.3
        },
        {
          "id": "f7901f97-50c5-4f56-bae3-21c575aa22cc",
          "name": "get_order",
          "type": "n8n-nodes-base.wooCommerceTool",
          "position": [
            80,
            600
          ],
          "parameters": {
            "orderId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Order_ID', `Order Details Retrieval Process:\n1. Request Order Number\n   - Explicitly ask customer for the complete order number\n\n2. Identity Verification\n   - Ask for the email address associated with the order\n   - Strictly verify that the provided email matches the order record\n   - If email does NOT match the order:\n     * Immediately halt the process\n     * Inform customer that the email is incorrect\n     * Do NOT provide the correct email\n     * Prevent access to order details\n\n3. Verification Criteria\n   - Exact match of email to order record is mandatory\n   - No exceptions or workarounds\n   - Customer must provide the precise, correct email`, 'string') }}",
            "resource": "order",
            "operation": "get"
          },
          "credentials": {
            "wooCommerceApi": {
              "id": "nCgFKMfBO95v38Mp",
              "name": "WooCommerce (magnanigioielli.com)"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "b448fb28-1bba-4743-923f-4198bdea0165",
          "name": "get_orders",
          "type": "n8n-nodes-base.wooCommerceTool",
          "position": [
            180,
            600
          ],
          "parameters": {
            "options": {
              "search": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Search', ``, 'string') }}"
            },
            "resource": "order",
            "operation": "getAll",
            "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}"
          },
          "credentials": {
            "wooCommerceApi": {
              "id": "nCgFKMfBO95v38Mp",
              "name": "WooCommerce (magnanigioielli.com)"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "4b386cd5-1f42-45b9-bfa6-e8caf50d49b3",
          "name": "get_user",
          "type": "n8n-nodes-base.wooCommerceTool",
          "position": [
            280,
            600
          ],
          "parameters": {
            "filters": {
              "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}"
            },
            "resource": "customer",
            "operation": "getAll",
            "returnAll": true
          },
          "credentials": {
            "wooCommerceApi": {
              "id": "nCgFKMfBO95v38Mp",
              "name": "WooCommerce (magnanigioielli.com)"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "2235e0c5-ad5e-42d3-a6da-19513dcba181",
          "name": "Calculator",
          "type": "@n8n/n8n-nodes-langchain.toolCalculator",
          "position": [
            -400,
            720
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "e3b8fd50-2f47-4866-acc7-88e819b9d2ce",
          "name": "When clicking â€˜Test workflowâ€™",
          "type": "n8n-nodes-base.manualTrigger",
          "position": [
            -980,
            -500
          ],
          "parameters": {},
          "typeVersion": 1
        },
        {
          "id": "7ac0573f-fcc0-426e-b412-1f4a1e38b9ee",
          "name": "Create collection",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            -680,
            -640
          ],
          "parameters": {
            "url": "https://QDRANTURL/collections/COLLECTION",
            "method": "POST",
            "options": {},
            "jsonBody": "{\n  \"filter\": {}\n}",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "httpHeaderAuth": {
              "id": "qhny6r5ql9wwotpn",
              "name": "Qdrant API (Hetzner)"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "15de11a6-27eb-4431-9105-a7f07f103d44",
          "name": "Refresh collection",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            -680,
            -380
          ],
          "parameters": {
            "url": "https://QDRANTURL/collections/COLLECTION/points/delete",
            "method": "POST",
            "options": {},
            "jsonBody": "{\n  \"filter\": {}\n}",
            "sendBody": true,
            "sendHeaders": true,
            "specifyBody": "json",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "application/json"
                }
              ]
            }
          },
          "credentials": {
            "httpHeaderAuth": {
              "id": "qhny6r5ql9wwotpn",
              "name": "Qdrant API (Hetzner)"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "aab947f3-3e7f-4068-8183-a6003754dc16",
          "name": "Get folder",
          "type": "n8n-nodes-base.googleDrive",
          "position": [
            -460,
            -380
          ],
          "parameters": {
            "filter": {
              "driveId": {
                "__rl": true,
                "mode": "list",
                "value": "My Drive",
                "cachedResultUrl": "https://drive.google.com/drive/my-drive",
                "cachedResultName": "My Drive"
              },
              "folderId": {
                "__rl": true,
                "mode": "id",
                "value": "=test-whatsapp"
              }
            },
            "options": {},
            "resource": "fileFolder"
          },
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "HEy5EuZkgPZVEa9w",
              "name": "Google Drive account (n3w.it)"
            }
          },
          "typeVersion": 3
        },
        {
          "id": "091b9080-eae0-433a-80e6-d1c553b4912b",
          "name": "Download Files",
          "type": "n8n-nodes-base.googleDrive",
          "position": [
            -240,
            -380
          ],
          "parameters": {
            "fileId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.id }}"
            },
            "options": {
              "googleFileConversion": {
                "conversion": {
                  "docsToFormat": "text/plain"
                }
              }
            },
            "operation": "download"
          },
          "credentials": {
            "googleDriveOAuth2Api": {
              "id": "HEy5EuZkgPZVEa9w",
              "name": "Google Drive account (n3w.it)"
            }
          },
          "typeVersion": 3
        },
        {
          "id": "400fcdde-ef42-49bf-807d-e2ed029aae1f",
          "name": "Default Data Loader",
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "position": [
            160,
            -180
          ],
          "parameters": {
            "options": {},
            "dataType": "binary"
          },
          "typeVersion": 1
        },
        {
          "id": "b3f39ac8-ebbc-42c5-8368-2fedd8d133f3",
          "name": "Token Splitter",
          "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
          "position": [
            140,
            0
          ],
          "parameters": {
            "chunkSize": 300,
            "chunkOverlap": 30
          },
          "typeVersion": 1
        },
        {
          "id": "a17ed192-cd39-456d-b35a-ee7d8532fb7c",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -480,
            -700
          ],
          "parameters": {
            "color": 6,
            "width": 880,
            "height": 220,
            "content": "# STEP 1\n\n## Create Qdrant Collection\nChange:\n- QDRANTURL\n- COLLECTION"
          },
          "typeVersion": 1
        },
        {
          "id": "ce12df1d-357a-4f8f-91cf-f92c0aa6bcd7",
          "name": "Qdrant Vector Store1",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
          "position": [
            0,
            -380
          ],
          "parameters": {
            "mode": "insert",
            "options": {},
            "qdrantCollection": {
              "__rl": true,
              "mode": "id",
              "value": "=COLLECTION"
            }
          },
          "credentials": {
            "qdrantApi": {
              "id": "iyQ6MQiVaF3VMBmt",
              "name": "QdrantApi account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "e440121d-6aa8-4cc7-920c-d28d93717d99",
          "name": "Embeddings OpenAI1",
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "position": [
            0,
            -160
          ],
          "parameters": {
            "options": {}
          },
          "credentials": {
            "openAiApi": {
              "id": "CDX6QM4gLYanh0P4",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "c6f89301-3ae0-4068-8279-de149859f6a5",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -700,
            -440
          ],
          "parameters": {
            "color": 4,
            "width": 620,
            "height": 400,
            "content": "# STEP 2\n\n\n\n\n\n\n\n\n\n\n\n\n## Documents vectorization with Qdrant and Google Drive\nChange:\n- QDRANTURL\n- COLLECTION"
          },
          "typeVersion": 1
        },
        {
          "id": "7ae502f5-bf12-49bd-afd0-d8ad050c1d8b",
          "name": "Qdrant Vector Store",
          "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
          "position": [
            -140,
            960
          ],
          "parameters": {
            "options": {},
            "qdrantCollection": {
              "__rl": true,
              "mode": "id",
              "value": "=COLLECTION"
            }
          },
          "credentials": {
            "qdrantApi": {
              "id": "iyQ6MQiVaF3VMBmt",
              "name": "QdrantApi account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "b3bc247f-7fcb-4c17-8995-ec4ba26b65ee",
          "name": "Embeddings OpenAI",
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "position": [
            -160,
            1140
          ],
          "parameters": {
            "options": {}
          },
          "credentials": {
            "openAiApi": {
              "id": "CDX6QM4gLYanh0P4",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "7c110a8b-5e66-4824-ac9f-a42fabbe3929",
          "name": "OpenAI Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            160,
            960
          ],
          "parameters": {
            "options": {}
          },
          "credentials": {
            "openAiApi": {
              "id": "CDX6QM4gLYanh0P4",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "b9a62833-a124-439b-b6ca-eb6061afa74d",
          "name": "ToS",
          "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
          "position": [
            -40,
            780
          ],
          "parameters": {
            "name": "company",
            "description": "Rispondi alle domande relative ai termini e condizioni e spedizioni"
          },
          "typeVersion": 1
        },
        {
          "id": "667e8756-78a6-4cd1-bf24-00af8188fe50",
          "name": "get_tracking",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            -240,
            600
          ],
          "parameters": {
            "name": "get_tracking",
            "workflowId": {
              "__rl": true,
              "mode": "list",
              "value": "AcPE4PXeFOiOW48H",
              "cachedResultName": "WooCommerce Get Tracking Number"
            },
            "description": "Get tracking number for a specific order by providing the order number. The tool retrieves the unique tracking code that allows customers to monitor their shipment's current status and location.",
            "workflowInputs": {
              "value": {
                "order_number": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('order_number', ``, 'string') }}"
              },
              "schema": [
                {
                  "id": "order_number",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "order_number",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [
                "order_number"
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "305ea876-80b9-45c4-b548-6d1df093bd94",
          "name": "When Executed by Another Workflow",
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "position": [
            560,
            480
          ],
          "parameters": {
            "inputSource": "jsonExample",
            "jsonExample": "{\n  \"order_number\": \"order number\"\n}"
          },
          "typeVersion": 1.1
        },
        {
          "id": "4f7547c1-1d21-45f6-a409-09e55c4b9477",
          "name": "Post-Sales Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            -540,
            420
          ],
          "parameters": {
            "options": {
              "systemMessage": "=## Role and Primary Objective\nYou are a customer support AI agent for an online clothing store, specializing in post-sales assistance. Your primary goals are to:\n- Help customers track their orders\n- Provide information about past and current orders\n- Offer clear and concise support\n\n## Communication Guidelines\n1. Always be professional, helpful, and precise\n2. Use available tools to retrieve accurate information\n3. Verify customer identity before sharing order details\n4. Protect customer privacy and data confidentiality\n\n## Tool Usage Instructions\n\n### Order Information Retrieval\n- Use `get_order` to fetch details for a single order\n  - REQUIRED: Complete user information including request, email, and order number\n- Use `get_orders` to retrieve multiple orders for a single customer\n- Use `get_user` to obtain customer profile information\n\n### Tracking and Support\n- Use `get_tracking` to obtain tracking information for an order using the order number\n- If a customer cannot find what they need, use `human*assistance`\n  - Synthesize the request clearly\n  - Include associated user email\n  - Provide concise, relevant details\n\n### General Information\n- Use `ToS` tool to answer questions about:\n  - Terms and Conditions\n  - Shipping information\n  - General store policies\n\n## Critical Verification Rules\n- ALWAYS verify that the email provided matches the order number\n- If the email does not match the order:\n  - DO NOT provide the correct email\n  - Inform the customer that the email address is incorrect\n  - Request the correct email associated with the order\n\n## Prohibited Actions\n- Never disclose sensitive customer information\n- Do not share full order details without proper verification\n- Avoid providing speculative or unconfirmed information\n\n## Communication Style\n- Be direct and helpful\n- Use clear, professional language\n- Focus on solving the customer's specific query\n- Provide step-by-step guidance when necessary\n\n## Escalation Protocol\n- If unable to resolve the customer's issue using available tools\n- Use `human_assistance` to escalate complex or unresolvable queries\n- Ensure clear, concise problem description\n\nToday is {{$now}}"
            }
          },
          "typeVersion": 1.8
        },
        {
          "id": "a5b49dbf-f041-43ec-b621-a89f65675705",
          "name": "human_assistence",
          "type": "n8n-nodes-base.telegramTool",
          "position": [
            -80,
            600
          ],
          "webhookId": "1f9cad22-45e3-4c6b-bec8-f421060d14d9",
          "parameters": {
            "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', ``, 'string') }}",
            "chatId": "CHAT_ID",
            "additionalFields": {}
          },
          "credentials": {
            "telegramApi": {
              "id": "rQ5q95W7uKesMDx4",
              "name": "Telegram account Fastewb"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "46110bcd-dae7-4c33-8936-cc4867c9abde",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -880,
            240
          ],
          "parameters": {
            "width": 1220,
            "height": 140,
            "content": "# STEP 3\n\n- Add your Telegram CHAT_ID in the \"human_assistance\" tool"
          },
          "typeVersion": 1
        },
        {
          "id": "9c45d20d-f4d3-4bde-9e3e-749c64a123bb",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            540,
            240
          ],
          "parameters": {
            "color": 5,
            "width": 580,
            "height": 200,
            "content": "# STEP 4\n\nThe tracking code request is made through the most popular WooCommerce tracking plugin: \"YITH WooCommerce Order & Shipment Tracking\". The free version can be [downloaded here](https://wordpress.org/plugins/yith-woocommerce-order-tracking/)\n- Create a new workflow and change URL in the node \"Http Request\" with your WooCommerce shop url"
          },
          "typeVersion": 1
        },
        {
          "id": "f16ee312-8434-4958-b111-d80384ae869c",
          "name": "Get tracking",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            780,
            480
          ],
          "parameters": {
            "url": "=https://URL/wp-json/wc/v3/orders/{{ $json.order_number }}",
            "options": {},
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth"
          },
          "credentials": {
            "httpBasicAuth": {
              "id": "nIitKwSJa9EpgG8K",
              "name": "WP (magnanigioielli.com)"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "e5de4ad6-3469-4720-828e-618db5c4f3ae",
          "name": "Set tracking code",
          "type": "n8n-nodes-base.set",
          "position": [
            1020,
            480
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "19b33abc-5191-4449-b682-4466f1975ff2",
                  "name": "tracking_code",
                  "type": "string",
                  "value": "={{ $json[\"meta_data\"].find(item => item.key === \"ywot_tracking_code\").value }}"
                },
                {
                  "id": "2e18b337-e3e8-4669-a902-ecc2ba027a1a",
                  "name": "carrier_url",
                  "type": "string",
                  "value": "={{ $json[\"meta_data\"].find(item => item.key === \"ywot_carrier_url\").value }}"
                },
                {
                  "id": "ae834f65-67b2-4e95-9a49-5172e36fc5b9",
                  "name": "pick_up",
                  "type": "string",
                  "value": "={{ $json[\"meta_data\"].find(item => item.key === \"ywot_pick_up_date\").value }}"
                }
              ]
            }
          },
          "typeVersion": 3.4
        },
        {
          "id": "b889e33b-5243-4b5b-80ef-023df779e673",
          "name": "GPT 4o-mini",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "position": [
            -700,
            720
          ],
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "credentials": {
            "openAiApi": {
              "id": "CDX6QM4gLYanh0P4",
              "name": "OpenAi account"
            }
          },
          "typeVersion": 1.2
        },
        {
          "id": "c9863b08-f6aa-4502-85a4-7782a090d532",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -1000,
            -1040
          ],
          "parameters": {
            "color": 3,
            "width": 1400,
            "height": 240,
            "content": "# WooCommerce AI Chatbot Workflow for Post-Sales Support\n\nThis WooCommerce-integrated chatbot is designed to transform post-sales customer support by combining automation and artificial intelligence to deliver fast, secure, and personalized assistance. By connecting directly to the WooCommerce database, the chatbot retrieves real-time order informationâ€”including shipping details and tracking numbersâ€”after verifying the customer's identity through a strict email-based authentication system. This ensures maximum data security, preventing leaks of sensitive information.  \n\nBeyond order management, the chatbot answers frequently asked questions about return policies, delivery times, and terms of service using a vector database that provides accurate, context-aware responses. If a request is too complex, the system seamlessly escalates it to a human operator via Telegram, guaranteeing no customer query goes unresolved. \n"
          },
          "typeVersion": 1
        }
      ],
      "active": false,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "bace4bf0-d6b4-46f8-81d1-26dbc1120d85",
      "connections": {
        "ToS": {
          "ai_tool": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "get_user": {
          "ai_tool": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "get_order": {
          "ai_tool": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Calculator": {
          "ai_tool": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Get folder": {
          "main": [
            [
              {
                "node": "Download Files",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_orders": {
          "ai_tool": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "GPT 4o-mini": {
          "ai_languageModel": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Get tracking": {
          "main": [
            [
              {
                "node": "Set tracking code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "get_tracking": {
          "ai_tool": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Download Files": {
          "main": [
            [
              {
                "node": "Qdrant Vector Store1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Token Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Post-Sales Agent": {
          "main": [
            []
          ]
        },
        "human_assistence": {
          "ai_tool": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI": {
          "ai_embedding": [
            [
              {
                "node": "Qdrant Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "ToS",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI1": {
          "ai_embedding": [
            [
              {
                "node": "Qdrant Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Refresh collection": {
          "main": [
            [
              {
                "node": "Get folder",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Qdrant Vector Store1",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Qdrant Vector Store": {
          "ai_vectorStore": [
            [
              {
                "node": "ToS",
                "type": "ai_vectorStore",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "Post-Sales Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Get tracking",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When clicking â€˜Test workflowâ€™": {
          "main": [
            [
              {
                "node": "Create collection",
                "type": "main",
                "index": 0
              },
              {
                "node": "Refresh collection",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "stripe-zoom-payments",
    "title": "Stripe-Paid Zoom Booking",
    "description": "Collects payments via Stripe Checkout, records attendees in Sheets, emails confirmations, and provisions Zoom sessions.",
    "problem": "Consultants want to gate Zoom meetings behind payment without juggling multiple tools manually.",
    "tags": [
      "stripe",
      "zoom",
      "payments",
      "forms"
    ],
    "metadata": {
      "industries": [
        "consulting",
        "events"
      ],
      "domains": [
        "booking",
        "payments"
      ],
      "channels": [
        "zoom",
        "email"
      ],
      "trigger": "webhook",
      "complexity": "medium",
      "integrations": [
        "Stripe",
        "Zoom",
        "Google Sheets",
        "Gmail"
      ]
    },
    "workflow": {
      "id": "2DT5BW5tOdy87AUl",
      "meta": {
        "instanceId": "8418cffce8d48086ec0a73fd90aca708aa07591f2fefa6034d87fe12a09de26e"
      },
      "name": "Streamline Your Zoom Meetings with Secure, Automated Stripe Payments",
      "tags": [],
      "nodes": [
        {
          "id": "fcc38ae8-0dbf-4676-b47b-ba77f97a38b8",
          "name": "Create Zoom meeting",
          "type": "n8n-nodes-base.zoom",
          "position": [
            180,
            480
          ],
          "parameters": {
            "topic": "={{ $('Creation Form').item.json.title }}",
            "authentication": "oAuth2",
            "additionalFields": {
              "password": "={{ Math.random().toString(36).slice(-4); }}",
              "startTime": "={{ new Date(new Date($('Creation Form').item.json.date_start).getTime() + ($('Creation Form').item.json.hour * 3600000) + ($('Creation Form').item.json.minute * 60000)).toISOString() }}"
            }
          },
          "credentials": {
            "zoomOAuth2Api": {
              "id": "JQ9fG5WNTVssHxGj",
              "name": "Zoom account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "3d2dea09-c463-447b-9a9d-daca8fdcac06",
          "name": "Create Stripe Product",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            400,
            480
          ],
          "parameters": {
            "url": "https://api.stripe.com/v1/products",
            "method": "POST",
            "options": {},
            "sendBody": true,
            "contentType": "form-urlencoded",
            "authentication": "predefinedCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "name",
                  "value": "={{ $('Creation Form').item.json.title }}"
                },
                {
                  "name": "default_price_data[unit_amount]",
                  "value": "={{ $('Creation Form').item.json.price * 100 }}"
                },
                {
                  "name": "default_price_data[currency]",
                  "value": "={{ $('Config').item.json.currency }}"
                }
              ]
            },
            "nodeCredentialType": "stripeApi"
          },
          "credentials": {
            "stripeApi": {
              "id": "qjose8z3RR7Xzm7b",
              "name": "Stripe Dev"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "01ab74fb-19a1-42ef-a0ad-31107c7ded3f",
          "name": "Config",
          "type": "n8n-nodes-base.set",
          "notes": "Setup your flow",
          "position": [
            -220,
            640
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "038b54b7-9559-444e-8653-c5256a5b784e",
                  "name": "currency",
                  "type": "string",
                  "value": "EUR"
                },
                {
                  "id": "64d1eeee-cabe-403b-a634-f3238f586f58",
                  "name": "sheet_url",
                  "type": "string",
                  "value": "https://docs.google.com/spreadsheets/d/1ZliqqBNo6X0iM9yXBOiCG1e4Q7L7bQKMFmjvbSgUSnA/edit#gid=0"
                },
                {
                  "id": "997fe5a1-f601-458d-899c-673dff4acb04",
                  "name": "teacher_email",
                  "type": "string",
                  "value": "emm.bernard@gmail.com"
                }
              ]
            }
          },
          "notesInFlow": true,
          "typeVersion": 3.3
        },
        {
          "id": "2aa87b96-924b-472c-8cc6-2de028ce0195",
          "name": "Send email to teacher",
          "type": "n8n-nodes-base.gmail",
          "position": [
            1040,
            480
          ],
          "parameters": {
            "sendTo": "={{ $('Config').item.json.teacher_email }}",
            "message": "=<b>Congratulations, your event has been succesfully created ðŸŽ‰</b><br/><br/>\n\nTitle: {{ $('Creation Form').item.json.title }}<br/>\nPrice:  {{ $('Creation Form').item.json.price }} {{ $('Config').item.json.currency }}<br/>\nStart date: {{ $('Creation Form').item.json.date_start }}<br/><br/>\n\n<b>Payment link:</b><br/>\n {{ $('Create payment link').item.json.url }}<br/>\n<i>Start sharing this link to get subscriptions</i><br/><br/>\n<b>Participant list:</b><br/>\n{{ $('Config').item.json.sheet_url }}#gid={{ $('Create Stripe Product').item.json.created }}\n<br/><br/>\n<b>Zoom infos:</b><br/>\nLink: {{ $('Create Zoom meeting').item.json.join_url }}<br/>\nSession ID: {{ $('Create Zoom meeting').item.json.id }}<br/>\nPassword: {{ $('Create Zoom meeting').item.json.password }}<br/> ",
            "options": {},
            "subject": "=ðŸŽ‰ {{ $('Creation Form').item.json.title }} has been created!"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "DMcPDN0IHPwGmI7f",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "40f66f09-19c9-40eb-a9c4-138464ccd371",
          "name": "Create participant list",
          "type": "n8n-nodes-base.googleSheets",
          "position": [
            840,
            480
          ],
          "parameters": {
            "title": "={{ $('Creation Form').item.json.date_start }} - {{ $('Creation Form').item.json.title }} - {{ $('Create Stripe Product').item.json.created }}",
            "options": {
              "index": 0,
              "sheetId": "={{ $('Create Stripe Product').item.json.created }}"
            },
            "operation": "create",
            "documentId": {
              "__rl": true,
              "mode": "url",
              "value": "={{ $('Config').item.json.sheet_url }}"
            }
          },
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "RICzFHixgHXMuKmg",
              "name": "Google Sheets account"
            }
          },
          "typeVersion": 4.3,
          "alwaysOutputData": true
        },
        {
          "id": "67ff21d2-57b8-4ccd-91ee-a1bff1ea23b2",
          "name": "Add participant to list",
          "type": "n8n-nodes-base.googleSheets",
          "position": [
            400,
            800
          ],
          "parameters": {
            "columns": {
              "value": {},
              "schema": [
                {
                  "id": "city",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "city",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "email",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "email",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "name",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "name",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "country",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "country",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "postal_code",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "postal_code",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "amount",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "amount",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                },
                {
                  "id": "currency",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "currency",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                }
              ],
              "mappingMode": "autoMapInputData",
              "matchingColumns": []
            },
            "options": {},
            "operation": "append",
            "sheetName": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $('On payment').item.json.data.object.metadata.event_sheet_id }}"
            },
            "documentId": {
              "__rl": true,
              "mode": "url",
              "value": "={{ $('Config').item.json.sheet_url }}"
            }
          },
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "RICzFHixgHXMuKmg",
              "name": "Google Sheets account"
            }
          },
          "typeVersion": 4.3
        },
        {
          "id": "67e317ba-77d5-4f77-8fe2-d38e1a68c6f1",
          "name": "Send confirmation to participant",
          "type": "n8n-nodes-base.gmail",
          "position": [
            620,
            800
          ],
          "parameters": {
            "sendTo": "={{ $('On payment').item.json.data.object.customer_details.email }}",
            "message": "=Dear {{ $('On payment').item.json.data.object.customer_details.name }},<br/><br/>\n\nWe are very happy to announce that your subscription to our event <b>{{ $json.title }}</b> starting on <b>{{ $json.start }}</b> is now confirmed.<br/><br/>\n\nHere are the infos you will need to participate:<br/> \nZoom link:  {{ $('On payment').item.json.data.object.metadata.zoom_link }}<br/>\nZoom password:{{ $('On payment').item.json.data.object.metadata.zoom_password }}<br/>\nZoom ID: {{ $('On payment').item.json.data.object.metadata.zoom_id }}<br/><br/> \n\nLooking forward to see you there!<br/>\nKind regards<br/>",
            "options": {
              "appendAttribution": false
            },
            "subject": "Than you for your subscription ðŸ™"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "DMcPDN0IHPwGmI7f",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "ac5ca5f3-f9ca-494f-8e78-33dd663111ab",
          "name": "Notify teacher",
          "type": "n8n-nodes-base.gmail",
          "position": [
            840,
            800
          ],
          "parameters": {
            "sendTo": "={{ $('Config').item.json.teacher_email }}",
            "message": "=<b>A new participant registred for the event {{ $('Retrieve event infos').item.json.title }} ({{ $('Retrieve event infos').item.json.start }})!</b><br/><br/>\n\n<b>Name: {{ $('On payment').item.json.data.object.customer_details.name }}</b><br/>\n<b>Email: {{ $('On payment').item.json.data.object.customer_details.email }}</b><br/><br/>\n\n<b>Participant list:</b><br/>\n{{ $('Config').item.json.sheet_url }}#gid={{ $('On payment').item.json.data.object.metadata.event_sheet_id }} ",
            "options": {},
            "subject": "New participant registred â˜ï¸"
          },
          "credentials": {
            "gmailOAuth2": {
              "id": "DMcPDN0IHPwGmI7f",
              "name": "Gmail account"
            }
          },
          "typeVersion": 2.1
        },
        {
          "id": "33e5283f-3854-4ada-8412-858c205f1d1e",
          "name": "Create payment link",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            620,
            480
          ],
          "parameters": {
            "url": "https://api.stripe.com/v1/payment_links",
            "method": "POST",
            "options": {},
            "sendBody": true,
            "contentType": "form-urlencoded",
            "authentication": "predefinedCredentialType",
            "bodyParameters": {
              "parameters": [
                {
                  "name": "line_items[0][price]",
                  "value": "={{ $json.default_price }}"
                },
                {
                  "name": "line_items[0][quantity]",
                  "value": "1"
                },
                {
                  "name": "metadata[event_sheet_id]",
                  "value": "={{ $('Create Stripe Product').item.json.created }}"
                },
                {
                  "name": "metadata[zoom_link]",
                  "value": "={{ $('Create Zoom meeting').item.json.join_url }}"
                },
                {
                  "name": "metadata[zoom_password]",
                  "value": "={{ $('Create Zoom meeting').item.json.password }}"
                },
                {
                  "name": "metadata[zoom_id]",
                  "value": "={{ $('Create Zoom meeting').item.json.id }}"
                },
                {
                  "name": "metadata[title]",
                  "value": "={{ $('Creation Form').item.json.title }}"
                },
                {
                  "name": "metadata[start_time]",
                  "value": "={{ $('Create Zoom meeting').item.json.start_time }}"
                },
                {
                  "name": "metadata[price]",
                  "value": "={{ $('Creation Form').item.json.price }}"
                },
                {
                  "name": "metadata[currency]",
                  "value": "={{ $('Config').item.json.currency }}"
                }
              ]
            },
            "nodeCredentialType": "stripeApi"
          },
          "credentials": {
            "stripeApi": {
              "id": "qjose8z3RR7Xzm7b",
              "name": "Stripe Dev"
            }
          },
          "typeVersion": 4.1
        },
        {
          "id": "600c5382-bdac-4131-a784-399f5be2b54b",
          "name": "Format participant",
          "type": "n8n-nodes-base.set",
          "position": [
            180,
            800
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "dabd3bc2-ca92-4d99-a223-b0ad18945121",
                  "name": "email",
                  "type": "string",
                  "value": "={{ $('On payment').item.json.data.object.customer_details.email }}"
                },
                {
                  "id": "d40709f6-ffcd-4055-a374-9044a9a5e3b2",
                  "name": "name",
                  "type": "string",
                  "value": "={{ $('On payment').item.json.data.object.customer_details.name }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "c8a90ac5-14cd-4ff2-bd5b-c35724f085d1",
          "name": "Format event",
          "type": "n8n-nodes-base.set",
          "position": [
            840,
            280
          ],
          "parameters": {
            "options": {},
            "assignments": {
              "assignments": [
                {
                  "id": "a29943ba-b516-41a8-8f85-5bcee5eda0d1",
                  "name": "title",
                  "type": "string",
                  "value": "={{ $('Creation Form').item.json.title }}"
                },
                {
                  "id": "bf642fde-c4c2-42b4-beed-ef65efdab55b",
                  "name": "start",
                  "type": "string",
                  "value": "={{ $('Creation Form').item.json.date_start }}"
                },
                {
                  "id": "33f7a58e-624d-4ccc-bbea-ed3365cede20",
                  "name": "price",
                  "type": "number",
                  "value": "={{ $('Creation Form').item.json.price }}"
                },
                {
                  "id": "c948f71e-3b12-4c6a-a1f9-ee9a511fe262",
                  "name": "currency",
                  "type": "string",
                  "value": "={{ $('Config').item.json.currency }}"
                },
                {
                  "id": "887461ca-db0d-442e-8008-5fe6a6fbdd8f",
                  "name": "zoom_link",
                  "type": "string",
                  "value": "={{ $('Create Zoom meeting').item.json.join_url }}"
                },
                {
                  "id": "4b2bd5e2-3bd5-443a-94a3-9ababfd9d881",
                  "name": "zoom_id",
                  "type": "string",
                  "value": "={{ $('Create Zoom meeting').item.json.id }}"
                },
                {
                  "id": "a1cea8e2-9954-4143-b71f-5ea194a873dd",
                  "name": "zoom_password",
                  "type": "string",
                  "value": "={{ $('Create Zoom meeting').item.json.password }}"
                },
                {
                  "id": "faa52bc6-dfbe-49e2-bc95-dae198a61293",
                  "name": "payment_link",
                  "type": "string",
                  "value": "={{ $json.url }}"
                },
                {
                  "id": "d7f5f0f5-cc7b-436a-9ad1-0b8f410c62c6",
                  "name": "payment_id",
                  "type": "string",
                  "value": "={{ $json.id }}"
                },
                {
                  "id": "020b22d0-f525-4120-9f8b-2fa33e88c2e1",
                  "name": "event_sheet_id",
                  "type": "string",
                  "value": "={{ $json.metadata.event_sheet_id }}"
                }
              ]
            }
          },
          "typeVersion": 3.3
        },
        {
          "id": "def10b04-98c3-46cc-bdeb-9592c7466992",
          "name": "Store event",
          "type": "n8n-nodes-base.googleSheets",
          "position": [
            1040,
            280
          ],
          "parameters": {
            "columns": {
              "value": {},
              "schema": [],
              "mappingMode": "autoMapInputData",
              "matchingColumns": []
            },
            "options": {},
            "operation": "append",
            "sheetName": {
              "__rl": true,
              "mode": "id",
              "value": "0"
            },
            "documentId": {
              "__rl": true,
              "mode": "url",
              "value": "={{ $('Config').item.json.sheet_url }}"
            }
          },
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "RICzFHixgHXMuKmg",
              "name": "Google Sheets account"
            }
          },
          "typeVersion": 4.3,
          "alwaysOutputData": true
        },
        {
          "id": "594fc7a1-f299-49c4-a25b-07cf2ced16f7",
          "name": "Creation Form",
          "type": "n8n-nodes-base.formTrigger",
          "position": [
            -500,
            480
          ],
          "webhookId": "1c6fe52c-48ab-4688-b5ae-7e24361aa603",
          "parameters": {
            "path": "1c6fe52c-48ab-4688-b5ae-7e24361aa602",
            "options": {},
            "formTitle": "Create a new meeting",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "title",
                  "requiredField": true
                },
                {
                  "fieldType": "number",
                  "fieldLabel": "price",
                  "requiredField": true
                },
                {
                  "fieldType": "date",
                  "fieldLabel": "date_start",
                  "requiredField": true
                },
                {
                  "fieldType": "number",
                  "fieldLabel": "hour"
                },
                {
                  "fieldType": "number",
                  "fieldLabel": "minute"
                }
              ]
            },
            "responseMode": "lastNode",
            "formDescription": "This automates the creation of a Zoom Meeting and a Stripe Payment page, streamlining your event setup process."
          },
          "typeVersion": 2
        },
        {
          "id": "18fec11b-da39-4fe2-afab-d1585e3d9a99",
          "name": "On payment",
          "type": "n8n-nodes-base.stripeTrigger",
          "disabled": true,
          "position": [
            -500,
            780
          ],
          "webhookId": "ee7d6932-0583-47a3-b442-8bc161eee5e9",
          "parameters": {
            "events": [
              "checkout.session.completed"
            ]
          },
          "credentials": {
            "stripeApi": {
              "id": "qjose8z3RR7Xzm7b",
              "name": "Stripe Dev"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "1d95a7a5-7ddc-4338-9784-1d0554f39808",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -220,
            118
          ],
          "parameters": {
            "color": 6,
            "width": 275.01592825011585,
            "height": 468.76027109756643,
            "content": "# Setup\n### 1/ Add Your credentials\n[Zoom](https://docs.n8n.io/integrations/builtin/credentials/zoom/)\n[Google](https://docs.n8n.io/integrations/builtin/credentials/google/)\n[Stripe](https://docs.n8n.io/integrations/builtin/credentials/stripe/)\n\nNote: For Google, you need to add Gmail and Google Sheet.\n\n### 2/ Create a [new Google Sheet](https://sheets.new/).\nKeep this sheet blank for now; it contains your meeting and participant information. Place it wherever it fits best in your organization.\n\n### 3/ And fill the config node\n# ðŸ‘‡"
          },
          "typeVersion": 1
        },
        {
          "id": "58312523-1bee-4a56-9ab2-dc166fe30573",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -920,
            500
          ],
          "parameters": {
            "color": 6,
            "width": 372,
            "height": 200.14793114506386,
            "content": "# Create a meeting ðŸ‘‰ðŸ»\n\nYour journey to easy event management starts here.\n\nClick this node, copy the production URL, and keep it handy. It's your personal admin tool for quickly creating new meetings. Simple and efficient!"
          },
          "typeVersion": 1
        },
        {
          "id": "09153c6b-33cb-4fd1-8fa2-3513bca01f0c",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            620,
            660
          ],
          "parameters": {
            "color": 6,
            "width": 519.9859025074911,
            "height": 106.11515926602786,
            "content": "# ðŸ–‹ï¸ Customize\n### Feel free to adapt email contents to your needs."
          },
          "typeVersion": 1
        },
        {
          "id": "da13aadc-eb3c-4d99-8e2b-3e56a40d09f3",
          "name": "if is creation flow",
          "type": "n8n-nodes-base.if",
          "position": [
            -20,
            640
          ],
          "parameters": {
            "options": {
              "looseTypeValidation": true
            },
            "conditions": {
              "options": {
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "loose"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "40ddf809-1602-4120-ae7e-8be61437b50d",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  },
                  "leftValue": "={{ $(\"Creation Form\").isExecuted }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2
        },
        {
          "id": "ca62dd52-cb79-45c1-a26a-91ba4c16b6ed",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            180,
            340
          ],
          "parameters": {
            "color": 7,
            "width": 202.64787116404852,
            "height": 85.79488430601403,
            "content": "### Crafted by the\n## [ðŸ¥· n8n.ninja](https://n8n.ninja)"
          },
          "typeVersion": 1
        },
        {
          "id": "aebdc1b5-ccf7-4299-a8ec-10eb448c4d72",
          "name": "the end",
          "type": "n8n-nodes-base.noOp",
          "position": [
            1040,
            800
          ],
          "parameters": {},
          "typeVersion": 1
        }
      ],
      "active": true,
      "pinData": {
        "On payment": [
          {
            "json": {
              "id": "evt_1Ou0e4BH8XCwzsfXEKVN0GkI",
              "data": {
                "object": {
                  "id": "cs_test_a1G73c0pSu8hnD8y4we2ZVGy3MdmDuam1jLT07DqcBgYkuH1vOpWSkclBr",
                  "url": null,
                  "mode": "payment",
                  "locale": "auto",
                  "object": "checkout.session",
                  "status": "complete",
                  "consent": null,
                  "created": 1710370285,
                  "invoice": null,
                  "ui_mode": "hosted",
                  "currency": "eur",
                  "customer": null,
                  "livemode": false,
                  "metadata": {
                    "zoom_id": "86579738722",
                    "zoom_link": "https://us06web.zoom.us/j/86579738722?pwd=i8QeOxKGO8GODInTP3gsYUjvrCYarA.1",
                    "zoom_password": "260j",
                    "event_sheet_id": "1710369993"
                  },
                  "shipping": null,
                  "cancel_url": "https://stripe.com",
                  "expires_at": 1710456685,
                  "custom_text": {
                    "submit": null,
                    "after_submit": null,
                    "shipping_address": null,
                    "terms_of_service_acceptance": null
                  },
                  "submit_type": "auto",
                  "success_url": "https://stripe.com",
                  "amount_total": 2000,
                  "payment_link": "plink_1Ou0ZCBH8XCwzsfXUongWL67",
                  "setup_intent": null,
                  "subscription": null,
                  "automatic_tax": {
                    "status": null,
                    "enabled": false,
                    "liability": null
                  },
                  "client_secret": null,
                  "custom_fields": [],
                  "shipping_rate": null,
                  "total_details": {
                    "amount_tax": 0,
                    "amount_discount": 0,
                    "amount_shipping": 0
                  },
                  "customer_email": null,
                  "payment_intent": "pi_3Ou0e2BH8XCwzsfX14Vi1Pak",
                  "payment_status": "paid",
                  "recovered_from": null,
                  "amount_subtotal": 2000,
                  "after_expiration": null,
                  "customer_details": {
                    "name": "Emmanuel Bern",
                    "email": "emm.bernard@gmail.com",
                    "phone": null,
                    "address": {
                      "city": "Lausanne",
                      "line1": "Avenue Charles Dickens 10",
                      "line2": null,
                      "state": null,
                      "country": "CH",
                      "postal_code": "1006"
                    },
                    "tax_ids": [],
                    "tax_exempt": "none"
                  },
                  "invoice_creation": {
                    "enabled": false,
                    "invoice_data": {
                      "footer": null,
                      "issuer": null,
                      "metadata": {},
                      "description": null,
                      "custom_fields": null,
                      "account_tax_ids": null,
                      "rendering_options": null
                    }
                  },
                  "shipping_options": [],
                  "customer_creation": "if_required",
                  "consent_collection": null,
                  "client_reference_id": null,
                  "currency_conversion": null,
                  "payment_method_types": [
                    "card",
                    "bancontact",
                    "eps",
                    "giropay",
                    "ideal",
                    "link",
                    "klarna"
                  ],
                  "allow_promotion_codes": false,
                  "payment_method_options": {
                    "card": {
                      "request_three_d_secure": "automatic"
                    }
                  },
                  "phone_number_collection": {
                    "enabled": false
                  },
                  "payment_method_collection": "always",
                  "billing_address_collection": "auto",
                  "shipping_address_collection": null,
                  "payment_method_configuration_details": {
                    "id": "pmc_1Om7TPBH8XCwzsfXBB30jrJh",
                    "parent": null
                  }
                }
              },
              "type": "checkout.session.completed",
              "object": "event",
              "created": 1710370296,
              "request": {
                "id": null,
                "idempotency_key": null
              },
              "livemode": false,
              "api_version": "2020-08-27",
              "pending_webhooks": 4
            }
          }
        ]
      },
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "9e350a8f-30e0-43ab-8dab-a7edbfd637d8",
      "connections": {
        "Config": {
          "main": [
            [
              {
                "node": "if is creation flow",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On payment": {
          "main": [
            [
              {
                "node": "Config",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Format event": {
          "main": [
            [
              {
                "node": "Store event",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Creation Form": {
          "main": [
            [
              {
                "node": "Config",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Notify teacher": {
          "main": [
            [
              {
                "node": "the end",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Format participant": {
          "main": [
            [
              {
                "node": "Add participant to list",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Zoom meeting": {
          "main": [
            [
              {
                "node": "Create Stripe Product",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create payment link": {
          "main": [
            [
              {
                "node": "Create participant list",
                "type": "main",
                "index": 0
              },
              {
                "node": "Format event",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "if is creation flow": {
          "main": [
            [
              {
                "node": "Create Zoom meeting",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Format participant",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create Stripe Product": {
          "main": [
            [
              {
                "node": "Create payment link",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add participant to list": {
          "main": [
            [
              {
                "node": "Send confirmation to participant",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create participant list": {
          "main": [
            [
              {
                "node": "Send email to teacher",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Send confirmation to participant": {
          "main": [
            [
              {
                "node": "Notify teacher",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "stripe-quickbooks-sync",
    "title": "Stripe â†’ QuickBooks Invoice Sync",
    "description": "Listens to Stripe events, looks up QuickBooks customers, and posts invoices/charges to accounting automatically.",
    "problem": "Finance teams need Stripe transactions reflected in QuickBooks without exporting CSVs.",
    "tags": [
      "stripe",
      "quickbooks",
      "accounting"
    ],
    "metadata": {
      "industries": [
        "finance"
      ],
      "domains": [
        "accounting"
      ],
      "channels": [
        "quickbooks"
      ],
      "trigger": "webhook",
      "complexity": "medium",
      "integrations": [
        "Stripe",
        "QuickBooks"
      ]
    },
    "workflow": {
      "meta": {
        "instanceId": "6f3fb2495ae05d668c93cbf9e1649128d6e08178f8a900941cf97e588f18fdfc",
        "templateCredsSetupCompleted": true
      },
      "nodes": [
        {
          "id": "7fe02521-c46a-4314-9387-b7b4983fa859",
          "name": "POST Sales Receipt",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1320,
            -120
          ],
          "parameters": {
            "url": "https://sandbox-quickbooks.api.intuit.com/v3/company/9341453851324714/salesreceipt?minorversion=73",
            "method": "POST",
            "options": {},
            "jsonBody": "={\n  \"Line\": [\n    {\n      \"Description\": \"{{ $json.data.object.description }}\",\n      \"DetailType\": \"SalesItemLineDetail\",\n      \"SalesItemLineDetail\": {\n        \"TaxCodeRef\": {\n          \"value\": \"NON\"\n        },\n        \"Qty\": 1,\n        \"UnitPrice\": {{ $json.data.object.amount_received / 100 }},\n        \"ItemRef\": {\n          \"name\": \"Subscription\", \n          \"value\": \"10\"\n        }\n      },\n      \"Amount\": {{ $json.data.object.amount / 100 }},\n      \"LineNum\": 1\n    }\n  ],\n  \"CustomerRef\": {\n    \"value\": {{ $input.all()[2].json.QueryResponse.Customer[0].BillAddr.Id }},\n    \"name\": \"{{ $input.all()[2].json.QueryResponse.Customer[0].DisplayName }}\"\n  },\n  \"CurrencyRef\": {\n    \"value\": \"{{ $json.data.object.currency.toUpperCase() }}\"\n  },\n  \"PrivateNote\": \"Payment from Stripe Payment Intent ID: {{ $json.data.object.id }}\"\n}",
            "sendBody": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "quickBooksOAuth2Api"
          },
          "credentials": {
            "quickBooksOAuth2Api": {
              "id": "IUNAfwwSgnbwWygB",
              "name": "QuickBooks Online account"
            }
          },
          "executeOnce": true,
          "typeVersion": 4.2
        },
        {
          "id": "5ed429d7-c93d-48c8-b603-ca8d7efb57ed",
          "name": "GET Quickbooks Customer",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            400,
            -20
          ],
          "parameters": {
            "url": "=https://sandbox-quickbooks.api.intuit.com/v3/company/9341453851324714/query?query=select * from Customer Where PrimaryEmailAddr = '{{ $json.email }}'&minorversion=73\n\n",
            "options": {},
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "quickBooksOAuth2Api"
          },
          "credentials": {
            "httpCustomAuth": {
              "id": "hqXGCVkt6W41KDDK",
              "name": "Custom Auth account"
            },
            "quickBooksOAuth2Api": {
              "id": "IUNAfwwSgnbwWygB",
              "name": "QuickBooks Online account"
            }
          },
          "typeVersion": 4.2
        },
        {
          "id": "bef5b4c3-4948-4294-bd80-7039342edf0d",
          "name": "Get Stripe Customer",
          "type": "n8n-nodes-base.stripe",
          "position": [
            240,
            -140
          ],
          "parameters": {
            "resource": "customer",
            "customerId": "={{ $json.data.object.customer }}"
          },
          "credentials": {
            "stripeApi": {
              "id": "o6KHVZiU8S7O38wq",
              "name": "Stripe account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "042fff2c-b5e7-4877-b935-f6a707118c4a",
          "name": "New Payment",
          "type": "n8n-nodes-base.stripeTrigger",
          "position": [
            80,
            -260
          ],
          "webhookId": "5cc15770-f762-4389-8372-1b2926de4570",
          "parameters": {
            "events": [
              "payment_intent.succeeded"
            ]
          },
          "credentials": {
            "stripeApi": {
              "id": "o6KHVZiU8S7O38wq",
              "name": "Stripe account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "12235c25-712b-4e84-b744-60573e00d381",
          "name": "If Customer Exists",
          "type": "n8n-nodes-base.if",
          "position": [
            560,
            100
          ],
          "parameters": {
            "options": {},
            "conditions": {
              "options": {
                "version": 2,
                "leftValue": "",
                "caseSensitive": true,
                "typeValidation": "strict"
              },
              "combinator": "and",
              "conditions": [
                {
                  "id": "aef7393c-c4ff-4196-887d-6a9b057381f8",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  },
                  "leftValue": "={{ $json.QueryResponse.Customer[0].PrimaryEmailAddr.Address }}",
                  "rightValue": ""
                }
              ]
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "68f63246-cb95-494f-918c-c0c6da5a64f9",
          "name": "Use Stripe Customer",
          "type": "n8n-nodes-base.merge",
          "position": [
            880,
            120
          ],
          "parameters": {},
          "executeOnce": true,
          "typeVersion": 3
        },
        {
          "id": "e9eea332-7109-479f-8f50-65b3b9438e0e",
          "name": "Create QuickBooks Customer",
          "type": "n8n-nodes-base.quickbooks",
          "position": [
            1100,
            120
          ],
          "parameters": {
            "operation": "create",
            "displayName": "={{ $input.all()[0].json.name }}",
            "additionalFields": {
              "Balance": "={{ $input.all()[0].json.balance }}",
              "PrimaryEmailAddr": "={{ $input.all()[0].json.email }}"
            }
          },
          "credentials": {
            "quickBooksOAuth2Api": {
              "id": "IUNAfwwSgnbwWygB",
              "name": "QuickBooks Online account"
            }
          },
          "executeOnce": true,
          "typeVersion": 1
        },
        {
          "id": "f805f03d-93b7-4e3b-8b6a-37d9dd802368",
          "name": "Merge Stripe and QuickBooks Data",
          "type": "n8n-nodes-base.merge",
          "position": [
            1100,
            -120
          ],
          "parameters": {
            "numberInputs": 3
          },
          "typeVersion": 3
        },
        {
          "id": "b9c31838-2bb7-4882-bd15-c096cb97e225",
          "name": "Merge Payment and QuickBooks Customer",
          "type": "n8n-nodes-base.merge",
          "position": [
            1320,
            120
          ],
          "parameters": {},
          "executeOnce": true,
          "typeVersion": 3
        },
        {
          "id": "cb69fcee-8d5d-47ab-be76-9e25cb0a7f42",
          "name": "POST Sales Receipt To QuickBooks",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            1540,
            120
          ],
          "parameters": {
            "url": "https://sandbox-quickbooks.api.intuit.com/v3/company/9341453851324714/salesreceipt?minorversion=73",
            "method": "POST",
            "options": {},
            "jsonBody": "={\n  \"Line\": [\n    {\n      \"Description\": \"{{ $json.data.object.description }}\",\n      \"DetailType\": \"SalesItemLineDetail\",\n      \"SalesItemLineDetail\": {\n        \"TaxCodeRef\": {\n          \"value\": \"NON\"\n        },\n        \"Qty\": 1,\n        \"UnitPrice\": {{ $json.data.object.amount_received / 100 }},\n        \"ItemRef\": {\n          \"name\": \"Subscription\", \n          \"value\": \"10\"\n        }\n      },\n      \"Amount\": {{ $json.data.object.amount / 100 }},\n      \"LineNum\": 1\n    }\n  ],\n  \"CustomerRef\": {\n    \"value\": {{ $input.all()[1].json.Id}},\n    \"name\": \"{{ $input.all()[1].json.DisplayName }}\"\n  },\n  \"CurrencyRef\": {\n    \"value\": \"{{ $json.data.object.currency.toUpperCase() }}\"\n  },\n  \"PrivateNote\": \"Payment from Stripe Payment Intent ID: {{ $json.data.object.id }}\"\n}",
            "sendBody": true,
            "specifyBody": "json",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "quickBooksOAuth2Api"
          },
          "credentials": {
            "quickBooksOAuth2Api": {
              "id": "IUNAfwwSgnbwWygB",
              "name": "QuickBooks Online account"
            }
          },
          "executeOnce": true,
          "typeVersion": 4.2
        }
      ],
      "pinData": {
        "New Payment": [
          {
            "id": "evt_3Qjf7fJJNVDH5POn01Am9Q1x",
            "data": {
              "object": {
                "id": "pi_3Qjf54D14htxZ8341jkWWJJs",
                "amount": 9500,
                "object": "payment_intent",
                "review": null,
                "source": null,
                "status": "succeeded",
                "created": 1737456794,
                "invoice": "in_1Qje8QD14htxZ834S3Gh3Nn6",
                "currency": "usd",
                "customer": "cus_R4OkhTTT1ebzPl",
                "livemode": false,
                "metadata": {},
                "shipping": null,
                "processing": null,
                "application": null,
                "canceled_at": null,
                "description": "Subscription update",
                "next_action": null,
                "on_behalf_of": null,
                "client_secret": "pi_3Qjf54D14htxZ8341jkWWJJs_secret_FXltcZHFUDM8I4F0AQjRPE9Vz",
                "latest_charge": "ch_3Qjf54D14htxZ8341xwQhggm",
                "receipt_email": null,
                "transfer_data": null,
                "amount_details": {
                  "tip": {}
                },
                "capture_method": "automatic",
                "payment_method": "pm_1Qh6nED14htxZ834bTgSzUQy",
                "transfer_group": null,
                "amount_received": 9500,
                "amount_capturable": 0,
                "last_payment_error": null,
                "setup_future_usage": null,
                "cancellation_reason": null,
                "confirmation_method": "automatic",
                "payment_method_types": [
                  "amazon_pay",
                  "card",
                  "cashapp",
                  "link"
                ],
                "statement_descriptor": null,
                "application_fee_amount": null,
                "payment_method_options": {
                  "card": {
                    "network": null,
                    "installments": null,
                    "mandate_options": null,
                    "request_three_d_secure": "automatic"
                  },
                  "link": {
                    "persistent_token": null
                  },
                  "cashapp": {},
                  "amazon_pay": {
                    "express_checkout_element_session_id": null
                  }
                },
                "automatic_payment_methods": null,
                "statement_descriptor_suffix": null,
                "payment_method_configuration_details": null
              }
            },
            "type": "payment_intent.succeeded",
            "object": "event",
            "created": 1737456956,
            "request": {
              "id": "req_vbXfG1vUORKZJ6",
              "idempotency_key": "e63d5e07-f753-429c-bd06-c642e23d9ff8"
            },
            "livemode": false,
            "api_version": "2020-08-27",
            "pending_webhooks": 3
          }
        ],
        "Get Stripe Customer": [
          {
            "id": "cus_R4OkhTTT1ebzPl",
            "name": "Test Usershvili",
            "email": "Birds@Intuit.com",
            "phone": null,
            "object": "customer",
            "address": {
              "city": null,
              "line1": null,
              "line2": null,
              "state": null,
              "country": "GE",
              "postal_code": null
            },
            "balance": 0,
            "created": 1729495354,
            "currency": "usd",
            "discount": null,
            "livemode": false,
            "metadata": {},
            "shipping": null,
            "delinquent": false,
            "tax_exempt": "none",
            "test_clock": null,
            "description": null,
            "default_source": null,
            "invoice_prefix": "F73B0901",
            "default_currency": "usd",
            "invoice_settings": {
              "footer": null,
              "custom_fields": null,
              "rendering_options": null,
              "default_payment_method": null
            },
            "preferred_locales": [
              "en-GB"
            ]
          }
        ]
      },
      "connections": {
        "New Payment": {
          "main": [
            [
              {
                "node": "Get Stripe Customer",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge Stripe and QuickBooks Data",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge Payment and QuickBooks Customer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If Customer Exists": {
          "main": [
            [
              {
                "node": "Merge Stripe and QuickBooks Data",
                "type": "main",
                "index": 2
              }
            ],
            [
              {
                "node": "Use Stripe Customer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "POST Sales Receipt": {
          "main": [
            []
          ]
        },
        "Get Stripe Customer": {
          "main": [
            [
              {
                "node": "GET Quickbooks Customer",
                "type": "main",
                "index": 0
              },
              {
                "node": "Use Stripe Customer",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Use Stripe Customer": {
          "main": [
            [
              {
                "node": "Create QuickBooks Customer",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "GET Quickbooks Customer": {
          "main": [
            [
              {
                "node": "If Customer Exists",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge Stripe and QuickBooks Data",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Create QuickBooks Customer": {
          "main": [
            [
              {
                "node": "Merge Payment and QuickBooks Customer",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge Stripe and QuickBooks Data": {
          "main": [
            [
              {
                "node": "POST Sales Receipt",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge Payment and QuickBooks Customer": {
          "main": [
            [
              {
                "node": "POST Sales Receipt To QuickBooks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  },
  {
    "id": "pipedrive-billing-handoff",
    "title": "Pipedrive + Stripe Deal Billing",
    "description": "Scheduled workflow that inspects Pipedrive deals, builds Stripe charges, and syncs results via Function & ItemList nodes.",
    "problem": "Sales ops need closed deals to trigger billing automatically so finance isnâ€™t chasing spreadsheets.",
    "tags": [
      "pipedrive",
      "stripe",
      "sales-ops"
    ],
    "metadata": {
      "industries": [
        "sales",
        "finance"
      ],
      "domains": [
        "billing"
      ],
      "channels": [
        "pipedrive",
        "stripe"
      ],
      "trigger": "scheduled",
      "complexity": "medium",
      "integrations": [
        "Pipedrive",
        "Stripe",
        "FunctionItem"
      ]
    },
    "workflow": {
      "meta": {
        "instanceId": "8c8c5237b8e37b006a7adce87f4369350c58e41f3ca9de16196d3197f69eabcd"
      },
      "nodes": [
        {
          "id": "28349bfd-f68e-4479-9508-28d408033d09",
          "name": "Get customers",
          "type": "n8n-nodes-base.stripe",
          "position": [
            5360,
            1100
          ],
          "parameters": {
            "filters": {},
            "resource": "customer",
            "operation": "getAll",
            "returnAll": true
          },
          "credentials": {
            "stripeApi": {
              "id": "26",
              "name": "Stripe account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "3f3d2389-e9ab-4140-8b04-f0a07003cecc",
          "name": "Rename fields and keep only needed fields",
          "type": "n8n-nodes-base.set",
          "position": [
            5560,
            1100
          ],
          "parameters": {
            "values": {
              "string": [
                {
                  "name": "customerName",
                  "value": "={{ $json[\"name\"] }}"
                },
                {
                  "name": "customerId",
                  "value": "={{ $json[\"id\"] }}"
                }
              ]
            },
            "options": {},
            "keepOnlySet": true
          },
          "typeVersion": 1
        },
        {
          "id": "d6d3ccff-f565-49c9-9cda-8e278d298433",
          "name": "Add customer name to charge data",
          "type": "n8n-nodes-base.merge",
          "position": [
            5860,
            920
          ],
          "parameters": {
            "mode": "mergeByKey",
            "propertyName1": "customer",
            "propertyName2": "customerId"
          },
          "typeVersion": 1
        },
        {
          "id": "eadce8e7-f523-485b-8cc0-5a336c8633ef",
          "name": "Search organisation",
          "type": "n8n-nodes-base.pipedrive",
          "position": [
            6140,
            1060
          ],
          "parameters": {
            "term": "={{ $json[\"customerName\"] }}",
            "resource": "organization",
            "operation": "search",
            "additionalFields": {}
          },
          "credentials": {
            "pipedriveApi": {
              "id": "96",
              "name": "Pipedrive account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "dde08b48-21b0-44af-a66d-ff69399608e7",
          "name": "Add organisation Information to charge data",
          "type": "n8n-nodes-base.merge",
          "position": [
            6400,
            940
          ],
          "parameters": {
            "join": "inner",
            "mode": "mergeByIndex"
          },
          "typeVersion": 1
        },
        {
          "id": "6cbd0f06-0f10-4360-8c5c-e181679ba370",
          "name": "Create note with charge information",
          "type": "n8n-nodes-base.pipedrive",
          "position": [
            6620,
            940
          ],
          "parameters": {
            "content": "={{ $json[\"description\"] }}: {{ $json[\"amount\"] / 100 }} {{ $json[\"currency\"] }}",
            "resource": "note",
            "additionalFields": {
              "org_id": "={{ $json[\"id\"] }}"
            }
          },
          "credentials": {
            "pipedriveApi": {
              "id": "96",
              "name": "Pipedrive account"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "c6ed5a89-b50a-40ad-bd78-62ffc2430fde",
          "name": "Get last execution timestamp",
          "type": "n8n-nodes-base.functionItem",
          "position": [
            5140,
            900
          ],
          "parameters": {
            "functionCode": "// Code here will run once per input item.\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\n\n// Add a new field called 'myNewField' to the JSON of the item\nconst staticData = getWorkflowStaticData('global');\n\nif(!staticData.lastExecution){\n  staticData.lastExecution = Math.round( new Date().getTime() / 1000 );\n}\n\nitem.executionTimeStamp = Math.round( new Date().getTime() / 1000 );\nitem.lastExecution = staticData.lastExecution;\n\n\nreturn item;"
          },
          "typeVersion": 1
        },
        {
          "id": "41b2c937-d479-4402-b428-29faabe32845",
          "name": "Set new last execution timestamp",
          "type": "n8n-nodes-base.functionItem",
          "position": [
            6820,
            940
          ],
          "parameters": {
            "functionCode": "// Code here will run once per input item.\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\n\n// Add a new field called 'myNewField' to the JSON of the item\nconst staticData = getWorkflowStaticData('global');\n\nstaticData.lastExecution = $item(0).$node[\"Get last execution timestamp\"].executionTimeStamp;\n\nreturn item;"
          },
          "executeOnce": true,
          "typeVersion": 1
        },
        {
          "id": "56612271-08c4-4347-92b1-b898c68c3460",
          "name": "Split array of charges to items",
          "type": "n8n-nodes-base.itemLists",
          "position": [
            5560,
            900
          ],
          "parameters": {
            "options": {},
            "fieldToSplitOut": "data"
          },
          "typeVersion": 1
        },
        {
          "id": "b866ba46-6269-4c8d-8021-ea99591d676d",
          "name": "Search for charges in Stripe",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            5360,
            900
          ],
          "parameters": {
            "url": "https://api.stripe.com/v1/charges/search",
            "options": {},
            "authentication": "predefinedCredentialType",
            "queryParametersUi": {
              "parameter": [
                {
                  "name": "query",
                  "value": "=created>{{$json[\"lastExecution\"]}} AND status:\"succeeded\""
                }
              ]
            },
            "nodeCredentialType": "stripeApi"
          },
          "credentials": {
            "stripeApi": {
              "id": "26",
              "name": "Stripe account"
            }
          },
          "typeVersion": 2
        },
        {
          "id": "a3249f70-1cd4-4d5f-8f27-15badcf10296",
          "name": "Every day at 8 am",
          "type": "n8n-nodes-base.cron",
          "position": [
            4920,
            900
          ],
          "parameters": {
            "triggerTimes": {
              "item": [
                {
                  "hour": 8
                }
              ]
            }
          },
          "typeVersion": 1
        }
      ],
      "connections": {
        "Get customers": {
          "main": [
            [
              {
                "node": "Rename fields and keep only needed fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Every day at 8 am": {
          "main": [
            [
              {
                "node": "Get last execution timestamp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Search organisation": {
          "main": [
            [
              {
                "node": "Add organisation Information to charge data",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Get last execution timestamp": {
          "main": [
            [
              {
                "node": "Search for charges in Stripe",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Search for charges in Stripe": {
          "main": [
            [
              {
                "node": "Split array of charges to items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split array of charges to items": {
          "main": [
            [
              {
                "node": "Add customer name to charge data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Add customer name to charge data": {
          "main": [
            [
              {
                "node": "Search organisation",
                "type": "main",
                "index": 0
              },
              {
                "node": "Add organisation Information to charge data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create note with charge information": {
          "main": [
            [
              {
                "node": "Set new last execution timestamp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Rename fields and keep only needed fields": {
          "main": [
            [
              {
                "node": "Add customer name to charge data",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Add organisation Information to charge data": {
          "main": [
            [
              {
                "node": "Create note with charge information",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    }
  }
]